Enter your prompt here

# Project Structure

â”œâ”€ ðŸ“ css
  â””â”€ style.css
  â””â”€ editor.css
â”œâ”€ ðŸ“ js
  â””â”€ utils.js
  â””â”€ sfx.js
  â””â”€ pirateShared.js
  â””â”€ pirate.js
  â””â”€ main.js
  â””â”€ inventory.js
  â””â”€ introCutscene.js
  â””â”€ input.js
  â””â”€ game.js
  â””â”€ editor.js
  â””â”€ constants.js
â”œâ”€ ðŸ“ levels
  â””â”€ level2.json
  â””â”€ level1.json
  â””â”€ debug.json
  â””â”€ level3.json
  â””â”€ level4.json
â”œâ”€ ðŸ“ vendor
  â”œâ”€ ðŸ“ three
    â”œâ”€ ðŸ“ examples
      â”œâ”€ ðŸ“ jsm
        â”œâ”€ ðŸ“ utils
          â””â”€ BufferGeometryUtils.js
        â”œâ”€ ðŸ“ loaders
          â””â”€ GLTFLoader.js
â””â”€ editor.html
â””â”€ package.json
â””â”€ index.html


# Project Files

- package.json
- css\style.css
- css\editor.css
- js\utils.js
- js\sfx.js
- js\pirateShared.js
- js\pirate.js
- js\main.js
- js\inventory.js
- js\introCutscene.js
- js\input.js
- js\game.js
- js\editor.js
- js\constants.js
- index.html
- editor.html
- levels\level2.json
- levels\level1.json
- levels\debug.json
- levels\level3.json
- levels\level4.json
- vendor\three\examples\jsm\utils\BufferGeometryUtils.js
- vendor\three\examples\jsm\loaders\GLTFLoader.js

## package.json
```
{
  "name": "space-jam",
  "version": "1.0.0",
  "scripts": {
    "start": "npx --yes serve -l 3000"
  }
}

```

## css\style.css
```
* {
  margin: 0;
  padding: 0;
}

:root {
  --game-width: 1200px;
  --game-height: 900px;
  --slot-bg: #222;
  --slot-border: #555;
}

body {
  display: flex;
  justify-content: center;
  align-items: center;
  min-height: 100vh;
  background: #1a1a1a;
  font-family: 'Oxanium', Arial, sans-serif;
}

button,
input,
select,
textarea {
  font: inherit;
}

#game-container {
  position: relative;
  box-shadow: 0 0 20px rgba(0, 0, 0, 0.5);
}

#game-canvas {
  display: block;
  background: #111;
  /* Fixed pixel size - prevents 4K from scaling canvas and tanking performance */
  width: var(--game-width);
  height: var(--game-height);
  cursor: none;
}

#ship-canvas {
  position: absolute;
  left: 0;
  top: 0;
  width: var(--game-width);
  height: var(--game-height);
  pointer-events: none;
  z-index: 2;
}

#ui-canvas {
  position: absolute;
  left: 0;
  top: 0;
  width: var(--game-width);
  height: var(--game-height);
  pointer-events: none;
  /* Above shop/warp blur overlays; below hotbar/drop zones */
  z-index: 14;
}

#game-ui {
  position: absolute;
  top: 10px;
  left: 10px;
  display: flex;
  gap: 15px;
  font-family: 'Oxanium', Arial, sans-serif;
  font-size: 12px;
}

#game-ui a {
  color: #6af;
  text-decoration: none;
}

#game-ui a:hover {
  text-decoration: underline;
}

#game-ui span {
  color: #666;
}

#game-ui label {
  color: #ccc;
  display: flex;
  align-items: center;
  gap: 6px;
}

#game-ui select {
  background: #333;
  color: #fff;
  border: 1px solid #555;
  padding: 2px 6px;
  font-size: 12px;
}

#start-menu-overlay {
  position: absolute;
  left: 0;
  top: 0;
  width: var(--game-width);
  height: var(--game-height);
  display: flex;
  align-items: center;
  justify-content: center;
  background: rgba(0, 0, 0, 0.45);
  backdrop-filter: grayscale(1) blur(2px);
  -webkit-backdrop-filter: grayscale(1) blur(2px);
  z-index: 20;
  pointer-events: auto;
  cursor: pointer;
  box-sizing: border-box;
}

#start-menu {
  background: rgba(20, 20, 20, 0.9);
  border: 1px solid #777;
  border-radius: 10px;
  padding: 18px 22px;
  text-align: center;
}

#start-menu .start-title {
  color: #fff;
  font-family: 'Oxanium', Arial, sans-serif;
  font-size: 20px;
  letter-spacing: 0.5px;
}

/* â”€â”€ Main Menu â”€â”€ */
#main-menu-overlay {
  position: absolute;
  left: 0;
  top: 0;
  width: var(--game-width);
  height: var(--game-height);
  display: flex;
  align-items: center;
  justify-content: center;
  background: rgba(0, 0, 0, 0.6);
  z-index: 30;
  pointer-events: auto;
  box-sizing: border-box;
}

#main-menu {
  background: rgba(20, 20, 20, 0.95);
  border: 1px solid #555;
  border-radius: 10px;
  padding: 32px 40px;
  text-align: center;
  display: flex;
  flex-direction: column;
  align-items: center;
  gap: 20px;
}

#main-menu .main-menu-title {
  color: #fff;
  font-family: 'Oxanium', Arial, sans-serif;
  font-size: 28px;
  font-weight: 600;
  letter-spacing: 1px;
  margin: 0;
}

#main-menu-start-btn {
  background: #444;
  color: #fff;
  border: 1px solid #666;
  border-radius: 6px;
  padding: 12px 28px;
  font-family: 'Oxanium', Arial, sans-serif;
  font-size: 16px;
  cursor: pointer;
}

#main-menu-start-btn:hover {
  background: #555;
  border-color: #777;
}

/* â”€â”€ Intro Cutscene â”€â”€ */
#intro-cutscene-overlay {
  position: absolute;
  left: 0;
  top: 0;
  width: var(--game-width);
  height: var(--game-height);
  z-index: 25;
  display: flex;
  flex-direction: column;
  background: #050510;
  overflow: hidden;
  box-sizing: border-box;
  transform-origin: center center;
  will-change: opacity, transform;
}

#intro-cutscene-overlay.fade-out {
  animation: cutsceneFadeOut 1.2s ease-in forwards;
}

@keyframes cutsceneFadeOut {
  0%   { opacity: 1; }
  100% { opacity: 0; }
}

#intro-dialogue-box {
  position: relative;
  z-index: 2;
  flex-shrink: 0;
  height: 115px;
  padding: 8px 20px 8px;
  box-sizing: border-box;
  background: rgba(5, 10, 18, 0.92);
  border-bottom: 1px solid rgba(0, 255, 140, 0.25);
  box-shadow: 0 2px 20px rgba(0, 255, 140, 0.06);
  font-family: 'Oxanium', Arial, sans-serif;
  display: flex;
  flex-direction: column;
  gap: 2px;
}

#intro-dialogue-header {
  font-size: 10px;
  color: rgba(0, 255, 140, 0.35);
  letter-spacing: 2px;
  text-transform: uppercase;
  margin-bottom: 2px;
}

#intro-dialogue-text {
  font-size: 15px;
  color: #00ff8c;
  line-height: 1.35;
  white-space: pre-wrap;
  text-shadow: 0 0 6px rgba(0, 255, 140, 0.4);
  overflow-y: auto;
  padding-right: 4px;
}

#intro-dialogue-text .cursor-blink {
  display: inline-block;
  width: 8px;
  height: 15px;
  background: #00ff8c;
  vertical-align: text-bottom;
  animation: cursorBlink 0.6s step-end infinite;
}

@keyframes cursorBlink {
  0%, 100% { opacity: 1; }
  50%      { opacity: 0; }
}

#intro-map-canvas {
  flex: 1;
  width: 100%;
  display: block;
}

#intro-skip-hint {
  position: absolute;
  bottom: 12px;
  right: 16px;
  font-family: 'Oxanium', Arial, sans-serif;
  font-size: 11px;
  color: rgba(255, 255, 255, 0.3);
  z-index: 3;
  pointer-events: none;
  letter-spacing: 0.5px;
}

#death-menu-overlay {
  position: absolute;
  left: 0;
  top: 0;
  width: var(--game-width);
  height: var(--game-height);
  display: flex;
  align-items: center;
  justify-content: center;
  background: rgba(0, 0, 0, 0.55);
  backdrop-filter: grayscale(1) blur(2px);
  -webkit-backdrop-filter: grayscale(1) blur(2px);
  z-index: 30;
  pointer-events: auto;
  box-sizing: border-box;
}

#death-menu {
  background: rgba(20, 20, 20, 0.92);
  border: 1px solid #777;
  border-radius: 10px;
  padding: 22px 26px;
  text-align: center;
  min-width: 260px;
  display: flex;
  flex-direction: column;
  gap: 12px;
}

#death-menu .death-title {
  color: #fff;
  font-size: 24px;
  letter-spacing: 0.5px;
  font-weight: 600;
}

#death-menu .death-subtitle {
  color: #ccc;
  font-size: 14px;
}

#death-menu button {
  padding: 10px 16px;
  border-radius: 8px;
  background: #2f2f2f;
  border: 1px solid #666;
  color: #eee;
  cursor: pointer;
}

#death-menu button:hover {
  background: #444;
}

#warp-menu-overlay {
  position: absolute;
  left: 0;
  top: 0;
  width: var(--game-width);
  height: var(--game-height);
  background: rgba(0, 0, 0, 0.6);
  display: flex;
  align-items: center;
  justify-content: center;
  z-index: 10;
}

#warp-menu {
  background: #2a2a2a;
  padding: 24px;
  border-radius: 8px;
  min-width: 200px;
  display: flex;
  flex-direction: column;
  align-items: center;
  gap: 12px;
  border: 1px solid #555;
}

#warp-menu p {
  margin: 0;
  color: #eee;
  font-family: 'Oxanium', Arial, sans-serif;
  font-size: 14px;
}

#warp-menu button {
  padding: 8px 16px;
  margin: 0 4px;
  font-size: 14px;
  cursor: pointer;
  border: 1px solid #666;
  border-radius: 4px;
  background: #444;
  color: #fff;
}

#warp-menu button:hover:not(:disabled) {
  background: #555;
}

#warp-menu button:disabled {
  opacity: 0.5;
  cursor: not-allowed;
}

#crafting-menu-overlay {
  position: absolute;
  left: 0;
  top: 0;
  width: var(--game-width);
  height: var(--game-height);
  background: rgba(0, 0, 0, 0.35);
  backdrop-filter: blur(6px);
  -webkit-backdrop-filter: blur(6px);
  display: flex;
  align-items: center;
  justify-content: center;
  box-sizing: border-box;
  z-index: 10;
  pointer-events: auto;
  cursor: default;
}

#crafting-menu {
  background: rgba(30, 30, 30, 0.95);
  padding: 20px;
  border-radius: 8px;
  min-width: 500px;
  min-height: 300px;
  display: flex;
  flex-direction: column;
  gap: 16px;
  border: 1px solid #666;
  pointer-events: auto;
  box-shadow: 0 4px 20px rgba(0, 0, 0, 0.5);
}

#crafting-header {
  display: flex;
  justify-content: space-between;
  align-items: center;
}

#crafting-header span {
  color: #eee;
  font-family: 'Oxanium', Arial, sans-serif;
  font-size: 18px;
}

#crafting-header button {
  padding: 8px 16px;
  font-size: 14px;
  cursor: pointer;
  border: 1px solid #666;
  border-radius: 4px;
  background: #444;
  color: #fff;
}

#crafting-main {
  display: flex;
  gap: 20px;
  flex: 1;
}

#crafting-recipes-list {
  width: 200px;
  background: #222;
  border: 1px solid #444;
  padding: 10px;
  overflow-y: auto;
  max-height: 300px;
}

.recipe-item {
  padding: 8px;
  background: #333;
  margin-bottom: 6px;
  border-radius: 4px;
  font-size: 12px;
  color: #ccc;
  cursor: pointer;
}

.recipe-item:hover {
  background: #444;
  color: #fff;
}

#crafting-work-area {
  flex: 1;
  display: flex;
  flex-direction: column;
  align-items: center;
  gap: 10px;
  padding: 10px;
  background: #252525;
  border-radius: 4px;
}

#crafting-input-grid {
  display: grid;
  grid-template-columns: repeat(3, 50px);
  gap: 4px;
}

.crafting-slot {
  width: 50px;
  height: 50px;
  background: #1a1a1a;
  border: 1px solid #555;
  display: flex;
  align-items: center;
  justify-content: center;
  position: relative;
}

.crafting-slot.has-item {
  cursor: grab;
}

.crafting-arrow {
  font-size: 24px;
  color: #888;
  margin: 10px 0;
}

#craft-btn {
  margin-top: auto;
  width: 100%;
  padding: 10px;
  background: #3a6ea5;
  border: none;
  color: white;
  border-radius: 4px;
  cursor: pointer;
}

#craft-btn:disabled {
  background: #444;
  cursor: not-allowed;
  opacity: 0.5;
}

/* --- Refinery Menu --- */
#refinery-menu-overlay {
  position: absolute;
  left: 0;
  top: 0;
  width: var(--game-width);
  height: var(--game-height);
  background: rgba(0, 0, 0, 0.35);
  backdrop-filter: blur(6px);
  -webkit-backdrop-filter: blur(6px);
  display: flex;
  align-items: center;
  justify-content: center;
  box-sizing: border-box;
  z-index: 10;
  pointer-events: auto;
  cursor: default;
}

#refinery-menu {
  background: rgba(30, 30, 30, 0.95);
  padding: 20px;
  border-radius: 8px;
  min-width: 400px;
  display: flex;
  flex-direction: column;
  gap: 16px;
  border: 1px solid #666;
  pointer-events: auto;
  box-shadow: 0 4px 20px rgba(0, 0, 0, 0.5);
}

#refinery-header {
  display: flex;
  justify-content: space-between;
  align-items: center;
}

#refinery-header span {
  color: #eee;
  font-family: 'Oxanium', Arial, sans-serif;
  font-size: 18px;
}

#refinery-header button {
  padding: 8px 16px;
  font-size: 14px;
  cursor: pointer;
  border: 1px solid #666;
  border-radius: 4px;
  background: #444;
  color: #fff;
}

#refinery-accepted-label {
  color: #aaa;
  font-family: 'Oxanium', Arial, sans-serif;
  font-size: 12px;
}

#refinery-main {
  display: flex;
  gap: 16px;
  align-items: center;
  justify-content: center;
}

#refinery-input-area,
#refinery-output-area {
  display: flex;
  flex-direction: column;
  align-items: center;
  gap: 8px;
}

.refinery-section-title {
  color: #bbb;
  font-family: 'Oxanium', Arial, sans-serif;
  font-size: 12px;
  text-transform: uppercase;
}

#refinery-input-grid {
  display: grid;
  grid-template-columns: repeat(2, 50px);
  gap: 4px;
}

#refine-btn {
  width: 100%;
  padding: 10px;
  background: #6a8a3a;
  border: none;
  color: white;
  border-radius: 4px;
  cursor: pointer;
  font-family: 'Oxanium', Arial, sans-serif;
  font-size: 14px;
}

#refine-btn:disabled {
  background: #444;
  cursor: not-allowed;
  opacity: 0.5;
}

#shipyard-menu-overlay {
  position: absolute;
  left: 0;
  top: 0;
  width: var(--game-width);
  height: var(--game-height);
  background: rgba(0, 0, 0, 0.35);
  backdrop-filter: blur(6px);
  -webkit-backdrop-filter: blur(6px);
  display: flex;
  align-items: center;
  justify-content: center;
  box-sizing: border-box;
  z-index: 10;
  pointer-events: auto;
  cursor: default;
}

#shipyard-menu {
  background: rgba(30, 30, 30, 0.95);
  padding: 24px 28px;
  border-radius: 10px;
  display: flex;
  flex-direction: column;
  gap: 18px;
  border: 1px solid #555;
  pointer-events: auto;
  box-shadow: 0 6px 30px rgba(0, 0, 0, 0.6);
  max-width: 900px;
  max-height: 800px;
  overflow-y: auto;
}

#shipyard-header {
  display: flex;
  justify-content: space-between;
  align-items: center;
}

#shipyard-header span {
  color: #eee;
  font-family: 'Oxanium', Arial, sans-serif;
  font-size: 18px;
}

#shipyard-header button {
  padding: 8px 16px;
  font-size: 14px;
  cursor: pointer;
  border: 1px solid #666;
  border-radius: 4px;
  background: #444;
  color: #fff;
}

#shipyard-header button:hover {
  background: #555;
}

.shipyard-title-row {
  display: flex;
  align-items: center;
  gap: 24px;
}

#shipyard-credits {
  color: #aaa;
  font-family: 'Oxanium', Arial, sans-serif;
  font-size: 14px;
}

.shipyard-section-label {
  color: #888;
  font-family: 'Oxanium', Arial, sans-serif;
  font-size: 11px;
  text-transform: uppercase;
  letter-spacing: 1px;
  margin-bottom: 8px;
}

.shipyard-cards {
  display: flex;
  flex-direction: row;
  gap: 14px;
  flex-wrap: wrap;
}

.shipyard-card {
  width: 200px;
  background: #1e1e1e;
  border: 1px solid #444;
  border-radius: 12px;
  overflow: hidden;
  display: flex;
  flex-direction: column;
  transition: border-color 0.2s;
}

.shipyard-card:hover {
  border-color: #777;
}

.shipyard-card.current {
  border-color: #5a5;
}

.shipyard-card-preview {
  width: 200px;
  height: 100px;
  background: transparent;
  position: relative;
  overflow: hidden;
}

.shipyard-card-preview canvas {
  width: 200px;
  height: 100px;
  display: block;
}

.shipyard-card-body {
  padding: 8px 10px 10px;
  display: flex;
  flex-direction: column;
  gap: 4px;
}

.shipyard-card-name {
  color: #fff;
  font-family: 'Oxanium', Arial, sans-serif;
  font-size: 14px;
  font-weight: 600;
}

.shipyard-card-desc {
  color: #888;
  font-family: 'Oxanium', Arial, sans-serif;
  font-size: 10px;
  line-height: 1.3;
}

.shipyard-card-stats {
  display: grid;
  grid-template-columns: 1fr 1fr;
  gap: 2px 10px;
  font-family: 'Oxanium', Arial, sans-serif;
  font-size: 10px;
  color: #aaa;
  margin-top: 1px;
}

.shipyard-stat-label {
  color: #666;
}

.shipyard-stat-value {
  color: #ccc;
  text-align: right;
}

.shipyard-card-action {
  margin-top: 4px;
}

.shipyard-card-btn {
  width: 100%;
  padding: 6px 0;
  border: none;
  border-radius: 6px;
  font-family: 'Oxanium', Arial, sans-serif;
  font-size: 12px;
  cursor: pointer;
  transition: background 0.15s;
}

.shipyard-card-btn.buy {
  background: #3a6ea5;
  color: #fff;
}

.shipyard-card-btn.buy:hover:not(:disabled) {
  background: #4a8ed5;
}

.shipyard-card-btn.buy:disabled {
  background: #333;
  color: #666;
  cursor: not-allowed;
}

.shipyard-card-btn.swap {
  background: #3a5a3a;
  color: #cfc;
}

.shipyard-card-btn.swap:hover {
  background: #4a7a4a;
}

.shipyard-card-btn.current-ship {
  background: #2a2a2a;
  color: #5a5;
  cursor: default;
  border: 1px solid #3a3a3a;
}

#shop-menu-overlay {
  position: absolute;
  left: 0;
  top: 0;
  width: var(--game-width);
  height: var(--game-height);
  background: rgba(0, 0, 0, 0.35);
  backdrop-filter: blur(6px);
  -webkit-backdrop-filter: blur(6px);
  display: flex;
  align-items: center;
  justify-content: center;
  box-sizing: border-box;
  z-index: 10;
  pointer-events: auto;
  cursor: default;
}

#shop-item-tooltip {
  position: absolute;
  background: rgba(20, 20, 20, 0.95);
  border: 1px solid #888;
  border-radius: 6px;
  padding: 8px 12px;
  font-family: 'Oxanium', Arial, sans-serif;
  font-size: 12px;
  color: #fff;
  z-index: 100;
  pointer-events: none;
  max-width: 220px;
  box-shadow: 0 2px 8px rgba(0,0,0,0.5);
}

#shop-item-tooltip .tooltip-name {
  font-weight: bold;
  font-size: 13px;
  color: #ffcc44;
  margin-bottom: 4px;
}

#shop-item-tooltip .tooltip-price {
  color: #88ff88;
  margin-bottom: 6px;
}

#shop-item-tooltip .tooltip-usage {
  color: #aaa;
  font-size: 11px;
  line-height: 1.4;
}

#hotbar-item-tooltip {
  position: absolute;
  background: rgba(20, 20, 20, 0.65);
  border: 1px solid rgba(136, 136, 136, 0.7);
  border-radius: 6px;
  padding: 8px 12px;
  font-family: 'Oxanium', Arial, sans-serif;
  font-size: 12px;
  color: #fff;
  z-index: 100;
  pointer-events: none;
  max-width: 220px;
  box-shadow: 0 2px 8px rgba(0,0,0,0.3);
}

#hotbar-item-tooltip .tooltip-name {
  font-weight: bold;
  font-size: 13px;
  color: #ffcc44;
  margin-bottom: 4px;
}

#hotbar-item-tooltip .tooltip-price {
  color: #88ff88;
  margin-bottom: 6px;
}

#hotbar-item-tooltip .tooltip-usage {
  color: #aaa;
  font-size: 11px;
  line-height: 1.4;
}

#shop-menu {
  background: rgba(30, 30, 30, 0.95);
  padding: 20px;
  border-radius: 8px;
  min-width: 320px;
  display: flex;
  flex-direction: column;
  gap: 16px;
  border: 1px solid #666;
  pointer-events: auto;
  box-shadow: 0 4px 20px rgba(0, 0, 0, 0.5);
}

#shop-header {
  display: flex;
  justify-content: space-between;
  align-items: center;
}

#shop-header span {
  color: #eee;
  font-family: 'Oxanium', Arial, sans-serif;
  font-size: 18px;
}

.shop-title-row {
  display: flex;
  align-items: center;
  gap: 24px;
}

#shop-credits-display {
  color: #eee;
  font-family: 'Oxanium', Arial, sans-serif;
  font-size: 18px;
}

#shop-main {
  display: flex;
  flex-direction: row;
  gap: 24px;
  align-items: flex-start;
}

#shop-buy-area,
#shop-sell-area {
  display: flex;
  flex-direction: column;
  gap: 8px;
}

.shop-section-title {
  color: #bbb;
  font-family: 'Oxanium', Arial, sans-serif;
  font-size: 12px;
  text-transform: uppercase;
}

#shop-buy-slots,
#shop-sell-slots {
  display: grid;
  grid-template-columns: repeat(6, 40px);
  gap: 0;
}

.shop-buy-slot {
  width: 40px;
  height: 40px;
  box-sizing: border-box;
  border: 1px solid var(--slot-border);
  background: var(--slot-bg);
  display: flex;
  align-items: center;
  justify-content: center;
  color: #fff;
  font-family: 'Oxanium', Arial, sans-serif;
  font-size: 12px;
  position: relative;
  user-select: none;
  overflow: hidden;
}

.shop-buy-slot.has-item {
  cursor: grab;
}

.shop-buy-slot.has-item:active {
  cursor: grabbing;
}

#shop-price-list {
  margin-top: 8px;
  font-family: 'Oxanium', Arial, sans-serif;
  font-size: 11px;
  color: #ccc;
}

#shop-price-list .price-row {
  display: flex;
  justify-content: space-between;
  padding: 2px 0;
}

#shop-price-list .price-label {
  color: #aaa;
}

#shop-price-list .price-value {
  color: #9c9;
}

/* Generic slot child elements */
.slot-icon {
  margin-top: -4px;
}

.slot-icon-img {
  width: 28px;
  height: 28px;
  object-fit: contain;
}

.slot-icon-ore-wrap {
  position: relative;
  width: 28px;
  height: 28px;
  display: flex;
  align-items: center;
  justify-content: center;
}

.slot-icon-ore-bg {
  position: absolute;
  inset: 0;
  width: 100%;
  height: 100%;
  object-fit: contain;
  z-index: 0;
}

.slot-icon-ore-letter {
  position: relative;
  z-index: 1;
  font-size: 12px;
  color: #fff;
  text-shadow: 0 0 2px #000, 0 1px 2px #000;
  pointer-events: none;
}

.slot-energy {
  position: absolute;
  bottom: 6px;
  left: 50%;
  transform: translateX(-50%);
  font-size: 9px;
  color: #aaffaa;
}

.slot-bar {
  position: absolute;
  right: 3px;
  top: 3px;
  width: 5px;
  height: 32px;
  background: #333;
}

.slot-bar-fill {
  position: absolute;
  bottom: 0;
  left: 0;
  width: 100%;
}

.slot-qty {
  position: absolute;
  bottom: 2px;
  right: 2px;
  font-size: 10px;
  color: #aaa;
}

.slot-tier {
  position: absolute;
  bottom: 2px;
  left: 50%;
  transform: translateX(-50%);
  font-size: 9px;
  color: #888;
  pointer-events: none;
}

.slot-num {
  position: absolute;
  top: 2px;
  left: 2px;
  font-size: 10px;
  color: #666;
}

/* Main Hotbar Slots */
.slot {
  width: 40px;
  height: 40px;
  box-sizing: border-box;
  border: 1px solid var(--slot-border);
  background: var(--slot-bg);
  display: flex;
  align-items: center;
  justify-content: center;
  color: #fff;
  font-family: 'Oxanium', Arial, sans-serif;
  font-size: 12px;
  position: relative;
  user-select: none;
  overflow: hidden;
  cursor: pointer;
}

.slot.selected {
  border: 2px solid #fff;
  background: #444;
}

.slot.has-item {
  cursor: grab;
}

.slot.has-item:active {
  cursor: grabbing;
}

/* Sell Slots */
.shop-sell-slot {
  width: 40px;
  height: 40px;
  box-sizing: border-box;
  border: 1px solid var(--slot-border);
  background: var(--slot-bg);
  display: flex;
  align-items: center;
  justify-content: center;
  color: #fff;
  font-family: 'Oxanium', Arial, sans-serif;
  font-size: 12px;
  position: relative;
  user-select: none;
  overflow: hidden;
}

.shop-sell-slot.has-item {
  cursor: grab;
}

.shop-sell-slot.has-item:active {
  cursor: grabbing;
}

.shop-sell-slot.droppable {
  border-color: #6a6;
  background: #2a3a2a;
}

#shop-sell-total {
  color: #9c9;
  font-family: 'Oxanium', Arial, sans-serif;
  font-size: 14px;
  margin-top: 4px;
}

#shop-menu button {
  padding: 8px 16px;
  margin: 0 4px;
  font-size: 14px;
  cursor: pointer;
  border: 1px solid #666;
  border-radius: 4px;
  background: #444;
  color: #fff;
}

#shop-menu button:hover:not(:disabled) {
  background: #555;
}

#shop-menu button:disabled {
  opacity: 0.5;
  cursor: not-allowed;
}

#oxygen-bar-drop-zone {
  position: absolute;
  left: 1050px;
  bottom: 20px;
  width: 40px;
  height: 60px;
  pointer-events: auto;
  z-index: 15;
  box-sizing: border-box;
  border: 2px solid transparent;
  transition: border-color 0.15s;
}

#oxygen-bar-drop-zone.highlight {
  border-color: #fff;
}

#health-bar-drop-zone {
  position: absolute;
  left: 1150px;
  bottom: 20px;
  width: 40px;
  height: 100px;
  pointer-events: auto;
  z-index: 15;
  box-sizing: border-box;
  border: 2px solid transparent;
  transition: border-color 0.15s;
}

#health-bar-drop-zone.highlight {
  border-color: #fff;
}

#fuel-bar-drop-zone {
  position: absolute;
  left: 1100px;
  bottom: 20px;
  width: 40px;
  height: 50px;
  pointer-events: auto;
  z-index: 15;
  box-sizing: border-box;
  border: 2px solid transparent;
  transition: border-color 0.15s;
}

#fuel-bar-drop-zone.highlight {
  border-color: #fff;
}

#hud-overlay {
  position: absolute;
  /* Hotbar is 360px wide, centered in 1200px = starts at 420px */
  left: 420px;
  bottom: 0;
  pointer-events: auto;
  display: flex;
  flex-direction: column;
  align-items: flex-start;
  z-index: 15;
}

#extended-inventory {
  display: none;
  flex-direction: row;
  flex-wrap: wrap;
  max-width: 360px;
  background: rgba(20, 20, 20, 0.75);
  border: 1px solid #444;
  border-bottom: none;
}

#extended-inventory .ext-slot {
  background: #1a1a1a;
  border-color: #444;
}

#extended-inventory.visible {
  display: flex;
}

#hud-bottom-row {
  display: flex;
  flex-direction: row;
}

#hotbar {
  display: flex;
  flex-direction: row;
  gap: 0;
}

#credits {
  width: 80px;
  height: 40px;
  background: #222;
  border: 1px solid #555;
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
  box-sizing: border-box;
}

.credits-label {
  color: #ffcc00;
  font-family: 'Oxanium', Arial, sans-serif;
  font-size: 12px;
}

.credits-value {
  color: #fff;
  font-family: 'Oxanium', Arial, sans-serif;
  font-size: 14px;
}

#level-select-ui {
  position: absolute;
  top: 8px;
  left: 8px;
  z-index: 50;
  display: flex;
  align-items: center;
  gap: 6px;
  font-family: 'Oxanium', Arial, sans-serif;
  font-size: 12px;
  color: rgba(255, 255, 255, 0.7);
  pointer-events: auto;
}

#level-select-ui label {
  text-shadow: 0 1px 3px rgba(0, 0, 0, 0.8);
}

.level-editor-link {
  margin-left: 0.75em;
}

#level-select {
  background: rgba(20, 20, 30, 0.75);
  color: #ccc;
  border: 1px solid rgba(255, 255, 255, 0.2);
  border-radius: 4px;
  padding: 2px 6px;
  font-family: 'Oxanium', Arial, sans-serif;
  font-size: 12px;
  cursor: pointer;
  outline: none;
}

#level-select:hover {
  border-color: rgba(255, 255, 255, 0.4);
  color: #fff;
}

#level-select:focus {
  border-color: rgba(100, 150, 255, 0.6);
}

#shop-drag-ghost {
  position: fixed;
  width: 40px;
  height: 40px;
  background: rgba(40, 40, 40, 0.8);
  border: 2px solid #aaa;
  color: #fff;
  font-family: 'Oxanium', Arial, sans-serif;
  font-size: 14px;
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
  pointer-events: none;
  z-index: 9999;
}

#shop-drag-ghost img {
  width: 28px;
  height: 28px;
  object-fit: contain;
}

```

## css\editor.css
```
* {
  margin: 0;
  padding: 0;
  box-sizing: border-box;
}

body {
  display: flex;
  min-height: 100vh;
  background: #1a1a1a;
  color: #eee;
  font-family: Arial, sans-serif;
}

.hidden-input {
  display: none;
}

#toolbar {
  width: 240px;
  padding: 15px;
  background: #252525;
  display: flex;
  flex-direction: column;
  gap: 15px;
  overflow-y: auto;
}

#toolbar h2 {
  margin-bottom: 5px;
  font-size: 1.2em;
}

.tool-group {
  display: flex;
  flex-direction: column;
  gap: 8px;
  padding-bottom: 12px;
  border-bottom: 1px solid #444;
}

.tool-group label {
  display: flex;
  flex-direction: column;
  gap: 4px;
  font-size: 0.9em;
}

.tool-group input[type="number"] {
  padding: 6px;
  background: #333;
  border: 1px solid #555;
  color: #eee;
  border-radius: 3px;
}

.tool-group input[type="range"] {
  width: 100%;
}

.tool-group button {
  padding: 8px 12px;
  background: #3a6ea5;
  border: none;
  color: #fff;
  border-radius: 4px;
  cursor: pointer;
}

.tool-group button:hover {
  background: #4a8ed5;
}

.tool-group a {
  color: #6af;
  text-decoration: none;
}

.tool-group a:hover {
  text-decoration: underline;
}

#size-display {
  font-size: 0.9em;
  color: #aaa;
}

#instructions {
  font-size: 0.8em;
  color: #888;
  line-height: 1.6;
}

#editor-container {
  flex: 1;
  overflow: hidden;
  position: relative;
  min-height: 100vh;
}

#editor-canvas {
  display: block;
  background: #0a0a12;
  width: 100%;
  height: 100%;
  cursor: crosshair;
}

#tool-palette {
  position: absolute;
  bottom: 15px;
  left: 15px;
  background: rgba(30, 30, 35, 0.95);
  border: 1px solid #444;
  border-radius: 6px;
  padding: 8px;
  display: flex;
  flex-direction: column;
  gap: 6px;
}

.palette-title {
  font-size: 11px;
  color: #888;
  text-transform: uppercase;
  letter-spacing: 0.5px;
}

.palette-grid {
  display: grid;
  grid-template-columns: repeat(2, 1fr);
  column-gap: 4px;
  row-gap: 6px;
}

.palette-grid-bottom-gap {
  margin-bottom: 10px;
}

.palette-grid-single-column {
  grid-template-columns: 1fr;
}

.palette-btn {
  padding: 8px 10px;
  background: #333;
  border: 1px solid #555;
  color: #ccc;
  border-radius: 4px;
  cursor: pointer;
  font-size: 12px;
}

.palette-btn:hover {
  background: #404;
  color: #fff;
}

.palette-btn.selected {
  background: #3a6ea5;
  border-color: #4a8ed5;
  color: #fff;
}

.palette-btn[data-asteroid-type="cuprite"] { border-left: 5px solid #665544; }
.palette-btn[data-asteroid-type="hematite"] { border-left: 5px solid #8B4513; }
.palette-btn[data-asteroid-type="aurite"] { border-left: 5px solid #FFD700; }
.palette-btn[data-asteroid-type="diamite"] { border-left: 5px solid #C0C0C0; }
.palette-btn[data-asteroid-type="platinite"] { border-left: 5px solid #E5E4E2; }

#properties-panel {
  position: absolute;
  top: 15px;
  right: 15px;
  width: 245px;
  background: rgba(30, 30, 35, 0.95);
  border: 1px solid #444;
  border-radius: 6px;
  padding: 10px;
  display: none;
  flex-direction: column;
  gap: 10px;
  max-height: calc(100vh - 30px);
  overflow-y: auto;
}

.panel-header {
  display: flex;
  justify-content: space-between;
  align-items: center;
  border-bottom: 1px solid #444;
  padding-bottom: 10px;
  margin-bottom: 5px;
}

.panel-header h3 {
  font-size: 14px;
  color: #eee;
  text-transform: uppercase;
}

#close-properties {
  background: none;
  border: none;
  color: #888;
  font-size: 20px;
  cursor: pointer;
}

#close-properties:hover {
  color: #fff;
}

.prop-group {
  display: flex;
  flex-direction: column;
  gap: 5px;
  margin-bottom: 10px;
}

.prop-group label {
  font-size: 12px;
  color: #aaa;
}

.prop-inline-row {
  display: flex;
  align-items: center;
  gap: 8px;
  margin: 4px 0;
}

.prop-inline-label {
  font-size: 11px;
  color: #ccc;
  min-width: 55px;
}

.prop-note {
  font-size: 10px;
  color: #888;
  margin-top: 4px;
}

.prop-row-tight {
  display: flex;
  gap: 5px;
}

.prop-small-label {
  font-size: 12px;
}

.prop-group input, .prop-group select {
  padding: 6px;
  background: #222;
  border: 1px solid #444;
  color: #eee;
  border-radius: 3px;
  font-size: 12px;
}

.prop-list {
  display: flex;
  flex-direction: column;
  gap: 5px;
  background: #222;
  padding: 5px;
  border-radius: 3px;
  max-height: 150px;
  overflow-y: auto;
}

.prop-list-item {
  display: flex;
  gap: 5px;
  align-items: center;
  background: #333;
  padding: 4px;
  border-radius: 2px;
  transition: border-top 0.1s;
}

.prop-list-item .drag-handle {
  cursor: grab;
  color: #666;
  font-size: 14px;
  user-select: none;
  margin-right: 5px;
}

.prop-list-item .drag-handle:hover {
  color: #999;
}

.prop-list-item[draggable="true"]:active .drag-handle {
  cursor: grabbing;
}

.prop-list-item .item-label {
  font-size: 10px;
  flex: 1;
}

.prop-list-item input {
  width: 60px;
}

.prop-list-item button {
  background: #a33;
  border: none;
  color: #fff;
  padding: 2px 6px;
  cursor: pointer;
  border-radius: 2px;
}

.add-btn {
  background: #3a6ea5;
  border: none;
  color: #fff;
  padding: 6px;
  border-radius: 3px;
  cursor: pointer;
  font-size: 12px;
  margin-top: 5px;
}

.add-btn:hover {
  background: #4a8ed5;
}

.recipe-item-select {
  font-size: 10px;
  flex: 1;
  min-width: 0;
}

.recipe-list {
  max-height: 400px;
}

.recipe-card {
  flex-direction: column;
  align-items: stretch;
  padding: 6px;
  margin-bottom: 6px;
}

.recipe-header-row {
  display: flex;
  justify-content: space-between;
  align-items: center;
  margin-bottom: 4px;
}

.recipe-header-label {
  font-size: 11px;
  font-weight: bold;
  color: #ccc;
}

.recipe-delete-btn {
  background: #844;
  font-size: 12px;
  padding: 1px 5px;
}

.recipe-section-label {
  font-size: 10px;
  color: #aaa;
  margin-bottom: 2px;
}

.recipe-input-row,
.recipe-output-row {
  display: flex;
  gap: 4px;
  align-items: center;
}

.recipe-input-row {
  margin-bottom: 3px;
}

.recipe-qty-input {
  width: 40px;
  font-size: 10px;
}

.recipe-remove-input-btn {
  font-size: 10px;
  padding: 1px 4px;
  background: #a33;
}

.recipe-add-input-btn {
  font-size: 10px;
  padding: 3px 6px;
  margin-bottom: 6px;
}

.spawn-tier {
  border: 1px solid #555;
  background: #2a2a2a;
  padding: 10px;
  margin-top: 10px;
  border-radius: 4px;
}

.spawn-tier h4 {
  margin: 0 0 10px 0;
  font-size: 13px;
  color: #ddd;
  display: flex;
  justify-content: space-between;
  align-items: center;
}

.spawn-tier .delete-tier-btn {
  background: #d54a4a;
  color: white;
  border: none;
  padding: 2px 6px;
  border-radius: 3px;
  cursor: pointer;
  font-size: 10px;
}

.spawn-tier .delete-tier-btn:hover {
  background: #e56a6a;
}

```

## js\utils.js
```
import { ORE_ITEMS, MAX_ORE_STACK, ITEM_IMAGE_PATHS, ITEM_LABELS, ITEM_DEFAULTS } from './constants.js';

export function normalize(x, y) {
  const len = Math.sqrt(x * x + y * y);
  if (len === 0) return { x: 0, y: 0 };
  return { x: x / len, y: y / len };
}

export function createSeededRandom(seed) {
  return function () {
    let t = (seed += 0x6d2b79f5);
    t = Math.imul(t ^ (t >>> 15), t | 1);
    t ^= t + Math.imul(t ^ (t >>> 7), t | 61);
    return ((t ^ (t >>> 14)) >>> 0) / 4294967296;
  };
}

export function getMaxStack(itemName) {
  return ORE_ITEMS.includes(itemName) ? MAX_ORE_STACK : 1;
}

/** Get the icon image path for a given item name (or null if none). */
export function getItemImagePath(itemName) {
  return ITEM_IMAGE_PATHS[itemName] || null;
}

/** Get the short HUD label for an inventory slot object (e.g. {item:'cuprite'}). */
export function getItemLabel(it) {
  if (!it) return '';
  return ITEM_LABELS[it.item] || (it.item && it.item.charAt(0).toUpperCase()) || '';
}

/** Build a full item payload for a given item key (used when buying/spawning items). */
export function getItemPayload(itemKey) {
  const defaults = ITEM_DEFAULTS[itemKey];
  return defaults ? { item: itemKey, ...defaults } : { item: itemKey };
}

// ---------------------------------------------------------------------------
// Raycast helpers â€“ shared by laser hit detection
// ---------------------------------------------------------------------------

/**
 * Test a ray (origin ox,oy  direction dx,dy  max length maxLen) against a
 * single circle (cx, cy, radius).  Returns the entry distance along the ray
 * if the ray hits, or -1 if it misses.
 */
export function raycastCircle(ox, oy, dx, dy, cx, cy, radius, maxLen) {
  const fx = cx - ox;
  const fy = cy - oy;
  const t = fx * dx + fy * dy;
  if (t < 0) return -1; // behind ray origin
  const px = ox + dx * t;
  const py = oy + dy * t;
  const distSq = (cx - px) * (cx - px) + (cy - py) * (cy - py);
  const radiusSq = radius * radius;
  if (distSq >= radiusSq) return -1;
  const hitDist = t - Math.sqrt(radiusSq - distSq);
  return (hitDist > 0 && hitDist < maxLen) ? hitDist : -1;
}

// ---------------------------------------------------------------------------
// Physics helpers â€“ shared by ship, pirate, and floating-item collision code
// ---------------------------------------------------------------------------

/**
 * Push `entity` out of `obstacle` if their circles overlap.
 * Returns {nx, ny, overlap, dist} if overlapping, or null if no collision.
 * Mutates entity.x / entity.y to resolve the overlap.
 */
export function pushOutOverlap(entity, obstacle, entityRadius, obstacleRadius) {
  const dx = entity.x - obstacle.x;
  const dy = entity.y - obstacle.y;
  const dist = Math.sqrt(dx * dx + dy * dy);
  const minDist = entityRadius + obstacleRadius;
  if (dist >= minDist || dist === 0) return null;
  const nx = dx / dist;
  const ny = dy / dist;
  const overlap = minDist - dist;
  entity.x += nx * overlap;
  entity.y += ny * overlap;
  return { nx, ny, overlap, dist };
}

/**
 * Apply a bounce to `entity` along the collision normal (nx, ny).
 * `restitution` controls how much velocity is reflected (0 = absorb, 1 = elastic).
 * Returns the signed impact speed along the normal (negative means entity was
 * moving into the obstacle). Only bounces if moving inward.
 */
export function bounceEntity(entity, nx, ny, restitution) {
  const normalSpeed = entity.vx * nx + entity.vy * ny;
  if (normalSpeed >= 0) return 0; // already moving away
  const impactSpeed = -normalSpeed;
  const bounce = impactSpeed * (1 + restitution);
  entity.vx += nx * bounce;
  entity.vy += ny * bounce;
  return impactSpeed;
}

```

## js\sfx.js
```
const DEFAULTS = Object.freeze({
  // Raised ~2x from previous 0.35 baseline.
  masterVolume: 0.7,
  // Keep category gains closer for a more consistent mix.
  weaponsVolume: 0.9,
  impactsVolume: 0.9,
  uiVolume: 0.9,
  worldVolume: 0.9,
  cooldowns: {
    laserImpact: 0.03,
    playerBlaster: 0.03,
    enemyShot: 0.04,
    collision: 0.08,
    pickup: 0.04,
    genericUi: 0.05
  }
});

function clamp(v, min, max) {
  return Math.max(min, Math.min(max, v));
}

function rand(min, max) {
  return min + Math.random() * (max - min);
}

class SpaceJamSfx {
  constructor() {
    this.ctx = null;
    this.masterGain = null;
    this.masterCompressor = null;
    this.groups = null;
    this.cooldowns = new Map();
    this.started = false;
    this.laserLoop = null;
  }

  ensureContext() {
    if (this.ctx) return this.ctx;
    const Ctx = window.AudioContext || window.webkitAudioContext;
    if (!Ctx) return null;
    this.ctx = new Ctx();

    this.masterGain = this.ctx.createGain();
    this.masterGain.gain.value = DEFAULTS.masterVolume;
    // Output compressor smooths loudness differences and reduces clipping spikes.
    this.masterCompressor = this.ctx.createDynamicsCompressor();
    this.masterCompressor.threshold.setValueAtTime(-20, this.ctx.currentTime);
    this.masterCompressor.knee.setValueAtTime(18, this.ctx.currentTime);
    this.masterCompressor.ratio.setValueAtTime(4, this.ctx.currentTime);
    this.masterCompressor.attack.setValueAtTime(0.006, this.ctx.currentTime);
    this.masterCompressor.release.setValueAtTime(0.18, this.ctx.currentTime);

    this.masterGain.connect(this.masterCompressor);
    this.masterCompressor.connect(this.ctx.destination);

    this.groups = {
      weapons: this.createGroup(DEFAULTS.weaponsVolume),
      impacts: this.createGroup(DEFAULTS.impactsVolume),
      ui: this.createGroup(DEFAULTS.uiVolume),
      world: this.createGroup(DEFAULTS.worldVolume)
    };
    return this.ctx;
  }

  createGroup(initialGain) {
    const gain = this.ctx.createGain();
    gain.gain.value = initialGain;
    gain.connect(this.masterGain);
    return gain;
  }

  async unlock() {
    const ctx = this.ensureContext();
    if (!ctx) return false;
    try {
      if (ctx.state !== 'running') await ctx.resume();
      this.started = ctx.state === 'running';
    } catch (_) {
      this.started = false;
    }
    return this.started;
  }

  async resumeIfNeeded() {
    const ctx = this.ensureContext();
    if (!ctx) return false;
    if (ctx.state === 'running') return true;
    try {
      await ctx.resume();
      this.started = ctx.state === 'running';
    } catch (_) {
      this.started = false;
    }
    return this.started;
  }

  canPlay() {
    return !!(this.ctx && this.ctx.state === 'running' && this.groups);
  }

  now() {
    return this.ctx.currentTime;
  }

  passCooldown(key, seconds) {
    const ctx = this.ctx;
    if (!ctx) return false;
    const now = ctx.currentTime;
    const until = this.cooldowns.get(key) || 0;
    if (now < until) return false;
    this.cooldowns.set(key, now + seconds);
    return true;
  }

  envelope(gainNode, attack, decay, sustain, release, now, hold = 0) {
    const g = gainNode.gain;
    g.cancelScheduledValues(now);
    g.setValueAtTime(0.0001, now);
    g.exponentialRampToValueAtTime(Math.max(0.0001, sustain), now + attack);
    const decayTarget = Math.max(0.0001, sustain * 0.65);
    g.exponentialRampToValueAtTime(decayTarget, now + attack + decay);
    const relStart = now + attack + decay + hold;
    g.setValueAtTime(decayTarget, relStart);
    g.exponentialRampToValueAtTime(0.0001, relStart + release);
    return relStart + release;
  }

  tone({
    group = 'world',
    type = 'sine',
    freqStart = 440,
    freqEnd = 440,
    duration = 0.2,
    gain = 0.2,
    attack = 0.003,
    decay = 0.03,
    release = 0.08,
    hold = 0
  }) {
    if (!this.canPlay()) return;
    const now = this.now();
    const osc = this.ctx.createOscillator();
    const amp = this.ctx.createGain();
    osc.type = type;
    osc.frequency.setValueAtTime(Math.max(10, freqStart), now);
    osc.frequency.exponentialRampToValueAtTime(Math.max(10, freqEnd), now + duration);
    const stopAt = this.envelope(amp, attack, decay, gain, release, now, hold);
    osc.connect(amp);
    amp.connect(this.groups[group] || this.groups.world);
    osc.start(now);
    osc.stop(stopAt + 0.02);
  }

  noiseBurst({
    group = 'impacts',
    duration = 0.12,
    gain = 0.12,
    filterType = 'bandpass',
    filterFreq = 1000,
    q = 1,
    release = 0.08
  }) {
    if (!this.canPlay()) return;
    const now = this.now();
    const len = Math.max(0.01, duration);
    const buffer = this.ctx.createBuffer(1, Math.floor(this.ctx.sampleRate * len), this.ctx.sampleRate);
    const data = buffer.getChannelData(0);
    for (let i = 0; i < data.length; i++) data[i] = Math.random() * 2 - 1;

    const src = this.ctx.createBufferSource();
    src.buffer = buffer;
    const amp = this.ctx.createGain();
    const filter = this.ctx.createBiquadFilter();
    filter.type = filterType;
    filter.frequency.value = filterFreq;
    filter.Q.value = q;

    src.connect(filter);
    filter.connect(amp);
    amp.connect(this.groups[group] || this.groups.impacts);

    amp.gain.setValueAtTime(0.0001, now);
    amp.gain.exponentialRampToValueAtTime(Math.max(0.0001, gain), now + 0.003);
    amp.gain.exponentialRampToValueAtTime(0.0001, now + len + release);

    src.start(now);
    src.stop(now + len + release + 0.01);
  }

  playPlayerBlaster(heat01 = 1) {
    if (!this.canPlay() || !this.passCooldown('playerBlaster', DEFAULTS.cooldowns.playerBlaster)) return;
    const h = Math.max(0, Math.min(1, heat01));
    const pitchScale = 0.55 + 0.2 * h; // cold: 55%, hot: 75% (25% less high)
    this.tone({ group: 'weapons', type: 'triangle', freqStart: rand(1200, 1450) * pitchScale, freqEnd: rand(500, 650) * pitchScale, duration: 0.09, gain: 0.1, release: 0.06 });
    this.tone({ group: 'weapons', type: 'square', freqStart: rand(1800, 2200) * pitchScale, freqEnd: rand(700, 900) * pitchScale, duration: 0.06, gain: 0.045, release: 0.04 });
  }

  playEnemyShot(archetype = 'standard') {
    if (!this.canPlay() || !this.passCooldown('enemyShot', DEFAULTS.cooldowns.enemyShot)) return;
    let start = 620;
    let end = 300;
    if (archetype === 'shotgun') {
      start = 500;
      end = 195;
      this.noiseBurst({ group: 'weapons', duration: 0.05, gain: 0.028, filterType: 'highpass', filterFreq: 1000, q: 0.8, release: 0.03 });
    } else if (archetype === 'slowing') {
      start = 665;
      end = 230;
    } else if (archetype === 'drone') {
      start = 860;
      end = 420;
    }
    this.tone({ group: 'weapons', type: 'sawtooth', freqStart: start, freqEnd: end, duration: 0.1, gain: 0.08, release: 0.08 });
  }

  startLaserLoop() {
    if (!this.canPlay() || this.laserLoop) return;
    const now = this.now();
    const osc = this.ctx.createOscillator();
    const filter = this.ctx.createBiquadFilter();
    const amp = this.ctx.createGain();

    osc.type = 'sawtooth';
    osc.frequency.setValueAtTime(60, now);
    filter.type = 'lowpass';
    filter.frequency.setValueAtTime(900, now);
    filter.Q.setValueAtTime(0.8, now);
    amp.gain.setValueAtTime(0.0001, now);
    amp.gain.exponentialRampToValueAtTime(0.067, now + 0.04);

    osc.connect(filter);
    filter.connect(amp);
    amp.connect(this.groups.weapons);
    osc.start(now);

    this.laserLoop = { osc, filter, amp };
  }

  updateLaserHeat(heat01 = 0) {
    if (!this.canPlay() || !this.laserLoop) return;
    const h = clamp(heat01, 0, 1);
    const now = this.now();
    const targetFreq = 55 + h * 20; // 55â€“75 Hz range
    const targetCutoff = 700 + h * 1600;
    const targetGain = (0.08 + h * 0.08) * (2 / 3);
    this.laserLoop.osc.frequency.setTargetAtTime(targetFreq, now, 0.02);
    this.laserLoop.filter.frequency.setTargetAtTime(targetCutoff, now, 0.03);
    this.laserLoop.amp.gain.setTargetAtTime(targetGain, now, 0.02);
  }

  stopLaserLoop() {
    if (!this.laserLoop) return;
    const now = this.now();
    const { osc, amp } = this.laserLoop;
    amp.gain.cancelScheduledValues(now);
    amp.gain.setValueAtTime(Math.max(0.0001, amp.gain.value || 0.01), now);
    amp.gain.exponentialRampToValueAtTime(0.0001, now + 0.06);
    try { osc.stop(now + 0.08); } catch (_) {}
    this.laserLoop = null;
  }

  playOverheat() {
    if (!this.canPlay() || !this.passCooldown('overheat', 0.5)) return;
    const now = this.now();
    this.noiseBurst({ group: 'weapons', duration: 0.12, gain: 0.11, filterType: 'bandpass', filterFreq: 320, q: 1.2, release: 0.08 });
    this.tone({ group: 'weapons', type: 'sawtooth', freqStart: 380, freqEnd: 90, duration: 0.14, gain: 0.06, release: 0.1 });
  }

  playImpact(kind = 'generic') {
    if (!this.canPlay()) return;
    const key = `impact:${kind}`;
    if (!this.passCooldown(key, DEFAULTS.cooldowns.laserImpact)) return;
    if (kind === 'playerHit') {
      // Similar to ship collision but a tad lower in pitch and volume
      this.noiseBurst({ group: 'impacts', duration: 0.12, gain: 0.11, filterType: 'lowpass', filterFreq: 520, q: 0.9, release: 0.1 });
      this.tone({ group: 'impacts', type: 'triangle', freqStart: 105, freqEnd: 42, duration: 0.15, gain: 0.07, release: 0.14 });
      return;
    }
    let f = 1300;
    if (kind === 'bullet') f = 1700;
    else if (kind === 'laser') f = 2200;
    this.noiseBurst({ group: 'impacts', duration: 0.05, gain: 0.08, filterType: 'bandpass', filterFreq: f, q: 1.5, release: 0.06 });
  }

  playShipCollision(intensity = 0.5) {
    if (!this.canPlay() || !this.passCooldown('collision', DEFAULTS.cooldowns.collision)) return;
    const t = clamp(intensity, 0, 1);
    this.noiseBurst({ group: 'impacts', duration: 0.1 + t * 0.08, gain: 0.09 + t * 0.1, filterType: 'lowpass', filterFreq: 750 - t * 250, q: 0.9, release: 0.12 });
    this.tone({ group: 'impacts', type: 'triangle', freqStart: 140 - t * 30, freqEnd: 55 - t * 12, duration: 0.18, gain: 0.08 + t * 0.04, release: 0.16 });
  }

  playExplosion(kind = 'asteroid') {
    if (!this.canPlay()) return;
    const key = `explosion:${kind}`;
    if (!this.passCooldown(key, 0.04)) return;
    let gain = 0.12;
    let low = 180;
    if (kind === 'pirate') {
      gain = 0.14;
      low = 220;
    } else if (kind === 'base') {
      gain = 0.2;
      low = 140;
    }
    this.noiseBurst({ group: 'world', duration: 0.22, gain, filterType: 'lowpass', filterFreq: low, q: 0.7, release: 0.18 });
    this.tone({ group: 'world', type: 'triangle', freqStart: low + 40, freqEnd: 45, duration: 0.25, gain: gain * 0.9, release: 0.2 });
  }

  playPickup(kind = 'generic') {
    if (!this.canPlay() || !this.passCooldown('pickup', DEFAULTS.cooldowns.pickup)) return;
    if (kind === 'ore') {
      this.tone({ group: 'world', type: 'sine', freqStart: 540, freqEnd: 760, duration: 0.04, gain: 0.08, release: 0.05 });
    } else {
      this.tone({ group: 'world', type: 'triangle', freqStart: 620, freqEnd: 980, duration: 0.05, gain: 0.1, release: 0.06 });
    }
  }

  playMenuOpen() { this.uiTick(720, 940, 0.06); }
  playMenuClose() { this.uiTick(860, 600, 0.06); }
  playConfirm() { this.uiTick(760, 1080, 0.08); }
  playCancel() { this.uiTick(680, 360, 0.07); }
  playBuy() { this.uiTick(760, 1180, 0.07); }
  playSell() { this.uiTick(980, 640, 0.08); }
  playCraft() { this.uiTick(620, 1020, 0.09); }
  playRefine() { this.uiTick(500, 920, 0.1); }
  playWarp() { this.uiTick(320, 1160, 0.15); }
  playJettison() { this.uiTick(430, 260, 0.09); }
  playDeath() { this.uiTick(260, 90, 0.35); }
  playRespawn() { this.uiTick(340, 860, 0.25); }
  playLevelChange() { this.uiTick(420, 980, 0.12); }
  playHotbarSelect() { this.uiTick(680, 760, 0.04); }
  playUseResource(kind = 'generic') {
    if (kind === 'health') this.uiTick(540, 900, 0.08);
    else if (kind === 'oxygen') this.uiTick(680, 1020, 0.08);
    else this.uiTick(460, 820, 0.08);
  }

  playCutsceneTypeTick() {
    if (!this.canPlay() || !this.passCooldown('cutsceneType', 0.025)) return;
    this.tone({ group: 'ui', type: 'square', freqStart: 1020, freqEnd: 860, duration: 0.025, gain: 0.03, release: 0.015 });
  }

  playCutsceneSkip() { this.uiTick(520, 300, 0.08); }
  playCutsceneBlendStart() { this.uiTick(340, 940, 0.2); }
  playCutsceneBlendComplete() { this.uiTick(560, 1180, 0.16); }

  uiTick(from, to, duration) {
    if (!this.canPlay() || !this.passCooldown(`ui:${from}:${to}`, DEFAULTS.cooldowns.genericUi)) return;
    this.tone({ group: 'ui', type: 'triangle', freqStart: from, freqEnd: to, duration, gain: 0.08, release: Math.max(0.03, duration * 0.65) });
  }
}

export const sfx = new SpaceJamSfx();

```

## js\pirateShared.js
```
export const PIRATE_TYPE_KEYS = ['normal', 'sturdy', 'fast'];
export const DEFAULT_PIRATE_TYPE_PERCENTAGES = Object.freeze({ normal: 100, sturdy: 0, fast: 0 });

export const PIRATE_ARCHETYPE_KEYS = ['standard', 'shotgun', 'slowing', 'breaching', 'drone'];

export const DEFAULT_SPAWN_SETTINGS = Object.freeze({
  initialDelay: 120,
  waveIntervalMin: 60,
  waveIntervalMax: 100,
  waveSizeMin: 2,
  waveSizeMax: 4
});

export const DEFAULT_SPAWN_TIER_SETTINGS = Object.freeze({
  startTime: 300,
  waveIntervalMin: 45,
  waveIntervalMax: 80,
  waveSizeMin: 3,
  waveSizeMax: 6
});

export function normalizePirateBaseTier(tier) {
  const n = Number(tier);
  if (!Number.isFinite(n)) return 2;
  return Math.min(5, Math.max(1, Math.round(n)));
}

export function getPirateBaseTierScale(tier) {
  return 0.6 + (normalizePirateBaseTier(tier) * 0.2);
}

export function normalizePirateType(type) {
  return PIRATE_TYPE_KEYS.includes(type) ? type : 'normal';
}

export function normalizePirateArchetype(archetype) {
  return PIRATE_ARCHETYPE_KEYS.includes(archetype) ? archetype : 'standard';
}

export function normalizePirateTypePercentages(percentages) {
  const out = { normal: 0, sturdy: 0, fast: 0 };
  for (const key of PIRATE_TYPE_KEYS) {
    const value = Number(percentages?.[key]);
    out[key] = Number.isFinite(value) ? Math.max(0, value) : 0;
  }
  const total = out.normal + out.sturdy + out.fast;
  if (total <= 0) return { ...DEFAULT_PIRATE_TYPE_PERCENTAGES };
  return out;
}

export function ensureSpawnSettingsDefaults(spawnSettings) {
  const s = spawnSettings || {};
  if (!Array.isArray(s.tiers)) s.tiers = [];

  s.initialDelay = Number.isFinite(Number(s.initialDelay))
    ? Number(s.initialDelay)
    : DEFAULT_SPAWN_SETTINGS.initialDelay;
  s.waveIntervalMin = Number.isFinite(Number(s.waveIntervalMin))
    ? Number(s.waveIntervalMin)
    : DEFAULT_SPAWN_SETTINGS.waveIntervalMin;
  s.waveIntervalMax = Number.isFinite(Number(s.waveIntervalMax))
    ? Number(s.waveIntervalMax)
    : DEFAULT_SPAWN_SETTINGS.waveIntervalMax;
  s.waveSizeMin = Number.isFinite(Number(s.waveSizeMin))
    ? Number(s.waveSizeMin)
    : DEFAULT_SPAWN_SETTINGS.waveSizeMin;
  s.waveSizeMax = Number.isFinite(Number(s.waveSizeMax))
    ? Number(s.waveSizeMax)
    : DEFAULT_SPAWN_SETTINGS.waveSizeMax;
  s.pirateTypePercentages = normalizePirateTypePercentages(s.pirateTypePercentages);

  for (const tier of s.tiers) {
    tier.startTime = Number.isFinite(Number(tier.startTime))
      ? Number(tier.startTime)
      : DEFAULT_SPAWN_TIER_SETTINGS.startTime;
    tier.waveIntervalMin = Number.isFinite(Number(tier.waveIntervalMin))
      ? Number(tier.waveIntervalMin)
      : DEFAULT_SPAWN_TIER_SETTINGS.waveIntervalMin;
    tier.waveIntervalMax = Number.isFinite(Number(tier.waveIntervalMax))
      ? Number(tier.waveIntervalMax)
      : DEFAULT_SPAWN_TIER_SETTINGS.waveIntervalMax;
    tier.waveSizeMin = Number.isFinite(Number(tier.waveSizeMin))
      ? Number(tier.waveSizeMin)
      : DEFAULT_SPAWN_TIER_SETTINGS.waveSizeMin;
    tier.waveSizeMax = Number.isFinite(Number(tier.waveSizeMax))
      ? Number(tier.waveSizeMax)
      : DEFAULT_SPAWN_TIER_SETTINGS.waveSizeMax;
    tier.pirateTypePercentages = normalizePirateTypePercentages(tier.pirateTypePercentages);
  }
  return s;
}

export function ensurePirateBaseSpawnDefaults(base) {
  base.pirateArchetype = normalizePirateArchetype(base.pirateArchetype);
  base.defenseTypePercentages = normalizePirateTypePercentages(base.defenseTypePercentages);
  base.waveSpawnTypePercentages = normalizePirateTypePercentages(base.waveSpawnTypePercentages);
  base.waveSpawnCount = Math.max(1, Math.round(Number(base.waveSpawnCount) || 4));
}

```

## js\pirate.js
```
import {
  PIRATE_ACCEL, PIRATE_FRICTION, PIRATE_MAX_SPEED, PIRATE_HEALTH, PIRATE_BULLET_SPEED,
  PIRATE_BASE_AGGRO_RADIUS, BASE_DEFENSE_ORBIT_RADIUS, BASE_DEFENSE_ORBIT_SPEED,
  SHIP_COLLISION_RADIUS, STRUCTURE_SIZE_COLL, SHIP_SIZE,
  PIRATE_FIRE_RANGE, PIRATE_AIM_SPREAD, PIRATE_TILT_SENSITIVITY, PIRATE_TILT_DECAY,
  isCollidableStructure
} from './constants.js';
import { pushOutOverlap, bounceEntity } from './utils.js';

const PIRATE_BOUNCE_RESTITUTION = 0.3; // 1.3x reflection factor = 1 + 0.3

export class PirateSystem {
  constructor() {
    this.pirates = [];
    this.nextWaveTime = 120;
  }

  spawnPirateGroup(x, y, count, fromBase = null) {
    for (let i = 0; i < count; i++) {
      const angle = Math.random() * Math.PI * 2;
      const dist = 50 + Math.random() * 100;
      this.pirates.push({
        id: Math.random(),
        x: x + Math.cos(angle) * dist,
        y: y + Math.sin(angle) * dist,
        vx: 0,
        vy: 0,
        health: PIRATE_HEALTH,
        maxHealth: PIRATE_HEALTH,
        state: 'chase',
        stateTimer: 0,
        facingAngle: 0,
        cooldown: Math.random() * 2,
        defendingBase: fromBase,
        orbitAngle: Math.random() * Math.PI * 2,
        orbitRadius: BASE_DEFENSE_ORBIT_RADIUS + (Math.random() - 0.5) * 40,
        fromBaseSpawn: !!fromBase
      });
    }
  }

  update(dt, ship, asteroids, structures, bullets, levelElapsedTime, levelSpawnSettings, levelIsDebug) {
     for (let i = this.pirates.length - 1; i >= 0; i--) {
        const p = this.pirates[i];
        let inDefenseMode = false;
        
        if (p.defendingBase) {
            const base = p.defendingBase;
            if (base.health <= 0 || base.dead || base.aggroed) {
                // treat as normal chase pirate
            } else {
                inDefenseMode = true;
                p.orbitAngle += dt * BASE_DEFENSE_ORBIT_SPEED;
                p.x = base.x + Math.cos(p.orbitAngle) * (p.orbitRadius || BASE_DEFENSE_ORBIT_RADIUS);
                p.y = base.y + Math.sin(p.orbitAngle) * (p.orbitRadius || BASE_DEFENSE_ORBIT_RADIUS);
                p.vx = 0;
                p.vy = 0;
                p.facingAngle = p.orbitAngle + Math.PI / 2;
            }
        }

        const dx = ship.x - p.x;
        const dy = ship.y - p.y;
        const distToPlayer = Math.sqrt(dx * dx + dy * dy);
        const dirToPlayer = distToPlayer > 0 ? { x: dx / distToPlayer, y: dy / distToPlayer } : { x: 0, y: 0 };

        if (!inDefenseMode) {
             p.stateTimer -= dt;
             if (p.stateTimer <= 0) {
                 p.state = Math.random() < 0.6 ? 'chase' : 'circle';
                 p.stateTimer = 2 + Math.random() * 4;
             }
             
             let ax = 0;
             let ay = 0;
             if (p.state === 'chase') {
                 ax += dirToPlayer.x * PIRATE_ACCEL;
                 ay += dirToPlayer.y * PIRATE_ACCEL;
             } else {
                 const cw = (p.id > 0.5) ? 1 : -1;
                 ax += -dirToPlayer.y * cw * PIRATE_ACCEL;
                 ay += dirToPlayer.x * cw * PIRATE_ACCEL;
             }
             
             // Avoidance
             const lookAhead = 150;
             const lookAheadObstacle = 50;
             
             for (const ast of asteroids) {
                 const adx = ast.x - p.x;
                 const ady = ast.y - p.y;
                 const adist = Math.sqrt(adx * adx + ady * ady);
                 if (adist < ast.radius + lookAheadObstacle) {
                     ax -= (adx / adist) * 400;
                     ay -= (ady / adist) * 400;
                 }
             }
             
             for (const st of structures) {
                 if (!isCollidableStructure(st)) continue;
                 const sdx = st.x - p.x;
                 const sdy = st.y - p.y;
                 const sdist = Math.sqrt(sdx * sdx + sdy * sdy);
                 if (sdist < STRUCTURE_SIZE_COLL + lookAheadObstacle) {
                     ax -= (sdx / sdist) * 400;
                     ay -= (sdy / sdist) * 400;
                 }
             }
             
             const PLAYER_AVOID_RADIUS = 5;
             if (distToPlayer > 0 && distToPlayer < PLAYER_AVOID_RADIUS + lookAhead) {
                 ax -= (dx / distToPlayer) * 400;
                 ay -= (dy / distToPlayer) * 400;
             }
             
             for (const other of this.pirates) {
                 if (other === p) continue;
                 const odx = other.x - p.x;
                 const ody = other.y - p.y;
                 const odist = Math.sqrt(odx * odx + ody * ody);
                 if (odist < 40) {
                     ax -= (odx / odist) * 200;
                     ay -= (ody / odist) * 200;
                 }
             }

             p.vx += ax * dt;
             p.vy += ay * dt;
             
             // Facing
             const thrustMag = Math.sqrt(ax * ax + ay * ay);
             if (thrustMag > 10) {
                 const targetAngle = Math.atan2(ay, ax);
                 let angleDiff = targetAngle - p.facingAngle;
                 while (angleDiff > Math.PI) angleDiff -= Math.PI * 2;
                 while (angleDiff < -Math.PI) angleDiff += Math.PI * 2;
                 p.facingAngle += angleDiff * Math.min(1, 3 * dt);
             }
             
             // Friction & max speed
             p.vx *= Math.max(0, 1 - PIRATE_FRICTION * dt);
             p.vy *= Math.max(0, 1 - PIRATE_FRICTION * dt);
             const speed = Math.sqrt(p.vx * p.vx + p.vy * p.vy);
             if (speed > PIRATE_MAX_SPEED) {
                 const scale = PIRATE_MAX_SPEED / speed;
                 p.vx *= scale;
                 p.vy *= scale;
             }
             
             p.x += p.vx * dt;
             p.y += p.vy * dt;
        }
        
        // Collisions â€“ asteroids
        for (const ast of asteroids) {
            const hit = pushOutOverlap(p, ast, SHIP_COLLISION_RADIUS, ast.radius);
            if (hit) bounceEntity(p, hit.nx, hit.ny, PIRATE_BOUNCE_RESTITUTION);
        }
        
        // Collisions â€“ structures
        for (const st of structures) {
            if (!isCollidableStructure(st)) continue;
            const hit = pushOutOverlap(p, st, SHIP_COLLISION_RADIUS, STRUCTURE_SIZE_COLL);
            if (hit) bounceEntity(p, hit.nx, hit.ny, PIRATE_BOUNCE_RESTITUTION);
        }
        
        // Firing
        if (!inDefenseMode) {
            p.cooldown -= dt;
            if (p.cooldown <= 0 && distToPlayer < PIRATE_FIRE_RANGE) {
                p.cooldown = 1.0 + Math.random() * 2.0;
                
                const timeToHit = distToPlayer / PIRATE_BULLET_SPEED;
                const predX = ship.x + ship.vx * timeToHit;
                const predY = ship.y + ship.vy * timeToHit;
                
                const aimX = predX + (Math.random() - 0.5) * PIRATE_AIM_SPREAD;
                const aimY = predY + (Math.random() - 0.5) * PIRATE_AIM_SPREAD;
                
                const fdx = aimX - p.x;
                const fdy = aimY - p.y;
                const fdist = Math.sqrt(fdx * fdx + fdy * fdy);
                const fdir = (fdist > 0) ? { x: fdx / fdist, y: fdy / fdist } : { x: 1, y: 0 };
                
                bullets.push({
                    x: p.x + fdir.x * SHIP_SIZE,
                    y: p.y + fdir.y * SHIP_SIZE,
                    vx: fdir.x * PIRATE_BULLET_SPEED + p.vx,
                    vy: fdir.y * PIRATE_BULLET_SPEED + p.vy,
                    lifespan: 4,
                    owner: 'pirate'
                });
            }
        }
        
        // Tilt
        let deltaAngle = p.facingAngle - (p.prevFacingAngle !== undefined ? p.prevFacingAngle : p.facingAngle);
        while (deltaAngle > Math.PI) deltaAngle -= 2 * Math.PI;
        while (deltaAngle < -Math.PI) deltaAngle += 2 * Math.PI;
        p.prevFacingAngle = p.facingAngle;
        
        p.tilt = (p.tilt || 0) + deltaAngle * PIRATE_TILT_SENSITIVITY - (p.tilt || 0) * PIRATE_TILT_DECAY * dt;
        p.tilt = Math.max(-0.5, Math.min(0.5, p.tilt));
     }
  }
}

```

## js\main.js
```
import * as THREE from '../vendor/three/build/three.module.js';
import { GLTFLoader } from '../vendor/three/examples/jsm/loaders/GLTFLoader.js';

// Bridge: expose Three + GLTFLoader for existing game.js code.
window.THREE = THREE;
window.GLTFLoader = GLTFLoader;

// Run the game after Three is ready.
import('./game.js');

```

## js\inventory.js
```
import { getMaxStack } from './utils.js';

const ENERGY_CELL_ITEMS = new Set(['small energy cell', 'medium energy cell', 'large energy cell']);

export class Inventory {
  constructor(size = 9) {
    this.slots = new Array(size).fill(null);
    this.selectedSlot = 0;
  }

  add(itemName, quantity) {
    const maxStack = getMaxStack(itemName);

    while (quantity > 0) {
      // First try to stack with existing item
      let added = false;
      for (let i = 0; i < this.slots.length && quantity > 0; i++) {
        if (this.slots[i] && this.slots[i].item === itemName && this.slots[i].quantity != null && this.slots[i].quantity < maxStack) {
          const space = maxStack - this.slots[i].quantity;
          const add = Math.min(quantity, space);
          this.slots[i].quantity += add;
          quantity -= add;
          added = true;
        }
      }
      if (quantity <= 0) return true;

      // Otherwise find first empty slot
      for (let i = 0; i < this.slots.length; i++) {
        if (!this.slots[i]) {
          const add = Math.min(quantity, maxStack);
          this.slots[i] = { item: itemName, quantity: add };
          quantity -= add;
          added = true;
          break;
        }
      }
      if (!added) return false; // Inventory full
    }
    return true;
  }

  get(index) {
    return this.slots[index];
  }

  set(index, item) {
    this.slots[index] = item;
  }

  getSelected() {
    return this.slots[this.selectedSlot];
  }

  findFirstEnergyCell(where) {
    for (let i = 0; i < this.slots.length; i++) {
      const cell = this.slots[i];
      if (!cell || !ENERGY_CELL_ITEMS.has(cell.item) || cell.energy == null) continue;
      if (!where || where(cell)) return cell;
    }
    return null;
  }

  getFirstChargedCell() {
    return this.findFirstEnergyCell((cell) => cell.energy > 0);
  }

  /** Resize inventory. Returns array of excess items that no longer fit (when shrinking). */
  resize(newSize) {
    const excess = [];
    if (newSize > this.slots.length) {
      while (this.slots.length < newSize) this.slots.push(null);
    } else if (newSize < this.slots.length) {
      for (let i = newSize; i < this.slots.length; i++) {
        if (this.slots[i]) excess.push(this.slots[i]);
      }
      this.slots.length = newSize;
    }
    return excess;
  }

  getFirstCellWithMinEnergy(min) {
    return this.findFirstEnergyCell((cell) => cell.energy >= min);
  }
}

```

## js\introCutscene.js
```
/**
 * introCutscene.js â€“ Self-contained intro cutscene for Space Jam.
 *
 * Exports a single function:
 *   playIntroCutscene(mapCanvas, dialogueEl, overlayEl, onComplete)
 *
 * The cutscene draws a procedural stellar map on `mapCanvas`, slowly zooms
 * toward "Sector 7" in the top-right quadrant, and types dialogue lines
 * into `dialogueEl` with a typewriter effect.  When finished (or skipped)
 * it fades the overlay out and calls `onComplete`.
 */

// â”€â”€â”€ Configuration â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

const MAP_W = 3200;   // offscreen map resolution
const MAP_H = 2400;

// Dialogue script: each entry is { text, preDelay (s before typing starts),
//                                    charDelay (s per character) }
const SCRIPT = [
  { text: 'Day 260.',                                          preDelay: 1.0,  charDelay: 0.06 },
  { text: 'The search continues... I need better gear.',       preDelay: 1.5,  charDelay: 0.04 },
  { text: 'Continuing in the Gamene Belt. The edge of space.', preDelay: 1.5,  charDelay: 0.04 },
  { text: 'Checking Sector 7....',                             preDelay: 1.5,  charDelay: 0.055 },
];

// Camera start/end for one clean continuous motion.
const SECTOR7_X = MAP_W * 0.78;
const SECTOR7_Y = MAP_H * 0.18;
const CAMERA_START_X = MAP_W / 2;
const CAMERA_START_Y = MAP_H / 2;
const CAMERA_END_X = SECTOR7_X;
const CAMERA_END_Y = SECTOR7_Y;
const ZOOM_START = 1.0;
const ZOOM_END = 288.0;
const PAN_EASE_OUT_POWER = 2.6;
const PAN_LOCK_SECONDS = 16.0;
const ZOOM_SPEED_MULT = 1.1;

const TOTAL_DURATION = 19; // shortened by 11 seconds total
const FINAL_LABEL_SECONDS = 10;
const FINAL_BLEND_SECONDS = 5;
const LOD_TIER_2_ZOOM = 2.2;
const LOD_TIER_3_ZOOM = 5.5;
const LOD_TIER_4_ZOOM = 11.5;
const PAN_LOCK_T = PAN_LOCK_SECONDS / TOTAL_DURATION;

// â”€â”€â”€ Helpers â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

function smoothstep(a, b, t) {
  const x = Math.max(0, Math.min(1, (t - a) / (b - a)));
  return x * x * (3 - 2 * x);
}

function lerp(a, b, t) {
  return a + (b - a) * t;
}

function getContinuousCameraPose(t) {
  const clamped = Math.max(0, Math.min(1, t));
  // Single global ease curve across the full intro for one continuous motion.
  const u = smoothstep(0, 1, clamped);
  // Pan fully to Sector 7 by 8 seconds; ease-out so it decelerates as it approaches.
  const panT = Math.max(0, Math.min(1, clamped / PAN_LOCK_T));
  const easedPanT = 1 - Math.pow(1 - panT, PAN_EASE_OUT_POWER);
  let panU = smoothstep(0, 1, easedPanT);
  if (clamped >= PAN_LOCK_T) panU = 1;
  // Slightly faster zoom progression so the end focuses on zoom, not pan.
  const zoomU = Math.max(0, Math.min(1, u * ZOOM_SPEED_MULT));
  return {
    cx: lerp(CAMERA_START_X, CAMERA_END_X, panU),
    cy: lerp(CAMERA_START_Y, CAMERA_END_Y, panU),
    // Exponential zoom feels more natural than linear at large zoom ranges.
    zoom: ZOOM_START * Math.pow(ZOOM_END / ZOOM_START, zoomU)
  };
}

function hash2ToUnit(x, y, seed = 0) {
  // Deterministic pseudo-random hash in [0, 1)
  const h = Math.sin((x * 127.1) + (y * 311.7) + (seed * 74.7)) * 43758.5453123;
  return h - Math.floor(h);
}

// â”€â”€â”€ Trade Route Generation â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
// Uses same procedural star logic as drawProceduralStarLOD (Tier 1) so routes
// connect actual star positions. All hash-based; fully deterministic.

const STAR_TIER_CELL_SIZE = 85;
const STAR_TIER_DENSITY = 0.28;
const STAR_TIER_SEED = 5001;
const ROUTE_SEED = 880033;
const ROUTE_MIN_DIST = 120;
const ROUTE_MAX_DIST = 450;
const ROUTE_CONNECT_PROB = 0.24;

function generateStarNodes() {
  const nodes = [];
  const cellSize = STAR_TIER_CELL_SIZE;
  const density = STAR_TIER_DENSITY;
  const seed = STAR_TIER_SEED;
  const cellStartX = Math.floor(0 / cellSize) - 1;
  const cellEndX = Math.floor(MAP_W / cellSize) + 1;
  const cellStartY = Math.floor(0 / cellSize) - 1;
  const cellEndY = Math.floor(MAP_H / cellSize) + 1;

  for (let cxCell = cellStartX; cxCell <= cellEndX; cxCell++) {
    for (let cyCell = cellStartY; cyCell <= cellEndY; cyCell++) {
      if (hash2ToUnit(cxCell, cyCell, seed) > density) continue;
      const ox = hash2ToUnit(cxCell, cyCell, seed + 13);
      const oy = hash2ToUnit(cxCell, cyCell, seed + 29);
      const wx = (cxCell + ox) * cellSize;
      const wy = (cyCell + oy) * cellSize;
      if (wx < -20 || wx > MAP_W + 20 || wy < -20 || wy > MAP_H + 20) continue;
      nodes.push({ x: wx, y: wy });
    }
  }
  // Sector 7 is excluded from trade routes so it remains isolated.
  return nodes;
}

function generateTradeRoutes() {
  const nodes = generateStarNodes();
  const routes = [];
  for (let i = 0; i < nodes.length; i++) {
    for (let j = i + 1; j < nodes.length; j++) {
      const dx = nodes[j].x - nodes[i].x;
      const dy = nodes[j].y - nodes[i].y;
      const dist = Math.sqrt(dx * dx + dy * dy);
      const connect = hash2ToUnit(i * 17, j * 31, ROUTE_SEED) < ROUTE_CONNECT_PROB;
      if (dist >= ROUTE_MIN_DIST && dist <= ROUTE_MAX_DIST && connect) {
        const lodPick = hash2ToUnit(i * 53, j * 97, ROUTE_SEED + 29);
        const lodLevel = (lodPick < 0.35) ? 1 : (lodPick < 0.62) ? 2 : (lodPick < 0.82) ? 3 : 4;
        routes.push({ ax: nodes[i].x, ay: nodes[i].y, bx: nodes[j].x, by: nodes[j].y, lodLevel });
      }
    }
  }
  return routes;
}

// â”€â”€â”€ Offscreen Map Generation â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

function generateMap() {
  const off = document.createElement('canvas');
  off.width = MAP_W;
  off.height = MAP_H;
  const ctx = off.getContext('2d');

  // Background
  ctx.fillStyle = '#050510';
  ctx.fillRect(0, 0, MAP_W, MAP_H);

  // â”€â”€ Nebulae (large soft gradients) â”€â”€
  const nebulae = [
    { x: MAP_W * 0.20, y: MAP_H * 0.35, r: 600, color: [90, 40, 140] },
    { x: MAP_W * 0.50, y: MAP_H * 0.55, r: 500, color: [30, 60, 130] },
    { x: MAP_W * 0.75, y: MAP_H * 0.25, r: 450, color: [20, 100, 100] },
    { x: MAP_W * 0.35, y: MAP_H * 0.75, r: 550, color: [110, 30, 70] },
    { x: MAP_W * 0.85, y: MAP_H * 0.65, r: 400, color: [40, 50, 120] },
    { x: MAP_W * 0.12, y: MAP_H * 0.15, r: 350, color: [60, 30, 100] },
    { x: MAP_W * 0.60, y: MAP_H * 0.12, r: 380, color: [25, 80, 90] },
  ];
  for (const n of nebulae) {
    const grad = ctx.createRadialGradient(n.x, n.y, 0, n.x, n.y, n.r);
    const [r, g, b] = n.color;
    grad.addColorStop(0, `rgba(${r},${g},${b},0.18)`);
    grad.addColorStop(0.4, `rgba(${r},${g},${b},0.08)`);
    grad.addColorStop(1, `rgba(${r},${g},${b},0)`);
    ctx.fillStyle = grad;
    ctx.beginPath();
    ctx.arc(n.x, n.y, n.r, 0, Math.PI * 2);
    ctx.fill();
  }

  // Stars (including Sector 7) are drawn in screen space per tier so they stay fixed size.

  return off;
}

// â”€â”€â”€ Typewriter Engine â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

function runTypewriter(el, script, onDone, onCharTyped = null) {
  let lineIdx = 0;
  let charIdx = 0;
  let waitTimer = 0;
  let phase = 'wait'; // 'wait' | 'type' | 'done'
  const lines = []; // accumulated finished lines (as plain strings)
  let cancelled = false;

  // Start with pre-delay of first line
  waitTimer = script[0].preDelay;

  function buildHTML() {
    // Finished lines as dim text, current line being typed, plus cursor
    let html = '';
    for (let i = 0; i < lines.length; i++) {
      html += lines[i] + '\n';
    }
    if (lineIdx < script.length) {
      const partial = script[lineIdx].text.slice(0, charIdx);
      html += partial;
      html += '<span class="cursor-blink"></span>';
    }
    return html;
  }

  function tick(dt) {
    if (cancelled) return true;

    if (phase === 'wait') {
      waitTimer -= dt;
      if (waitTimer <= 0) {
        phase = 'type';
        charIdx = 0;
        waitTimer = 0;
      }
    }

    if (phase === 'type') {
      waitTimer -= dt;
      if (waitTimer <= 0) {
        charIdx++;
        if (onCharTyped) onCharTyped();
        if (charIdx >= script[lineIdx].text.length) {
          // Finished this line
          lines.push(script[lineIdx].text);
          lineIdx++;
          if (lineIdx >= script.length) {
            phase = 'done';
          } else {
            phase = 'wait';
            waitTimer = script[lineIdx].preDelay;
            charIdx = 0;
          }
        } else {
          waitTimer = script[lineIdx].charDelay;
        }
      }
    }

    el.innerHTML = buildHTML();

    if (phase === 'done') {
      if (onDone) onDone();
      return true;
    }
    return false;
  }

  function skipToEnd() {
    cancelled = true;
    // Show all text immediately
    el.innerHTML = script.map(s => s.text).join('\n');
    if (onDone) onDone();
  }

  return { tick, skipToEnd };
}

// â”€â”€â”€ Main Entry Point â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

export function playIntroCutscene(mapCanvas, dialogueEl, overlayEl, onComplete, transitionHooks = null) {
  const tradeRoutes = generateTradeRoutes();
  const mapImage = generateMap();
  const hooks = transitionHooks || {};
  const onBlendStart = (typeof hooks.onBlendStart === 'function') ? hooks.onBlendStart : null;
  const onBlendProgress = (typeof hooks.onBlendProgress === 'function') ? hooks.onBlendProgress : null;
  const onBlendComplete = (typeof hooks.onBlendComplete === 'function') ? hooks.onBlendComplete : null;
  const onTypeChar = (typeof hooks.onTypeChar === 'function') ? hooks.onTypeChar : null;
  const onSkip = (typeof hooks.onSkip === 'function') ? hooks.onSkip : null;

  // Size the visible canvas to match its CSS layout
  const rect = mapCanvas.getBoundingClientRect();
  const dpr = Math.min(3, Math.max(1, window.devicePixelRatio || 1));
  mapCanvas.width = Math.floor(rect.width * dpr);
  mapCanvas.height = Math.floor(rect.height * dpr);
  const mCtx = mapCanvas.getContext('2d');
  mCtx.imageSmoothingEnabled = true;
  mCtx.imageSmoothingQuality = 'high';

  const cw = mapCanvas.width;
  const ch = mapCanvas.height;

  let elapsed = 0;
  let done = false;
  let dialogueDone = false;
  let animId = null;
  let lastNow = performance.now();
  let blendStarted = false;

  const typewriter = runTypewriter(dialogueEl, SCRIPT, () => { dialogueDone = true; }, onTypeChar);

  function clearOverlayBlendStyles() {
    overlayEl.style.opacity = '';
    overlayEl.style.transform = '';
  }

  function getLastLabelT(elapsedSeconds) {
    const start = TOTAL_DURATION - FINAL_LABEL_SECONDS;
    return Math.max(0, Math.min(1, (elapsedSeconds - start) / FINAL_LABEL_SECONDS));
  }

  function getBlendT(elapsedSeconds) {
    const start = TOTAL_DURATION - FINAL_BLEND_SECONDS;
    return Math.max(0, Math.min(1, (elapsedSeconds - start) / FINAL_BLEND_SECONDS));
  }

  function applyOverlayBlend(blendT) {
    const t = Math.max(0, Math.min(1, blendT));
    overlayEl.style.opacity = String(1 - t);
    overlayEl.style.transform = `scale(${lerp(1, 1.06, t).toFixed(4)})`;
  }

  function notifyBlendProgress(elapsedSeconds) {
    const blendT = getBlendT(elapsedSeconds);
    if (blendT > 0 && !blendStarted) {
      blendStarted = true;
      if (onBlendStart) onBlendStart();
    }
    if (onBlendProgress) onBlendProgress(blendT);
    return blendT;
  }

  function finish() {
    if (done) return;
    done = true;
    if (animId) cancelAnimationFrame(animId);
    notifyBlendProgress(TOTAL_DURATION);
    if (onBlendComplete) onBlendComplete();
    clearOverlayBlendStyles();
    overlayEl.style.display = 'none';
    if (onComplete) onComplete();
  }

  function skip() {
    if (done) return;
    if (onSkip) onSkip();
    typewriter.skipToEnd();
    // Draw final frame at the end of the single timeline.
    drawMapFrame(TOTAL_DURATION);
    applyOverlayBlend(1);
    finish();
  }

  // Skip listeners
  function onKeyDown(e) {
    // Ignore modifier-only presses
    if (['Shift', 'Control', 'Alt', 'Meta'].includes(e.key)) return;
    skip();
  }
  function onClick() { skip(); }

  window.addEventListener('keydown', onKeyDown);
  overlayEl.addEventListener('click', onClick);

  function cleanup() {
    window.removeEventListener('keydown', onKeyDown);
    overlayEl.removeEventListener('click', onClick);
  }

  // Wrap onComplete to also clean up listeners
  const originalOnComplete = onComplete;
  onComplete = () => {
    cleanup();
    if (originalOnComplete) originalOnComplete();
  };

  function mapToScreen(x, y, sx, sy, srcW, srcH) {
    return {
      x: ((x - sx) / srcW) * cw,
      y: ((y - sy) / srcH) * ch
    };
  }

  function getWorldToScreenScale(srcW) {
    return cw / srcW;
  }

  function wrapDashOffset(value, period) {
    if (!Number.isFinite(period) || period <= 0) return 0;
    const mod = value % period;
    return (mod + period) % period;
  }

  // Draw grid lines in map-anchored vector space (always solid).
  function drawGridLayer(sx, sy, srcW, srcH, step, color, lineWidth) {
    const startX = Math.floor(sx / step) * step;
    const endX = sx + srcW;
    const startY = Math.floor(sy / step) * step;
    const endY = sy + srcH;
    const scale = getWorldToScreenScale(srcW);
    const dashPx = [];

    mCtx.save();
    mCtx.strokeStyle = color;
    mCtx.lineWidth = lineWidth;
    mCtx.setLineDash(dashPx);
    mCtx.lineCap = 'butt';

    for (let gx = startX; gx <= endX; gx += step) {
      const p1 = mapToScreen(gx, sy, sx, sy, srcW, srcH);
      const p2 = mapToScreen(gx, sy + srcH, sx, sy, srcW, srcH);
      mCtx.beginPath();
      mCtx.moveTo(p1.x, p1.y);
      mCtx.lineTo(p2.x, p2.y);
      mCtx.stroke();
    }
    for (let gy = startY; gy <= endY; gy += step) {
      const p1 = mapToScreen(sx, gy, sx, sy, srcW, srcH);
      const p2 = mapToScreen(sx + srcW, gy, sx, sy, srcW, srcH);
      mCtx.beginPath();
      mCtx.moveTo(p1.x, p1.y);
      mCtx.lineTo(p2.x, p2.y);
      mCtx.stroke();
    }
    mCtx.restore();
  }

  // Draw route layer per LOD in vector space for crisp lines at all zoom levels.
  function drawTradeRoutesLayer(sx, sy, srcW, srcH, lodLevel, alpha, lineWidth) {
    const margin = 100;
    const scale = getWorldToScreenScale(srcW);
    const dashWorld = [14, 16];
    const dashPx = [dashWorld[0] * scale, dashWorld[1] * scale];
    const periodPx = dashPx[0] + dashPx[1];

    mCtx.save();
    mCtx.strokeStyle = `rgba(100,180,220,${alpha})`;
    mCtx.lineWidth = lineWidth;
    mCtx.setLineDash(dashPx);
    mCtx.lineCap = 'butt';

    for (const r of tradeRoutes) {
      if (r.lodLevel !== lodLevel) continue;
      const pa = mapToScreen(r.ax, r.ay, sx, sy, srcW, srcH);
      const pb = mapToScreen(r.bx, r.by, sx, sy, srcW, srcH);
      if (pa.x < -margin && pb.x < -margin) continue;
      if (pa.x > cw + margin && pb.x > cw + margin) continue;
      if (pa.y < -margin && pb.y < -margin) continue;
      if (pa.y > ch + margin && pb.y > ch + margin) continue;

      const dx = r.bx - r.ax;
      const dy = r.by - r.ay;
      const len = Math.hypot(dx, dy);
      if (len <= 0.0001) continue;
      const ux = dx / len;
      const uy = dy / len;
      const anchor = (r.ax * ux) + (r.ay * uy);
      mCtx.lineDashOffset = -wrapDashOffset(anchor * scale, periodPx);

      mCtx.beginPath();
      mCtx.moveTo(pa.x, pa.y);
      mCtx.lineTo(pb.x, pb.y);
      mCtx.stroke();
    }
    mCtx.restore();
  }

  function drawMapLabel(text, x, y, fontPx, color, sx, sy, srcW, srcH, align = 'center') {
    const screen = mapToScreen(x, y, sx, sy, srcW, srcH);
    if (screen.x < -140 || screen.x > cw + 140 || screen.y < -30 || screen.y > ch + 30) return;
    mCtx.save();
    mCtx.font = `${fontPx}px 'Oxanium', Arial, sans-serif`;
    mCtx.textAlign = align;
    mCtx.textBaseline = 'middle';
    mCtx.fillStyle = color;
    mCtx.fillText(text, screen.x, screen.y);
    mCtx.restore();
  }

  function drawProceduralStarLOD(sx, sy, srcW, srcH, cellSize, density, minSize, maxSize, alphaMin, alphaMax, seed) {
    const cellStartX = Math.floor(sx / cellSize) - 1;
    const cellEndX = Math.floor((sx + srcW) / cellSize) + 1;
    const cellStartY = Math.floor(sy / cellSize) - 1;
    const cellEndY = Math.floor((sy + srcH) / cellSize) + 1;

    for (let cxCell = cellStartX; cxCell <= cellEndX; cxCell++) {
      for (let cyCell = cellStartY; cyCell <= cellEndY; cyCell++) {
        const appear = hash2ToUnit(cxCell, cyCell, seed);
        if (appear > density) continue;

        const ox = hash2ToUnit(cxCell, cyCell, seed + 13);
        const oy = hash2ToUnit(cxCell, cyCell, seed + 29);
        const twinkle = hash2ToUnit(cxCell, cyCell, seed + 41);

        const wx = (cxCell + ox) * cellSize;
        const wy = (cyCell + oy) * cellSize;
        const p = mapToScreen(wx, wy, sx, sy, srcW, srcH);
        if (p.x < -6 || p.x > cw + 6 || p.y < -6 || p.y > ch + 6) continue;

        const size = minSize + (maxSize - minSize) * twinkle;
        const alpha = alphaMin + (alphaMax - alphaMin) * twinkle;
        mCtx.fillStyle = `rgba(235,245,255,${alpha})`;
        mCtx.fillRect(p.x - size / 2, p.y - size / 2, size, size);
      }
    }
  }

  // Draw three deterministic star fields per LOD tier (3x star count).
  function drawProceduralStarLODTriple(sx, sy, srcW, srcH, cellSize, density, minSize, maxSize, alphaMin, alphaMax, seed) {
    drawProceduralStarLOD(sx, sy, srcW, srcH, cellSize, density, minSize, maxSize, alphaMin, alphaMax, seed);
    drawProceduralStarLOD(sx, sy, srcW, srcH, cellSize, density, minSize, maxSize, alphaMin, alphaMax, seed + 100003);
    drawProceduralStarLOD(sx, sy, srcW, srcH, cellSize, density, minSize, maxSize, alphaMin, alphaMax, seed + 200009);
  }

  function drawStarAt(sx, sy, srcW, srcH, mapX, mapY, size, alpha) {
    const p = mapToScreen(mapX, mapY, sx, sy, srcW, srcH);
    if (p.x < -6 || p.x > cw + 6 || p.y < -6 || p.y > ch + 6) return;
    mCtx.fillStyle = `rgba(235,245,255,${alpha})`;
    mCtx.fillRect(p.x - size / 2, p.y - size / 2, size, size);
  }

  function drawTier1Overview(sx, sy, srcW, srcH) {
    drawGridLayer(sx, sy, srcW, srcH, 420, 'rgba(70,110,150,0.12)', 1);
    drawTradeRoutesLayer(sx, sy, srcW, srcH, 1, 0.20, 1.1);
    drawProceduralStarLODTriple(sx, sy, srcW, srcH, 85, 0.28, 0.6, 1.2, 0.3, 0.65, 5001);
    drawStarAt(sx, sy, srcW, srcH, SECTOR7_X, SECTOR7_Y, 0.9, 0.5);
    drawMapLabel('CORE WORLDS', MAP_W * 0.38, MAP_H * 0.50, 26, 'rgba(140,180,220,0.20)', sx, sy, srcW, srcH);
    drawMapLabel('OUTER RIM', MAP_W * 0.15, MAP_H * 0.22, 18, 'rgba(140,180,220,0.16)', sx, sy, srcW, srcH);
    drawMapLabel('GAMENE BELT', MAP_W * 0.72, MAP_H * 0.18, 20, 'rgba(160,220,210,0.24)', sx, sy, srcW, srcH);
    drawMapLabel('FRONTIER', MAP_W * 0.55, MAP_H * 0.82, 16, 'rgba(140,180,220,0.13)', sx, sy, srcW, srcH);
  }

  function drawTier2SectorMap(sx, sy, srcW, srcH) {
    drawGridLayer(sx, sy, srcW, srcH, 220, 'rgba(90,140,190,0.18)', 1);
    drawTradeRoutesLayer(sx, sy, srcW, srcH, 2, 0.18, 1.0);
    // Higher-detail star points that stay sharp as zoom increases.
    drawProceduralStarLODTriple(sx, sy, srcW, srcH, 46, 0.34, 0.8, 1.4, 0.35, 0.7, 1001);
    drawStarAt(sx, sy, srcW, srcH, SECTOR7_X, SECTOR7_Y, 1.1, 0.55);
    const sectorDots = [
      { name: 'S-3', x: MAP_W * 0.68, y: MAP_H * 0.22 },
      { name: 'S-5', x: MAP_W * 0.73, y: MAP_H * 0.13 },
      { name: 'S-9', x: MAP_W * 0.82, y: MAP_H * 0.25 },
      { name: 'S-12', x: MAP_W * 0.70, y: MAP_H * 0.30 },
      { name: 'S-1', x: MAP_W * 0.60, y: MAP_H * 0.28 }
    ];
    mCtx.save();
    for (const s of sectorDots) {
      const p = mapToScreen(s.x, s.y, sx, sy, srcW, srcH);
      if (p.x < -30 || p.x > cw + 30 || p.y < -30 || p.y > ch + 30) continue;
      mCtx.fillStyle = 'rgba(170,210,240,0.50)';
      mCtx.beginPath();
      mCtx.arc(p.x, p.y, 2, 0, Math.PI * 2);
      mCtx.fill();
      drawMapLabel(s.name, s.x + 20, s.y, 10, 'rgba(170,210,240,0.40)', sx, sy, srcW, srcH, 'left');
    }
    mCtx.restore();
  }

  function drawTier3LocalDetails(sx, sy, srcW, srcH) {
    drawGridLayer(sx, sy, srcW, srcH, 120, 'rgba(110,170,220,0.22)', 1);
    drawGridLayer(sx, sy, srcW, srcH, 60, 'rgba(110,170,220,0.08)', 1);
    drawTradeRoutesLayer(sx, sy, srcW, srcH, 3, 0.14, 0.95);
    drawProceduralStarLODTriple(sx, sy, srcW, srcH, 28, 0.48, 0.9, 1.7, 0.4, 0.78, 2003);
    drawStarAt(sx, sy, srcW, srcH, SECTOR7_X, SECTOR7_Y, 1.3, 0.6);

    // Local neighborhood markers around Sector 7 (still no special S7 label yet).
    const localNodes = [
      { name: 'NODE A', x: SECTOR7_X - 80, y: SECTOR7_Y + 50 },
      { name: 'NODE B', x: SECTOR7_X + 95, y: SECTOR7_Y - 45 },
      { name: 'NODE C', x: SECTOR7_X - 120, y: SECTOR7_Y - 70 },
      { name: 'NODE D', x: SECTOR7_X + 140, y: SECTOR7_Y + 65 }
    ];
    for (const node of localNodes) {
      const p = mapToScreen(node.x, node.y, sx, sy, srcW, srcH);
      if (p.x < -30 || p.x > cw + 30 || p.y < -30 || p.y > ch + 30) continue;
      mCtx.fillStyle = 'rgba(160,210,240,0.35)';
      mCtx.beginPath();
      mCtx.arc(p.x, p.y, 1.8, 0, Math.PI * 2);
      mCtx.fill();
      drawMapLabel(node.name, node.x + 16, node.y, 9, 'rgba(160,210,240,0.28)', sx, sy, srcW, srcH, 'left');
    }
  }

  function drawTier4FinalApproach(sx, sy, srcW, srcH, zoom) {
    drawGridLayer(sx, sy, srcW, srcH, 45, 'rgba(120,200,240,0.18)', 1);
    drawTradeRoutesLayer(sx, sy, srcW, srcH, 4, 0.12, 0.9);
    drawProceduralStarLODTriple(sx, sy, srcW, srcH, 18, 0.62, 1.0, 2.0, 0.45, 0.88, 3007);

    // Add dense close-up star detail only at final LOD.
    for (let i = 0; i < 70; i++) {
      const angle = i * 0.27;
      const radius = 25 + ((i * 17) % 90);
      const x = SECTOR7_X + Math.cos(angle) * radius;
      const y = SECTOR7_Y + Math.sin(angle) * radius * 0.8;
      const p = mapToScreen(x, y, sx, sy, srcW, srcH);
      if (p.x < -10 || p.x > cw + 10 || p.y < -10 || p.y > ch + 10) continue;
      const starSize = (i % 3 === 0) ? 1.5 : 1;
      mCtx.fillStyle = (i % 4 === 0) ? 'rgba(190,220,255,0.60)' : 'rgba(230,230,255,0.55)';
      mCtx.fillRect(p.x - starSize / 2, p.y - starSize / 2, starSize, starSize);
    }

    // No fixed Sector 7 marker in the final section; zoom drives the transition.
  }

  function drawMapFrame(elapsedSeconds) {
    const tNorm = Math.max(0, Math.min(1, elapsedSeconds / TOTAL_DURATION));
    const { cx, cy, zoom } = getContinuousCameraPose(tNorm);
    const lastLabelT = getLastLabelT(elapsedSeconds);
    const blendT = getBlendT(elapsedSeconds);

    // Source rect on offscreen map
    const viewW = MAP_W / zoom;
    const viewH = MAP_H / zoom;
    // Maintain aspect ratio of destination canvas
    const aspect = cw / ch;
    let srcW = viewW;
    let srcH = viewW / aspect;
    if (srcH > viewH) {
      srcH = viewH;
      srcW = viewH * aspect;
    }
    const sx = cx - srcW / 2;
    const sy = cy - srcH / 2;

    mCtx.clearRect(0, 0, cw, ch);
    mCtx.fillStyle = '#050510';
    mCtx.fillRect(0, 0, cw, ch);
    mCtx.drawImage(mapImage, sx, sy, srcW, srcH, 0, 0, cw, ch);

    // Progressive map detail levels (4 LOD tiers).
    drawTier1Overview(sx, sy, srcW, srcH);
    if (zoom >= LOD_TIER_2_ZOOM) drawTier2SectorMap(sx, sy, srcW, srcH);
    if (zoom >= LOD_TIER_3_ZOOM) drawTier3LocalDetails(sx, sy, srcW, srcH);
    if (zoom >= LOD_TIER_4_ZOOM) drawTier4FinalApproach(sx, sy, srcW, srcH, zoom);

    // Last 5s: show a basic Sector 7 label above the target star.
    if (lastLabelT > 0) {
      const labelFadeIn = smoothstep(0, 0.25, lastLabelT);
      const labelAlpha = Math.max(0, Math.min(1, labelFadeIn));
      if (labelAlpha > 0) {
        const sector7Screen = mapToScreen(SECTOR7_X, SECTOR7_Y, sx, sy, srcW, srcH);
        mCtx.save();
        mCtx.font = `16px 'Oxanium', Arial, sans-serif`;
        mCtx.textAlign = 'center';
        mCtx.textBaseline = 'bottom';
        mCtx.fillStyle = `rgba(185,245,255,${(0.84 * labelAlpha).toFixed(3)})`;
        mCtx.fillText('Sector 7', sector7Screen.x, sector7Screen.y - 14);
        mCtx.restore();
      }
    }

    // Slight scanline / vignette overlay for atmosphere
    const vigGrad = mCtx.createRadialGradient(cw / 2, ch / 2, ch * 0.3, cw / 2, ch / 2, ch * 0.8);
    vigGrad.addColorStop(0, 'rgba(0,0,0,0)');
    vigGrad.addColorStop(1, 'rgba(0,0,0,0.35)');
    mCtx.fillStyle = vigGrad;
    mCtx.fillRect(0, 0, cw, ch);
  }

  function frame(now) {
    if (done) return;
    const dt = Math.min((now - lastNow) / 1000, 0.1);
    lastNow = now;
    elapsed += dt;

    // Update typewriter
    typewriter.tick(dt);

    // Draw map
    drawMapFrame(elapsed);
    const blendT = notifyBlendProgress(elapsed);
    applyOverlayBlend(blendT);

    // Auto-finish when both zoom and dialogue are done
    if (elapsed >= TOTAL_DURATION && dialogueDone) {
      finish();
      return;
    }

    animId = requestAnimationFrame(frame);
  }

  animId = requestAnimationFrame(frame);
}

```

## js\input.js
```
export class InputHandler {
  constructor(canvas) {
    this.canvas = canvas;
    this.mouseX = 0;
    this.mouseY = 0;
    this.rightMouseDown = false;
    this.leftMouseDown = false;
    this.ctrlBrake = false;
    this.keys = {};

    this.initListeners();
  }

  initListeners() {
    window.addEventListener('mousemove', (e) => {
      const rect = this.canvas.getBoundingClientRect();
      const scaleX = this.canvas.width / rect.width;
      const scaleY = this.canvas.height / rect.height;
      this.mouseX = (e.clientX - rect.left) * scaleX;
      this.mouseY = (e.clientY - rect.top) * scaleY;
    });

    this.canvas.addEventListener('mousedown', (e) => {
      if (e.button === 0) this.leftMouseDown = true;
      if (e.button === 2) this.rightMouseDown = true;
    });

    window.addEventListener('mouseup', (e) => {
      if (e.button === 0) this.leftMouseDown = false;
      if (e.button === 2) this.rightMouseDown = false;
    });

    window.addEventListener('contextmenu', (e) => e.preventDefault());

    window.addEventListener('keydown', (e) => {
      this.keys[e.code] = true;
      if (e.key === 'Control') this.ctrlBrake = true;
    });

    window.addEventListener('keyup', (e) => {
      this.keys[e.code] = false;
      if (e.key === 'Control') this.ctrlBrake = false;
    });
  }

  getMousePosition() {
    return { x: this.mouseX, y: this.mouseY };
  }

  isRightDown() {
    return this.rightMouseDown;
  }

  isLeftDown() {
    return this.leftMouseDown;
  }

  isCtrlDown() {
    return this.ctrlBrake;
  }
  
  isKeyDown(code) {
      return !!this.keys[code];
  }
  
  resetInputs() {
      this.leftMouseDown = false;
      this.rightMouseDown = false;
      this.ctrlBrake = false;
  }
}

```

## js\game.js
```
import { WIDTH, HEIGHT, ACCEL, FRICTION, BRAKE_FRICTION, MAX_SPEED_DEFAULT, BULLET_SPEED, FIRE_COOLDOWN, PIRATE_ACCEL, PIRATE_FRICTION, PIRATE_MAX_SPEED, PIRATE_HEALTH, PIRATE_BULLET_SPEED, PIRATE_BASE_AGGRO_RADIUS, BASE_DEFENSE_ORBIT_RADIUS, BASE_DEFENSE_ORBIT_SPEED, SHIP_SIZE, SHIP_COLLISION_RADIUS, SHIP_COLLECTION_RADIUS, LASER_HEAT_RATE, LASER_COOL_RATE, WEAPON_ENERGY_DRAIN, MINING_LASER_STATS, BLASTER_ENERGY_PER_SHOT, BLASTER_HEAT_PER_SHOT, BLASTER_COOL_RATE, BLASTER_FIRE_RATE, BLASTER_STATS, OXYGEN_DEPLETION_RATE, FUEL_DEPLETION_RATE, MAX_ORE_STACK, ORE_ITEMS, STRUCTURE_SIZE, STRUCTURE_RADIUS_3D, WARP_GATE_DASHED_EXTRA, SHOP_DASHED_EXTRA, WARP_GATE_DASHED_EXTRA_3D, SHOP_DASHED_EXTRA_3D, STRUCTURE_SIZE_COLL, PIRATE_BASE_HIT_RADIUS, STRUCTURE_STYLES, SHIP_STATS, ITEM_USAGE, ITEM_DISPLAY_NAMES, BOUNCE_RESTITUTION, MAX_COLLISION_DAMAGE, DAMAGE_PER_SPEED, MAGNET_RADIUS, MAGNET_STRENGTH, FLOAT_DRAG, FLOAT_STOP_SPEED, FLOAT_ITEM_RADIUS, FLOATING_ORE_SCALE, PARTICLE_DRAG, INTERACT_RADIUS, ITEM_BUY_PRICE, ITEM_SELL_PRICE, PIRATE_FIRE_RANGE, PIRATE_AIM_SPREAD, PIRATE_TILT_SENSITIVITY, PIRATE_TILT_DECAY, HEAT_WEAPONS, RESOURCE_BAR_CONFIG, isCollidableStructure, RAW_TO_REFINED } from './constants.js';
import { normalize, createSeededRandom, getMaxStack, getItemImagePath, getItemLabel, getItemPayload, pushOutOverlap, bounceEntity, raycastCircle } from './utils.js';
import { InputHandler } from './input.js';
import { Inventory } from './inventory.js';
import {
  PIRATE_TYPE_KEYS,
  DEFAULT_PIRATE_TYPE_PERCENTAGES,
  PIRATE_ARCHETYPE_KEYS,
  normalizePirateBaseTier,
  getPirateBaseTierScale,
  normalizePirateType,
  normalizePirateArchetype,
  normalizePirateTypePercentages,
  ensureSpawnSettingsDefaults,
  ensurePirateBaseSpawnDefaults
} from './pirateShared.js';
import { playIntroCutscene } from './introCutscene.js';
import { sfx } from './sfx.js';

const canvas = document.getElementById('game-canvas');
const ctx = canvas.getContext('2d');

// Three.js ship layer (3D model from scout-ship.glb)
let shipCanvas, shipScene, shipCamera, shipRenderer, shipMesh, shipModelLoaded = false;
let shipFlames = []; // Thruster flame meshes
let shipBaseScale = 1; // Base 3D model scale (set once on load)
const SHIP_MODEL_FILES = {
  scout: 'scout-ship.glb',
  cutter: 'cutter.glb',
  transport: 'transport.glb'
};
const shipModelSources = { scout: null, cutter: null, transport: null };
const PLAYER_SHIP_Y_OFFSET_BY_TYPE = { scout: 3, cutter: 5, transport: 5 };
const SHIP_PREVIEW_Y_OFFSET_FACTOR = 0.15; // Scout baseline nudge factor in preview.
// Small asteroid 3D models (radius 10-30)
let smallAsteroidModels = [null, null, null];
// Medium asteroid 3D models (radius 40-90)
let mediumAsteroidModels = [null, null];
// Large asteroid 3D model (radius 100+)
let largeAsteroidModel = null;
let oreModel = null;
let scrapModel = null;
let asteroidContainer = null;
let structureModels = {
  warpgate: null,
  shop: null,
  piratebase: { 1: null, 2: null, 3: null, 4: null, 5: null }
};
const pirateModelFiles = { standard: 'pirate-standard.glb', shotgun: 'pirate-shotgun.glb', slowing: 'pirate-slowing.glb', breaching: 'pirate-breaching.glb', drone: 'pirate-drone.glb' };
let pirateModels = { standard: null, shotgun: null, slowing: null, breaching: null, drone: null };
let pirateContainer = null;
let structureContainer = null;
let floatingOreContainer = null;
let levelSeed = 0;

// Pirate Globals
const pirates = [];
let levelElapsedTime = 0;
// Pirate wave spawning is scheduled against levelElapsedTime (seconds since level load).
// Keep an absolute "next wave at time T" so tier/phase changes don't reset the timer.
let pirateNextWaveTime = 120; // default; overwritten by loadLevel()
let levelIsDebug = false;

// Dynamic ship properties (updated when switching ships)
let MAX_SPEED = MAX_SPEED_DEFAULT;
let shipCollisionRadius = SHIP_COLLISION_RADIUS;
let shipScale = 1.0;
let shipDamageMult = 1.0;
let shipSlowTimer = 0;
let shipSlowVisualActive = false;
const SHIP_SLOW_DURATION = 3;
const SHIP_SLOW_FACTOR = 0.8;
const SHIP_SLOW_EMISSIVE_COLOR = 0xaa55ff;
const SHIP_SLOW_EMISSIVE_INTENSITY = 0.1;

canvas.width = WIDTH;
canvas.height = HEIGHT;

let uiCanvas = document.getElementById('ui-canvas');
let uiCtx = uiCanvas ? uiCanvas.getContext('2d') : null;
if (uiCanvas) {
  uiCanvas.width = WIDTH;
  uiCanvas.height = HEIGHT;
}

// Item icon images (preloaded for floating items)
const ITEM_IMAGES = {
  'fuel tank': new Image(),
  'small energy cell': new Image(),
  'medium energy cell': new Image(),
  'large energy cell': new Image(),
  'oxygen canister': new Image()
};
ITEM_IMAGES['fuel tank'].src = 'assets/fuel-can.png';
ITEM_IMAGES['small energy cell'].src = 'assets/energy-cell.png';
ITEM_IMAGES['medium energy cell'].src = 'assets/energy-cell.png';
ITEM_IMAGES['large energy cell'].src = 'assets/energy-cell.png';
ITEM_IMAGES['oxygen canister'].src = 'assets/oxygen-can.png';
const healthPackImg = new Image();
healthPackImg.src = 'assets/health-pack.png';
ITEM_IMAGES['health pack'] = healthPackImg;
ITEM_IMAGES['medium health pack'] = healthPackImg;
ITEM_IMAGES['large health pack'] = healthPackImg;
ITEM_IMAGES['medium fuel tank'] = ITEM_IMAGES['fuel tank'];
ITEM_IMAGES['large fuel tank'] = ITEM_IMAGES['fuel tank'];
ITEM_IMAGES['medium oxygen canister'] = ITEM_IMAGES['oxygen canister'];
ITEM_IMAGES['large oxygen canister'] = ITEM_IMAGES['oxygen canister'];
const laserImg = new Image();
laserImg.src = 'assets/laser.png';
ITEM_IMAGES['mining laser'] = laserImg;
ITEM_IMAGES['medium mining laser'] = laserImg;
ITEM_IMAGES['large mining laser'] = laserImg;
const blasterImg = new Image();
blasterImg.src = 'assets/blaster.png';
ITEM_IMAGES['light blaster'] = blasterImg;
ITEM_IMAGES['medium blaster'] = blasterImg;
ITEM_IMAGES['large blaster'] = blasterImg;
const warpKeyImg = new Image();
warpKeyImg.src = 'assets/warp-key.png';
ITEM_IMAGES['warp key'] = warpKeyImg;
const warpKeyFragmentImg = new Image();
warpKeyFragmentImg.src = 'assets/warp-key-fragment.png';
ITEM_IMAGES['warp key fragment'] = warpKeyFragmentImg;

// Ship (world coordinates, camera follows)
const ship = {
  x: 0,
  y: 0,
  vx: 0,
  vy: 0
};

// Player stats
const player = {
  health: 50.0,
  maxHealth: 50.0,
  fuel: 25.0,
  maxFuel: 25.0,
  oxygen: 30.0,
  maxOxygen: 30.0,
  credits: 10000
};

// Inventory
const inventory = new Inventory();
inventory.set(0, { item: 'mining laser', heat: 0, overheated: false });
inventory.set(1, { item: 'small energy cell', energy: 10, maxEnergy: 10 });
inventory.set(2, { item: 'small energy cell', energy: 10, maxEnergy: 10 });
const hotbar = inventory.slots; // Alias for compatibility

let selectedSlot = 0;
let blasterFireAccum = 0;
let hudDirty = true; // When true, updateHUD() will re-render; set by any mutation
let laserWasFiring = false;

// Input
const input = new InputHandler(canvas);
// Aliases for compatibility where possible, but primitives must be replaced

// Ship tilt (banks when turning, decays when resting)
let prevAimAngle = 0;
let shipTilt = 0;
let shipTiltInitialized = false;

let gamePaused = true;
let warpMenuOpen = false;
let shopMenuOpen = false;
let craftingMenuOpen = false;
let shipyardMenuOpen = false;
let startScreenOpen = true;
let deathScreenOpen = false;
let interactPromptAlpha = 0; // Fade alpha for interaction prompt (0-1)
let interactPromptTarget = null; // Current structure showing prompt
let tutorialTextTimer = 0; // Time remaining for tutorial text (seconds)
let tutorialTextTimerStarted = false; // True after player thrusts for the first time
let tutorialTextWorldX = 0; // World X position of tutorial text
let tutorialTextWorldY = 0; // World Y position of tutorial text
const OXYGEN_BAR_COLOR = '#44aaff';
const FUEL_BAR_COLOR = '#ffaa44';
const HEALTH_BAR_COLOR = '#ff4444';
const LOW_RESOURCE_THRESHOLD = 0.25;
const OUTSIDE_BORDER_OXYGEN_DRAIN_RATE = 1; // additive, per second
const SHIP_STATUS_TRANSIENT_DURATION = 0.75;
const SHIP_STATUS_TRANSIENT_FADE_DURATION = 0.3;
const SHIP_STATUS_PERSISTENT_FADE_DURATION = 0.225;
const SHIP_STATUS_BASE_Y_OFFSET = 72;
const SHIP_STATUS_LINE_SPACING = 16;
const shipStatusTransient = [];
const shipStatusPersistent = {
  text: '',
  color: '#fff',
  active: false,
  alpha: 0
};
const lowResourceState = {
  health: false,
  fuel: false,
  oxygen: false
};
let refineryMenuOpen = false;
let activeShopStructure = null;
let activeCraftingStructure = null;
const craftingInputSlots = [null, null, null, null, null, null, null, null, null];
let craftingOutputSlot = null;
let activeRefineryStructure = null;
const refineryInputSlots = [null, null, null, null];
let refineryOutputSlot = null;

// Start screen overlay â€” hidden during cutscene, shown as fallback.
const startOverlayEl = document.getElementById('start-menu-overlay');

// Intro cutscene overlay (replaces click-to-start).
function beginGame() {
  if (startOverlayEl) startOverlayEl.style.display = 'none';
  startScreenOpen = false;
  gamePaused = warpMenuOpen || shopMenuOpen || craftingMenuOpen || shipyardMenuOpen || refineryMenuOpen;
  input.leftMouseDown = false;
  input.rightMouseDown = false;
  input.ctrlBrake = false;
  sfx.stopLaserLoop();
  if (canvas && canvas.focus) canvas.focus();
}

const mainMenuOverlay = document.getElementById('main-menu-overlay');
const mainMenuStartBtn = document.getElementById('main-menu-start-btn');
const cutsceneOverlay = document.getElementById('intro-cutscene-overlay');
const cutsceneMapCanvas = document.getElementById('intro-map-canvas');
const cutsceneDialogue = document.getElementById('intro-dialogue-text');

if (mainMenuOverlay && mainMenuStartBtn) {
  // Show main menu; game loads in background. On Start Game, play cutscene then begin.
  mainMenuOverlay.style.display = 'flex';
  mainMenuStartBtn.addEventListener('click', (e) => {
    e.preventDefault();
    e.stopPropagation();
    sfx.unlock();
    mainMenuOverlay.style.display = 'none';
    if (cutsceneOverlay && cutsceneMapCanvas && cutsceneDialogue) {
      cutsceneOverlay.style.display = 'flex';
      playIntroCutscene(cutsceneMapCanvas, cutsceneDialogue, cutsceneOverlay, beginGame, {
        onTypeChar: () => sfx.playCutsceneTypeTick(),
        onSkip: () => sfx.playCutsceneSkip(),
        onBlendStart: () => sfx.playCutsceneBlendStart(),
        onBlendComplete: () => sfx.playCutsceneBlendComplete()
      });
    } else {
      beginGame();
    }
  });
} else if (cutsceneOverlay && cutsceneMapCanvas && cutsceneDialogue) {
  // Fallback: no main menu â€” play cutscene immediately.
  cutsceneOverlay.style.display = 'flex';
  playIntroCutscene(cutsceneMapCanvas, cutsceneDialogue, cutsceneOverlay, beginGame, {
    onTypeChar: () => sfx.playCutsceneTypeTick(),
    onSkip: () => sfx.playCutsceneSkip(),
    onBlendStart: () => sfx.playCutsceneBlendStart(),
    onBlendComplete: () => sfx.playCutsceneBlendComplete()
  });
} else if (startOverlayEl) {
  // Fallback: classic click-to-start if cutscene markup is missing.
  startOverlayEl.style.display = 'flex';
  startOverlayEl.addEventListener('click', (e) => {
    e.preventDefault();
    e.stopPropagation();
    sfx.unlock();
    beginGame();
  });
} else {
  // No overlays at all â€” just start.
  startScreenOpen = false;
  gamePaused = false;
}

// Death screen overlay (shown when HP reaches 0)
const deathOverlayEl = document.getElementById('death-menu-overlay');
const deathRestartBtn = document.getElementById('death-restart-btn');
if (deathRestartBtn) {
  deathRestartBtn.addEventListener('click', (e) => {
    e.preventDefault();
    e.stopPropagation();
    sfx.unlock();
    sfx.playRespawn();
    // Hard reset: reload page to reset all runtime state
    window.location.reload();
  });
}

// Bullets
const bullets = [];
let fireCooldown = 0;

// Asteroids (loaded from level)
let asteroids = [];
let structures = [];
let levelWidth = 10000;
let levelHeight = 10000;

// Floating items in space (dropped/jettisoned)
const floatingItems = [];

// Spark particles for laser impact
const particles = [];
let sparkCarry = 0; // fractional sparks accumulator (FPS independent)

function spawnSparks(x, y, count) {
  for (let i = 0; i < count; i++) {
    const angle = Math.random() * Math.PI * 2;
    const speed = 50 + Math.random() * 150;
    const life = 0.2 + Math.random() * 0.3; // 0.2-0.5 seconds
    particles.push({
      x: x,
      y: y,
      vx: Math.cos(angle) * speed,
      vy: Math.sin(angle) * speed,
      life,
      maxLife: life,
      size: 1 + Math.random() * 2
    });
  }
}

// Drag state for hotbar (Legacy canvas drag removed)



// Starfield
const NUM_STARS = 2400;
const stars = [];

function initStars() {
  const spread = 5000;
  for (let i = 0; i < NUM_STARS; i++) {
    stars.push({
      x: (Math.random() - 0.5) * 2 * spread,
      y: (Math.random() - 0.5) * 2 * spread,
      size: Math.random() * 2 + 0.5,
      brightness: 0.3 + Math.random() * 0.7
    });
  }
}


function worldToScreen(wx, wy) {
  return {
    x: wx - ship.x + WIDTH / 2,
    y: wy - ship.y + HEIGHT / 2
  };
}

function pushShipStatusTransient(text, color, duration = SHIP_STATUS_TRANSIENT_DURATION, fadeDuration = SHIP_STATUS_TRANSIENT_FADE_DURATION) {
  shipStatusTransient.push({
    text,
    color,
    remaining: Math.max(0.01, duration),
    fadeDuration: Math.max(0.01, fadeDuration)
  });
}

function setShipStatusPersistent(text, color, active) {
  shipStatusPersistent.text = text;
  shipStatusPersistent.color = color;
  shipStatusPersistent.active = !!active;
}

function updateShipStatus(dt) {
  const fadeOutRate = 1 / SHIP_STATUS_PERSISTENT_FADE_DURATION;
  const fadeInRate = fadeOutRate * 0.6;
  if (shipStatusPersistent.active) {
    shipStatusPersistent.alpha = Math.min(1, shipStatusPersistent.alpha + fadeInRate * dt);
  } else {
    shipStatusPersistent.alpha = Math.max(0, shipStatusPersistent.alpha - fadeOutRate * dt);
  }
  for (let i = shipStatusTransient.length - 1; i >= 0; i--) {
    const msg = shipStatusTransient[i];
    msg.remaining -= dt;
    if (msg.remaining <= 0) {
      shipStatusTransient[i] = shipStatusTransient[shipStatusTransient.length - 1];
      shipStatusTransient.pop();
    }
  }
}

function syncLowResourceStateFromPlayer() {
  lowResourceState.health = player.maxHealth > 0 && (player.health / player.maxHealth) <= LOW_RESOURCE_THRESHOLD;
  lowResourceState.fuel = player.maxFuel > 0 && (player.fuel / player.maxFuel) <= LOW_RESOURCE_THRESHOLD;
  lowResourceState.oxygen = player.maxOxygen > 0 && (player.oxygen / player.maxOxygen) <= LOW_RESOURCE_THRESHOLD;
}

function maybeNotifyLowResource(key, value, max, text, color) {
  const below = max > 0 && (value / max) <= LOW_RESOURCE_THRESHOLD;
  if (below && !lowResourceState[key]) {
    pushShipStatusTransient(text, color);
  }
  lowResourceState[key] = below;
}

// Laser raycast: find closest asteroid hit by a ray from (ox, oy) in direction (dx, dy)
function laserHitAsteroid(ox, oy, dx, dy, maxLen) {
  let closest = null;
  let closestDist = maxLen;
  for (const ast of asteroids) {
    const d = raycastCircle(ox, oy, dx, dy, ast.x, ast.y, ast.radius, closestDist);
    if (d >= 0) { closest = ast; closestDist = d; }
  }
  return closest ? { asteroid: closest, distance: closestDist } : null;
}

// Ray vs circle for pirate base
function laserHitPirateBase(ox, oy, dx, dy, maxLen) {
  let closest = null;
  let closestDist = maxLen;
  for (const st of structures) {
    if (st.type !== 'piratebase' || st.dead || st.health <= 0) continue;
    const d = raycastCircle(ox, oy, dx, dy, st.x, st.y, getPirateBaseHitRadius(st), closestDist);
    if (d >= 0) { closest = st; closestDist = d; }
  }
  return closest ? { structure: closest, distance: closestDist } : null;
}

const SHOT_SPREAD = 8;

function fireBullet() {
  const dx = input.mouseX - WIDTH / 2;
  const dy = input.mouseY - HEIGHT / 2;
  const dir = normalize(dx, dy);
  if (dir.x === 0 && dir.y === 0) return;
  const perp = { x: -dir.y, y: dir.x };
  const offsets = [-SHOT_SPREAD, 0, SHOT_SPREAD];
  for (const offset of offsets) {
    bullets.push({
      x: ship.x + dir.x * SHIP_SIZE * shipScale + perp.x * offset,
      y: ship.y + dir.y * SHIP_SIZE * shipScale + perp.y * offset,
      vx: dir.x * BULLET_SPEED + ship.vx,
      vy: dir.y * BULLET_SPEED + ship.vy,
      lifespan: 4,
      owner: 'player'
    });
  }
}

function fireBlasterPellet(pirateDmg, asteroidDmg) {
  const dx = input.mouseX - WIDTH / 2;
  const dy = input.mouseY - HEIGHT / 2;
  const dir = normalize(dx, dy);
  if (dir.x === 0 && dir.y === 0) return;
  bullets.push({
    x: ship.x + dir.x * SHIP_SIZE * shipScale,
    y: ship.y + dir.y * SHIP_SIZE * shipScale,
    vx: dir.x * BULLET_SPEED + ship.vx,
    vy: dir.y * BULLET_SPEED + ship.vy,
    lifespan: 4,
    owner: 'player',
    pirateDmg: pirateDmg,
    asteroidDmg: asteroidDmg
  });
}

function drawShip2D() {
  const cx = WIDTH / 2;
  const cy = HEIGHT / 2;
  const dx = input.mouseX - cx;
  const dy = input.mouseY - cy;
  const dir = normalize(dx, dy);
  const angle = Math.atan2(dir.y, dir.x);
  const S = SHIP_SIZE * shipScale;
  ctx.save();
  ctx.translate(cx, cy);
  ctx.rotate(angle);
  ctx.fillStyle = '#fff';
  ctx.strokeStyle = '#888';
  ctx.lineWidth = 1;
  ctx.beginPath();
  if (currentShipType === 'cutter') {
    // Wider, angular profile
    ctx.moveTo(S * 1.1, 0);
    ctx.lineTo(-S * 0.5, S * 0.8);
    ctx.lineTo(-S * 0.3, S * 0.2);
    ctx.lineTo(-S * 0.6, 0);
    ctx.lineTo(-S * 0.3, -S * 0.2);
    ctx.lineTo(-S * 0.5, -S * 0.8);
  } else if (currentShipType === 'transport') {
    // Large bulky shape
    ctx.moveTo(S * 0.9, 0);
    ctx.lineTo(S * 0.3, S * 0.7);
    ctx.lineTo(-S * 0.7, S * 0.7);
    ctx.lineTo(-S * 0.9, S * 0.3);
    ctx.lineTo(-S * 0.9, -S * 0.3);
    ctx.lineTo(-S * 0.7, -S * 0.7);
    ctx.lineTo(S * 0.3, -S * 0.7);
  } else {
    // Scout: default arrow shape
    ctx.moveTo(S, 0);
    ctx.lineTo(-S * 0.7, S * 0.6);
    ctx.lineTo(-S * 0.4, 0);
    ctx.lineTo(-S * 0.7, -S * 0.6);
  }
  ctx.closePath();
  ctx.fill();
  ctx.stroke();
  ctx.restore();
}

function createShipFlames(shipType) {
  const flameHeight = 0.42;
  const flameGeom = new THREE.ConeGeometry(0.105, flameHeight, 8);
  const flameMat = new THREE.MeshBasicMaterial({ color: 0xffcc44, transparent: true, opacity: 0.9 });
  const flame1 = new THREE.Mesh(flameGeom.clone(), flameMat.clone());
  const flame2 = new THREE.Mesh(flameGeom.clone(), flameMat.clone());
  flame1.rotation.x = -Math.PI / 2;
  flame2.rotation.x = -Math.PI / 2;
  flame1.position.set(0, 0, -flameHeight / 2);
  flame2.position.set(0, 0, -flameHeight / 2);
  const flameGroup1 = new THREE.Group();
  const flameGroup2 = new THREE.Group();
  flameGroup1.add(flame1);
  flameGroup2.add(flame2);
  const flameX = shipType === 'cutter' ? 0.235 : 0.15;
  flameGroup1.position.set(-flameX, 0.3, -0.9);
  flameGroup2.position.set(flameX, 0.3, -0.9);
  flameGroup1.visible = false;
  flameGroup2.visible = false;
  return [flameGroup1, flameGroup2];
}

function attachShipModelForType(shipType) {
  if (!shipScene || typeof THREE === 'undefined') return;
  const resolvedType = SHIP_MODEL_FILES[shipType] ? shipType : 'scout';
  const source = shipModelSources[resolvedType] || shipModelSources.scout;
  if (!source) return;

  if (shipMesh) {
    shipScene.remove(shipMesh);
    shipMesh = null;
    shipFlames = [];
  }

  const model = source.clone(true);
  const box = new THREE.Box3().setFromObject(model);
  const center = box.getCenter(new THREE.Vector3());
  const size = box.getSize(new THREE.Vector3());
  const maxDim = Math.max(size.x, size.y, size.z);
  const scale = (SHIP_SIZE * 2) / (maxDim > 0 ? maxDim : 1) * 1.2;
  shipBaseScale = scale;
  model.scale.setScalar(scale * shipScale);
  model.position.sub(center.multiplyScalar(scale * shipScale));
  // Flip to show ship tops (not undersides) in top-down view.
  model.rotation.x = Math.PI / 2;
  model.position.y += PLAYER_SHIP_Y_OFFSET_BY_TYPE[resolvedType] ?? PLAYER_SHIP_Y_OFFSET_BY_TYPE.scout;

  const [flameGroup1, flameGroup2] = createShipFlames(resolvedType);
  model.add(flameGroup1);
  model.add(flameGroup2);
  shipFlames = [flameGroup1, flameGroup2];

  shipMesh = model;
  shipScene.add(shipMesh);
  shipModelLoaded = true;
  setShipSlowVisual(shipSlowTimer > 0);
}

function drawCrosshairAndHeatBar() {
  if (!uiCtx) return;
  uiCtx.clearRect(0, 0, WIDTH, HEIGHT);
  if (shopMenuOpen) return;
  const armLen = 6;
  const centerGap = 2;
  const crosshairX = Math.floor(input.mouseX) + 0.5;
  const crosshairY = Math.floor(input.mouseY) + 0.5;
  const armW = 2;
  uiCtx.fillStyle = 'rgba(255, 255, 255, 0.9)';
  uiCtx.fillRect(crosshairX - armW / 2, crosshairY - armLen, armW, armLen - centerGap);
  uiCtx.fillRect(crosshairX - armW / 2, crosshairY + centerGap, armW, armLen - centerGap);
  uiCtx.strokeStyle = 'rgba(255, 255, 255, 0.9)';
  uiCtx.lineWidth = 1;
  uiCtx.lineCap = 'round';
  uiCtx.beginPath();
  uiCtx.moveTo(crosshairX - armLen, crosshairY);
  uiCtx.lineTo(crosshairX - centerGap, crosshairY);
  uiCtx.moveTo(crosshairX + centerGap, crosshairY);
  uiCtx.lineTo(crosshairX + armLen, crosshairY);
  uiCtx.stroke();
  const equipped = hotbar[selectedSlot];
  const hasHeatWeapon = equipped && equipped.heat != null && equipped.heat > 0 && (MINING_LASER_STATS[equipped.item] || BLASTER_STATS[equipped.item]);
  if (hasHeatWeapon) {
    const barW = 16;
    const barH = 4;
    const barY = input.mouseY + 8;
    const barX = input.mouseX - barW / 2;
    const isOverheated = equipped.overheated;
    uiCtx.fillStyle = isOverheated ? 'rgba(255, 0, 0, 0.2)' : 'rgba(255, 255, 255, 0.2)';
    uiCtx.fillRect(barX, barY, barW, barH);
    uiCtx.fillStyle = isOverheated ? 'rgba(255, 0, 0, 0.6)' : 'rgba(255, 255, 255, 0.6)';
    uiCtx.fillRect(barX, barY, barW * Math.min(1, equipped.heat), barH);
  }
}

function initShip3D() {
  if (typeof THREE === 'undefined') return;
  shipCanvas = document.getElementById('ship-canvas');
  if (!shipCanvas) return;
  const aspect = WIDTH / HEIGHT;
  shipCamera = new THREE.PerspectiveCamera(15, aspect, 1, 5000);
  shipCamera.position.set(0, 0, 3390);
  shipCamera.lookAt(0, 0, 0);
  shipScene = new THREE.Scene();
  asteroidContainer = new THREE.Group();
  shipScene.add(asteroidContainer);
  structureContainer = new THREE.Group();
  shipScene.add(structureContainer);
  pirateContainer = new THREE.Group();
  shipScene.add(pirateContainer);
  floatingOreContainer = new THREE.Group();
  shipScene.add(floatingOreContainer);
  const light = new THREE.DirectionalLight(0xffffff, 1);
  light.position.set(20, 20, 50);
  shipScene.add(light);
  const light2 = new THREE.DirectionalLight(0xffffff, 0.8);
  light2.position.set(-50, -30, 40);
  shipScene.add(light2);
  const topLight = new THREE.DirectionalLight(0xffffff, 3.0);
  topLight.position.set(0, 100, 20);
  shipScene.add(topLight);
  shipScene.add(new THREE.AmbientLight(0xffffff, 1.0));
  shipRenderer = new THREE.WebGLRenderer({ canvas: shipCanvas, antialias: true, alpha: true });
  shipRenderer.setPixelRatio(window.devicePixelRatio || 1);
  shipRenderer.setSize(WIDTH, HEIGHT);
  shipRenderer.setClearColor(0x000000, 0);
  const LoaderClass = (window.GLTFLoader || (THREE && THREE.GLTFLoader));
  if (!LoaderClass) return;
  const loader = new LoaderClass();
  Object.entries(SHIP_MODEL_FILES).forEach(([type, file]) => {
    const glbUrl = new URL('assets/' + file, window.location.href).toString();
    loader.load(glbUrl, (gltf) => {
      shipModelSources[type] = gltf.scene;
      if (!shipMesh || type === currentShipType) {
        attachShipModelForType(currentShipType);
      }
      // eslint-disable-next-line no-console
      console.log('[ship3d] Loaded ' + file);
    }, undefined, (err) => {
      // eslint-disable-next-line no-console
      console.error('[ship3d] Failed to load ' + file, err);
    });
  });

  function setupAsteroidModel(model) {
    model.traverse((child) => {
      if (child.isMesh && child.material) {
        const oldMat = child.material;
        const newMat = new THREE.MeshStandardMaterial({
          color: oldMat.color ? oldMat.color.clone() : 0x888888,
          map: oldMat.map || null,
          roughness: 0.8,
          metalness: 0.2,
          emissive: 0x333333,
          emissiveMap: oldMat.map || null,
          emissiveIntensity: 50.0
        });
        child.material = newMat;
      }
    });
    const box = new THREE.Box3().setFromObject(model);
    const center = box.getCenter(new THREE.Vector3());
    const size = box.getSize(new THREE.Vector3());
    const maxDim = Math.max(size.x, size.y, size.z);
    const scale = 1 / (maxDim > 0 ? maxDim : 1);
    model.scale.setScalar(scale);
    model.position.sub(center.multiplyScalar(scale));
    model.rotation.x = -Math.PI / 2;
  }
  let asteroidsLoaded = 0;
  const TOTAL_ASTEROID_MODELS = 6;
  const SMALL_ASTEROID_FILES = ['small-asteroid1.glb', 'small-asteroid2.glb', 'small-asteroid3.glb'];
  const MEDIUM_ASTEROID_FILES = ['medium-asteroid1.glb', 'medium-asteroid2.glb'];
  function onAsteroidLoaded() {
    asteroidsLoaded++;
    if (asteroidsLoaded === TOTAL_ASTEROID_MODELS) refreshAsteroidMeshes();
  }
  SMALL_ASTEROID_FILES.forEach((filename, i) => {
    const url = new URL('assets/' + filename, window.location.href).toString();
    loader.load(url, (gltf) => {
      const model = gltf.scene;
      setupAsteroidModel(model);
      smallAsteroidModels[i] = model;
      onAsteroidLoaded();
      console.log('[ship3d] Loaded ' + filename);
    }, undefined, (err) => console.error('[ship3d] Failed to load ' + filename, err));
  });
  MEDIUM_ASTEROID_FILES.forEach((filename, i) => {
    const url = new URL('assets/' + filename, window.location.href).toString();
    loader.load(url, (gltf) => {
      const model = gltf.scene;
      setupAsteroidModel(model);
      mediumAsteroidModels[i] = model;
      onAsteroidLoaded();
      console.log('[ship3d] Loaded ' + filename);
    }, undefined, (err) => console.error('[ship3d] Failed to load ' + filename, err));
  });
  loader.load(new URL('assets/large-asteroid1.glb', window.location.href).toString(), (gltf) => {
    const model = gltf.scene;
    setupAsteroidModel(model);
    largeAsteroidModel = model;
    onAsteroidLoaded();
    console.log('[ship3d] Loaded large-asteroid1.glb');
  }, undefined, (err) => console.error('[ship3d] Failed to load large-asteroid1.glb', err));

  function setupStructureModel(model, structureType) {
    const isPirateBase = structureType === 'piratebase';
    model.traverse((child) => {
      if (child.isMesh && child.material) {
        const oldMat = child.material;
        const newMat = new THREE.MeshStandardMaterial({
          color: oldMat.color ? oldMat.color.clone() : 0x888888,
          map: oldMat.map || null,
          roughness: 0.8,
          metalness: 0.2,
          emissive: isPirateBase ? 0x882222 : 0x333333,
          emissiveMap: oldMat.map || null,
          emissiveIntensity: isPirateBase ? 0.08 : 50.0
        });
        child.material = newMat;
      }
    });
    const box = new THREE.Box3().setFromObject(model);
    const center = box.getCenter(new THREE.Vector3());
    const size = box.getSize(new THREE.Vector3());
    const maxDim = Math.max(size.x, size.y, size.z);
    const scale = 1 / (maxDim > 0 ? maxDim : 1);
    model.scale.setScalar(scale);
    model.position.sub(center.multiplyScalar(scale));
    model.rotation.x = Math.PI / 4; // 45Â° tilt downward
    if (structureType === 'crafting') {
      model.rotation.y = (310 * Math.PI) / 180; // 310Â° on horizontal
    } else {
      model.rotation.y = Math.PI / 4; // 45Â°
    }
  }
  const STRUCTURE_FILES = [
    { type: 'warpgate', file: 'warp-gate.glb' },
    { type: 'shop', file: 'shop.glb' },
    { type: 'shipyard', file: 'shipyard.glb' },
    { type: 'refinery', file: 'refinery.glb' },
    { type: 'crafting', file: 'crafting-station.glb' }
  ];
  STRUCTURE_FILES.forEach(({ type, file }) => {
    loader.load(new URL('assets/' + file, window.location.href).toString(), (gltf) => {
      const model = gltf.scene;
      setupStructureModel(model, type);
      structureModels[type] = model;
      console.log('[ship3d] Loaded ' + file);
      refreshStructureMeshes();
    }, undefined, (err) => console.error('[ship3d] Failed to load ' + file, err));
  });

  [1, 2, 3, 4, 5].forEach((tier) => {
    const file = `pirate-base-t${tier}.glb`;
    loader.load(new URL('assets/' + file, window.location.href).toString(), (gltf) => {
      const model = gltf.scene;
      setupStructureModel(model, 'piratebase');
      structureModels.piratebase[tier] = model;
      console.log('[ship3d] Loaded ' + file);
      refreshStructureMeshes();
    }, undefined, (err) => console.error('[ship3d] Failed to load ' + file, err));
  });

  loader.load(new URL('assets/ore.glb', window.location.href).toString(), (gltf) => {
    const model = gltf.scene;
    const box = new THREE.Box3().setFromObject(model);
    const center = box.getCenter(new THREE.Vector3());
    const size = box.getSize(new THREE.Vector3());
    const maxDim = Math.max(size.x, size.y, size.z) || 1;
    const scale = 1 / maxDim;
    model.scale.setScalar(scale);
    model.position.sub(center.multiplyScalar(scale));
    model.rotation.x = -Math.PI / 2;
    model.rotation.y = Math.PI; // flip 180
    oreModel = model;
    buildOreIconDataUrls();
    console.log('[ship3d] Loaded ore.glb');
  }, undefined, (err) => console.error('[ship3d] Failed to load ore.glb', err));

  loader.load(new URL('assets/scrap.glb', window.location.href).toString(), (gltf) => {
    const model = gltf.scene;
    const box = new THREE.Box3().setFromObject(model);
    const center = box.getCenter(new THREE.Vector3());
    const size = box.getSize(new THREE.Vector3());
    const maxDim = Math.max(size.x, size.y, size.z) || 1;
    const scale = 1 / maxDim;
    model.scale.setScalar(scale);
    model.position.sub(center.multiplyScalar(scale));
    model.rotation.x = -Math.PI / 2;
    model.rotation.y = Math.PI; // flip 180
    scrapModel = model;
    buildScrapIconDataUrl();
    console.log('[ship3d] Loaded scrap.glb');
  }, undefined, (err) => console.error('[ship3d] Failed to load scrap.glb', err));

  const setupPirateModel = (model) => {
    const box = new THREE.Box3().setFromObject(model);
    const center = box.getCenter(new THREE.Vector3());
    const size = box.getSize(new THREE.Vector3());
    const maxDim = Math.max(size.x, size.y, size.z) || 1;
    const scale = (SHIP_SIZE * 2) / maxDim * 1.1;
    model.scale.setScalar(scale);
    model.position.sub(center.multiplyScalar(scale));
    model.rotation.x = -Math.PI / 2;
    model.rotation.y = Math.PI;
    model.traverse((child) => {
      if (child.isMesh && child.material) {
        const oldMat = child.material;
        child.material = new THREE.MeshStandardMaterial({
          color: oldMat.color ? oldMat.color.clone() : 0xee9999,
          map: oldMat.map || null,
          roughness: 0.7,
          metalness: 0.3,
          emissive: 0xffffff,
          emissiveMap: oldMat.map || null,
          emissiveIntensity: 1.5
        });
      }
    });
  };
  for (const archetype of PIRATE_ARCHETYPE_KEYS) {
    const file = pirateModelFiles[archetype];
    if (!file) continue;
    loader.load(new URL('assets/' + file, window.location.href).toString(), (gltf) => {
      const model = gltf.scene;
      setupPirateModel(model);
      pirateModels[archetype] = model;
      console.log('[ship3d] Loaded ' + file);
    }, undefined, (err) => console.error('[ship3d] Failed to load ' + file, err));
  }
}

function buildOreIconDataUrls() {
  if (!oreModel || typeof THREE === 'undefined') return;
  const size = 64;
  const canvas = document.createElement('canvas');
  canvas.width = size;
  canvas.height = size;
  const renderer = new THREE.WebGLRenderer({ canvas, alpha: true, antialias: true });
  renderer.setSize(size, size);
  renderer.setClearColor(0x000000, 0);
  const scene = new THREE.Scene();
  const camera = new THREE.PerspectiveCamera(50, 1, 0.1, 10);
  camera.position.set(0, 0, 1.4);
  camera.lookAt(0, 0, 0);
  scene.add(new THREE.AmbientLight(0xffffff, 0.8));
  const dir = new THREE.DirectionalLight(0xffffff, 1.2);
  dir.position.set(0.5, 0.5, 1);
  scene.add(dir);
  for (const itemKey of FLOATING_ORE_ITEMS) {
    if (itemKey === 'scrap') continue;
    const clone = oreModel.clone(true);
    applyFloatingOreMaterial(clone, itemKey);
    clone.position.set(0, 0, 0);
    clone.rotation.x = -Math.PI / 2;
    clone.rotation.y = Math.PI;
    clone.rotation.z = 0;
    scene.add(clone);
    renderer.render(scene, camera);
    try {
      ORE_ICON_DATA_URLS[itemKey] = canvas.toDataURL('image/png');
    } catch (e) { /* security / CORS */ }
    scene.remove(clone);
  }
  renderer.dispose();
}

function buildScrapIconDataUrl() {
  if (!scrapModel || typeof THREE === 'undefined') return;
  const size = 64;
  const canvas = document.createElement('canvas');
  canvas.width = size;
  canvas.height = size;
  const renderer = new THREE.WebGLRenderer({ canvas, alpha: true, antialias: true });
  renderer.setSize(size, size);
  renderer.setClearColor(0x000000, 0);
  const scene = new THREE.Scene();
  const camera = new THREE.PerspectiveCamera(50, 1, 0.1, 10);
  camera.position.set(0, 0, 1.4);
  camera.lookAt(0, 0, 0);
  scene.add(new THREE.AmbientLight(0xffffff, 0.8));
  const dir = new THREE.DirectionalLight(0xffffff, 1.2);
  dir.position.set(0.5, 0.5, 1);
  scene.add(dir);
  const clone = scrapModel.clone(true);
  applyFloatingOreMaterial(clone, 'scrap');
  clone.position.set(0, 0, 0);
  clone.rotation.x = -Math.PI / 2;
  clone.rotation.y = Math.PI;
  clone.rotation.z = 0;
  scene.add(clone);
  renderer.render(scene, camera);
  try {
    ORE_ICON_DATA_URLS['scrap'] = canvas.toDataURL('image/png');
  } catch (e) { /* security / CORS */ }
  renderer.dispose();
}

function refreshAsteroidMeshes() {
  const smallLoaded = smallAsteroidModels.every(m => m != null);
  const mediumLoaded = mediumAsteroidModels.every(m => m != null);
  if (!asteroidContainer || !smallLoaded || !mediumLoaded || !largeAsteroidModel) return;
  while (asteroidContainer.children.length) asteroidContainer.remove(asteroidContainer.children[0]);
  const rng = createSeededRandom(levelSeed);
  for (const ast of asteroids) {
    ast._mesh = null;
    let src = null;
    if (ast.radius >= 10 && ast.radius <= 30) {
      const modelIndex = Math.floor(rng() * 3);
      src = smallAsteroidModels[modelIndex];
    } else if (ast.radius >= 40 && ast.radius <= 90) {
      const modelIndex = rng() < 0.8 ? 0 : 1; // 80% medium-asteroid1, 20% medium-asteroid2
      src = mediumAsteroidModels[modelIndex];
    } else if (ast.radius >= 100) {
      src = largeAsteroidModel;
    }
    if (!src) continue;
    ast._initialSpinPhase = rng() * Math.PI * 2;
    const spinAxis = Math.floor(rng() * 3);
    const spinDirection = rng() < 0.5 ? -1 : 1;
    ast._spinSpeed = 0.3 * (0.7 + rng() * 0.6) * (ast.radius >= 100 ? 0.7 : 1);
    ast._spinAxis = spinAxis;
    ast._spinDirection = spinDirection;
    const clone = src.clone(true);
    if (ast.oreType && ast.oreType !== 'cuprite') applyOreEmissiveMaterial(clone, ast.oreType);
    // Compute scale from unrotated model so same radius => same visual size (hitbox match)
    const box = new THREE.Box3().setFromObject(clone);
    const size = box.getSize(new THREE.Vector3());
    const maxDim = Math.max(size.x, size.y, size.z) || 1;
    const sizeMult = 1.05;
    const scale = ((ast.radius * 2) / maxDim) * sizeMult;
    clone.scale.setScalar(scale);
    clone.rotation[['x', 'y', 'z'][spinAxis]] = ast._initialSpinPhase;
    ast._mesh = clone;
    asteroidContainer.add(clone);
  }
}

function setShipSlowVisual(active) {
  if (shipSlowVisualActive === active) return;
  shipSlowVisualActive = active;
  if (!shipMesh) return;
  shipMesh.traverse((child) => {
    if (!child.isMesh || !child.material) return;
    const applyToMaterial = (mat) => {
      if (!mat || !mat.isMaterial || !mat.emissive) return;
      if (!mat.userData._shipSlowBaseEmissive) {
        mat.userData._shipSlowBaseEmissive = mat.emissive.clone();
        mat.userData._shipSlowBaseEmissiveIntensity = mat.emissiveIntensity ?? 0;
      }
      if (active) {
        mat.emissive.setHex(SHIP_SLOW_EMISSIVE_COLOR);
        mat.emissiveIntensity = SHIP_SLOW_EMISSIVE_INTENSITY;
      } else {
        mat.emissive.copy(mat.userData._shipSlowBaseEmissive);
        mat.emissiveIntensity = mat.userData._shipSlowBaseEmissiveIntensity;
      }
      mat.needsUpdate = true;
    };
    if (Array.isArray(child.material)) {
      child.material.forEach(applyToMaterial);
    } else {
      applyToMaterial(child.material);
    }
  });
}

// Non-cuprite asteroids: emissive glow in ore color, intensity 0.06
const ORE_EMISSIVE_COLOR = { hematite: 0xA0522D, aurite: 0xFFD700, diamite: 0x909090, platinite: 0xE5E4E2 };
const ORE_EMISSIVE_INTENSITY = { hematite: 0.06, aurite: 0.02, diamite: 0.06, platinite: 0.06 };
function applyOreEmissiveMaterial(mesh, oreType) {
  const emissiveColor = ORE_EMISSIVE_COLOR[oreType] ?? 0x888888;
  const intensity = ORE_EMISSIVE_INTENSITY[oreType] ?? 0.06;
  mesh.traverse((child) => {
    if (child.isMesh && child.material) {
      const oldMat = child.material;
      child.material = new THREE.MeshStandardMaterial({
        color: oldMat.color ? oldMat.color.clone() : 0x888888,
        map: oldMat.map || null,
        roughness: oldMat.roughness ?? 0.8,
        metalness: oldMat.metalness ?? 0.2,
        emissive: emissiveColor,
        emissiveIntensity: intensity
      });
    }
  });
}

// Floating ore drops: self-lit like asteroids with ore-colored emissive tint
const FLOATING_ORE_ITEMS = new Set(['cuprite', 'hematite', 'aurite', 'diamite', 'platinite', 'scrap', 'warp key', 'warp key fragment', 'copper', 'iron', 'gold', 'diamond', 'platinum']);
const FLOATING_ORE_EMISSIVE = { cuprite: 0x7A6D5F, hematite: 0x804224, aurite: 0xCCAC00, diamite: 0x737373, platinite: 0xB7B6B5, scrap: 0x888888, 'warp key': 0xAE841A, 'warp key fragment': 0x8A7A44, copper: 0xB87333, iron: 0x696969, gold: 0xFFD700, diamond: 0xB9F2FF, platinum: 0xE5E4E2 };
const ORE_ICON_DATA_URLS = {}; // itemKey -> data URL for inventory slot (3D ore, no rotation)

function getPirateBaseHitRadius(st) {
  return PIRATE_BASE_HIT_RADIUS * getPirateBaseTierScale(st?.tier);
}

function getPirateBaseVisualRadius(st) {
  return STRUCTURE_RADIUS_3D * getPirateBaseTierScale(st?.tier);
}

function getPirateBaseAggroRadius(st) {
  return PIRATE_BASE_AGGRO_RADIUS * getPirateBaseTierScale(st?.tier);
}

function getPirateBaseDefenseOrbitRadius(st) {
  return BASE_DEFENSE_ORBIT_RADIUS * getPirateBaseTierScale(st?.tier);
}

function getStructureCollisionRadius(st) {
  if (st?.type === 'piratebase') return STRUCTURE_SIZE_COLL * getPirateBaseTierScale(st.tier);
  return STRUCTURE_SIZE_COLL;
}

const PIRATE_BASE_COLLISION_RADIUS = SHIP_COLLISION_RADIUS + 4;
const PIRATE_TYPE_CONFIG = Object.freeze({
  normal: { health: PIRATE_HEALTH, speedMult: 1, sizeMult: 1, tint: 0xff6666, emissiveIntensity: 1.5 },
  sturdy: { health: PIRATE_HEALTH * 2, speedMult: 0.7, sizeMult: 1.3, tint: 0xff6666, emissiveIntensity: 1.5 },
  fast: { health: 15, speedMult: 1.5, sizeMult: 0.8, tint: 0xff6666, emissiveIntensity: 1.5 }
});
const PIRATE_ARCHETYPE_CONFIG = Object.freeze({
  standard: { bonusHealthMult: 1, speedMult: 1, sizeMult: 1, fixedHealth: null, pelletCount: 1, pelletSpread: 0, bulletDamage: 3 },
  shotgun: { bonusHealthMult: 2, speedMult: 1, sizeMult: 1, fixedHealth: null, pelletCount: 3, pelletSpread: 0.06, bulletDamage: 2 },
  slowing: { bonusHealthMult: 2, speedMult: 1, sizeMult: 1, fixedHealth: null, pelletCount: 1, pelletSpread: 0, bulletDamage: 3 },
  breaching: { bonusHealthMult: 2, speedMult: 1, sizeMult: 1, fixedHealth: null, pelletCount: 1, pelletSpread: 0, bulletDamage: 3 },
  drone: { bonusHealthMult: 1, speedMult: 2, sizeMult: 0.5, fixedHealth: 5, pelletCount: 1, pelletSpread: 0, bulletDamage: 3 }
});
const PIRATE_ARCHETYPE_BULLET_COLORS = Object.freeze({
  standard: '#ffcc00',
  shotgun: '#ffcc00',
  slowing: '#d8a6ff',
  breaching: '#ffcc00',
  drone: '#ffcc00'
});

function pickPirateType(percentages) {
  const mix = normalizePirateTypePercentages(percentages);
  const total = mix.normal + mix.sturdy + mix.fast;
  let roll = Math.random() * total;
  for (const key of PIRATE_TYPE_KEYS) {
    roll -= mix[key];
    if (roll <= 0) return key;
  }
  return 'normal';
}

function shuffleWithSeed(arr, seed) {
  const rng = createSeededRandom(seed >>> 0);
  const out = [...arr];
  for (let i = out.length - 1; i > 0; i--) {
    const j = Math.floor(rng() * (i + 1));
    [out[i], out[j]] = [out[j], out[i]];
  }
  return out;
}

function buildDeterministicPirateTypeSequence(count, percentages, shuffleSeed) {
  const n = Math.max(0, Math.round(Number(count) || 0));
  if (n <= 0) return [];
  const mix = normalizePirateTypePercentages(percentages);
  const total = mix.normal + mix.sturdy + mix.fast;
  const counts = { normal: 0, sturdy: 0, fast: 0 };
  const remainders = [];
  let assigned = 0;
  for (const key of PIRATE_TYPE_KEYS) {
    const exact = (mix[key] / total) * n;
    const base = Math.floor(exact);
    counts[key] = base;
    assigned += base;
    remainders.push({ key, frac: exact - base });
  }
  // Allocate leftovers by largest remainder; stable tie-break by PIRATE_TYPE_KEYS order.
  remainders.sort((a, b) => b.frac - a.frac);
  for (let i = 0; i < (n - assigned); i++) {
    counts[remainders[i % remainders.length].key] += 1;
  }
  const sequence = [];
  for (const key of PIRATE_TYPE_KEYS) {
    for (let i = 0; i < counts[key]; i++) sequence.push(key);
  }
  if (shuffleSeed != null && typeof shuffleSeed === 'number') {
    return shuffleWithSeed(sequence, shuffleSeed >>> 0);
  }
  return sequence;
}

function getPirateCombatProfile(pirateType, pirateArchetype) {
  const resolvedType = normalizePirateType(pirateType);
  const resolvedArchetype = normalizePirateArchetype(pirateArchetype);
  const typeCfg = PIRATE_TYPE_CONFIG[resolvedType];
  const archetypeCfg = PIRATE_ARCHETYPE_CONFIG[resolvedArchetype];
  let health = typeCfg.health;
  if (archetypeCfg.fixedHealth != null) {
    health = archetypeCfg.fixedHealth;
  } else {
    health = Math.max(1, Math.round(health * (archetypeCfg.bonusHealthMult ?? 1)));
  }
  const speedMult = (typeCfg.speedMult ?? 1) * (archetypeCfg.speedMult ?? 1);
  const sizeMult = (typeCfg.sizeMult ?? 1) * (archetypeCfg.sizeMult ?? 1);
  return {
    pirateType: resolvedType,
    pirateArchetype: resolvedArchetype,
    health,
    speedMult,
    sizeMult
  };
}

function getPirateBulletProfile(pirateArchetype) {
  const resolvedArchetype = normalizePirateArchetype(pirateArchetype);
  const cfg = PIRATE_ARCHETYPE_CONFIG[resolvedArchetype] || PIRATE_ARCHETYPE_CONFIG.standard;
  return {
    pirateArchetype: resolvedArchetype,
    pelletCount: Math.max(1, Math.round(cfg.pelletCount || 1)),
    pelletSpread: cfg.pelletSpread || 0,
    bulletDamage: cfg.bulletDamage || 3,
    bulletColor: PIRATE_ARCHETYPE_BULLET_COLORS[resolvedArchetype] || PIRATE_ARCHETYPE_BULLET_COLORS.standard
  };
}

function rotateUnitVector(v, angle) {
  const c = Math.cos(angle);
  const s = Math.sin(angle);
  return {
    x: v.x * c - v.y * s,
    y: v.x * s + v.y * c
  };
}

function createPirate({
  x,
  y,
  vx = 0,
  vy = 0,
  pirateType = 'normal',
  pirateArchetype = 'standard',
  facingAngle = 0,
  defendingBase,
  orbitAngle,
  orbitRadius,
  fromBaseSpawn = false
}) {
  const profile = getPirateCombatProfile(pirateType, pirateArchetype);
  return {
    x,
    y,
    vx,
    vy,
    health: profile.health,
    maxHealth: profile.health,
    state: 'chase',
    stateTimer: Math.random() * 5,
    cooldown: 1 + Math.random() * 2,
    id: Math.random(),
    facingAngle,
    prevFacingAngle: facingAngle,
    tilt: 0,
    defendingBase,
    orbitAngle,
    orbitRadius,
    fromBaseSpawn,
    pirateType: profile.pirateType,
    pirateArchetype: profile.pirateArchetype,
    sizeMult: profile.sizeMult,
    accel: PIRATE_ACCEL * profile.speedMult,
    maxSpeed: PIRATE_MAX_SPEED * profile.speedMult,
    collisionRadius: PIRATE_BASE_COLLISION_RADIUS * profile.sizeMult
  };
}

function buildRadialSpawnOffsets(count, radius) {
  const n = Math.max(1, Math.round(Number(count) || 1));
  const offsets = [];
  for (let i = 0; i < n; i++) {
    const angle = (i / n) * Math.PI * 2;
    offsets.push([Math.cos(angle) * radius, Math.sin(angle) * radius]);
  }
  return offsets;
}

function applyPirateVariantVisual(clone, pirateType, sizeMult) {
  const resolvedType = normalizePirateType(pirateType);
  const cfg = PIRATE_TYPE_CONFIG[resolvedType];
  const baseVisualCfg = PIRATE_TYPE_CONFIG.normal;
  const tintColor = new THREE.Color(baseVisualCfg.tint);
  clone.scale.multiplyScalar(sizeMult || cfg.sizeMult || 1);
  clone.traverse((child) => {
    if (!child.isMesh || !child.material) return;
    const applyTint = (oldMat) => {
      const sourceColor = oldMat.color ? oldMat.color.clone() : new THREE.Color(0xee9999);
      const sourceEmissive = oldMat.emissive ? oldMat.emissive.clone() : new THREE.Color(0xff6666);
      sourceColor.lerp(tintColor, 0.35);
      sourceEmissive.lerp(tintColor, 0.25);
      return new THREE.MeshStandardMaterial({
        color: sourceColor,
        map: oldMat.map || null,
        roughness: oldMat.roughness ?? 0.7,
        metalness: oldMat.metalness ?? 0.3,
        emissive: sourceEmissive,
        emissiveMap: oldMat.emissiveMap || oldMat.map || null,
        emissiveIntensity: baseVisualCfg.emissiveIntensity ?? oldMat.emissiveIntensity ?? 1.5
      });
    };
    if (Array.isArray(child.material)) {
      child.material = child.material.map((m) => applyTint(m));
    } else {
      child.material = applyTint(child.material);
    }
  });
}

function applyFloatingOreMaterial(mesh, itemKey) {
  const emissiveColor = FLOATING_ORE_EMISSIVE[itemKey] ?? 0x888888;
  mesh.traverse((child) => {
    if (child.isMesh && child.material) {
      const oldMat = child.material;
      child.material = new THREE.MeshStandardMaterial({
        color: oldMat.color ? oldMat.color.clone() : 0x888888,
        map: oldMat.map || null,
        roughness: oldMat.roughness ?? 0.8,
        metalness: oldMat.metalness ?? 0.2,
        emissive: emissiveColor,
        emissiveMap: oldMat.map || null,
        emissiveIntensity: 5.0
      });
    }
  });
}

function refreshStructureMeshes() {
  if (!structureContainer) return;
  const STRUCTURE_SIZE = 40;
  const STRUCTURE_DIAMETER = STRUCTURE_SIZE * 2;
  const STRUCTURE_SCALE_MULT = 2.7; // base
  const scaleMultByType = { warpgate: 1.15, shop: 1.10, piratebase: 1.0, crafting: 0.75, shipyard: 0.96, refinery: 1.0 };
  const getSourceModel = (st) => {
    if (st.type === 'piratebase') {
      const tier = normalizePirateBaseTier(st.tier);
      return structureModels.piratebase?.[tier] || structureModels.piratebase?.[2] || structureModels['shop'];
    }
    return structureModels[st.type] || structureModels['shop'];
  };
  while (structureContainer.children.length) structureContainer.remove(structureContainer.children[0]);
  for (const st of structures) {
    if (!isCollidableStructure(st)) continue;
    const src = getSourceModel(st);
    if (!src) continue;
    const clone = src.clone(true);
    const box = new THREE.Box3().setFromObject(clone);
    const size = box.getSize(new THREE.Vector3());
    const maxDim = Math.max(size.x, size.y, size.z) || 1;
    const typeMult = scaleMultByType[st.type] ?? 1.0;
    const tierMult = st.type === 'piratebase' ? getPirateBaseTierScale(st.tier) : 1.0;
    const scale = (STRUCTURE_DIAMETER / maxDim) * STRUCTURE_SCALE_MULT * typeMult * tierMult;
    clone.scale.setScalar(scale);
    st._mesh = clone;
    structureContainer.add(clone);
  }
}

function spawnPirateGroup(minCount, maxCount, typePercentages = DEFAULT_PIRATE_TYPE_PERCENTAGES) {
  const count = minCount + Math.floor(Math.random() * (maxCount - minCount + 1));
  const angle = Math.random() * Math.PI * 2;
  const dist = 1100; // Just outside view
  const cx = ship.x + Math.cos(angle) * dist;
  const cy = ship.y + Math.sin(angle) * dist;

  const spreadRadius = 50;
  for (let i = 0; i < count; i++) {
    const r = Math.random() * spreadRadius;
    const a = Math.random() * Math.PI * 2;
    pirates.push(createPirate({
      x: cx + Math.cos(a) * r,
      y: cy + Math.sin(a) * r,
      facingAngle: angle, // Face toward player initially
      pirateType: pickPirateType(typePercentages)
    }));
  }
}


function spawnBaseDefensePirates(st) {
  const count = Math.max(0, Math.round(Number(st.defenseCount ?? 8)));
  const orbitRadius = getPirateBaseDefenseOrbitRadius(st);
  const baseShuffleSeed = ((levelSeed ^ (Math.imul(Math.floor(st.x), 31) ^ Math.imul(Math.floor(st.y), 37))) >>> 0);
  const defenseTypeSequence = buildDeterministicPirateTypeSequence(count, st.defenseTypePercentages, baseShuffleSeed);
  const baseArchetype = normalizePirateArchetype(st.pirateArchetype);
  for (let i = 0; i < count; i++) {
    const orbitAngle = (i / count) * Math.PI * 2;
    pirates.push(createPirate({
      x: st.x + Math.cos(orbitAngle) * orbitRadius,
      y: st.y + Math.sin(orbitAngle) * orbitRadius,
      facingAngle: orbitAngle + Math.PI / 2,
      pirateType: defenseTypeSequence[i] || 'normal',
      pirateArchetype: baseArchetype,
      defendingBase: st,
      orbitAngle,
      orbitRadius
    }));
  }
}


function onPirateBaseDeath(st) {
  if (st.dead) return;
  st.dead = true;
  sfx.playExplosion('base');
  
  const drops = st.drops || [
    { item: 'scrap', quantity: 50 },
    { item: 'warp key', quantity: 1 }
  ];

  for (const drop of drops) {
    for (let k = 0; k < drop.quantity; k++) {
      const angle = Math.random() * Math.PI * 2;
      const speed = 20 + Math.random() * 40;
      const droppedItem = getItemPayload(drop.item, 1);
      floatingItems.push({
        ...droppedItem,
        quantity: 1,
        x: st.x,
        y: st.y,
        vx: Math.cos(angle) * speed,
        vy: Math.sin(angle) * speed
      });
    }
  }

  if (st._mesh && structureContainer) structureContainer.remove(st._mesh);
  st._mesh = null;
}

function updatePirates(dt) {
  // Aggro: player entering radius 300 around any living pirate base
  for (const st of structures) {
    if (st.type !== 'piratebase' || st.dead || st.health <= 0) continue;
    const d = Math.sqrt((ship.x - st.x) ** 2 + (ship.y - st.y) ** 2);
    if (d < getPirateBaseAggroRadius(st)) st.aggroed = true;
  }

  // Spawning logic using level settings
  // Spawn based on absolute schedule (no countdown reset between tiers/phases).
  if (levelIsDebug) {
    while (levelElapsedTime >= pirateNextWaveTime) {
      spawnPirateGroup(6, 10, levelSpawnSettings.pirateTypePercentages);
      pirateNextWaveTime += 5;
    }
  } else {
    while (levelElapsedTime >= pirateNextWaveTime) {
      const t = pirateNextWaveTime;

      // Determine active tier based on the scheduled spawn time.
      let activeTier = null;
      if (levelSpawnSettings.tiers && levelSpawnSettings.tiers.length > 0) {
        // Find the tier with the highest startTime that is <= current time
        // Tiers should be sorted by startTime, but we'll iterate to be safe
        let bestStart = -1;
        for (const tier of levelSpawnSettings.tiers) {
          if (t >= tier.startTime && tier.startTime > bestStart) {
            bestStart = tier.startTime;
            activeTier = tier;
          }
        }
      }

      // Use active tier settings or fall back to base settings
      const minWave = activeTier ? activeTier.waveSizeMin : levelSpawnSettings.waveSizeMin;
      const maxWave = activeTier ? activeTier.waveSizeMax : levelSpawnSettings.waveSizeMax;
      const minInt = activeTier ? activeTier.waveIntervalMin : levelSpawnSettings.waveIntervalMin;
      const maxInt = activeTier ? activeTier.waveIntervalMax : levelSpawnSettings.waveIntervalMax;
      const typePercentages = activeTier?.pirateTypePercentages || levelSpawnSettings.pirateTypePercentages;

      spawnPirateGroup(minWave, maxWave, typePercentages);

      // Schedule next wave (keep time moving forward even if dt is large)
      const rawInterval = minInt + Math.random() * (maxInt - minInt);
      const interval = Math.max(0.1, rawInterval);
      pirateNextWaveTime += interval;
    }
  }

  for (let i = pirates.length - 1; i >= 0; i--) {
    const p = pirates[i];
    let inDefenseMode = false;
    if (p.defendingBase) {
      const base = p.defendingBase;
      if (base.health <= 0 || base.dead || base.aggroed) {
        // treat as normal pirate
      } else {
        inDefenseMode = true;
        p.orbitAngle += dt * BASE_DEFENSE_ORBIT_SPEED;
        const orbitRadius = p.orbitRadius || getPirateBaseDefenseOrbitRadius(base);
        p.x = base.x + Math.cos(p.orbitAngle) * orbitRadius;
        p.y = base.y + Math.sin(p.orbitAngle) * orbitRadius;
        p.vx = 0;
        p.vy = 0;
        p.facingAngle = p.orbitAngle + Math.PI / 2;
      }
    }

    const dx = ship.x - p.x;
    const dy = ship.y - p.y;
    const distToPlayer = Math.sqrt(dx*dx + dy*dy);
    const dirToPlayer = distToPlayer > 0 ? {x: dx/distToPlayer, y: dy/distToPlayer} : {x:0, y:0};

    if (!inDefenseMode) {
      // AI Target / Behavior
      p.stateTimer -= dt;
      if (p.stateTimer <= 0) {
         p.state = Math.random() < 0.6 ? 'chase' : 'circle';
         p.stateTimer = 2 + Math.random() * 4;
      }

      let ax = 0;
      let ay = 0;
      const pirateAccel = p.accel ?? PIRATE_ACCEL;
      if (p.state === 'chase') {
          ax += dirToPlayer.x * pirateAccel;
          ay += dirToPlayer.y * pirateAccel;
      } else {
          const cw = (p.id > 0.5) ? 1 : -1;
          ax += -dirToPlayer.y * cw * pirateAccel;
          ay += dirToPlayer.x * cw * pirateAccel;
      }

      const lookAhead = 150;
      const lookAheadObstacle = 50;
      for (const ast of asteroids) {
          const adx = ast.x - p.x;
          const ady = ast.y - p.y;
          const adist = Math.sqrt(adx*adx + ady*ady);
          if (adist < ast.radius + lookAheadObstacle) {
              ax -= (adx / adist) * 400;
              ay -= (ady / adist) * 400;
          }
      }
      for (const st of structures) {
         if (!isCollidableStructure(st)) continue;
         const sdx = st.x - p.x;
         const sdy = st.y - p.y;
         const sdist = Math.sqrt(sdx*sdx + sdy*sdy);
         if (sdist < getStructureCollisionRadius(st) + lookAheadObstacle) {
             ax -= (sdx / sdist) * 400;
             ay -= (sdy / sdist) * 400;
         }
      }
      const PLAYER_AVOID_RADIUS = 5;
      const pdx = ship.x - p.x;
      const pdy = ship.y - p.y;
      const pdist = Math.sqrt(pdx*pdx + pdy*pdy);
      if (pdist > 0 && pdist < PLAYER_AVOID_RADIUS + lookAhead) {
          ax -= (pdx / pdist) * 400;
          ay -= (pdy / pdist) * 400;
      }
      for (const other of pirates) {
          if (other === p) continue;
          const odx = other.x - p.x;
          const ody = other.y - p.y;
          const odist = Math.sqrt(odx*odx + ody*ody);
          if (odist < 40) {
              ax -= (odx / odist) * 200;
              ay -= (ody / odist) * 200;
          }
      }

      p.vx += ax * dt;
      p.vy += ay * dt;

      const thrustMag = Math.sqrt(ax * ax + ay * ay);
      if (thrustMag > 10) {
        const targetAngle = Math.atan2(ay, ax);
        let angleDiff = targetAngle - p.facingAngle;
        while (angleDiff > Math.PI) angleDiff -= Math.PI * 2;
        while (angleDiff < -Math.PI) angleDiff += Math.PI * 2;
        p.facingAngle += angleDiff * Math.min(1, 3 * dt);
      }

      p.vx *= Math.max(0, 1 - PIRATE_FRICTION * dt);
      p.vy *= Math.max(0, 1 - PIRATE_FRICTION * dt);

      const speed = Math.sqrt(p.vx*p.vx + p.vy*p.vy);
      const pirateMaxSpeed = p.maxSpeed ?? PIRATE_MAX_SPEED;
      if (speed > pirateMaxSpeed) {
          const scale = pirateMaxSpeed / speed;
          p.vx *= scale;
          p.vy *= scale;
      }

      p.x += p.vx * dt;
      p.y += p.vy * dt;
    }

    // Physics Collisions (Bounce) â€“ pirates do not damage asteroids
    const pirateCollRadius = p.collisionRadius ?? PIRATE_BASE_COLLISION_RADIUS;
    for (const ast of asteroids) {
        const hit = pushOutOverlap(p, ast, pirateCollRadius, ast.radius);
        if (hit) bounceEntity(p, hit.nx, hit.ny, BOUNCE_RESTITUTION);
    }
    for (const st of structures) {
        if (!isCollidableStructure(st)) continue;
        const hit = pushOutOverlap(p, st, pirateCollRadius, getStructureCollisionRadius(st));
        if (hit) bounceEntity(p, hit.nx, hit.ny, BOUNCE_RESTITUTION);
    }

    // Firing (defense-mode pirates do not shoot)
    if (!inDefenseMode) {
    p.cooldown -= dt;
    if (p.cooldown <= 0 && distToPlayer < PIRATE_FIRE_RANGE) {
         p.cooldown = 1.0 + Math.random() * 2.0;
         
         // Anticipate: use pirate bullet speed so lead matches travel time
         const timeToHit = distToPlayer / PIRATE_BULLET_SPEED;
         const predX = ship.x + ship.vx * timeToHit;
         const predY = ship.y + ship.vy * timeToHit;
         
         const aimX = predX + (Math.random()-0.5) * PIRATE_AIM_SPREAD;
         const aimY = predY + (Math.random()-0.5) * PIRATE_AIM_SPREAD;
         
         const fdx = aimX - p.x;
         const fdy = aimY - p.y;
         const fdist = Math.sqrt(fdx*fdx + fdy*fdy);
         const fdir = (fdist > 0) ? {x: fdx/fdist, y: fdy/fdist} : {x:1, y:0};
         
         const bulletProfile = getPirateBulletProfile(p.pirateArchetype);
         for (let pelletIdx = 0; pelletIdx < bulletProfile.pelletCount; pelletIdx++) {
            const centered = pelletIdx - (bulletProfile.pelletCount - 1) / 2;
            const spreadAngle = centered * bulletProfile.pelletSpread;
            const pelletDir = spreadAngle === 0 ? fdir : rotateUnitVector(fdir, spreadAngle);
            bullets.push({
              x: p.x + pelletDir.x * SHIP_SIZE * (p.sizeMult || 1),
              y: p.y + pelletDir.y * SHIP_SIZE * (p.sizeMult || 1),
              vx: pelletDir.x * PIRATE_BULLET_SPEED + p.vx,
              vy: pelletDir.y * PIRATE_BULLET_SPEED + p.vy,
              lifespan: 4,
              owner: 'pirate',
              damage: bulletProfile.bulletDamage,
              pirateArchetype: bulletProfile.pirateArchetype,
              color: bulletProfile.bulletColor
            });
         }
         sfx.playEnemyShot(p.pirateArchetype);
    }
    }

    // Update tilt (bank when turning)
    let deltaAngle = p.facingAngle - (p.prevFacingAngle !== undefined ? p.prevFacingAngle : p.facingAngle);
    while (deltaAngle > Math.PI) deltaAngle -= 2 * Math.PI;
    while (deltaAngle < -Math.PI) deltaAngle += 2 * Math.PI;
    p.prevFacingAngle = p.facingAngle;
    
    p.tilt = (p.tilt || 0) + deltaAngle * PIRATE_TILT_SENSITIVITY - (p.tilt || 0) * PIRATE_TILT_DECAY * dt;
    p.tilt = Math.max(-0.5, Math.min(0.5, p.tilt));

    // Death: drop 3-5 scrap only if not fromBaseSpawn
    if (p.health <= 0) {
        spawnSparks(p.x, p.y, 15);
        sfx.playExplosion('pirate');
        if (!p.fromBaseSpawn) {
          const scrapCount = 3 + Math.floor(Math.random() * 3);
          for (let k = 0; k < scrapCount; k++) {
            const angle = Math.random() * Math.PI * 2;
            const speed = 20 + Math.random() * 40;
            floatingItems.push({
              x: p.x,
              y: p.y,
              vx: Math.cos(angle) * speed,
              vy: Math.sin(angle) * speed,
              item: 'scrap',
              quantity: 1
            });
          }
        }
        if (p._mesh && pirateContainer) pirateContainer.remove(p._mesh);
        pirates[i] = pirates[pirates.length - 1]; pirates.pop();
    }
  }
}

function update(dt) {
  levelElapsedTime += dt;
  shipSlowTimer = Math.max(0, shipSlowTimer - dt);
  const shipSlowActive = shipSlowTimer > 0;
  setShipSlowVisual(shipSlowActive);
  const effectiveAccel = shipSlowActive ? ACCEL * SHIP_SLOW_FACTOR : ACCEL;
  const effectiveMaxSpeed = shipSlowActive ? MAX_SPEED * SHIP_SLOW_FACTOR : MAX_SPEED;
  // Ship movement (right-click) - only if there's a direction to move
  if (input.rightMouseDown && player.fuel > 0) {
    const dx = input.mouseX - WIDTH / 2;
    const dy = input.mouseY - HEIGHT / 2;
    const dir = normalize(dx, dy);
    // Only apply thrust and consume fuel if there's a direction
    if (dir.x !== 0 || dir.y !== 0) {
      ship.vx += dir.x * effectiveAccel * dt;
      ship.vy += dir.y * effectiveAccel * dt;
      player.fuel = Math.max(0, player.fuel - FUEL_DEPLETION_RATE * dt);
      tutorialTextTimerStarted = true; // Start tutorial fade timer on first thrust
    }
  }

  // Friction (low when coasting, high when braking with Ctrl)
  const friction = input.ctrlBrake ? BRAKE_FRICTION : FRICTION;
  ship.vx *= Math.max(0, 1 - friction * dt);
  ship.vy *= Math.max(0, 1 - friction * dt);

  // Max speed cap
  const speed = Math.sqrt(ship.vx * ship.vx + ship.vy * ship.vy);
  if (speed > effectiveMaxSpeed) {
    const scale = effectiveMaxSpeed / speed;
    ship.vx *= scale;
    ship.vy *= scale;
  }

  // Position
  ship.x += ship.vx * dt;
  ship.y += ship.vy * dt;
  const halfLevelWidth = levelWidth * 0.5;
  const halfLevelHeight = levelHeight * 0.5;
  const outsideLevelBorder =
    ship.x < -halfLevelWidth ||
    ship.x > halfLevelWidth ||
    ship.y < -halfLevelHeight ||
    ship.y > halfLevelHeight;
  setShipStatusPersistent('oxygen---', OXYGEN_BAR_COLOR, outsideLevelBorder);

  // Shipâ€“asteroid collision: bounce + damage
  for (const ast of asteroids) {
    const hit = pushOutOverlap(ship, ast, shipCollisionRadius, ast.radius);
    if (hit) {
      const impactSpeed = bounceEntity(ship, hit.nx, hit.ny, BOUNCE_RESTITUTION);
      if (impactSpeed > 0) {
        sfx.playShipCollision(impactSpeed / 200);
        const damage = Math.min(MAX_COLLISION_DAMAGE, impactSpeed * DAMAGE_PER_SPEED);
        player.health = Math.max(0, player.health - damage);
        const currentHealth = ast.health ?? ast.radius;
        ast.health = Math.max(0, currentHealth - damage / 2);
        const sparkOffset = shipCollisionRadius * 0.7 + (SHIP_SIZE * shipScale * 0.3);
        const sparkX = ship.x - hit.nx * sparkOffset;
        const sparkY = ship.y - hit.ny * sparkOffset;
        spawnSparks(sparkX, sparkY, Math.max(2, Math.round(damage)));
      }
    }
  }

  // Shipâ€“structure collision
  for (const st of structures) {
    if (!isCollidableStructure(st)) continue;
    const hit = pushOutOverlap(ship, st, shipCollisionRadius, getStructureCollisionRadius(st));
    if (hit) {
      const impactSpeed = bounceEntity(ship, hit.nx, hit.ny, BOUNCE_RESTITUTION);
      if (impactSpeed > 0) {
        sfx.playShipCollision(impactSpeed / 200);
        const damage = Math.min(MAX_COLLISION_DAMAGE, impactSpeed * DAMAGE_PER_SPEED);
        player.health = Math.max(0, player.health - damage);
        const sparkOffset = shipCollisionRadius * 0.7 + (SHIP_SIZE * shipScale * 0.3);
        const sparkX = ship.x - hit.nx * sparkOffset;
        const sparkY = ship.y - hit.ny * sparkOffset;
        spawnSparks(sparkX, sparkY, Math.max(2, Math.round(damage)));
        if (st.type === 'piratebase') {
          st.aggroed = true;
          const currentHealth = st.health ?? 100;
          st.health = Math.max(0, currentHealth - damage / 2);
          if (st.health <= 0) onPirateBaseDeath(st);
        }
      }
    }
  }

  // Oxygen depletion
  let oxygenDrainPerSecond = OXYGEN_DEPLETION_RATE;
  if (outsideLevelBorder) oxygenDrainPerSecond += OUTSIDE_BORDER_OXYGEN_DRAIN_RATE;
  player.oxygen = Math.max(0, player.oxygen - oxygenDrainPerSecond * dt);
  
  // No oxygen: drain health at 1 per second
  if (player.oxygen <= 0) {
    player.health = Math.max(0, player.health - 1 * dt);
  }

  // Mining lasers (light + medium): unified logic via MINING_LASER_STATS
  const hasEnergy = inventory.getFirstChargedCell() != null;
  const selectedItem = hotbar[selectedSlot];
  const miningLaser = selectedItem && MINING_LASER_STATS[selectedItem.item] ? selectedItem : null;
  const laserStats = miningLaser ? MINING_LASER_STATS[miningLaser.item] : null;
  let laserFiringNow = false;

  if (miningLaser && laserStats && miningLaser.heat != null) {
    if (miningLaser.heat >= 1) {
      if (!miningLaser.overheated) sfx.playOverheat();
      miningLaser.overheated = true;
    }
    if (miningLaser.heat <= 0) miningLaser.overheated = false;
    if (miningLaser.heat > 0) hudDirty = true;

    const canFire = !miningLaser.overheated;
    if (miningLaser && input.leftMouseDown && hasEnergy && canFire) {
      laserFiringNow = true;
      miningLaser.heat = Math.min(1, miningLaser.heat + laserStats.heatRate * dt);
      hudDirty = true;
      const cell = inventory.getFirstChargedCell();
      if (cell) { cell.energy = Math.max(0, cell.energy - laserStats.energyDrain * dt); }

      const dx = input.mouseX - WIDTH / 2;
      const dy = input.mouseY - HEIGHT / 2;
      const dir = normalize(dx, dy);
      if (dir.x !== 0 || dir.y !== 0) {
        // Cap laser at screen edge (world units; 1:1 with screen pixels, ship at center)
        let maxLaserDist = 1500;
        if (Math.abs(dir.x) > 1e-6) maxLaserDist = Math.min(maxLaserDist, (WIDTH / 2) / Math.abs(dir.x));
        if (Math.abs(dir.y) > 1e-6) maxLaserDist = Math.min(maxLaserDist, (HEIGHT / 2) / Math.abs(dir.y));

        const hit = laserHitAsteroid(ship.x, ship.y, dir.x, dir.y, maxLaserDist);
        
        // Check Pirates for laser hit
        let hitPirate = null;
        let pirateDist = maxLaserDist;
        for (const p of pirates) {
             const fx = p.x - ship.x;
             const fy = p.y - ship.y;
             const t = fx * dir.x + fy * dir.y;
             if (t < 0) continue;
             const cx = ship.x + dir.x * t;
             const cy = ship.y + dir.y * t;
             const distSq = (p.x - cx)*(p.x - cx) + (p.y - cy)*(p.y - cy);
             const r = p.collisionRadius ?? PIRATE_BASE_COLLISION_RADIUS;
             if (distSq < r*r) {
                 const offset = Math.sqrt(r*r - distSq);
                 const tHit = t - offset;
                 if (tHit > 0 && tHit < pirateDist) {
                     pirateDist = tHit;
                     hitPirate = p;
                 }
             }
        }

        const hitBase = laserHitPirateBase(ship.x, ship.y, dir.x, dir.y, maxLaserDist);
        const baseDist = hitBase ? hitBase.distance : maxLaserDist;

        let target = null;
        let hitDist = maxLaserDist;
        if (hit && hitPirate && hitBase) {
            if (hit.distance <= pirateDist && hit.distance <= baseDist) {
                target = hit.asteroid;
                hitDist = hit.distance;
            } else if (pirateDist <= baseDist) {
                target = hitPirate;
                hitDist = pirateDist;
            } else {
                target = hitBase.structure;
                hitDist = baseDist;
            }
        } else if (hit && hitPirate) {
            if (hit.distance < pirateDist) {
                target = hit.asteroid;
                hitDist = hit.distance;
            } else {
                target = hitPirate;
                hitDist = pirateDist;
            }
        } else if (hit && hitBase) {
            if (hit.distance < baseDist) {
                target = hit.asteroid;
                hitDist = hit.distance;
            } else {
                target = hitBase.structure;
                hitDist = baseDist;
            }
        } else if (hitPirate && hitBase) {
            if (pirateDist < baseDist) {
                target = hitPirate;
                hitDist = pirateDist;
            } else {
                target = hitBase.structure;
                hitDist = baseDist;
            }
        } else if (hit) {
            target = hit.asteroid;
            hitDist = hit.distance;
        } else if (hitPirate) {
            target = hitPirate;
            hitDist = pirateDist;
        } else if (hitBase) {
            target = hitBase.structure;
            hitDist = baseDist;
        }

        if (target) {
          // Apply damage multiplier only to pirates/pirate bases, not asteroids
          const isEnemy = target.defendingBase !== undefined || target.type === 'piratebase';
          target.health -= laserStats.dps * dt * (isEnemy ? shipDamageMult : 1);
          if (target.defendingBase) target.defendingBase.aggroed = true;
          if (target.type === 'piratebase') {
            target.aggroed = true;
            if (target.health <= 0) onPirateBaseDeath(target);
          }
          const hitX = ship.x + dir.x * hitDist;
          const hitY = ship.y + dir.y * hitDist;
          sparkCarry += 60 * dt;
          const n = Math.floor(sparkCarry);
          if (n > 0) {
            spawnSparks(hitX, hitY, n);
            sfx.playImpact('laser');
            sparkCarry -= n;
          }
        }
      }
    } else {
      miningLaser.heat = Math.max(0, miningLaser.heat - laserStats.coolRate * dt);
    }
  }
  if (laserFiringNow) {
    if (!laserWasFiring) sfx.startLaserLoop();
    sfx.updateLaserHeat(miningLaser?.heat ?? 0);
  } else if (laserWasFiring) {
    sfx.stopLaserLoop();
  }
  laserWasFiring = laserFiringNow;

  // Blasters (light / medium / large): unified logic via BLASTER_STATS
  const blasterItem = hotbar[selectedSlot] && BLASTER_STATS[hotbar[selectedSlot].item] ? hotbar[selectedSlot] : null;
  const bStats = blasterItem ? BLASTER_STATS[blasterItem.item] : null;
  if (blasterItem && bStats && blasterItem.heat != null) {
    if (blasterItem.heat >= 1) {
      if (!blasterItem.overheated) sfx.playOverheat();
      blasterItem.overheated = true;
    }
    if (blasterItem.heat <= 0) blasterItem.overheated = false;
    if (blasterItem.heat > 0) hudDirty = true;
    const blasterCanFire = !blasterItem.overheated;
    const hasBlasterEnergy = inventory.getFirstCellWithMinEnergy(bStats.energyPerShot) != null;
    if (blasterCanFire && input.leftMouseDown && hasBlasterEnergy) {
      blasterFireAccum += bStats.fireRate * dt;
      while (blasterFireAccum >= 1) {
        blasterFireAccum -= 1;
        const c = inventory.getFirstCellWithMinEnergy(bStats.energyPerShot);
        if (!c) break;
        c.energy = Math.max(0, c.energy - bStats.energyPerShot);
        blasterItem.heat = Math.min(1, blasterItem.heat + bStats.heatPerShot);
        fireBlasterPellet(bStats.pirateDmg, bStats.asteroidDmg);
        sfx.playPlayerBlaster(blasterItem.heat);
        hudDirty = true;
      }
    } else {
      blasterItem.heat = Math.max(0, blasterItem.heat - bStats.coolRate * dt);
    }
  }

  updatePirates(dt);

  // Pirate base wave spawning while aggroed
  const BASE_SPAWN_OFFSET = 80;
  for (const st of structures) {
    if (st.type !== 'piratebase' || st.dead || st.health <= 0 || !st.aggroed) continue;
    st.spawnTimer -= dt;
    if (st.spawnTimer <= 0) {
      st.spawnTimer = st.spawnRate || 30; // Use instance spawn rate
      const waveCount = Math.max(1, Math.round(Number(st.waveSpawnCount) || 4));
      const spawnMix = normalizePirateTypePercentages(st.waveSpawnTypePercentages);
      const offsets = buildRadialSpawnOffsets(waveCount, BASE_SPAWN_OFFSET);
      const baseArchetype = normalizePirateArchetype(st.pirateArchetype);
      for (const [ox, oy] of offsets) {
        const angle = Math.atan2(ship.y - (st.y + oy), ship.x - (st.x + ox));
        pirates.push(createPirate({
          x: st.x + ox,
          y: st.y + oy,
          facingAngle: angle,
          pirateType: pickPirateType(spawnMix),
          pirateArchetype: baseArchetype,
          fromBaseSpawn: true
        }));
      }
    }
  }

  // Bullets (movement + bullet-asteroid collision)
  const BULLET_DAMAGE = 3;            // pirate bullet damage to player
  const BULLET_DAMAGE_PIRATE = 3;    // fallback blaster damage per pellet to pirates
  const BULLET_DAMAGE_ASTEROID = 0.5; // fallback pellet damage to asteroids
  const VIEWPORT_HALF_W = WIDTH / 2;
  const VIEWPORT_HALF_H = HEIGHT / 2;
  for (let i = bullets.length - 1; i >= 0; i--) {
    const b = bullets[i];
    b.x += b.vx * dt;
    b.y += b.vy * dt;
    b.lifespan -= dt;
    let remove = b.lifespan <= 0;
    if (!remove) {
      const screenX = b.x - ship.x + VIEWPORT_HALF_W;
      const screenY = b.y - ship.y + VIEWPORT_HALF_H;
      if (screenX < 0 || screenX > WIDTH || screenY < 0 || screenY > HEIGHT) remove = true;
    }
    if (!remove) {
      // Check Asteroids (bullet stops on hit; only player bullets damage)
      for (const ast of asteroids) {
        const dx = b.x - ast.x;
        const dy = b.y - ast.y;
        const dist = Math.sqrt(dx * dx + dy * dy);
        if (dist < ast.radius) {
          if (b.owner === 'player') ast.health -= (b.asteroidDmg ?? BULLET_DAMAGE_ASTEROID);
          remove = true;
          spawnSparks(b.x, b.y, 3);
          sfx.playImpact('bullet');
          break;
        }
      }

      // Check Pirate Base (player bullets only)
      if (!remove && b.owner === 'player') {
        for (const st of structures) {
          if (st.type !== 'piratebase' || st.dead || st.health <= 0) continue;
          const dx = b.x - st.x;
          const dy = b.y - st.y;
          const dist = Math.sqrt(dx * dx + dy * dy);
          if (dist < getPirateBaseHitRadius(st)) {
            st.health -= (b.pirateDmg ?? BULLET_DAMAGE_PIRATE) * shipDamageMult;
            st.aggroed = true;
            remove = true;
            spawnSparks(b.x, b.y, 4);
            sfx.playImpact('bullet');
            if (st.health <= 0) onPirateBaseDeath(st);
            break;
          }
        }
      }

      // Check Pirates (Player bullets)
      if (!remove && b.owner === 'player') {
        for (const p of pirates) {
            const dx = b.x - p.x;
            const dy = b.y - p.y;
            const dist = Math.sqrt(dx * dx + dy * dy);
            if (dist < (p.collisionRadius ?? PIRATE_BASE_COLLISION_RADIUS)) {
                p.health -= (b.pirateDmg ?? BULLET_DAMAGE_PIRATE) * shipDamageMult;
                if (p.defendingBase) p.defendingBase.aggroed = true;
                remove = true;
                spawnSparks(b.x, b.y, 2);
                sfx.playImpact('bullet');
                break;
            }
        }
      }
      
      // Check Player (Pirate bullets)
      if (!remove && b.owner === 'pirate') {
          const dx = b.x - ship.x;
          const dy = b.y - ship.y;
          const dist = Math.sqrt(dx * dx + dy * dy);
          if (dist < shipCollisionRadius) {
              const bulletDamage = Number.isFinite(Number(b.damage)) ? Number(b.damage) : BULLET_DAMAGE;
              const bulletArchetype = normalizePirateArchetype(b.pirateArchetype);
              player.health = Math.max(0, player.health - bulletDamage);
              if (bulletArchetype === 'slowing') {
                shipSlowTimer = SHIP_SLOW_DURATION;
                setShipSlowVisual(true);
              } else if (bulletArchetype === 'breaching') {
                if (Math.random() < 0.5) {
                  const prevOxygen = player.oxygen;
                  player.oxygen = Math.max(0, player.oxygen - 1);
                  if (player.oxygen < prevOxygen) pushShipStatusTransient('oxygen-', OXYGEN_BAR_COLOR);
                } else {
                  const prevFuel = player.fuel;
                  player.fuel = Math.max(0, player.fuel - 1);
                  if (player.fuel < prevFuel) pushShipStatusTransient('fuel-', FUEL_BAR_COLOR);
                }
              }
              remove = true;
              spawnSparks(b.x, b.y, 4);
              sfx.playImpact('playerHit');
          }
      }
    }
    if (remove) { bullets[i] = bullets[bullets.length - 1]; bullets.pop(); }
  }

  // Particles (sparks) â€” damp computed once (same for all particles)
  const particleDamp = Math.exp(-PARTICLE_DRAG * dt);
  for (let i = particles.length - 1; i >= 0; i--) {
    const p = particles[i];
    p.x += p.vx * dt;
    p.y += p.vy * dt;
    p.vx *= particleDamp;
    p.vy *= particleDamp;
    p.life -= dt;
    if (p.life <= 0) { particles[i] = particles[particles.length - 1]; particles.pop(); }
  }

  // Check for destroyed asteroids and drop ore (diminishing returns: +10 at tier 1, then decreases by 1 every 2 tiers, min +4)
  function calculateOreCount(radius) {
    const tier = Math.floor(radius / 10);
    if (tier <= 0) return 0;
    if (tier === 1) return 10;
    let ore = 10; // tier 1 base
    for (let t = 2; t <= tier; t++) {
      const increment = Math.max(4, 11 - Math.ceil(t / 2));
      ore += increment;
    }
    return ore;
  }
  for (let i = asteroids.length - 1; i >= 0; i--) {
    if (asteroids[i].health <= 0) {
      const ast = asteroids[i];
      sfx.playExplosion('asteroid');
      if (ast._mesh && asteroidContainer) asteroidContainer.remove(ast._mesh);
      const oreCount = calculateOreCount(ast.radius);
      if (oreCount > 0) {
        for (let j = 0; j < oreCount; j++) {
          const angle = Math.random() * Math.PI * 2;
          const speed = 30 + Math.random() * 50;
          floatingItems.push({
            x: ast.x,
            y: ast.y,
            vx: Math.cos(angle) * speed,
            vy: Math.sin(angle) * speed,
            item: ast.oreType || 'cuprite',
            quantity: 1
          });
        }
      }
      asteroids[i] = asteroids[asteroids.length - 1]; asteroids.pop();
    }
  }

  // Floating items: magnet + movement + drag
  for (const item of floatingItems) {
    if (item.vx == null) item.vx = 0;
    if (item.vy == null) item.vy = 0;

    // Magnet attraction (only if inventory can accept this item)
    const dx = ship.x - item.x;
    const dy = ship.y - item.y;
    const dist = Math.sqrt(dx * dx + dy * dy);
    if (dist > 0 && dist < MAGNET_RADIUS && dist > shipCollisionRadius && canAcceptFloatingItem(item)) {
      const inv = 1 / dist;
      const pull = MAGNET_STRENGTH * (1 - dist / MAGNET_RADIUS);
      item.vx += dx * inv * pull * dt;
      item.vy += dy * inv * pull * dt;
    }

    // Integrate movement
    item.x += item.vx * dt;
    item.y += item.vy * dt;

    // Collision with asteroids and structures: push out so items don't overlap
    for (const ast of asteroids) {
      pushOutOverlap(item, ast, FLOAT_ITEM_RADIUS, ast.radius);
    }
    for (const st of structures) {
      if (!isCollidableStructure(st)) continue;
      pushOutOverlap(item, st, FLOAT_ITEM_RADIUS, getStructureCollisionRadius(st));
    }

    // Apply drag (exponential decay)
    const damp = Math.max(0, 1 - FLOAT_DRAG * dt);
    item.vx *= damp;
    item.vy *= damp;

    // Stop tiny drift
    const sp = Math.sqrt(item.vx * item.vx + item.vy * item.vy);
    if (sp < FLOAT_STOP_SPEED) {
      item.vx = 0;
      item.vy = 0;
    }
  }

  // Create/update 3D mesh for ore-type floating items (skip off-screen position updates)
  const CULL_MARGIN_UPDATE = 350;
  const cullLeftU   = ship.x - WIDTH / 2 - CULL_MARGIN_UPDATE;
  const cullRightU  = ship.x + WIDTH / 2 + CULL_MARGIN_UPDATE;
  const cullTopU    = ship.y - HEIGHT / 2 - CULL_MARGIN_UPDATE;
  const cullBottomU = ship.y + HEIGHT / 2 + CULL_MARGIN_UPDATE;
  if (floatingOreContainer && (oreModel || scrapModel)) {
    for (const item of floatingItems) {
      if (!FLOATING_ORE_ITEMS.has(item.item)) continue;
      const src = (item.item === 'scrap' && scrapModel) ? scrapModel : oreModel;
      if (!src) continue;
      if (!item._mesh) {
        const clone = src.clone(true);
        applyFloatingOreMaterial(clone, item.item);
        clone.scale.setScalar(FLOATING_ORE_SCALE);
        item._mesh = clone;
        floatingOreContainer.add(clone);
        item._spinAxis = Math.floor(Math.random() * 3);
        item._spinDirection = Math.random() < 0.5 ? -1 : 1;
        item._spinSpeed = 0.5 + Math.random() * 0.4;
      }
      const onScreen = item.x > cullLeftU && item.x < cullRightU && item.y > cullTopU && item.y < cullBottomU;
      item._mesh.visible = onScreen;
      if (!onScreen) continue;
      item._mesh.position.set(item.x - ship.x, -(item.y - ship.y), 0);
      const spin = (item._spinSpeed ?? 0.6) * (item._spinDirection ?? 1) * dt;
      if (item._spinAxis === 0) item._mesh.rotation.x += spin;
      else if (item._spinAxis === 1) item._mesh.rotation.y += spin;
      else item._mesh.rotation.z += spin;
    }
  }

  // Pickup floating items only when within ship collision radius
  const prevFloatingCount = floatingItems.length;
  for (let i = floatingItems.length - 1; i >= 0; i--) {
    const item = floatingItems[i];
    const dx = item.x - ship.x;
    const dy = item.y - ship.y;
    const dist = Math.sqrt(dx * dx + dy * dy);
    if (dist < SHIP_COLLECTION_RADIUS) {
      // Energy cells restore their charge - find empty slot
      if (item.energy != null) {
        let added = false;
        for (let j = 0; j < hotbar.length; j++) {
          if (!hotbar[j]) {
            hotbar[j] = { item: item.item, energy: item.energy, maxEnergy: item.maxEnergy };
            added = true;
            break;
          }
        }
        if (added) {
          sfx.playPickup('resource');
          if (item._mesh && floatingOreContainer) floatingOreContainer.remove(item._mesh);
          floatingItems[i] = floatingItems[floatingItems.length - 1]; floatingItems.pop();
        }
      } else if (item.fuel != null) {
        let added = false;
        for (let j = 0; j < hotbar.length; j++) {
          if (!hotbar[j]) {
            hotbar[j] = { item: item.item, fuel: item.fuel, maxFuel: item.maxFuel };
            added = true;
            break;
          }
        }
        if (added) {
          sfx.playPickup('resource');
          if (item._mesh && floatingOreContainer) floatingOreContainer.remove(item._mesh);
          floatingItems[i] = floatingItems[floatingItems.length - 1]; floatingItems.pop();
        }
      } else if (item.oxygen != null) {
        let added = false;
        for (let j = 0; j < hotbar.length; j++) {
          if (!hotbar[j]) {
            hotbar[j] = { item: item.item, oxygen: item.oxygen, maxOxygen: item.maxOxygen };
            added = true;
            break;
          }
        }
        if (added) {
          sfx.playPickup('resource');
          if (item._mesh && floatingOreContainer) floatingOreContainer.remove(item._mesh);
          floatingItems[i] = floatingItems[floatingItems.length - 1]; floatingItems.pop();
        }
      } else if (item.health != null) {
        let added = false;
        for (let j = 0; j < hotbar.length; j++) {
          if (!hotbar[j]) {
            hotbar[j] = {
              item: item.item,
              health: item.health,
              maxHealth: item.maxHealth ?? item.health
            };
            added = true;
            break;
          }
        }
        if (added) {
          sfx.playPickup('resource');
          if (item._mesh && floatingOreContainer) floatingOreContainer.remove(item._mesh);
          floatingItems[i] = floatingItems[floatingItems.length - 1]; floatingItems.pop();
        }
      } else if ((MINING_LASER_STATS[item.item] || BLASTER_STATS[item.item]) && item.heat != null) {
        // Heat weapon (any mining laser or blaster): restore heat/overheated
        let added = false;
        for (let j = 0; j < hotbar.length; j++) {
          if (!hotbar[j]) {
            hotbar[j] = { item: item.item, heat: item.heat, overheated: !!item.overheated };
            added = true;
            break;
          }
        }
        if (added) {
          sfx.playPickup('weapon');
          if (item._mesh && floatingOreContainer) floatingOreContainer.remove(item._mesh);
          floatingItems[i] = floatingItems[floatingItems.length - 1]; floatingItems.pop();
        }
      } else if (inventory.add(item.item, item.quantity)) {
        sfx.playPickup(ORE_ITEMS.includes(item.item) ? 'ore' : 'generic');
        if (item._mesh && floatingOreContainer) floatingOreContainer.remove(item._mesh);
        floatingItems[i] = floatingItems[floatingItems.length - 1]; floatingItems.pop();
      }
    }
  }
  if (floatingItems.length !== prevFloatingCount) hudDirty = true;
  maybeNotifyLowResource('health', player.health, player.maxHealth, 'low health', HEALTH_BAR_COLOR);
  maybeNotifyLowResource('fuel', player.fuel, player.maxFuel, 'low fuel', FUEL_BAR_COLOR);
  maybeNotifyLowResource('oxygen', player.oxygen, player.maxOxygen, 'low oxygen', OXYGEN_BAR_COLOR);
  updateShipStatus(dt);

  // Death: show overlay + pause game (one-shot)
  if (!deathScreenOpen && player.health <= 0) {
    sfx.playDeath();
    sfx.stopLaserLoop();
    deathScreenOpen = true;
    gamePaused = true;
    // Clear latched inputs so nothing keeps firing/thrusting
    input.leftMouseDown = false;
    input.rightMouseDown = false;
    input.ctrlBrake = false;
    // Cancel any inventory drag state
    inventoryDrag = null;
    try { setDragGhostVisible(false); } catch (e) {}
    if (deathOverlayEl) deathOverlayEl.style.display = 'flex';
  }
}

function render(dt = 1 / 60) {
  ctx.fillStyle = '#0a0a12';
  ctx.fillRect(0, 0, WIDTH, HEIGHT);

  // Off-screen culling bounds (world coordinates, with margin for large objects)
  const CULL_MARGIN = 350;
  const cullLeft   = ship.x - WIDTH / 2 - CULL_MARGIN;
  const cullRight  = ship.x + WIDTH / 2 + CULL_MARGIN;
  const cullTop    = ship.y - HEIGHT / 2 - CULL_MARGIN;
  const cullBottom = ship.y + HEIGHT / 2 + CULL_MARGIN;

  // Starfield (fillRect is much faster than arc for small shapes)
  for (const star of stars) {
    const sx = star.x - ship.x + WIDTH / 2;
    const sy = star.y - ship.y + HEIGHT / 2;
    if (sx < -10 || sx > WIDTH + 10 || sy < -10 || sy > HEIGHT + 10) continue;
    const s = Math.max(1, star.size);
    ctx.fillStyle = `rgba(255, 255, 255, ${star.brightness})`;
    ctx.fillRect(sx - s / 2, sy - s / 2, s, s);
  }

  // Asteroids (2D circles; radius 10-30 use 3D model instead)
  for (const ast of asteroids) {
    if ((ast.radius >= 10 && ast.radius <= 30) || (ast.radius >= 40 && ast.radius <= 90) || ast.radius >= 100) continue;
    const { x, y } = worldToScreen(ast.x, ast.y);
    const r = ast.radius;
    if (x + r < 0 || x - r > WIDTH || y + r < 0 || y - r > HEIGHT) continue;
    
    // Asteroid colors based on ore type
    let fill = '#665544';
    let stroke = '#998877';
    
    if (ast.oreType === 'hematite') { fill = '#8B4513'; stroke = '#A0522D'; }
    else if (ast.oreType === 'aurite') { fill = '#B8860B'; stroke = '#FFD700'; }
    else if (ast.oreType === 'diamite') { fill = '#787878'; stroke = '#909090'; }
    else if (ast.oreType === 'platinite') { fill = '#D3D3D3'; stroke = '#E5E4E2'; }
    
    ctx.fillStyle = fill;
    ctx.strokeStyle = stroke;
    ctx.lineWidth = 2;
    ctx.beginPath();
    ctx.arc(x, y, r, 0, Math.PI * 2);
    ctx.fill();
    ctx.stroke();
  }

  // Pirates
  for (const p of pirates) {
      const { x, y } = worldToScreen(p.x, p.y);
      if (x < -30 || x > WIDTH+30 || y < -30 || y > HEIGHT+30) continue;
      
      // Health Bar
      if (p.health < p.maxHealth) {
          const barW = 32;
          const barH = 4;
          const pct = Math.max(0, p.health / p.maxHealth);
          const yOffset = 25 * (p.sizeMult || 1);
          ctx.fillStyle = 'rgba(0,0,0,0.5)';
          ctx.fillRect(x - barW/2, y - yOffset, barW, barH);
          ctx.fillStyle = '#ff3333';
          ctx.fillRect(x - barW/2, y - yOffset, barW * pct, barH);
      }
  }

  // Floating items in space â€” thin white glow for ore-type (3D) pellets
  for (const item of floatingItems) {
    if (!FLOATING_ORE_ITEMS.has(item.item)) continue;
    const { x, y } = worldToScreen(item.x, item.y);
    if (x < -30 || x > WIDTH + 30 || y < -30 || y > HEIGHT + 30) continue;
    const r = 14;
    const gradient = ctx.createRadialGradient(x, y, 0, x, y, r);
    gradient.addColorStop(0, 'rgba(255,255,255,0.35)');
    gradient.addColorStop(0.5, 'rgba(255,255,255,0.12)');
    gradient.addColorStop(1, 'rgba(255,255,255,0)');
    ctx.fillStyle = gradient;
    ctx.beginPath();
    ctx.arc(x, y, r, 0, Math.PI * 2);
    ctx.fill();
  }
  for (const item of floatingItems) {
    if (FLOATING_ORE_ITEMS.has(item.item)) continue; // ore-type items rendered as 3D only
    const { x, y } = worldToScreen(item.x, item.y);
    if (x < -20 || x > WIDTH + 20 || y < -20 || y > HEIGHT + 20) continue;
    // Draw small glowing circle - same fill/stroke as ore type
    const oreFill = { cuprite: '#665544', hematite: '#8B4513', aurite: '#B8860B', diamite: '#787878', platinite: '#D3D3D3', scrap: '#888888', 'warp key': '#B8860B', 'warp key fragment': '#8C7A45', copper: '#B87333', iron: '#696969', gold: '#FFD700', diamond: '#B9F2FF', platinum: '#E5E4E2' };
    const oreStroke = { cuprite: '#998877', hematite: '#A0522D', aurite: '#FFD700', diamite: '#909090', platinite: '#E5E4E2', scrap: '#aaaaaa', 'warp key': '#DAA520', 'warp key fragment': '#C4AE62', copper: '#D4915E', iron: '#8A8A8A', gold: '#FFE44D', diamond: '#DFFFFF', platinum: '#F0F0F0' };
    ctx.fillStyle = item.energy != null ? '#448844' :
                    (item.fuel != null ? '#886622' :
                    (item.oxygen != null ? '#446688' :
                    (BLASTER_STATS[item.item] ? '#6644aa' :
                    (item.heat != null ? '#884422' :
                    (oreFill[item.item] || '#aa8844')))));
    ctx.beginPath();
    ctx.arc(x, y, 10, 0, Math.PI * 2);
    ctx.fill();
    ctx.strokeStyle = item.energy != null ? '#66cc66' : (item.fuel != null ? '#cc8844' : (item.oxygen != null ? '#6699cc' : (BLASTER_STATS[item.item] ? '#8866dd' : (item.heat != null ? '#cc6633' : (oreStroke[item.item] || '#ccaa66')))));
    ctx.lineWidth = 2;
    ctx.stroke();
    // Item icon: image for fuel/energy/oxygen, else letter fallback
    const img = ITEM_IMAGES[item.item];
    if (img && img.complete && img.naturalWidth > 0) {
      const size = 18;
      ctx.drawImage(img, x - size / 2, y - size / 2, size, size);
    } else {
      const icon = getItemLabel(item);
      ctx.fillStyle = '#fff';
      ctx.font = '10px Oxanium';
      ctx.textAlign = 'center';
      ctx.textBaseline = 'middle';
      ctx.fillText(icon, x, y);
    }
    // Quantity if > 1
    if (item.quantity > 1) {
      ctx.fillStyle = '#ffcc00';
      ctx.font = '8px Oxanium';
      ctx.textAlign = 'right';
      ctx.textBaseline = 'bottom';
      ctx.fillText(item.quantity, x + 12, y + 12);
    }
  }

  // Structures (circles underneath 3D models; 2D circles for other types)
  const STRUCTURE_RADIUS_3D = 54;
  const STRUCTURE_SIZE = 40;
  const STRUCTURE_STYLES = { shop: '#446688', shipyard: '#664466', refinery: '#666644', fueling: '#446644', crafting: '#886644', warpgate: '#6644aa', piratebase: '#884422' };
  const INTERACTABLE_TYPES_SET = new Set(['shop', 'warpgate', 'crafting', 'refinery', 'shipyard']);
  for (const st of structures) {
    if (st.type === 'piratebase' && (st.dead || st.health <= 0)) continue;
    const is3D = st.type === 'warpgate' || st.type === 'shop' || st.type === 'shipyard' || st.type === 'refinery' || st.type === 'crafting' || st.type === 'piratebase';
    const r = is3D
      ? (st.type === 'piratebase' ? getPirateBaseVisualRadius(st) : STRUCTURE_RADIUS_3D)
      : STRUCTURE_SIZE;
    const isInteractable = INTERACTABLE_TYPES_SET.has(st.type);
    const cullR = st.type === 'piratebase' ? getPirateBaseAggroRadius(st) : (isInteractable ? INTERACT_RADIUS : r);
    const { x, y } = worldToScreen(st.x, st.y);
    if (x + cullR < 0 || x - cullR > WIDTH || y + cullR < 0 || y - cullR > HEIGHT) continue;
    ctx.strokeStyle = '#888';
    ctx.lineWidth = 2;
    if (is3D) {
      if (st.type === 'piratebase') {
        ctx.strokeStyle = normalizePirateBaseTier(st.tier) === 5 ? '#552200' : STRUCTURE_STYLES.piratebase;
        ctx.setLineDash([10, 10]);
        ctx.beginPath();
        ctx.arc(x, y, getPirateBaseAggroRadius(st), 0, Math.PI * 2);
        ctx.stroke();
        ctx.setLineDash([]);
        // Health bar when damaged
        if (st.health < st.maxHealth) {
          const barW = 90;
          const barH = 6;
          const pct = Math.max(0, st.health / st.maxHealth);
          const barUpOffset = st.tier === 1 ? 28 : 20; // tier 1 bar slightly higher
          ctx.fillStyle = 'rgba(0,0,0,0.5)';
          ctx.fillRect(x - barW/2, y - r - barUpOffset, barW, barH);
          ctx.fillStyle = '#ff3333';
          ctx.fillRect(x - barW/2, y - r - barUpOffset, barW * pct, barH);
        }
      } else {
        // Shop, warpgate (3D) -- dashed interact ring
        ctx.setLineDash([8, 8]);
        ctx.beginPath();
        ctx.arc(x, y, INTERACT_RADIUS, 0, Math.PI * 2);
        ctx.stroke();
        ctx.setLineDash([]);
      }
    } else {
      ctx.beginPath();
      ctx.arc(x, y, r, 0, Math.PI * 2);
      ctx.fillStyle = STRUCTURE_STYLES[st.type] || '#446688';
      ctx.fill();
      ctx.stroke();
      if (isInteractable) {
        // Dashed interact ring -- same size for all interactable structures
        ctx.setLineDash([8, 8]);
        ctx.beginPath();
        ctx.arc(x, y, INTERACT_RADIUS, 0, Math.PI * 2);
        ctx.stroke();
        ctx.setLineDash([]);
      }
    }
    if (is3D) continue;
    ctx.fillStyle = '#fff';
    ctx.font = '14px Oxanium';
    ctx.textAlign = 'center';
    ctx.textBaseline = 'middle';
    const label = st.type === 'warpgate' ? 'W' : (st.type === 'piratebase' ? 'P' : (st.type ? st.type.charAt(0).toUpperCase() : '?'));
    ctx.fillText(label, x, y);
  }

  // Bullets (fillRect faster than arc)
  for (const b of bullets) {
    const { x, y } = worldToScreen(b.x, b.y);
    ctx.fillStyle = b.color || '#ffcc00';
    ctx.fillRect(x - 2, y - 2, 4, 4);
  }

  // Spark particles
  for (const p of particles) {
    const { x, y } = worldToScreen(p.x, p.y);
    if (x < -10 || x > WIDTH + 10 || y < -10 || y > HEIGHT + 10) continue;
    const alpha = p.life / p.maxLife;
    const r = 255;
    const g = Math.round(150 + 105 * alpha); // yellow to orange
    const b = Math.round(50 * alpha);
    ctx.fillStyle = `rgba(${r},${g},${b},${alpha})`;
    ctx.fillRect(x - p.size / 2, y - p.size / 2, p.size, p.size);
  }

  // Update 3D asteroid positions (camera-follow; skip off-screen)
  for (const ast of asteroids) {
    if (!ast._mesh) continue;
    const onScreen = ast.x > cullLeft && ast.x < cullRight && ast.y > cullTop && ast.y < cullBottom;
    ast._mesh.visible = onScreen;
    if (!onScreen) continue;
    ast._mesh.position.set(ast.x - ship.x, -(ast.y - ship.y), 0);
    const spin = (ast._spinSpeed ?? 0.3) * (ast._spinDirection ?? 1) * dt;
    if (ast._spinAxis === 0) ast._mesh.rotation.x += spin;
    else if (ast._spinAxis === 1) ast._mesh.rotation.y += spin;
    else ast._mesh.rotation.z += spin;
  }

  // Update 3D structure positions (camera-follow; skip off-screen)
  for (const st of structures) {
    if (!st._mesh) continue;
    const onScreen = st.x > cullLeft && st.x < cullRight && st.y > cullTop && st.y < cullBottom;
    st._mesh.visible = onScreen;
    if (!onScreen) continue;
    const yOff = st.type === 'shop' ? 4 : st.type === 'crafting' ? 5 : 0;
    st._mesh.position.set(st.x - ship.x, -(st.y - ship.y) + yOff, 0);
  }

  // Update 3D pirate positions
  for (const p of pirates) {
    if (!p._mesh && pirateContainer) {
        const archetype = normalizePirateArchetype(p.pirateArchetype);
        const src = pirateModels[archetype];
        if (!src) continue;
        const clone = src.clone(true);
        applyPirateVariantVisual(clone, p.pirateType, p.sizeMult);
        pirateContainer.add(clone);
        p._mesh = clone;
    }
    if (p._mesh) {
        p._mesh.position.set(p.x - ship.x, -(p.y - ship.y), 0);
        p._mesh.rotation.x = -Math.PI / 2;
        p._mesh.rotation.y = p.facingAngle + Math.PI / 2;
        p._mesh.rotation.z = p.tilt || 0;
        p._mesh.visible = true;
    }
  }

  // Ship: 3D model if loaded, else 2D triangle
  const cx = WIDTH / 2;
  const cy = HEIGHT / 2;
  const aimAngle = Math.atan2(input.mouseY - cy, input.mouseX - cx);
  // Always clear the ship canvas so it stays transparent before model load.
  if (shipRenderer) shipRenderer.clear();
  if (shipModelLoaded && shipMesh && shipRenderer && shipScene && shipCamera) {
    // Tilt when turning, decay when resting
    if (!shipTiltInitialized) {
      prevAimAngle = aimAngle;
      shipTiltInitialized = true;
    }
    let deltaAngle = aimAngle - prevAimAngle;
    while (deltaAngle > Math.PI) deltaAngle -= 2 * Math.PI;
    while (deltaAngle < -Math.PI) deltaAngle += 2 * Math.PI;
    prevAimAngle = aimAngle;
    shipTilt += deltaAngle * PIRATE_TILT_SENSITIVITY - shipTilt * PIRATE_TILT_DECAY * dt;
    shipTilt = Math.max(-0.5, Math.min(0.5, shipTilt));
    shipMesh.scale.setScalar(shipBaseScale * shipScale);
    shipMesh.rotation.y = -aimAngle + Math.PI / 2;
    shipMesh.rotation.z = shipTilt;
    // Show thruster flames when thrusting
    const thrustDx = input.mouseX - WIDTH / 2;
    const thrustDy = input.mouseY - HEIGHT / 2;
    const isThrusting = input.rightMouseDown && player.fuel > 0 && (thrustDx !== 0 || thrustDy !== 0);
    for (const flame of shipFlames) {
      flame.visible = isThrusting;
      flame.rotation.z = shipTilt; // Tilt flames with ship
      if (isThrusting) {
        // Animate flame length from base (oscillate between 0.7 and 1.3)
        const flicker = 1 + 0.3 * Math.sin(performance.now() * 0.02);
        flame.scale.set(1, 1, flicker);
      }
    }
    shipRenderer.render(shipScene, shipCamera);
  } else {
    drawShip2D();
  }
  drawCrosshairAndHeatBar();

  // Mining laser beam (orange-red line) - any mining laser in MINING_LASER_STATS
  const hasEnergy = inventory.getFirstChargedCell() != null;
  const selectedItem = hotbar[selectedSlot];
  const miningLaser = selectedItem && MINING_LASER_STATS[selectedItem.item] ? selectedItem : null;
  const canFire = miningLaser && !miningLaser.overheated;
  if (miningLaser && input.leftMouseDown && hasEnergy && canFire) {
    const cx = WIDTH / 2;
    const cy = HEIGHT / 2;
    const dx = input.mouseX - cx;
    const dy = input.mouseY - cy;
    const dir = normalize(dx, dy);
    // Cap at screen edge (world units; 1:1 with screen, ship at center)
    let maxLaserDist = 1500;
    if (Math.abs(dir.x) > 1e-6) maxLaserDist = Math.min(maxLaserDist, (WIDTH / 2) / Math.abs(dir.x));
    if (Math.abs(dir.y) > 1e-6) maxLaserDist = Math.min(maxLaserDist, (HEIGHT / 2) / Math.abs(dir.y));
    let laserLength = maxLaserDist;
    
    // Check for asteroid or pirate hit and shorten laser (stop before surface)
    if (dir.x !== 0 || dir.y !== 0) {
      const hit = laserHitAsteroid(ship.x, ship.y, dir.x, dir.y, maxLaserDist);
      if (hit) {
        laserLength = Math.min(laserLength, Math.max(0, hit.distance - 10));
      }
      // Check pirates: ray-circle intersection, use closest hit
      for (const p of pirates) {
        const pirateRadius = p.collisionRadius ?? PIRATE_BASE_COLLISION_RADIUS;
        const fx = p.x - ship.x;
        const fy = p.y - ship.y;
        const t = fx * dir.x + fy * dir.y;
        if (t < 0) continue;
        const cxW = ship.x + dir.x * t;
        const cyW = ship.y + dir.y * t;
        const distSq = (p.x - cxW) * (p.x - cxW) + (p.y - cyW) * (p.y - cyW);
        if (distSq < pirateRadius * pirateRadius) {
          const offset = Math.sqrt(pirateRadius * pirateRadius - distSq);
          const tHit = t - offset;
          if (tHit > 0 && tHit < laserLength) {
            laserLength = Math.max(0, tHit - 4);
          }
        }
      }
      // Check pirate bases: ray-circle intersection (radius 54)
      const baseHit = laserHitPirateBase(ship.x, ship.y, dir.x, dir.y, laserLength);
      if (baseHit) {
        laserLength = Math.min(laserLength, Math.max(0, baseHit.distance - 10));
      }
    }
    const x1 = cx + dir.x * SHIP_SIZE;
    const y1 = cy + dir.y * SHIP_SIZE;
    let maxL = laserLength;
    if (dir.x > 0) maxL = Math.min(maxL, (WIDTH - x1) / dir.x);
    else if (dir.x < 0) maxL = Math.min(maxL, -x1 / dir.x);
    if (dir.y > 0) maxL = Math.min(maxL, (HEIGHT - y1) / dir.y);
    else if (dir.y < 0) maxL = Math.min(maxL, -y1 / dir.y);
    laserLength = Math.max(0, Math.min(laserLength, maxL));
    const x2 = x1 + dir.x * laserLength;
    const y2 = y1 + dir.y * laserLength;
    // Interpolate color based on heat: orange when cool, deep red when hot
    const heat = miningLaser.heat || 0;
    const outerR = Math.round(255 - heat * 55); // 255 -> 200
    const outerG = Math.round(102 - heat * 102); // 102 -> 0
    const outerB = 0;
    const innerR = Math.round(255 - heat * 55); // 255 -> 200
    const innerG = Math.round(136 - heat * 136); // 136 -> 0
    const innerB = Math.round(68 - heat * 68); // 68 -> 0
    ctx.strokeStyle = `rgb(${outerR},${outerG},${outerB})`;
    ctx.lineWidth = 4;
    ctx.beginPath();
    ctx.moveTo(x1, y1);
    ctx.lineTo(x2, y2);
    ctx.stroke();
    ctx.strokeStyle = `rgb(${innerR},${innerG},${innerB})`;
    ctx.lineWidth = 2;
    ctx.beginPath();
    ctx.moveTo(x1, y1);
    ctx.lineTo(x2, y2);
    ctx.stroke();
  }

  // Interaction prompt for nearby interactable structures (shop, warpgate, crafting, refinery)
  {
    const INTERACTABLE_TYPES = new Set(['shop', 'warpgate', 'crafting', 'refinery', 'shipyard']);
    const INTERACT_LABELS = { shop: 'Shop', warpgate: 'Warp Gate', crafting: 'Crafting Station', refinery: 'Refinery', shipyard: 'Shipyard' };
    let nearestInteractable = null;
    let nearestDist = Infinity;
    if (!shopMenuOpen && !craftingMenuOpen && !refineryMenuOpen && !shipyardMenuOpen) {
      for (const st of structures) {
        if (!INTERACTABLE_TYPES.has(st.type)) continue;
        if (st.type === 'piratebase' && (st.dead || st.health <= 0)) continue;
        const dx = ship.x - st.x;
        const dy = ship.y - st.y;
        const dist = Math.sqrt(dx * dx + dy * dy);
        if (dist < INTERACT_RADIUS && dist < nearestDist) {
          nearestDist = dist;
          nearestInteractable = st;
        }
      }
    }
    // Fade in/out
    const fadeSpeed = 6; // per second
    if (nearestInteractable) {
      interactPromptTarget = nearestInteractable;
      interactPromptAlpha = Math.min(1, interactPromptAlpha + fadeSpeed * dt);
    } else {
      interactPromptAlpha = Math.max(0, interactPromptAlpha - fadeSpeed * dt);
    }
    // Draw with alpha (above the 3D model)
    if (interactPromptAlpha > 0 && interactPromptTarget) {
      const { x, y } = worldToScreen(interactPromptTarget.x, interactPromptTarget.y);
      const label = INTERACT_LABELS[interactPromptTarget.type] || interactPromptTarget.type;
      const a = interactPromptAlpha;
      const topY = y - 95; // Above 3D model (radius ~54 + padding)
      ctx.font = 'bold 14px Oxanium';
      ctx.textAlign = 'center';
      ctx.textBaseline = 'bottom';
      ctx.fillStyle = `rgba(0,0,0,${a})`;
      ctx.fillText(label, x + 1, topY + 1);
      ctx.fillStyle = `rgba(255,255,255,${a})`;
      ctx.fillText(label, x, topY);
      ctx.font = '12px Oxanium';
      ctx.textBaseline = 'top';
      ctx.fillStyle = `rgba(0,0,0,${a})`;
      ctx.fillText('Press E to interact', x + 1, topY + 4);
      ctx.fillStyle = `rgba(170,170,170,${a})`;
      ctx.fillText('Press E to interact', x, topY + 3);
    }
    if (interactPromptAlpha <= 0) interactPromptTarget = null;
  }

  // Tutorial text (visible until first thrust, then 10s + 1s fade)
  if (tutorialTextTimer > 0 || !tutorialTextTimerStarted) {
    if (tutorialTextTimerStarted) tutorialTextTimer -= dt;
    const fadeStart = 1; // Start fading at 1 second remaining
    const alpha = !tutorialTextTimerStarted ? 1 : (tutorialTextTimer > fadeStart ? 1 : Math.max(0, tutorialTextTimer / fadeStart));
    if (alpha > 0) {
      const { x, y } = worldToScreen(tutorialTextWorldX, tutorialTextWorldY);
      const lines = [
        'Left click to fire.',
        'Right click to thrust.',
        'Ctrl to brake.'
      ];
      ctx.font = '14px Oxanium';
      ctx.textAlign = 'center';
      ctx.textBaseline = 'middle';
      const lineHeight = 20;
      const startY = y - ((lines.length - 1) * lineHeight) / 2;
      for (let i = 0; i < lines.length; i++) {
        const ly = startY + i * lineHeight;
        ctx.fillStyle = `rgba(0,0,0,${alpha})`;
        ctx.fillText(lines[i], x + 1, ly + 1);
        ctx.fillStyle = `rgba(255,255,255,${alpha})`;
        ctx.fillText(lines[i], x, ly);
      }
    }
  }

  // Ship status notifications
  {
    const visible = [];
    if (shipStatusPersistent.alpha > 0 && shipStatusPersistent.text) {
      visible.push({
        text: shipStatusPersistent.text,
        color: shipStatusPersistent.color,
        alpha: shipStatusPersistent.alpha
      });
    }
    for (let i = shipStatusTransient.length - 1; i >= 0; i--) {
      const msg = shipStatusTransient[i];
      const alpha = msg.remaining > msg.fadeDuration ? 1 : Math.max(0, msg.remaining / msg.fadeDuration);
      if (alpha <= 0) continue;
      visible.push({ text: msg.text, color: msg.color, alpha });
    }
    if (visible.length > 0) {
      const { x, y } = worldToScreen(ship.x, ship.y);
      ctx.font = 'bold 13px Oxanium';
      ctx.textAlign = 'center';
      ctx.textBaseline = 'middle';
      for (let i = 0; i < visible.length; i++) {
        const msg = visible[i];
        const msgY = y - SHIP_STATUS_BASE_Y_OFFSET - (i * SHIP_STATUS_LINE_SPACING);
        ctx.fillStyle = `rgba(0,0,0,${msg.alpha})`;
        ctx.fillText(msg.text, x + 1, msgY + 1);
        ctx.fillStyle = msg.color;
        ctx.globalAlpha = msg.alpha;
        ctx.fillText(msg.text, x, msgY);
        ctx.globalAlpha = 1;
      }
    }
  }

  // Player stats meters (bottom right) - bar height in pixels = max value in units
  if (uiCtx) {
    const meterWidth = 40;
    const meterSpacing = 50;
    const meterY = HEIGHT - 20;
    const rightmost = WIDTH - 30;

    syncResourceBarDropZones({
      meterWidth,
      meterY,
      oxygenX: rightmost - (meterSpacing * 2),
      fuelX: rightmost - meterSpacing,
      healthX: rightmost,
      oxygenMax: player.maxOxygen,
      fuelMax: player.maxFuel,
      healthMax: player.maxHealth
    });

    function drawMeter(x, value, max, color, label) {
      const barHeight = max * 2; // 2 pixels per unit
      const fillH = (value / max) * barHeight;
      // Background
      uiCtx.fillStyle = '#222';
      uiCtx.fillRect(x - meterWidth / 2, meterY - barHeight, meterWidth, barHeight);
      // Fill
      uiCtx.fillStyle = color;
      uiCtx.fillRect(x - meterWidth / 2, meterY - fillH, meterWidth, fillH);
      // Border
      uiCtx.strokeStyle = '#555';
      uiCtx.lineWidth = 1;
      uiCtx.strokeRect(x - meterWidth / 2, meterY - barHeight, meterWidth, barHeight);
      // Label
      uiCtx.fillStyle = '#aaa';
      uiCtx.font = '10px Oxanium';
      uiCtx.textAlign = 'center';
      uiCtx.textBaseline = 'top';
      uiCtx.fillText(label, x, meterY + 4);
      // Value
      uiCtx.fillStyle = '#fff';
      uiCtx.textBaseline = 'bottom';
      uiCtx.fillText(value.toFixed(1), x, meterY - barHeight - 2);
    }

    drawMeter(rightmost - 100, player.oxygen, player.maxOxygen, OXYGEN_BAR_COLOR, 'O2');
    drawMeter(rightmost - 50, player.fuel, player.maxFuel, FUEL_BAR_COLOR, 'Fuel');
    drawMeter(rightmost, player.health, player.maxHealth, HEALTH_BAR_COLOR, 'HP');
  }
}

function syncResourceBarDropZones({
  meterWidth,
  meterY,
  oxygenX,
  fuelX,
  healthX,
  oxygenMax,
  fuelMax,
  healthMax
}) {
  const barSpecs = [
    { id: 'oxygen-bar-drop-zone', x: oxygenX, max: oxygenMax },
    { id: 'fuel-bar-drop-zone', x: fuelX, max: fuelMax },
    { id: 'health-bar-drop-zone', x: healthX, max: healthMax }
  ];
  for (const spec of barSpecs) {
    const el = document.getElementById(spec.id);
    if (!el) continue;
    const barHeight = Math.max(1, Number(spec.max) * 2);
    el.style.left = `${spec.x - meterWidth / 2}px`;
    el.style.bottom = `${HEIGHT - meterY}px`;
    el.style.width = `${meterWidth}px`;
    el.style.height = `${barHeight}px`;
  }
}

// Input





canvas.addEventListener('wheel', (e) => {
  e.preventDefault();
  if (startScreenOpen || deathScreenOpen) return;
  if (warpMenuOpen) return;
  if (shopMenuOpen) return;
  const slotCount = inventory.slots.length;
  if (slotCount <= 0) return;
  if (e.deltaY > 0) {
    selectedSlot = (selectedSlot + 1) % slotCount;
  } else {
    selectedSlot = (selectedSlot - 1 + slotCount) % slotCount;
  }
  sfx.playHotbarSelect();
  markHUDDirty();
});

function getNearbyStructureByType(type) {
  for (const st of structures) {
    if (st.type !== type) continue;
    const dx = ship.x - st.x;
    const dy = ship.y - st.y;
    const dist = Math.sqrt(dx * dx + dy * dy);
    if (dist < INTERACT_RADIUS) return st;
  }
  return null;
}

function isShipInWarpGate() {
  return getNearbyStructureByType('warpgate');
}

function isShipInShop() {
  return getNearbyStructureByType('shop');
}

function isShipInCrafting() {
  return getNearbyStructureByType('crafting');
}

function isShipInRefinery() {
  return getNearbyStructureByType('refinery');
}

function isShipInShipyard() {
  return getNearbyStructureByType('shipyard');
}

function hasCuprite() {
  for (let i = 0; i < hotbar.length; i++) {
    if (hotbar[i] && hotbar[i].item === 'cuprite' && hotbar[i].quantity > 0) return true;
  }
  return false;
}

function hasEmptyHotbarSlot() {
  for (let i = 0; i < hotbar.length; i++) {
    if (!hotbar[i]) return true;
  }
  return false;
}

// Can we accept this floating item (for magnet: don't attract if inventory can't take it)
function canAcceptFloatingItem(item) {
  if (item.energy != null || item.fuel != null || item.oxygen != null || ((MINING_LASER_STATS[item.item] || BLASTER_STATS[item.item]) && item.heat != null)) {
    return hasEmptyHotbarSlot();
  }
  const qty = item.quantity != null ? item.quantity : 1;
  const maxStack = getMaxStack(item.item);
  let space = 0;
  for (let i = 0; i < hotbar.length; i++) {
    const cell = hotbar[i];
    if (!cell) space += maxStack;
    else if (cell.item === item.item && cell.quantity != null && cell.quantity < maxStack) {
      space += maxStack - cell.quantity;
    }
  }
  return space >= qty;
}

// Shop: buy/sell 6x4 grid (24 slots)
const shopBuySlots = Array(24).fill(null);
const shopSellSlots = Array(24).fill(null);

function initShopBuySlots() {
  // Global init removed, handled per shop instance
}

// Remove one unit of an item from the active shop structure's persistent inventory
function removeFromShopInventory(itemKey) {
  if (!activeShopStructure || !activeShopStructure.inventory) return;
  const inv = activeShopStructure.inventory;
  const idx = inv.findIndex(entry => entry.item === itemKey);
  if (idx === -1) return;
  const entry = inv[idx];
  const qty = entry.quantity || 1;
  if (qty > 1) {
    entry.quantity = qty - 1;
  } else {
    inv.splice(idx, 1);
  }
}

function getShopItemPayload(itemKey) {
  return getItemPayload(itemKey);
}


function getWeaponTierLetter(itemKey) {
  if (itemKey === 'light blaster' || itemKey === 'mining laser') return 'L';
  if (itemKey === 'medium mining laser' || itemKey === 'medium blaster') return 'M';
  if (itemKey === 'large mining laser' || itemKey === 'large blaster') return 'XL';
  return null;
}

function getSlotHTML(it) {
  let html = '';
  if (it) {
    const imgPath = getItemImagePath(it.item);
    const oreIconUrl = FLOATING_ORE_ITEMS.has(it.item) ? ORE_ICON_DATA_URLS[it.item] : null;
    if (oreIconUrl) {
      html += `<div class="slot-icon slot-icon-ore-wrap"><img src="${oreIconUrl}" class="slot-icon-ore-bg" alt=""><span class="slot-icon-ore-letter">${getItemLabel(it)}</span></div>`;
    } else if (imgPath) {
      html += `<img src="${imgPath}" class="slot-icon slot-icon-img" alt="">`;
    } else {
      html += `<span class="slot-icon">${getItemLabel(it)}</span>`;
    }
    const tierLetter = getWeaponTierLetter(it.item);
    if (tierLetter) html += `<span class="slot-tier">${tierLetter}</span>`;

    // Weapon heat bar (red)
    if (HEAT_WEAPONS.includes(it.item) && it.heat != null) {
      const fillH = Math.round(32 * it.heat);
      html += `<div class="slot-bar"><div class="slot-bar-fill" style="height:${fillH}px;background:#cc2222;"></div></div>`;
    }
    
    // Energy cell: energy value + charge bar
    if (it.energy != null) {
      html += `<span class="slot-energy">${it.energy.toFixed(1)}</span>`;
      const charge = it.maxEnergy > 0 ? it.energy / it.maxEnergy : 0;
      const fillH = Math.round(32 * charge);
      const color = charge > 0.5 ? '#66ff66' : (charge > 0.25 ? '#ffff66' : '#ff6666');
      html += `<div class="slot-bar"><div class="slot-bar-fill" style="height:${fillH}px;background:${color};"></div></div>`;
    } else if (it.fuel != null) {
      // Fuel cell: fuel value + charge bar (orange)
      html += `<span class="slot-energy">${it.fuel.toFixed(1)}</span>`;
      const charge = it.maxFuel > 0 ? it.fuel / it.maxFuel : 0;
      const fillH = Math.round(32 * charge);
      const color = charge > 0.5 ? '#ffaa44' : (charge > 0.25 ? '#ffcc66' : '#ff8844');
      html += `<div class="slot-bar"><div class="slot-bar-fill" style="height:${fillH}px;background:${color};"></div></div>`;
    } else if (it.oxygen != null) {
      // Oxygen canister: oxygen value + charge bar (blue)
      html += `<span class="slot-energy">${it.oxygen.toFixed(1)}</span>`;
      const charge = it.maxOxygen > 0 ? it.oxygen / it.maxOxygen : 0;
      const fillH = Math.round(32 * charge);
      const color = charge > 0.5 ? '#66aaff' : (charge > 0.25 ? '#88ccff' : '#4488dd');
      html += `<div class="slot-bar"><div class="slot-bar-fill" style="height:${fillH}px;background:${color};"></div></div>`;
    } else if (it.health != null) {
      // Health pack: health value + charge bar (reddish)
      html += `<span class="slot-energy">${it.health.toFixed(1)}</span>`;
      const maxHealthByItem = { 'health pack': 10, 'medium health pack': 30, 'large health pack': 60 };
      const maxHealth = maxHealthByItem[it.item] || Math.max(it.health, 10);
      const charge = it.health / maxHealth;
      const fillH = Math.round(32 * charge);
      const color = '#ff4444';
      html += `<div class="slot-bar"><div class="slot-bar-fill" style="height:${fillH}px;background:${color};"></div></div>`;
    } else if (it.quantity != null && it.quantity > 1) {
      html += `<span class="slot-qty">${it.quantity}</span>`;
    }
  }
  return html;
}

const SMALL_ENERGY_CELL_FULL_SELL = 150;
const MEDIUM_ENERGY_CELL_FULL_SELL = 550;
const LARGE_ENERGY_CELL_FULL_SELL = 1200;
const ENERGY_CELL_MIN_SELL = 10;

function getItemSellPrice(item) {
  if (!item) return 0;
  // Energy cells: proportional to remaining charge, with a small sell floor.
  const energyCellFullSell = {
    'small energy cell': SMALL_ENERGY_CELL_FULL_SELL,
    'medium energy cell': MEDIUM_ENERGY_CELL_FULL_SELL,
    'large energy cell': LARGE_ENERGY_CELL_FULL_SELL
  };
  if (energyCellFullSell[item.item] != null && item.energy != null && item.maxEnergy != null) {
    const chargeRatio = item.maxEnergy > 0 ? item.energy / item.maxEnergy : 0;
    return Math.max(ENERGY_CELL_MIN_SELL, Math.round(energyCellFullSell[item.item] * chargeRatio));
  }
  // Consumable refill items sell for half of purchase price.
  if ([
    'fuel tank', 'medium fuel tank', 'large fuel tank',
    'oxygen canister', 'medium oxygen canister', 'large oxygen canister',
    'health pack', 'medium health pack', 'large health pack'
  ].includes(item.item)) {
    const buy = ITEM_BUY_PRICE[item.item];
    return buy != null ? Math.floor(buy / 2) : 0;
  }
  // Static prices for other items
  const price = ITEM_SELL_PRICE[item.item];
  return price != null ? price : 0;
}

function getItemBuyPrice(itemKey) {
  // Check for custom shop price override first
  if (activeShopStructure && activeShopStructure.prices && activeShopStructure.prices[itemKey] !== undefined) {
    return activeShopStructure.prices[itemKey];
  }
  // Fall back to default price
  return ITEM_BUY_PRICE[itemKey] || 0;
}

function getSellTotal() {
  let total = 0;
  for (const slot of shopSellSlots) {
    if (!slot) continue;
    const price = getItemSellPrice(slot);
    const qty = slot.quantity != null ? slot.quantity : 1;
    total += price * qty;
  }
  return total;
}

function syncShopBuyArea() {
  for (let i = 0; i < shopBuySlots.length; i++) {
    const el = document.querySelector(`#shop-buy-slots .shop-buy-slot[data-buy-slot="${i}"]`);
    if (!el) continue;
    const it = shopBuySlots[i];
    el.classList.toggle('has-item', !!it);
    
    // We can reuse getSlotHTML, but buy slots don't usually need dynamic heat/energy bars if they are static store items.
    // However, our shop items DO have energy/maxEnergy properties (like energy cells).
    // So getSlotHTML works fine.
    
    el.innerHTML = getSlotHTML(it);
  }
  
    // Build price list - only items in this shop, sorted by price
    const itemNames = { 
      'small energy cell': 'Small Energy Cell',
      'medium energy cell': 'Medium Energy Cell',
      'large energy cell': 'Large Energy Cell',
      'fuel tank': 'Fuel Tank', 
      'medium fuel tank': 'Medium Fuel Tank',
      'large fuel tank': 'Large Fuel Tank',
      'oxygen canister': 'Oxygen Canister',
      'medium oxygen canister': 'Medium Oxygen Canister',
      'large oxygen canister': 'Large Oxygen Canister',
      'health pack': 'Health Pack',
      'medium health pack': 'Medium Health Pack',
      'large health pack': 'Large Health Pack',
      'light blaster': 'Light Blaster',
      'medium blaster': 'Medium Blaster',
      'large blaster': 'Large Blaster',
      'medium mining laser': 'Medium Mining Laser',
      'large mining laser': 'Large Mining Laser',
      cuprite: 'Cuprite',
      hematite: 'Hematite',
      aurite: 'Aurite',
      diamite: 'Diamite',
      platinite: 'Platinite',
      'scrap': 'Scrap',
      'warp key': 'Warp Key',
      'warp key fragment': 'Warp Key Fragment'
    };
    let html = '';
    
    // Only include items that are in this shop's inventory
    const shopItems = new Set();
    if (activeShopStructure && activeShopStructure.inventory) {
      activeShopStructure.inventory.forEach(i => shopItems.add(i.item));
    }
    
    // Sort by price (ascending)
    const sortedItems = Array.from(shopItems)
      .map(itemKey => ({ itemKey, price: getItemBuyPrice(itemKey) }))
      .filter(x => x.price > 0)
      .sort((a, b) => a.price - b.price);
    
    for (const { itemKey, price } of sortedItems) {
      const label = itemNames[itemKey] || itemKey;
      html += `<div class="price-row"><span class="price-label">${label}</span><span class="price-value">${price} cr</span></div>`;
    }
    const priceList = document.getElementById('shop-price-list');
    if (priceList) priceList.innerHTML = html;
}


// Cached HUD DOM references (populated once, avoids querySelector per frame)
const _hudSlots = []; // indices 0-8 = hotbar, 9-17 = extended
let _hudCreditsVal = null;
let _hudShopCredits = null;
let _extInvEl = null;
function _cacheHUDElements() {
  for (let i = 0; i < 9; i++) {
    _hudSlots[i] = document.querySelector(`#hotbar .slot[data-slot="${i}"]`);
  }
  for (let i = 9; i < 18; i++) {
    _hudSlots[i] = document.querySelector(`#extended-inventory .ext-slot[data-slot="${i}"]`);
  }
  _hudCreditsVal = document.querySelector('.credits-value');
  _hudShopCredits = document.getElementById('shop-credits-display');
  _extInvEl = document.getElementById('extended-inventory');
}

function markHUDDirty() { hudDirty = true; }

function updateHUD() {
  hudDirty = true; // Mark dirty so the gameLoop flushes it (keeps existing call-sites working)
}

function _flushHUD() {
  if (!hudDirty) return;
  hudDirty = false;
  if (_hudSlots.length === 0 || !_hudSlots[0]) _cacheHUDElements();
  const totalSlots = inventory.slots.length;
  // Render hotbar slots (0-8)
  for (let i = 0; i < 9; i++) {
    const el = _hudSlots[i];
    if (!el) continue;
    const it = hotbar[i];
    el.classList.toggle('has-item', !!it);
    el.classList.toggle('selected', i === selectedSlot);
    let html = `<span class="slot-num">${i + 1}</span>`;
    html += getSlotHTML(it);
    el.innerHTML = html;
  }
  // Render extended slots (9-17)
  for (let i = 9; i < 18; i++) {
    const el = _hudSlots[i];
    if (!el) continue;
    if (i < totalSlots) {
      el.style.display = '';
      const it = hotbar[i];
      el.classList.toggle('has-item', !!it);
      el.classList.toggle('selected', false);
      el.innerHTML = getSlotHTML(it);
    } else {
      el.style.display = 'none';
    }
  }
  // Show/hide extended inventory container based on whether ship has >9 slots
  if (_extInvEl) {
    const shouldShow = totalSlots > 9 && _extInvVisible;
    _extInvEl.classList.toggle('visible', shouldShow);
  }
  if (_hudCreditsVal) _hudCreditsVal.textContent = player.credits;
  if (_hudShopCredits) _hudShopCredits.textContent = `You have ${player.credits} credits`;
  // Update extended inventory visibility
  updateExtInvVisibility();
}

// Extended inventory visibility (hover or menu open)
let _extInvVisible = false;
let _extInvHovered = false;
function updateExtInvVisibility() {
  const anyMenuOpen = shopMenuOpen || craftingMenuOpen || refineryMenuOpen || shipyardMenuOpen;
  _extInvVisible = _extInvHovered || anyMenuOpen;
  if (_extInvEl) {
    const shouldShow = inventory.slots.length > 9 && _extInvVisible;
    _extInvEl.classList.toggle('visible', shouldShow);
  }
}

// Alias for compatibility if needed, or I can replace calls
const syncShopHotbar = updateHUD;
const syncShopCredits = updateHUD;

function syncShopSellArea() {
  for (let i = 0; i < shopSellSlots.length; i++) {
    const el = document.querySelector(`#shop-sell-slots .shop-sell-slot[data-sell-slot="${i}"]`);
    if (!el) continue;
    const it = shopSellSlots[i];
    el.classList.toggle('has-item', !!it);
    
    el.innerHTML = getSlotHTML(it);
  }
  const totalEl = document.getElementById('shop-sell-total');
  if (totalEl) totalEl.textContent = `Total: ${getSellTotal()} credits`;
  const sellBtn = document.getElementById('shop-sell-btn');
  if (sellBtn) sellBtn.disabled = getSellTotal() === 0;
}

// syncShopCredits merged into updateHUD


function returnSellAreaToHotbar() {
  for (let i = 0; i < shopSellSlots.length; i++) {
    const it = shopSellSlots[i];
    if (!it) continue;
    const qty = it.quantity != null ? it.quantity : 1;
    if (ORE_ITEMS.includes(it.item)) {
      inventory.add(it.item, qty);
    } else {
      for (let k = 0; k < qty; k++) {
        const payload = { ...it };
        if (payload.quantity != null) delete payload.quantity;
        for (let j = 0; j < hotbar.length; j++) {
          if (!hotbar[j]) {
            hotbar[j] = { ...payload };
            break;
          }
        }
      }
    }
    shopSellSlots[i] = null;
  }
  syncShopSellArea();
}

window.addEventListener('keydown', (e) => {
  sfx.resumeIfNeeded();
  if (startScreenOpen || deathScreenOpen) return;
  if (warpMenuOpen) return;
  // Allow E to close any open menu
  if (shopMenuOpen) {
    if (e.code === 'KeyE') { e.preventDefault(); closeShopMenu(); }
    return;
  }
  if (craftingMenuOpen) {
    if (e.code === 'KeyE') { e.preventDefault(); closeCraftingMenu(); }
    return;
  }
  if (refineryMenuOpen) {
    if (e.code === 'KeyE') { e.preventDefault(); closeRefineryMenu(); }
    return;
  }
  if (shipyardMenuOpen) {
    if (e.code === 'KeyE') { e.preventDefault(); closeShipyardMenu(); }
    return;
  }
  // Hotbar slot selection (1-9)
  if (e.key >= '1' && e.key <= '9') {
    selectedSlot = parseInt(e.key) - 1;
    sfx.playHotbarSelect();
    markHUDDirty();
  }
  // Key in E position (KeyE): open warp gate/shop/crafting/refinery/shipyard menu when inside
  if (e.code === 'KeyE') {
    if (!gamePaused && isShipInWarpGate()) {
      e.preventDefault();
      input.leftMouseDown = false;
      input.rightMouseDown = false;
      input.ctrlBrake = false;
      sfx.stopLaserLoop();
      laserWasFiring = false;
      gamePaused = true;
      warpMenuOpen = true;
      sfx.playMenuOpen();
      const overlay = document.getElementById('warp-menu-overlay');
      if (overlay) overlay.style.display = 'flex';
      const payBtn = document.getElementById('warp-pay-btn');
      if (payBtn) payBtn.disabled = player.credits < 3000;
    } else if (!gamePaused) {
      const shopSt = isShipInShop();
      if (shopSt) {
        e.preventDefault();
        input.leftMouseDown = false;
        input.rightMouseDown = false;
        input.ctrlBrake = false;
        openShopMenu(shopSt);
      } else {
        const craftSt = isShipInCrafting();
        if (craftSt) {
          e.preventDefault();
          input.leftMouseDown = false;
          input.rightMouseDown = false;
          input.ctrlBrake = false;
          openCraftingMenu(craftSt);
        } else {
          const refSt = isShipInRefinery();
          if (refSt) {
            e.preventDefault();
            input.leftMouseDown = false;
            input.rightMouseDown = false;
            input.ctrlBrake = false;
            openRefineryMenu(refSt);
          } else {
            const shipSt = isShipInShipyard();
            if (shipSt) {
              e.preventDefault();
              input.leftMouseDown = false;
              input.rightMouseDown = false;
              input.ctrlBrake = false;
              openShipyardMenu(shipSt);
            }
          }
        }
      }
    }
  }
});
window.addEventListener('keyup', (e) => {
  if (startScreenOpen || deathScreenOpen) return;
  if (warpMenuOpen) return;
  if (shopMenuOpen || craftingMenuOpen || refineryMenuOpen || shipyardMenuOpen) return;
});

// Default shop inventory generator
function generateDefaultShopInventory() {
  const inv = [];
  inv.push({ item: 'light blaster', heat: 0, overheated: false });
  inv.push({ item: 'medium mining laser', heat: 0, overheated: false });
  for (let i = 0; i < 6; i++) inv.push({ item: 'small energy cell', energy: 10, maxEnergy: 10 });
  inv.push({ item: 'medium energy cell', energy: 30, maxEnergy: 30 });
  inv.push({ item: 'medium energy cell', energy: 30, maxEnergy: 30 });
  for (let i = 0; i < 3; i++) inv.push({ item: 'fuel tank', fuel: 10, maxFuel: 10 });
  for (let i = 0; i < 2; i++) inv.push({ item: 'oxygen canister', oxygen: 10, maxOxygen: 10 });
  return inv;
}

let levelSpawnSettings = {
  initialDelay: 120,
  waveIntervalMin: 60,
  waveIntervalMax: 100,
  waveSizeMin: 2,
  waveSizeMax: 4
};

let currentLevelIdx = 0;

// Load level from JSON file
function loadLevel(levelData, levelIdx) {
  if (levelIdx !== undefined) currentLevelIdx = levelIdx;
  // Reset ship position and velocity
  ship.x = 0;
  ship.y = 0;
  ship.vx = 0;
  ship.vy = 0;
  shipSlowTimer = 0;
  setShipSlowVisual(false);
  
  levelWidth = levelData.width || 10000;
  levelHeight = levelData.height || 10000;
  
  levelSpawnSettings = ensureSpawnSettingsDefaults(levelData.spawnSettings || {
    initialDelay: 120,
    waveIntervalMin: 60,
    waveIntervalMax: 100,
    waveSizeMin: 2,
    waveSizeMax: 4,
    pirateTypePercentages: { ...DEFAULT_PIRATE_TYPE_PERCENTAGES },
    tiers: []
  });

  // Health multipliers by ore type
  const oreHealthMult = { cuprite: 1, hematite: 3, aurite: 5, diamite: 8, platinite: 12 };
  asteroids = (levelData.asteroids || []).map(ast => {
    const baseHealth = ast.radius;
    const mult = oreHealthMult[ast.oreType] || 1;
    return {
      ...ast,
      health: ast.health ?? (baseHealth * mult)
    };
  });
  structures = (levelData.structures || []).map(s => {
    // Preserve all properties from editor
    const st = { ...s };
    st.x = Number(s.x) || 0;
    st.y = Number(s.y) || 0;
    st.type = String(s.type || 'shop');

    if (st.type === 'shop') {
      if (!st.inventory) st.inventory = generateDefaultShopInventory();
      if (!st.prices) st.prices = {};
    }
    
    if (st.type === 'piratebase') {
      st.tier = normalizePirateBaseTier(st.tier);
      // Use config health or default 150
      const hp = st.health || 150;
      st.health = hp;
      st.maxHealth = hp;
      st.aggroed = false;
      st.spawnTimer = st.spawnRate || 30; // Wait full spawn time before first wave
      // Default defense count if not set
      if (st.defenseCount === undefined) st.defenseCount = 8;
      // Default spawn rate if not set
      if (st.spawnRate === undefined) st.spawnRate = 30;
      ensurePirateBaseSpawnDefaults(st);
      // Default drops if not set
      if (!st.drops) st.drops = []; // Will fallback to default in onPirateBaseDeath if empty? No, better to pre-fill or handle empty logic. 
      // Actually, existing logic hardcoded drops. If st.drops is empty, we might want to default it?
      // Editor saves empty array if nothing added. 
      // Let's populate default drops if it's missing entirely (undefined), but respect empty array if user cleared it.
      if (s.drops === undefined) {
        st.drops = [
          { item: 'scrap', quantity: 50 }, // Approximation of previous random logic, handled in death function
          { item: 'warp key', quantity: 1 }
        ];
      }
    }
    
    if (st.type === 'warpgate') {
        if (st.warpCost === undefined) st.warpCost = 3000;
        if (st.warpDestination === undefined) st.warpDestination = 'level2'; // Default
    }

    return st;
  });
  if (floatingOreContainer) while (floatingOreContainer.children.length) floatingOreContainer.remove(floatingOreContainer.children[0]);
  floatingItems.length = 0; // Clear floating items on level load
  pirates.length = 0; // Clear pirates on level load
  for (const st of structures) {
    if (st.type === 'piratebase') spawnBaseDefensePirates(st);
  }
  levelElapsedTime = 0;
  levelIsDebug = levelData.debug === true;
  // Schedule first wave. (Non-debug uses spawnSettings.initialDelay.)
  pirateNextWaveTime = levelIsDebug ? 5 : (levelSpawnSettings.initialDelay || 0);
  
  // Regenerate stars: same density as a 3000x3000 level, using level seed for reproducibility
  levelSeed = typeof levelData.seed === 'number' ? levelData.seed >>> 0 : 0;
  const rng = createSeededRandom(levelSeed);
  const REFERENCE_AREA = 3000 * 3000;
  const numStars = Math.round(NUM_STARS * (levelWidth * levelHeight) / REFERENCE_AREA);
  stars.length = 0;
  const spread = Math.max(levelWidth, levelHeight) / 2;
  for (let i = 0; i < numStars; i++) {
    stars.push({
      x: (rng() - 0.5) * 2 * spread,
      y: (rng() - 0.5) * 2 * spread,
      size: rng() * 2 + 0.5,
      brightness: 0.3 + rng() * 0.7
    });
  }
  refreshAsteroidMeshes();
  refreshStructureMeshes();
  
  // Tutorial text: appears above player's starting position (timer starts on first thrust)
  tutorialTextTimer = 11; // 10 seconds visible + 1 second fade
  tutorialTextTimerStarted = false;
  tutorialTextWorldX = ship.x;
  tutorialTextWorldY = ship.y - 80; // Above the ship
  shipStatusTransient.length = 0;
  shipStatusPersistent.text = '';
  shipStatusPersistent.color = '#fff';
  shipStatusPersistent.active = false;
  shipStatusPersistent.alpha = 0;

  // Level 3: start in transport ship
  if (currentLevelIdx === 2) {
    ownedShips.add('transport');
    currentShipType = 'transport';
  }

  // Ensure inventory matches current ship's slot count
  const shipStats = SHIP_STATS[currentShipType];
  if (shipStats) {
    inventory.resize(shipStats.slots);
    applyShipStats(currentShipType);
  }
  if (currentLevelIdx === 2) {
    player.health = player.maxHealth;
    player.fuel = player.maxFuel;
    player.oxygen = player.maxOxygen;
  }

  // Per-level starting inventory
  if (currentLevelIdx === 1) {
    // Level 2: give player upgraded loadout
    for (let i = 0; i < inventory.slots.length; i++) inventory.set(i, null);
    inventory.set(0, { item: 'medium mining laser', heat: 0, overheated: false });
    inventory.set(1, { item: 'light blaster', heat: 0, overheated: false });
    inventory.set(2, { item: 'small energy cell', energy: 10, maxEnergy: 10 });
    inventory.set(3, { item: 'medium energy cell', energy: 30, maxEnergy: 30 });
    selectedSlot = 0;
    hudDirty = true;
  } else if (currentLevelIdx === 2) {
    // Level 3: med laser, med blaster, 2 medium energy cells
    for (let i = 0; i < inventory.slots.length; i++) inventory.set(i, null);
    inventory.set(0, { item: 'medium mining laser', heat: 0, overheated: false });
    inventory.set(1, { item: 'medium blaster', heat: 0, overheated: false });
    inventory.set(2, { item: 'medium energy cell', energy: 30, maxEnergy: 30 });
    inventory.set(3, { item: 'medium energy cell', energy: 30, maxEnergy: 30 });
    selectedSlot = 0;
    hudDirty = true;
  } else {
    // Default loadout (Level 1 / Debug)
    for (let i = 0; i < inventory.slots.length; i++) inventory.set(i, null);
    inventory.set(0, { item: 'mining laser', heat: 0, overheated: false });
    inventory.set(1, { item: 'small energy cell', energy: 10, maxEnergy: 10 });
    inventory.set(2, { item: 'small energy cell', energy: 10, maxEnergy: 10 });
    selectedSlot = 0;
    hudDirty = true;
  }
  syncLowResourceStateFromPlayer();
}

// Level select: scan known levels and populate dropdown
const KNOWN_LEVELS = [
  { name: 'Level 1', path: 'levels/level1.json' },
  { name: 'Level 2', path: 'levels/level2.json' },
  { name: 'Level 3', path: 'levels/level3.json' },
  { name: 'Debug', path: 'levels/debug.json' }
];

const LEVEL_STORAGE_KEY = 'lastSelectedLevel';
const levelSelect = document.getElementById('level-select');
if (levelSelect) {
  KNOWN_LEVELS.forEach((lev, i) => {
    const opt = document.createElement('option');
    opt.value = i;
    opt.textContent = lev.name;
    levelSelect.appendChild(opt);
  });
  levelSelect.addEventListener('change', () => {
    const idx = levelSelect.value;
    const lev = KNOWN_LEVELS[idx];
    if (lev) {
      try { localStorage.setItem(LEVEL_STORAGE_KEY, idx); } catch (_) {}
      fetch(lev.path + '?t=' + Date.now())
        .then(res => res.json())
        .then(level => {
          sfx.playLevelChange();
          loadLevel(level, Number(idx));
        })
        .catch(err => console.error('Failed to load ' + lev.path, err));
    }
  });
}

// Restore last selected level from cache, falling back to 0
let initialLevelIdx = 0;
try {
  const saved = localStorage.getItem(LEVEL_STORAGE_KEY);
  if (saved !== null && KNOWN_LEVELS[Number(saved)]) initialLevelIdx = Number(saved);
} catch (_) {}
if (levelSelect) levelSelect.value = initialLevelIdx;

fetch(KNOWN_LEVELS[initialLevelIdx].path + '?t=' + Date.now())
  .then(res => res.json())
  .then(level => loadLevel(level, initialLevelIdx))
  .catch(() => {});

function closeWarpMenu() {
  sfx.playMenuClose();
  warpMenuOpen = false;
  gamePaused = warpMenuOpen || shopMenuOpen || craftingMenuOpen || shipyardMenuOpen || refineryMenuOpen;
  const overlay = document.getElementById('warp-menu-overlay');
  if (overlay) overlay.style.display = 'none';
}

function openShopMenu(shopStructure) {
  if (shopMenuOpen) return;
  sfx.playMenuOpen();
  
  activeShopStructure = shopStructure;
  
  // Populate buy slots from structure inventory - expand by quantity
  shopBuySlots.fill(null);
  if (shopStructure && shopStructure.inventory) {
    let slotIndex = 0;
    for (const invItem of shopStructure.inventory) {
      const qty = invItem.quantity || 1;
      for (let q = 0; q < qty && slotIndex < shopBuySlots.length; q++) {
        const item = { ...invItem };
        delete item.quantity; // Remove quantity from individual slot item
        // Ensure containers are at full capacity with correct values
        if (item.item === 'small energy cell') { item.energy = 10; item.maxEnergy = 10; }
        else if (item.item === 'medium energy cell') { item.energy = 30; item.maxEnergy = 30; }
        else if (item.item === 'large energy cell') { item.energy = 60; item.maxEnergy = 60; }
        else if (item.item === 'fuel tank') { item.fuel = 10; item.maxFuel = 10; }
        else if (item.item === 'medium fuel tank') { item.fuel = 30; item.maxFuel = 30; }
        else if (item.item === 'large fuel tank') { item.fuel = 60; item.maxFuel = 60; }
        else if (item.item === 'oxygen canister') { item.oxygen = 10; item.maxOxygen = 10; }
        else if (item.item === 'medium oxygen canister') { item.oxygen = 30; item.maxOxygen = 30; }
        else if (item.item === 'large oxygen canister') { item.oxygen = 60; item.maxOxygen = 60; }
        else if (item.item === 'health pack') { item.health = 10; }
        else if (item.item === 'medium health pack') { item.health = 30; }
        else if (item.item === 'large health pack') { item.health = 60; }
        else if (item.maxFuel !== undefined) item.fuel = item.maxFuel;
        else if (item.maxOxygen !== undefined) item.oxygen = item.maxOxygen;
        shopBuySlots[slotIndex++] = item;
      }
    }
  }

  gamePaused = true;
  sfx.stopLaserLoop();
  laserWasFiring = false;
  shopMenuOpen = true;
  for (let i = 0; i < shopSellSlots.length; i++) shopSellSlots[i] = null;
  syncShopBuyArea();
  updateHUD();
  syncShopSellArea();
  const overlay = document.getElementById('shop-menu-overlay');
  if (overlay) overlay.style.display = 'flex';
  const ghost = document.getElementById('shop-drag-ghost');
  if (ghost) ghost.style.display = 'none';
  
  const creditsEl = document.getElementById('shop-credits-display');
  if (creditsEl) creditsEl.textContent = `You have ${player.credits} credits`;
}

function closeShopMenu() {
  sfx.playMenuClose();
  returnSellAreaToHotbar();
  shopMenuOpen = false;
  gamePaused = warpMenuOpen || shopMenuOpen || craftingMenuOpen || shipyardMenuOpen || refineryMenuOpen;
  inventoryDrag = null;
  activeShopStructure = null;
  const overlay = document.getElementById('shop-menu-overlay');
  if (overlay) overlay.style.display = 'none';
  const ghost = document.getElementById('shop-drag-ghost');
  if (ghost) ghost.style.display = 'none';
  hideShopTooltip();
}

const warpMenuOverlay = document.getElementById('warp-menu-overlay');
const warpPayBtn = document.getElementById('warp-pay-btn');
const warpCancelBtn = document.getElementById('warp-cancel-btn');
if (warpCancelBtn) {
  warpCancelBtn.addEventListener('click', () => {
    sfx.unlock();
    sfx.playCancel();
    closeWarpMenu();
  });
}
if (warpPayBtn) {
  warpPayBtn.addEventListener('click', () => {
    sfx.unlock();
    if (player.credits >= 3000) {
      player.credits -= 3000;
      sfx.playWarp();
      sfx.playConfirm();
      closeWarpMenu();
    } else {
      sfx.playCancel();
    }
  });
}

const shopCloseBtn = document.getElementById('shop-close-btn');
if (shopCloseBtn) {
  shopCloseBtn.addEventListener('click', () => {
    sfx.unlock();
    closeShopMenu();
  });
}

const shopSellBtn = document.getElementById('shop-sell-btn');
if (shopSellBtn) {
  shopSellBtn.addEventListener('click', () => {
    sfx.unlock();
    const total = getSellTotal();
    if (total <= 0) return;
    player.credits += total;
    sfx.playSell();
    for (let i = 0; i < shopSellSlots.length; i++) shopSellSlots[i] = null;
    syncShopSellArea();
    updateHUD();
  });
}

// Crafting Menu Logic
function openCraftingMenu(structure) {
  if (craftingMenuOpen) return;
  sfx.playMenuOpen();
  activeCraftingStructure = structure;
  craftingMenuOpen = true;
  gamePaused = true;
  sfx.stopLaserLoop();
  laserWasFiring = false;
  
  // Clear slots
  for(let i=0; i<craftingInputSlots.length; i++) craftingInputSlots[i] = null;
  craftingOutputSlot = null;
  
  // Render recipes list
  const list = document.getElementById('crafting-recipes-list');
  if (list) {
    list.innerHTML = '';
    if (structure.recipes) {
      structure.recipes.forEach(r => {
        const div = document.createElement('div');
        div.className = 'recipe-item';
        const inputs = r.inputs.map(i => `${i.quantity}x ${i.item}`).join(', ');
        div.textContent = `${inputs} -> ${r.output.quantity}x ${r.output.item}`;
        list.appendChild(div);
      });
    }
  }
  
  const overlay = document.getElementById('crafting-menu-overlay');
  if (overlay) overlay.style.display = 'flex';
  syncCraftingUI();
}

function closeCraftingMenu() {
  sfx.playMenuClose();
  // Return items to inventory or drop them
  for(let i=0; i<craftingInputSlots.length; i++) {
    if (craftingInputSlots[i]) {
        if (!inventory.add(craftingInputSlots[i].item, craftingInputSlots[i].quantity)) {
             // Drop if full
             const it = craftingInputSlots[i];
             const angle = Math.random() * Math.PI * 2;
             floatingItems.push({
               x: ship.x + Math.cos(angle) * 40,
               y: ship.y + Math.sin(angle) * 40,
               vx: Math.cos(angle) * 20,
               vy: Math.sin(angle) * 20,
               item: it.item,
               quantity: it.quantity,
               energy: it.energy, maxEnergy: it.maxEnergy,
               fuel: it.fuel, maxFuel: it.maxFuel,
               oxygen: it.oxygen, maxOxygen: it.maxOxygen
             });
        }
        craftingInputSlots[i] = null;
    }
  }
  
  craftingMenuOpen = false;
  gamePaused = warpMenuOpen || shopMenuOpen || craftingMenuOpen || shipyardMenuOpen || refineryMenuOpen;
  activeCraftingStructure = null;
  const overlay = document.getElementById('crafting-menu-overlay');
  if (overlay) overlay.style.display = 'none';
  inventoryDrag = null;
}

function syncCraftingUI() {
    // Sync input slots
    for(let i=0; i<craftingInputSlots.length; i++) {
        const el = document.querySelector(`.crafting-slot[data-craft-input="${i}"]`);
        if (el) {
            el.innerHTML = getSlotHTML(craftingInputSlots[i]);
            el.classList.toggle('has-item', !!craftingInputSlots[i]);
        }
    }
    // Sync output slot
    const outEl = document.getElementById('crafting-output-slot');
    if (outEl) {
        outEl.innerHTML = getSlotHTML(craftingOutputSlot);
        outEl.classList.toggle('has-item', !!craftingOutputSlot && craftingOutputSlot.real);
        if (craftingOutputSlot && !craftingOutputSlot.real) outEl.style.opacity = '0.5';
        else outEl.style.opacity = '1';
    }
    
    // Check recipes
    checkCraftingRecipe();
}

function checkCraftingRecipe() {
    if (!activeCraftingStructure || !activeCraftingStructure.recipes) return;
    
    // If output is real (crafted but not taken), don't update preview
    if (craftingOutputSlot && craftingOutputSlot.real) {
        const btn = document.getElementById('craft-btn');
        if (btn) {
            btn.disabled = true;
            btn.textContent = 'Output Full';
        }
        return;
    }

    // Aggregate inputs
    const currentInputs = {};
    for(const slot of craftingInputSlots) {
        if (slot) {
            currentInputs[slot.item] = (currentInputs[slot.item] || 0) + slot.quantity;
        }
    }
    
    let match = null;
    for (const r of activeCraftingStructure.recipes) {
        let possible = true;
        for (const req of r.inputs) {
            if ((currentInputs[req.item] || 0) < req.quantity) {
                possible = false;
                break;
            }
        }
        if (possible) {
            match = r;
            break; 
        }
    }
    
    const btn = document.getElementById('craft-btn');
    if (match) {
        craftingOutputSlot = { item: match.output.item, quantity: match.output.quantity, real: false };
        const payload = getShopItemPayload(match.output.item);
        Object.assign(craftingOutputSlot, payload);
        
        if (btn) {
            btn.disabled = false;
            btn.textContent = 'Craft';
            btn.onclick = () => craftItem(match);
        }
    } else {
        craftingOutputSlot = null;
        if (btn) {
            btn.disabled = true;
            btn.textContent = 'Craft';
            btn.onclick = null;
        }
    }
    
    // Re-render output slot to show ghost
    const outEl = document.getElementById('crafting-output-slot');
    if (outEl) {
        outEl.innerHTML = getSlotHTML(craftingOutputSlot);
        if (craftingOutputSlot && !craftingOutputSlot.real) outEl.style.opacity = '0.5';
        else outEl.style.opacity = '1';
    }
}

function craftItem(recipe) {
    if (craftingOutputSlot && craftingOutputSlot.real) return;
  sfx.playCraft();

    // Consume inputs
    // Deep copy inputs to avoid modifying recipe definition
    const inputsNeeded = recipe.inputs.map(i => ({...i}));
    
    for (const req of inputsNeeded) {
        let needed = req.quantity;
        for (let i=0; i<craftingInputSlots.length; i++) {
            if (craftingInputSlots[i] && craftingInputSlots[i].item === req.item) {
                const take = Math.min(needed, craftingInputSlots[i].quantity);
                craftingInputSlots[i].quantity -= take;
                needed -= take;
                if (craftingInputSlots[i].quantity <= 0) craftingInputSlots[i] = null;
                if (needed <= 0) break;
            }
        }
    }
    
    // Set Output
    if (craftingOutputSlot) {
        craftingOutputSlot.real = true;
    }
    syncCraftingUI();
}

const craftingCloseBtn = document.getElementById('crafting-close-btn');
if (craftingCloseBtn) {
  craftingCloseBtn.addEventListener('click', () => {
    sfx.unlock();
    closeCraftingMenu();
  });
}

// ============ Refinery Menu Logic ============

function openRefineryMenu(structure) {
  if (refineryMenuOpen) return;
  sfx.playMenuOpen();
  activeRefineryStructure = structure;
  refineryMenuOpen = true;
  gamePaused = true;
  sfx.stopLaserLoop();
  laserWasFiring = false;

  // Clear slots
  for (let i = 0; i < 4; i++) refineryInputSlots[i] = null;
  refineryOutputSlot = null;

  // Show accepted ores label
  const acceptedOres = structure.acceptedOres || [];
  const acceptedLabel = document.getElementById('refinery-accepted-label');
  if (acceptedLabel) {
    const names = acceptedOres.map(o => ITEM_DISPLAY_NAMES[o] || o);
    acceptedLabel.textContent = 'Accepts: ' + (names.length > 0 ? names.join(', ') : 'None');
  }

  const overlay = document.getElementById('refinery-menu-overlay');
  if (overlay) overlay.style.display = 'flex';
  syncRefineryUI();
}

function closeRefineryMenu() {
  sfx.playMenuClose();
  // Return unprocessed items to inventory or drop them
  for (let i = 0; i < 4; i++) {
    if (refineryInputSlots[i]) {
      if (!inventory.add(refineryInputSlots[i].item, refineryInputSlots[i].quantity)) {
        // Drop if full
        const it = refineryInputSlots[i];
        const angle = Math.random() * Math.PI * 2;
        floatingItems.push({
          x: ship.x + Math.cos(angle) * 30,
          y: ship.y + Math.sin(angle) * 30,
          vx: Math.cos(angle) * 40,
          vy: Math.sin(angle) * 40,
          item: it.item,
          quantity: it.quantity
        });
      }
      refineryInputSlots[i] = null;
    }
  }
  // Return output
  if (refineryOutputSlot && refineryOutputSlot.real) {
    if (!inventory.add(refineryOutputSlot.item, refineryOutputSlot.quantity)) {
      const angle = Math.random() * Math.PI * 2;
      floatingItems.push({
        x: ship.x + Math.cos(angle) * 30,
        y: ship.y + Math.sin(angle) * 30,
        vx: Math.cos(angle) * 40,
        vy: Math.sin(angle) * 40,
        item: refineryOutputSlot.item,
        quantity: refineryOutputSlot.quantity
      });
    }
    refineryOutputSlot = null;
  }

  refineryMenuOpen = false;
  gamePaused = warpMenuOpen || shopMenuOpen || craftingMenuOpen || shipyardMenuOpen || refineryMenuOpen;
  activeRefineryStructure = null;
  const overlay = document.getElementById('refinery-menu-overlay');
  if (overlay) overlay.style.display = 'none';
  inventoryDrag = null;
  hudDirty = true;
}

function syncRefineryUI() {
  // Sync input slots
  for (let i = 0; i < 4; i++) {
    const el = document.querySelector(`.refinery-input-slot[data-refinery-input="${i}"]`);
    if (el) {
      el.innerHTML = getSlotHTML(refineryInputSlots[i]);
      el.classList.toggle('has-item', !!refineryInputSlots[i]);
    }
  }
  // Sync output slot
  const outEl = document.getElementById('refinery-output-slot');
  if (outEl) {
    outEl.innerHTML = getSlotHTML(refineryOutputSlot);
    outEl.classList.toggle('has-item', !!refineryOutputSlot && refineryOutputSlot.real);
    if (refineryOutputSlot && !refineryOutputSlot.real) outEl.style.opacity = '0.5';
    else outEl.style.opacity = '1';
  }

  checkRefineryRecipe();
}

function checkRefineryRecipe() {
  if (!activeRefineryStructure) return;
  const acceptedOres = activeRefineryStructure.acceptedOres || [];

  // If output is real (already refined but not taken), disable button
  if (refineryOutputSlot && refineryOutputSlot.real) {
    const btn = document.getElementById('refine-btn');
    if (btn) { btn.disabled = true; btn.textContent = 'Output Full'; }
    return;
  }

  // Aggregate input ores, only counting accepted ores
  let totalOre = 0;
  let oreType = null;
  let mixedTypes = false;
  for (const slot of refineryInputSlots) {
    if (!slot) continue;
    if (!acceptedOres.includes(slot.item)) {
      // Non-accepted ore - can't refine
      mixedTypes = true;
      break;
    }
    if (oreType === null) oreType = slot.item;
    else if (slot.item !== oreType) { mixedTypes = true; break; }
    totalOre += slot.quantity;
  }

  const btn = document.getElementById('refine-btn');
  if (!mixedTypes && oreType && totalOre >= 2 && RAW_TO_REFINED[oreType]) {
    const refinedName = RAW_TO_REFINED[oreType];
    const outputQty = Math.floor(totalOre / 2);
    refineryOutputSlot = { item: refinedName, quantity: outputQty, real: false };
    const payload = getItemPayload(refinedName);
    Object.assign(refineryOutputSlot, payload);

    if (btn) {
      btn.disabled = false;
      btn.textContent = 'Refine';
      btn.onclick = () => refineOre(oreType, totalOre, refinedName, outputQty);
    }
  } else {
    refineryOutputSlot = null;
    if (btn) {
      btn.disabled = true;
      btn.textContent = totalOre > 0 && mixedTypes ? 'Single ore type only' : totalOre === 1 ? 'Need 2+ ore' : 'Refine';
      btn.onclick = null;
    }
  }

  // Update output preview
  const outEl = document.getElementById('refinery-output-slot');
  if (outEl) {
    outEl.innerHTML = getSlotHTML(refineryOutputSlot);
    if (refineryOutputSlot && !refineryOutputSlot.real) outEl.style.opacity = '0.5';
    else outEl.style.opacity = '1';
  }
}

function refineOre(oreType, totalOre, refinedName, outputQty) {
  if (refineryOutputSlot && refineryOutputSlot.real) return;
  sfx.playRefine();

  // Consume input ores: consume outputQty * 2 ores
  let toConsume = outputQty * 2;
  for (let i = 0; i < 4; i++) {
    if (!refineryInputSlots[i] || refineryInputSlots[i].item !== oreType) continue;
    const take = Math.min(toConsume, refineryInputSlots[i].quantity);
    refineryInputSlots[i].quantity -= take;
    toConsume -= take;
    if (refineryInputSlots[i].quantity <= 0) refineryInputSlots[i] = null;
    if (toConsume <= 0) break;
  }

  // Mark output as real
  if (refineryOutputSlot) {
    refineryOutputSlot.real = true;
  }
  syncRefineryUI();
}

const refineryCloseBtn = document.getElementById('refinery-close-btn');
if (refineryCloseBtn) {
  refineryCloseBtn.addEventListener('click', () => {
    sfx.unlock();
    closeRefineryMenu();
  });
}

// ============ End Refinery Menu Logic ============

let currentShipType = 'scout';
const ownedShips = new Set(['scout']); // Scout is owned by default
const shipSavedStats = {}; // { shipType: { health, fuel, oxygen } }
let activeShipyardStructure = null;

/** Apply ship stats to player and dynamic variables */
function applyShipStats(type) {
  const stats = SHIP_STATS[type];
  if (!stats) return;
  currentShipType = type;
  player.maxHealth = stats.health;
  player.maxFuel = stats.fuel;
  player.maxOxygen = stats.oxygen;
  MAX_SPEED = stats.speed;
  shipCollisionRadius = stats.collisionRadius;
  shipScale = stats.shipScale;
  shipDamageMult = stats.damageMult;
  attachShipModelForType(type);
  // Resize inventory
  const excess = inventory.resize(stats.slots);
  // Drop excess items as floating items
  for (const it of excess) {
    if (!it) continue;
    const angle = Math.random() * Math.PI * 2;
    floatingItems.push({
      x: ship.x + Math.cos(angle) * 30,
      y: ship.y + Math.sin(angle) * 30,
      vx: Math.cos(angle) * 40,
      vy: Math.sin(angle) * 40,
      item: it.item,
      quantity: it.quantity || 1
    });
  }
  if (selectedSlot >= stats.slots) selectedSlot = 0;
}

function switchShip(type) {
  if (type === currentShipType) return;
  const stats = SHIP_STATS[type];
  if (!stats) return;
  let isNewlyBought = false;

  // Buy if not owned
  if (!ownedShips.has(type)) {
    if (player.credits < stats.price) return;
    player.credits -= stats.price;
    ownedShips.add(type);
    isNewlyBought = true;
    sfx.playBuy();
  } else {
    sfx.playConfirm();
  }

  // Save current ship's resource state
  shipSavedStats[currentShipType] = {
    health: player.health,
    fuel: player.fuel,
    oxygen: player.oxygen
  };

  // Apply new ship stats
  applyShipStats(type);

  // Newly bought ships always start full. Otherwise restore saved stats if present.
  if (isNewlyBought) {
    player.health = player.maxHealth;
    player.fuel = player.maxFuel;
    player.oxygen = player.maxOxygen;
  } else if (shipSavedStats[type]) {
    player.health = Math.min(shipSavedStats[type].health, player.maxHealth);
    player.fuel = Math.min(shipSavedStats[type].fuel, player.maxFuel);
    player.oxygen = Math.min(shipSavedStats[type].oxygen, player.maxOxygen);
  } else {
    // New ship starts at full
    player.health = player.maxHealth;
    player.fuel = player.maxFuel;
    player.oxygen = player.maxOxygen;
  }

  updateHUD();
}

// Shipyard Menu Logic â€” Card-based UI with 3D ship previews
let shipyardPreviews = []; // Array of { renderer, scene, camera, model, canvas, animId }

function cleanupShipyardPreviews() {
  for (const p of shipyardPreviews) {
    if (p.animId) cancelAnimationFrame(p.animId);
    if (p.renderer) p.renderer.dispose();
  }
  shipyardPreviews = [];
}

function createShipPreview(container, shipType) {
  const PREVIEW_W = 200;
  const PREVIEW_H = 100;
  const DPR = Math.min(window.devicePixelRatio || 1, 2);

  const cvs = document.createElement('canvas');
  cvs.width = PREVIEW_W * DPR;
  cvs.height = PREVIEW_H * DPR;
  container.appendChild(cvs);

  const renderer = new THREE.WebGLRenderer({ canvas: cvs, antialias: true, alpha: true });
  renderer.setPixelRatio(DPR);
  renderer.setSize(PREVIEW_W, PREVIEW_H);
  renderer.setClearColor(0x000000, 0);

  const scene = new THREE.Scene();
  // Top-down orthographic camera matching the in-game perspective
  const aspect = PREVIEW_W / PREVIEW_H;
  const viewSize = 3.0;
  const camera = new THREE.OrthographicCamera(
    -viewSize * aspect / 2, viewSize * aspect / 2,
    viewSize / 2, -viewSize / 2,
    0.1, 100
  );
  // Camera looks straight down the Z axis (same as in-game)
  camera.position.set(0, 0, 20);
  camera.lookAt(0, 0, 0);

  // Lighting â€” strong top light + ambient to match game appearance
  scene.add(new THREE.AmbientLight(0xffffff, 0.8));
  const topLight = new THREE.DirectionalLight(0xffffff, 2.0);
  topLight.position.set(0, 0, 50);
  scene.add(topLight);
  const sideLight = new THREE.DirectionalLight(0xffffff, 0.6);
  sideLight.position.set(20, 20, 30);
  scene.add(sideLight);

  // Wrapper group: we rotate this group around Z to spin the ship in the top-down plane
  const spinGroup = new THREE.Group();
  scene.add(spinGroup);

  const previewObj = { renderer, scene, camera, model: null, spinGroup, canvas: cvs, animId: null };

  // Load ship model
  const LoaderClass = (window.GLTFLoader || (THREE && THREE.GLTFLoader));
  if (LoaderClass) {
    const loader = new LoaderClass();
    const modelFile = SHIP_MODEL_FILES[shipType] || SHIP_MODEL_FILES.scout;
    const glbUrl = new URL('assets/' + modelFile, window.location.href).toString();
    loader.load(glbUrl, (gltf) => {
      const model = gltf.scene.clone(true);
      const stats = SHIP_STATS[shipType];
      const box = new THREE.Box3().setFromObject(model);
      const center = box.getCenter(new THREE.Vector3());
      const size = box.getSize(new THREE.Vector3());
      const maxDim = Math.max(size.x, size.y, size.z);
      // Scale to fit the preview, adjusted by ship type scale (20% smaller)
      const fitScale = 1.76 / (maxDim > 0 ? maxDim : 1);
      const displayScale = fitScale * (stats ? stats.shipScale : 1.0);
      model.scale.setScalar(displayScale);
      model.position.sub(center.multiplyScalar(displayScale));
      // Same orientation as in-game: glTF Y-up â†’ top-down XY view (top hull visible)
      model.rotation.x = Math.PI / 2;
      // Match per-ship world offset (3 for scout, 5 for cutter/transport) in preview space.
      const scoutScale = fitScale * (SHIP_STATS.scout?.shipScale ?? 1.0);
      const scoutPreviewOffset = scoutScale * SHIP_PREVIEW_Y_OFFSET_FACTOR;
      const worldYOffset = PLAYER_SHIP_Y_OFFSET_BY_TYPE[shipType] ?? PLAYER_SHIP_Y_OFFSET_BY_TYPE.scout;
      model.position.y += scoutPreviewOffset * (worldYOffset / PLAYER_SHIP_Y_OFFSET_BY_TYPE.scout);

      model.traverse((child) => {
        if (child.isMesh && child.material) {
          child.material = child.material.clone();
        }
      });

      spinGroup.add(model);
      previewObj.model = model;
    });
  }

  // Animate: rotate the wrapper group around Z (yaw in top-down view, like turning in game)
  // Frame-rate independent at ~0.5 rad/s
  const SHIPYARD_SPIN_SPEED = 0.24; // radians per second (half of previous ~0.48)
  let lastTime = performance.now();
  function animate() {
    previewObj.animId = requestAnimationFrame(animate);
    const now = performance.now();
    const dt = (now - lastTime) / 1000;
    lastTime = now;
    previewObj.spinGroup.rotation.z -= SHIPYARD_SPIN_SPEED * dt;
    renderer.render(scene, camera);
  }
  animate();

  shipyardPreviews.push(previewObj);
  return previewObj;
}

function openShipyardMenu(structure) {
  if (shipyardMenuOpen) return;
  sfx.playMenuOpen();
  shipyardMenuOpen = true;
  activeShipyardStructure = structure;
  gamePaused = true;
  sfx.stopLaserLoop();
  laserWasFiring = false;

  renderShipyardCards(structure);

  const creditsEl = document.getElementById('shipyard-credits');
  if (creditsEl) creditsEl.textContent = `${player.credits} credits`;

  const overlay = document.getElementById('shipyard-menu-overlay');
  if (overlay) overlay.style.display = 'flex';
}

function renderShipyardCards(structure) {
  cleanupShipyardPreviews();

  const forSaleContainer = document.getElementById('shipyard-for-sale');
  const ownedContainer = document.getElementById('shipyard-owned');
  const forSaleSection = document.getElementById('shipyard-for-sale-section');
  const ownedSection = document.getElementById('shipyard-owned-section');
  if (!forSaleContainer || !ownedContainer) return;
  forSaleContainer.innerHTML = '';
  ownedContainer.innerHTML = '';

  const available = structure.availableShips || ['scout'];

  function makeCard(type, mode) {
    const stats = SHIP_STATS[type];
    if (!stats) return null;

    const card = document.createElement('div');
    card.className = 'shipyard-card' + (mode === 'current' ? ' current' : '');

    // 3D Preview area
    const previewDiv = document.createElement('div');
    previewDiv.className = 'shipyard-card-preview';
    createShipPreview(previewDiv, type);
    card.appendChild(previewDiv);

    // Card body
    const body = document.createElement('div');
    body.className = 'shipyard-card-body';

    const nameEl = document.createElement('div');
    nameEl.className = 'shipyard-card-name';
    nameEl.textContent = stats.name;
    body.appendChild(nameEl);

    const descEl = document.createElement('div');
    descEl.className = 'shipyard-card-desc';
    descEl.textContent = stats.desc;
    body.appendChild(descEl);

    // Stats grid
    const statsGrid = document.createElement('div');
    statsGrid.className = 'shipyard-card-stats';
    const statEntries = [
      ['HP', stats.health],
      ['Fuel', stats.fuel],
      ['O2', stats.oxygen],
      ['Speed', stats.speed],
      ['Slots', stats.slots],
    ];
    if (stats.damageMult > 1) {
      statEntries.push(['Wpn Dmg', `+${Math.round((stats.damageMult - 1) * 100)}%`]);
    }
    for (const [label, value] of statEntries) {
      const lbl = document.createElement('span');
      lbl.className = 'shipyard-stat-label';
      lbl.textContent = label;
      const val = document.createElement('span');
      val.className = 'shipyard-stat-value';
      val.textContent = value;
      statsGrid.appendChild(lbl);
      statsGrid.appendChild(val);
    }
    body.appendChild(statsGrid);

    // Action button
    const actionDiv = document.createElement('div');
    actionDiv.className = 'shipyard-card-action';
    const btn = document.createElement('button');
    btn.className = 'shipyard-card-btn';

    if (mode === 'current') {
      btn.classList.add('current-ship');
      btn.textContent = 'Current Ship';
      btn.disabled = true;
    } else if (mode === 'swap') {
      btn.classList.add('swap');
      btn.textContent = 'Swap (Free)';
      btn.onclick = () => {
        switchShip(type);
        renderShipyardCards(structure);
        const creditsEl = document.getElementById('shipyard-credits');
        if (creditsEl) creditsEl.textContent = `${player.credits} credits`;
      };
    } else {
      btn.classList.add('buy');
      btn.textContent = `Buy â€” ${stats.price} cr`;
      if (player.credits < stats.price) btn.disabled = true;
      btn.onclick = () => {
        switchShip(type);
        renderShipyardCards(structure);
        const creditsEl = document.getElementById('shipyard-credits');
        if (creditsEl) creditsEl.textContent = `${player.credits} credits`;
      };
    }
    actionDiv.appendChild(btn);
    body.appendChild(actionDiv);

    card.appendChild(body);
    return card;
  }

  // For-sale section (unowned ships available here)
  const forSale = available.filter(t => !ownedShips.has(t));
  if (forSale.length > 0) {
    forSaleSection.style.display = '';
    forSale.forEach(type => {
      const card = makeCard(type, 'buy');
      if (card) forSaleContainer.appendChild(card);
    });
  } else {
    forSaleSection.style.display = 'none';
  }

  // Owned ships section
  const ownedArr = [...ownedShips];
  if (ownedArr.length > 0) {
    ownedSection.style.display = '';
    ownedArr.forEach(type => {
      const mode = type === currentShipType ? 'current' : 'swap';
      const card = makeCard(type, mode);
      if (card) ownedContainer.appendChild(card);
    });
  } else {
    ownedSection.style.display = 'none';
  }
}

function closeShipyardMenu() {
  sfx.playMenuClose();
  cleanupShipyardPreviews();
  shipyardMenuOpen = false;
  activeShipyardStructure = null;
  gamePaused = warpMenuOpen || shopMenuOpen || craftingMenuOpen || shipyardMenuOpen || refineryMenuOpen;
  const overlay = document.getElementById('shipyard-menu-overlay');
  if (overlay) overlay.style.display = 'none';
}

const shipyardCloseBtn = document.getElementById('shipyard-close-btn');
if (shipyardCloseBtn) {
  shipyardCloseBtn.addEventListener('click', () => {
    sfx.unlock();
    closeShipyardMenu();
  });
}

// Extended inventory hover listeners
const hudOverlayEl = document.getElementById('hud-overlay');
if (hudOverlayEl) {
  hudOverlayEl.addEventListener('mouseenter', () => { _extInvHovered = true; updateExtInvVisibility(); });
  hudOverlayEl.addEventListener('mouseleave', () => { _extInvHovered = false; updateExtInvVisibility(); });
}

function showShopTooltip(itemKey, price, isBuy, slotEl) {
  const tooltip = document.getElementById('shop-item-tooltip');
  if (!tooltip || !itemKey) return;
  const name = ITEM_DISPLAY_NAMES[itemKey] || itemKey;
  const usage = ITEM_USAGE[itemKey] || '';
  const priceText = isBuy ? `Buy: ${price} cr` : `Sell: ${price} cr`;
  tooltip.innerHTML = `<div class="tooltip-name">${name}</div><div class="tooltip-price">${priceText}</div><div class="tooltip-usage">${usage}</div>`;
  tooltip.style.display = 'block';
  // Position above the slot
  const rect = slotEl.getBoundingClientRect();
  const overlay = document.getElementById('shop-menu-overlay');
  const overlayRect = overlay ? overlay.getBoundingClientRect() : { left: 0, top: 0 };
  const left = rect.left - overlayRect.left + rect.width / 2 - 110;
  const top = rect.top - overlayRect.top - tooltip.offsetHeight - 8;
  tooltip.style.left = Math.max(10, left) + 'px';
  tooltip.style.top = Math.max(10, top) + 'px';
}

function hideShopTooltip() {
  const tooltip = document.getElementById('shop-item-tooltip');
  if (tooltip) tooltip.style.display = 'none';
}

// Add hover listeners for shop slots
document.querySelectorAll('.shop-buy-slot').forEach(el => {
  el.addEventListener('mouseenter', () => {
    const idx = parseInt(el.dataset.buySlot, 10);
    const it = shopBuySlots[idx];
    if (it) {
      const price = getItemBuyPrice(it.item);
      showShopTooltip(it.item, price, true, el);
    }
  });
  el.addEventListener('mouseleave', hideShopTooltip);
});

document.querySelectorAll('.shop-sell-slot').forEach(el => {
  el.addEventListener('mouseenter', () => {
    const idx = parseInt(el.dataset.sellSlot, 10);
    const it = shopSellSlots[idx];
    if (it) {
      const price = getItemSellPrice(it);
      showShopTooltip(it.item, price, false, el);
    }
  });
  el.addEventListener('mouseleave', hideShopTooltip);
});

function showHotbarTooltip(it, slotEl) {
  const tooltip = document.getElementById('hotbar-item-tooltip');
  if (!tooltip || !it || !it.item) return;
  const name = ITEM_DISPLAY_NAMES[it.item] || it.item;
  const usage = ITEM_USAGE[it.item] || '';
  const sellPrice = getItemSellPrice(it);
  const priceHtml = sellPrice > 0 ? `<div class="tooltip-price">Sell: ${sellPrice} cr</div>` : '';
  tooltip.innerHTML = `<div class="tooltip-name">${name}</div>${priceHtml}<div class="tooltip-usage">${usage}</div>`;
  tooltip.style.display = 'block';
  const rect = slotEl.getBoundingClientRect();
  const overlay = document.getElementById('hud-overlay');
  const overlayRect = overlay ? overlay.getBoundingClientRect() : { left: 0, top: 0, width: 360 };
  const tooltipW = 220;
  const left = rect.left - overlayRect.left + rect.width / 2 - tooltipW / 2;
  const top = rect.top - overlayRect.top - tooltip.offsetHeight - 8;
  tooltip.style.left = Math.max(8, Math.min(left, (overlayRect.width || 360) - tooltipW - 8)) + 'px';
  tooltip.style.top = top + 'px';
}

function hideHotbarTooltip() {
  const tooltip = document.getElementById('hotbar-item-tooltip');
  if (tooltip) tooltip.style.display = 'none';
}

document.querySelectorAll('#hotbar .slot, #extended-inventory .slot').forEach(el => {
  el.addEventListener('mouseenter', () => {
    const slotIndex = parseInt(el.dataset.slot, 10);
    const it = hotbar[slotIndex];
    if (it) showHotbarTooltip(it, el);
  });
  el.addEventListener('mouseleave', hideHotbarTooltip);
});

// Inventory drag state (unified for HUD and Shop)
let inventoryDrag = null; // { kind: 'hotbar'|'buy'|'sell', fromSlot?: number, fromBuySlot?: number, fromSellSlot?: number, price?: number }

function setDragGhostVisible(visible) {
  const ghost = document.getElementById('shop-drag-ghost');
  if (!ghost) return;
  ghost.style.display = visible ? 'flex' : 'none';
}

function setDragGhostContent(it, label, qtyText) {
  const ghost = document.getElementById('shop-drag-ghost');
  if (!ghost) return;
  const imgPath = it ? getItemImagePath(it.item) : null;
  if (imgPath) {
    if (qtyText) {
      ghost.innerHTML = `<img src="${imgPath}" alt=""><span class="slot-qty">${qtyText}</span>`;
    } else {
      ghost.innerHTML = `<img src="${imgPath}" alt="">`;
    }
  } else {
    if (qtyText) {
      ghost.innerHTML = `${label}<span class="slot-qty">${qtyText}</span>`;
    } else {
      ghost.textContent = label;
    }
  }
}

function setDragGhostPos(clientX, clientY) {
  const ghost = document.getElementById('shop-drag-ghost');
  if (!ghost) return;
  ghost.style.left = (clientX - 22) + 'px';
  ghost.style.top = (clientY - 22) + 'px';
}

function beginDragFromHotbar(slotIndex, clientX, clientY) {
  const it = hotbar[slotIndex];
  if (!it) return;
  hideShopTooltip();
  inventoryDrag = { kind: 'hotbar', fromSlot: slotIndex };
  const qty = it.quantity != null ? String(it.quantity) : (it.energy != null ? String(Math.round(it.energy)) : (it.fuel != null ? String(Math.round(it.fuel)) : (it.oxygen != null ? String(Math.round(it.oxygen)) : (it.heat != null ? String(Math.round(it.heat * 100)) : ''))));
  setDragGhostContent(it, getItemLabel(it), qty);
  setDragGhostPos(clientX, clientY);
  setDragGhostVisible(true);
}

function beginDragFromBuy(buyIndex, clientX, clientY) {
  const it = shopBuySlots[buyIndex];
  if (!it) return;
  hideShopTooltip();
  const price = getItemBuyPrice(it.item);
  inventoryDrag = { kind: 'buy', fromBuySlot: buyIndex, price };
  const qty = it.quantity != null ? String(it.quantity) : (it.energy != null ? String(Math.round(it.energy)) : (it.fuel != null ? String(Math.round(it.fuel)) : (it.oxygen != null ? String(Math.round(it.oxygen)) : (it.heat != null ? String(Math.round(it.heat * 100)) : ''))));
  setDragGhostContent(it, getItemLabel(it), qty);
  setDragGhostPos(clientX, clientY);
  setDragGhostVisible(true);
}

function beginDragFromSell(sellIndex, clientX, clientY) {
  const it = shopSellSlots[sellIndex];
  if (!it) return;
  hideShopTooltip();
  inventoryDrag = { kind: 'sell', fromSellSlot: sellIndex };
  const qty = it.quantity != null ? String(it.quantity) : (it.energy != null ? String(Math.round(it.energy)) : (it.fuel != null ? String(Math.round(it.fuel)) : (it.oxygen != null ? String(Math.round(it.oxygen)) : (it.heat != null ? String(Math.round(it.heat * 100)) : ''))));
  setDragGhostContent(it, getItemLabel(it), qty);
  setDragGhostPos(clientX, clientY);
  setDragGhostVisible(true);
}

function clearResourceBarHighlights() {
  const fuelBarEl = document.getElementById('fuel-bar-drop-zone');
  if (fuelBarEl) fuelBarEl.classList.remove('highlight');
  const oxygenBarEl = document.getElementById('oxygen-bar-drop-zone');
  if (oxygenBarEl) oxygenBarEl.classList.remove('highlight');
  const healthBarEl = document.getElementById('health-bar-drop-zone');
  if (healthBarEl) healthBarEl.classList.remove('highlight');
}

function resolveDropTarget(clientX, clientY) {
  const under = document.elementFromPoint(clientX, clientY);
  const targetSlotEl = under
    ? (under.closest('.slot') ||
      under.closest('.shop-buy-slot') ||
      under.closest('.shop-sell-slot') ||
      under.closest('.crafting-slot') ||
      under.closest('.refinery-input-slot'))
    : null;
  return {
    targetSlotEl,
    isOverFuelBar: !!(under && under.closest('#fuel-bar-drop-zone')),
    isOverO2Bar: !!(under && under.closest('#oxygen-bar-drop-zone')),
    isOverHealthBar: !!(under && under.closest('#health-bar-drop-zone'))
  };
}

function tryHandleResourceBarDrop(drag, dropTarget) {
  const barChecks = [
    { isOver: dropTarget.isOverO2Bar, barType: 'oxygen' },
    { isOver: dropTarget.isOverFuelBar, barType: 'fuel' },
    { isOver: dropTarget.isOverHealthBar, barType: 'health' }
  ];

  for (const { isOver, barType } of barChecks) {
    if (!isOver) continue;
    const cfg = RESOURCE_BAR_CONFIG[barType];

    if (drag.kind === 'hotbar') {
      const it = hotbar[drag.fromSlot];
      if (it && cfg.items.includes(it.item)) {
        const addAmount = it[cfg.prop] !== undefined ? it[cfg.prop] : 10;
        player[cfg.playerProp] = Math.min(player[cfg.maxProp], player[cfg.playerProp] + addAmount);
        hotbar[drag.fromSlot] = null;
        sfx.playUseResource(barType);
        updateHUD();
        return true;
      }
    }

    if (drag.kind === 'buy') {
      const it = shopBuySlots[drag.fromBuySlot];
      if (it && cfg.items.includes(it.item)) {
        const price = drag.price;
        if (player.credits >= price) {
          player.credits -= price;
          const addAmount = it[cfg.prop] !== undefined ? it[cfg.prop] : 10;
          player[cfg.playerProp] = Math.min(player[cfg.maxProp], player[cfg.playerProp] + addAmount);
          sfx.playBuy();
          sfx.playUseResource(barType);
          removeFromShopInventory(it.item);
          shopBuySlots[drag.fromBuySlot] = null;
          syncShopBuyArea();
          updateHUD();
          const creditsEl = document.getElementById('shop-credits-display');
          if (creditsEl) creditsEl.textContent = `You have ${player.credits} credits`;
        }
        return true;
      }
    }
  }

  return false;
}

function tryHandleJettisonDrop(drag, targetSlotEl) {
  if (targetSlotEl || shopMenuOpen || craftingMenuOpen || shipyardMenuOpen || refineryMenuOpen || drag.kind !== 'hotbar') {
    return false;
  }

  const from = drag.fromSlot;
  const it = hotbar[from];
  if (it) {
    const dx = input.mouseX - WIDTH / 2;
    const dy = input.mouseY - HEIGHT / 2;
    const dir = normalize(dx, dy);
    if (dir.x !== 0 || dir.y !== 0) {
      const jettSpeed = 340;
      const totalQty = it.quantity || 1;
      const baseAngle = Math.atan2(dir.y, dir.x);

      for (let i = 0; i < totalQty; i++) {
        const spread = (Math.random() - 0.5) * 0.5;
        const angle = baseAngle + spread;
        const speedVar = 0.8 + Math.random() * 0.4;
        const jVx = Math.cos(angle) * jettSpeed * speedVar;
        const jVy = Math.sin(angle) * jettSpeed * speedVar;

        const floatItem = {
          x: ship.x + Math.cos(angle) * 20,
          y: ship.y + Math.sin(angle) * 20,
          vx: jVx + ship.vx * 0.3,
          vy: jVy + ship.vy * 0.3,
          item: it.item,
          quantity: 1
        };
        if (it.energy != null) {
          floatItem.energy = it.energy;
          floatItem.maxEnergy = it.maxEnergy;
        }
        if (it.fuel != null) {
          floatItem.fuel = it.fuel;
          floatItem.maxFuel = it.maxFuel;
        }
        if (it.oxygen != null) {
          floatItem.oxygen = it.oxygen;
          floatItem.maxOxygen = it.maxOxygen;
        }
        if (it.health != null) {
          floatItem.health = it.health;
          floatItem.maxHealth = it.maxHealth ?? it.health;
        }
        if (it.heat != null) {
          floatItem.heat = it.heat;
          floatItem.overheated = !!it.overheated;
        }
        floatingItems.push(floatItem);
      }
      hotbar[from] = null;
      sfx.playJettison();
      updateHUD();
    }
  }

  return true;
}

function getDropSlotKinds(targetSlotEl) {
  return {
    isHotbar: targetSlotEl.classList.contains('slot'),
    isSell: targetSlotEl.classList.contains('shop-sell-slot'),
    isCraftInput: targetSlotEl.classList.contains('input-slot') && !targetSlotEl.classList.contains('refinery-input-slot'),
    isRefineryInput: targetSlotEl.classList.contains('refinery-input-slot')
  };
}

function tryHandleHotbarDrag(drag, targetSlotEl, slotKinds) {
  const from = drag.fromSlot;
  const it = hotbar[from];
  if (!it) return false;

  if (slotKinds.isSell && shopMenuOpen) {
    const sellIndex = parseInt(targetSlotEl.dataset.sellSlot, 10);
    if (sellIndex >= 0 && !shopSellSlots[sellIndex]) {
      shopSellSlots[sellIndex] = { ...it };
      hotbar[from] = null;
      updateHUD();
      syncShopSellArea();
      return true;
    }
  } else if (slotKinds.isCraftInput && craftingMenuOpen) {
    const idx = parseInt(targetSlotEl.dataset.craftInput, 10);
    if (idx >= 0 && !craftingInputSlots[idx]) {
      craftingInputSlots[idx] = { ...it };
      hotbar[from] = null;
      updateHUD();
      syncCraftingUI();
      return true;
    }
  } else if (slotKinds.isRefineryInput && refineryMenuOpen) {
    const idx = parseInt(targetSlotEl.dataset.refineryInput, 10);
    if (idx >= 0 && !refineryInputSlots[idx]) {
      const accepted = activeRefineryStructure && activeRefineryStructure.acceptedOres || [];
      if (accepted.includes(it.item)) {
        refineryInputSlots[idx] = { ...it };
        hotbar[from] = null;
        updateHUD();
        syncRefineryUI();
        return true;
      }
    }
  } else if (slotKinds.isHotbar) {
    const to = parseInt(targetSlotEl.dataset.slot, 10);
    if (to >= 0 && to !== from) {
      const tmp = hotbar[to];
      hotbar[to] = hotbar[from];
      hotbar[from] = tmp;
      updateHUD();
      return true;
    }
  }

  return false;
}

function tryHandleBuyDrag(drag, targetSlotEl, slotKinds) {
  if (!slotKinds.isHotbar) return false;
  const from = drag.fromBuySlot;
  const it = shopBuySlots[from];
  if (!it) return false;
  const to = parseInt(targetSlotEl.dataset.slot, 10);
  if (to < 0 || hotbar[to] || player.credits < drag.price) return false;

  player.credits -= drag.price;
  sfx.playBuy();
  hotbar[to] = { ...it };
  removeFromShopInventory(it.item);
  shopBuySlots[from] = null;
  syncShopBuyArea();
  updateHUD();
  return true;
}

function tryHandleSellDrag(drag, targetSlotEl, slotKinds) {
  const from = drag.fromSellSlot;
  const it = shopSellSlots[from];
  if (!it) return false;

  if (slotKinds.isHotbar) {
    const to = parseInt(targetSlotEl.dataset.slot, 10);
    if (to >= 0 && !hotbar[to]) {
      hotbar[to] = { ...it };
      shopSellSlots[from] = null;
      updateHUD();
      syncShopSellArea();
      return true;
    }
  } else if (slotKinds.isSell) {
    const toSell = parseInt(targetSlotEl.dataset.sellSlot, 10);
    if (toSell >= 0 && toSell !== from) {
      const tmp = shopSellSlots[toSell];
      shopSellSlots[toSell] = shopSellSlots[from];
      shopSellSlots[from] = tmp;
      syncShopSellArea();
      return true;
    }
  }

  return false;
}

function tryHandleCraftInputDrag(drag, targetSlotEl, slotKinds) {
  const from = drag.fromCraftInput;
  const it = craftingInputSlots[from];
  if (!it) return false;

  if (slotKinds.isHotbar) {
    const to = parseInt(targetSlotEl.dataset.slot, 10);
    if (to >= 0 && !hotbar[to]) {
      hotbar[to] = { ...it };
      craftingInputSlots[from] = null;
      updateHUD();
      syncCraftingUI();
      return true;
    }
  } else if (slotKinds.isCraftInput) {
    const to = parseInt(targetSlotEl.dataset.craftInput, 10);
    if (to >= 0 && to !== from) {
      const tmp = craftingInputSlots[to];
      craftingInputSlots[to] = craftingInputSlots[from];
      craftingInputSlots[from] = tmp;
      syncCraftingUI();
      return true;
    }
  }

  return false;
}

function tryHandleCraftOutputDrag(targetSlotEl, slotKinds) {
  const it = craftingOutputSlot;
  if (!it || !it.real || !slotKinds.isHotbar) return false;

  const to = parseInt(targetSlotEl.dataset.slot, 10);
  if (to >= 0 && !hotbar[to]) {
    hotbar[to] = { ...it };
    craftingOutputSlot = null;
    updateHUD();
    syncCraftingUI();
    return true;
  }

  return false;
}

function tryHandleRefineryInputDrag(drag, targetSlotEl, slotKinds) {
  const from = drag.fromRefineryInput;
  const it = refineryInputSlots[from];
  if (!it) return false;

  if (slotKinds.isHotbar) {
    const to = parseInt(targetSlotEl.dataset.slot, 10);
    if (to >= 0 && !hotbar[to]) {
      hotbar[to] = { ...it };
      refineryInputSlots[from] = null;
      updateHUD();
      syncRefineryUI();
      return true;
    }
  } else if (slotKinds.isRefineryInput) {
    const to = parseInt(targetSlotEl.dataset.refineryInput, 10);
    if (to >= 0 && to !== from) {
      const tmp = refineryInputSlots[to];
      refineryInputSlots[to] = refineryInputSlots[from];
      refineryInputSlots[from] = tmp;
      syncRefineryUI();
      return true;
    }
  }

  return false;
}

function tryHandleRefineryOutputDrag(targetSlotEl, slotKinds) {
  const it = refineryOutputSlot;
  if (!it || !it.real || !slotKinds.isHotbar) return false;

  const to = parseInt(targetSlotEl.dataset.slot, 10);
  if (to >= 0 && !hotbar[to]) {
    hotbar[to] = { ...it };
    refineryOutputSlot = null;
    updateHUD();
    syncRefineryUI();
    return true;
  }

  return false;
}

function endDrag(clientX, clientY) {
  const drag = inventoryDrag;
  inventoryDrag = null;
  setDragGhostVisible(false);
  clearResourceBarHighlights();
  if (!drag) return;

  const dropTarget = resolveDropTarget(clientX, clientY);
  if (tryHandleResourceBarDrop(drag, dropTarget)) return;
  if (tryHandleJettisonDrop(drag, dropTarget.targetSlotEl)) return;
  if (!dropTarget.targetSlotEl) return;

  const slotKinds = getDropSlotKinds(dropTarget.targetSlotEl);
  if (drag.kind === 'hotbar') {
    tryHandleHotbarDrag(drag, dropTarget.targetSlotEl, slotKinds);
  } else if (drag.kind === 'buy') {
    tryHandleBuyDrag(drag, dropTarget.targetSlotEl, slotKinds);
  } else if (drag.kind === 'sell') {
    tryHandleSellDrag(drag, dropTarget.targetSlotEl, slotKinds);
  } else if (drag.kind === 'craftInput') {
    tryHandleCraftInputDrag(drag, dropTarget.targetSlotEl, slotKinds);
  } else if (drag.kind === 'craftOutput') {
    tryHandleCraftOutputDrag(dropTarget.targetSlotEl, slotKinds);
  } else if (drag.kind === 'refineryInput') {
    tryHandleRefineryInputDrag(drag, dropTarget.targetSlotEl, slotKinds);
  } else if (drag.kind === 'refineryOutput') {
    tryHandleRefineryOutputDrag(dropTarget.targetSlotEl, slotKinds);
  }
}

// UI Drag Start Listener
window.addEventListener('mousedown', (e) => {
  if (e.button !== 0) return;
  const t = e.target;
  
  const hotbarSlotEl = t.closest && (t.closest('#hotbar .slot') || t.closest('#extended-inventory .slot'));
  const buySlotEl = t.closest && t.closest('.shop-buy-slot');
  const sellSlotEl = t.closest && t.closest('.shop-sell-slot');
  const craftInputEl = t.closest && t.closest('.crafting-slot.input-slot:not(.refinery-input-slot)');
  const craftOutputEl = t.closest && t.closest('#crafting-work-area .crafting-slot.output-slot');
  const refineryInputEl = t.closest && t.closest('.refinery-input-slot');
  const refineryOutputEl = t.closest && t.closest('#refinery-output-area .crafting-slot.output-slot');
  
  if (hotbarSlotEl) {
    const slotIndex = parseInt(hotbarSlotEl.dataset.slot, 10);
    if (slotIndex >= 0 && hotbar[slotIndex]) {
      e.preventDefault();
      // Shift+click (with shop open): transfer item to first empty sell slot
      if (e.shiftKey && shopMenuOpen) {
        const it = hotbar[slotIndex];
        const firstEmpty = shopSellSlots.findIndex(s => !s);
        if (firstEmpty >= 0) {
          shopSellSlots[firstEmpty] = { ...it };
          hotbar[slotIndex] = null;
          syncShopSellArea();
          updateHUD();
        }
        return;
      }
      // Shift+click (with crafting open): transfer to first empty input slot
      if (e.shiftKey && craftingMenuOpen) {
        const it = hotbar[slotIndex];
        const firstEmpty = craftingInputSlots.findIndex(s => !s);
        if (firstEmpty >= 0) {
          craftingInputSlots[firstEmpty] = { ...it };
          hotbar[slotIndex] = null;
          syncCraftingUI();
          updateHUD();
        }
        return;
      }
      // Shift+click (with refinery open): transfer accepted ore to first empty input slot
      if (e.shiftKey && refineryMenuOpen) {
        const it = hotbar[slotIndex];
        const accepted = activeRefineryStructure && activeRefineryStructure.acceptedOres || [];
        if (accepted.includes(it.item)) {
          const firstEmpty = refineryInputSlots.findIndex(s => !s);
          if (firstEmpty >= 0) {
            refineryInputSlots[firstEmpty] = { ...it };
            hotbar[slotIndex] = null;
            syncRefineryUI();
            updateHUD();
          }
        }
        return;
      }
      beginDragFromHotbar(slotIndex, e.clientX, e.clientY);
    }
    return;
  }
  
  if (shopMenuOpen) {
    if (buySlotEl) {
      const buyIndex = parseInt(buySlotEl.dataset.buySlot, 10);
      if (buyIndex >= 0 && shopBuySlots[buyIndex]) {
        e.preventDefault();
        beginDragFromBuy(buyIndex, e.clientX, e.clientY);
      }
      return;
    }
    if (sellSlotEl) {
      const sellIndex = parseInt(sellSlotEl.dataset.sellSlot, 10);
      if (sellIndex >= 0 && shopSellSlots[sellIndex]) {
        e.preventDefault();
        beginDragFromSell(sellIndex, e.clientX, e.clientY);
      }
      return;
    }
  }

  if (craftingMenuOpen) {
    if (craftInputEl) {
      const idx = parseInt(craftInputEl.dataset.craftInput, 10);
      if (idx >= 0 && craftingInputSlots[idx]) {
        e.preventDefault();
        // Shift+click: return to inventory
        if (e.shiftKey) {
            if (inventory.add(craftingInputSlots[idx].item, craftingInputSlots[idx].quantity)) {
                craftingInputSlots[idx] = null;
                syncCraftingUI();
                updateHUD();
            }
            return;
        }
        // Drag
        hideShopTooltip();
        const it = craftingInputSlots[idx];
        inventoryDrag = { kind: 'craftInput', fromCraftInput: idx };
        const qty = it.quantity != null ? String(it.quantity) : '';
        setDragGhostContent(it, getItemLabel(it), qty);
        setDragGhostPos(e.clientX, e.clientY);
        setDragGhostVisible(true);
      }
      return;
    }
    if (craftOutputEl) {
      if (craftingOutputSlot && craftingOutputSlot.real) {
        e.preventDefault();
        if (e.shiftKey) {
            if (inventory.add(craftingOutputSlot.item, craftingOutputSlot.quantity)) {
                craftingOutputSlot = null;
                syncCraftingUI();
                updateHUD();
            }
            return;
        }
        // Drag
        hideShopTooltip();
        const it = craftingOutputSlot;
        inventoryDrag = { kind: 'craftOutput' };
        const qty = it.quantity != null ? String(it.quantity) : '';
        setDragGhostContent(it, getItemLabel(it), qty);
        setDragGhostPos(e.clientX, e.clientY);
        setDragGhostVisible(true);
      }
      return;
    }
  }

  if (refineryMenuOpen) {
    if (refineryInputEl) {
      const idx = parseInt(refineryInputEl.dataset.refineryInput, 10);
      if (idx >= 0 && refineryInputSlots[idx]) {
        e.preventDefault();
        // Shift+click: return to inventory
        if (e.shiftKey) {
          if (inventory.add(refineryInputSlots[idx].item, refineryInputSlots[idx].quantity)) {
            refineryInputSlots[idx] = null;
            syncRefineryUI();
            updateHUD();
          }
          return;
        }
        // Drag
        hideShopTooltip();
        const it = refineryInputSlots[idx];
        inventoryDrag = { kind: 'refineryInput', fromRefineryInput: idx };
        const qty = it.quantity != null ? String(it.quantity) : '';
        setDragGhostContent(it, getItemLabel(it), qty);
        setDragGhostPos(e.clientX, e.clientY);
        setDragGhostVisible(true);
      }
      return;
    }
    if (refineryOutputEl) {
      if (refineryOutputSlot && refineryOutputSlot.real) {
        e.preventDefault();
        if (e.shiftKey) {
          if (inventory.add(refineryOutputSlot.item, refineryOutputSlot.quantity)) {
            refineryOutputSlot = null;
            syncRefineryUI();
            updateHUD();
          }
          return;
        }
        // Drag
        hideShopTooltip();
        const it = refineryOutputSlot;
        inventoryDrag = { kind: 'refineryOutput' };
        const qty = it.quantity != null ? String(it.quantity) : '';
        setDragGhostContent(it, getItemLabel(it), qty);
        setDragGhostPos(e.clientX, e.clientY);
        setDragGhostVisible(true);
      }
      return;
    }
  }
});

window.addEventListener('mousemove', (e) => {
  if (inventoryDrag) {
    setDragGhostPos(e.clientX, e.clientY);
    const fuelBarEl = document.getElementById('fuel-bar-drop-zone');
    const oxygenBarEl = document.getElementById('oxygen-bar-drop-zone');
    const healthBarEl = document.getElementById('health-bar-drop-zone');
    const under = document.elementFromPoint(e.clientX, e.clientY);
    
    let it = null;
    if (inventoryDrag.kind === 'hotbar') {
      it = hotbar[inventoryDrag.fromSlot];
    } else if (inventoryDrag.kind === 'buy') {
      it = shopBuySlots[inventoryDrag.fromBuySlot];
    } else if (inventoryDrag.kind === 'craftInput') {
      it = craftingInputSlots[inventoryDrag.fromCraftInput];
    } else if (inventoryDrag.kind === 'craftOutput') {
      it = craftingOutputSlot;
    } else if (inventoryDrag.kind === 'refineryInput') {
      it = refineryInputSlots[inventoryDrag.fromRefineryInput];
    } else if (inventoryDrag.kind === 'refineryOutput') {
      it = refineryOutputSlot;
    }
    
    const isOverFuel = under && under.closest('#fuel-bar-drop-zone');
    const isOverO2 = under && under.closest('#oxygen-bar-drop-zone');
    const isOverHealth = under && under.closest('#health-bar-drop-zone');
    
    // Highlight fuel bar
    const showFuelHighlight = it && (it.item === 'fuel tank' || it.item === 'medium fuel tank' || it.item === 'large fuel tank') && isOverFuel;
    if (fuelBarEl) fuelBarEl.classList.toggle('highlight', showFuelHighlight);
    
    // Highlight O2 bar
    const showO2Highlight = it && (it.item === 'oxygen canister' || it.item === 'medium oxygen canister' || it.item === 'large oxygen canister') && isOverO2;
    if (oxygenBarEl) oxygenBarEl.classList.toggle('highlight', showO2Highlight);

    // Highlight Health bar
    const showHealthHighlight = it && (it.item === 'health pack' || it.item === 'medium health pack' || it.item === 'large health pack') && isOverHealth;
    if (healthBarEl) healthBarEl.classList.toggle('highlight', showHealthHighlight);
  }
});

window.addEventListener('mouseup', (e) => {
  if (e.button !== 0) return;
  if (inventoryDrag) {
    endDrag(e.clientX, e.clientY);
  }
});

// Game loop
let lastTime = performance.now();
initStars();
initShopBuySlots();
initShip3D();

// Initial level load is handled at startup (level1.json)

function gameLoop(now) {
  const dt = Math.min((now - lastTime) / 1000, 0.1);
  lastTime = now;

  if (!gamePaused) update(dt);
  render(gamePaused ? 0 : dt);
  _flushHUD(); // Only re-renders DOM when hudDirty is true

  requestAnimationFrame(gameLoop);
}
requestAnimationFrame(gameLoop);

```

## js\editor.js
```
import {
  PIRATE_TYPE_KEYS,
  DEFAULT_PIRATE_TYPE_PERCENTAGES,
  PIRATE_ARCHETYPE_KEYS,
  normalizePirateBaseTier,
  getPirateBaseTierScale,
  normalizePirateArchetype,
  normalizePirateTypePercentages,
  ensureSpawnSettingsDefaults,
  ensurePirateBaseSpawnDefaults
} from './pirateShared.js';

const canvas = document.getElementById('editor-canvas');
const ctx = canvas.getContext('2d');

// --- Constants ---
const CONSTANTS = {
  STORAGE_KEY: 'spacejam-level-editor',
  GRID_SIZE: 500,
  STRUCTURE_SIZE: 80,
  GAME_VIEW_WIDTH: 1200,
  GAME_VIEW_HEIGHT: 900,
  ZOOM_MIN: 0.02,
  ZOOM_MAX: 2,
  DEFAULT_LEVEL_SIZE: 5000,
  DEFAULT_SEED: 12345,
  ASTEROID_SIZE_MIN: 10,
  ASTEROID_SIZE_MAX: 300,
  ASTEROID_SIZE_STEP: 10
};

// --- Editor tool tuning ---
// Eraser is a screen-space brush (same pixel size at any zoom)
const ERASER_RADIUS_PX = 14;
const ERASE_SAVE_INTERVAL_MS = 200;

const COLORS = {
  BACKGROUND: '#0a0a12',
  GRID: '#222',
  LEVEL_BOUNDS: '#335',
  ORIGIN: '#444',
  VIEWPORT_BOX: 'rgba(100, 150, 255, 0.8)',
  TEXT: '#666',
  TEXT_WHITE: '#fff'
};

const ASTEROID_COLORS = {
  cuprite: { fill: '#665544', stroke: '#998877' },
  hematite: { fill: '#8B4513', stroke: '#A0522D' },
  aurite: { fill: '#B8860B', stroke: '#FFD700' },
  diamite: { fill: '#787878', stroke: '#909090' },
  platinite: { fill: '#D3D3D3', stroke: '#E5E4E2' }
};

const STRUCTURE_STYLES = {
  shop: { fill: '#446688', stroke: '#6699bb' },
  shipyard: { fill: '#664466', stroke: '#886688' },
  refinery: { fill: '#666644', stroke: '#888866' },
  fueling: { fill: '#446644', stroke: '#668866' },
  crafting: { fill: '#886644', stroke: '#aa8866' },
  warpgate: { fill: '#6644aa', stroke: '#8866cc' },
  piratebase: { fill: '#884422', stroke: '#aa6644' }
};

// Interact radius matches game: STRUCTURE_SIZE_COLL (54) + SHOP_DASHED_EXTRA_3D (108) = 162
const INTERACT_RADIUS = 162;
const INTERACTABLE_TYPES = new Set(['shop', 'warpgate', 'crafting', 'refinery', 'shipyard']);
// Pirate base aggro radius matches game constants.js
const PIRATE_BASE_AGGRO_RADIUS = 300;
const PIRATE_TYPE_LABELS = { normal: 'Normal', sturdy: 'Sturdy', fast: 'Fast' };
const PIRATE_ARCHETYPE_LABELS = {
  standard: 'Standard',
  shotgun: 'Shotgun',
  slowing: 'Slowing',
  breaching: 'Breaching',
  drone: 'Drone'
};
const PIRATE_ARCHETYPE_OUTLINE_COLORS = Object.freeze({
  standard: '#aa6644',
  shotgun: '#d18a4f',
  slowing: '#b48cff',
  breaching: '#ff6b5d',
  drone: '#7db8ff'
});

function getStructureDrawScale(type, tier) {
  return type === 'piratebase' ? getPirateBaseTierScale(tier) : 1;
}

function getStructureStyle(type, pirateArchetype = 'standard') {
  const baseStyle = STRUCTURE_STYLES[type] || STRUCTURE_STYLES.shop;
  if (type !== 'piratebase') return baseStyle;
  const resolvedArchetype = normalizePirateArchetype(pirateArchetype);
  return {
    ...baseStyle,
    stroke: PIRATE_ARCHETYPE_OUTLINE_COLORS[resolvedArchetype] || baseStyle.stroke
  };
}

function renderPirateTypePercentagesEditor(parent, labelText, mixObj, onChange) {
  const wrap = document.createElement('div');
  wrap.className = 'prop-group';
  wrap.innerHTML = `<label>${labelText}</label>`;
  for (const type of PIRATE_TYPE_KEYS) {
    const row = document.createElement('div');
    row.className = 'prop-inline-row';
    const name = document.createElement('span');
    name.className = 'prop-inline-label';
    name.textContent = PIRATE_TYPE_LABELS[type];
    const input = document.createElement('input');
    input.type = 'number';
    input.min = '0';
    input.max = '100';
    input.step = '1';
    input.value = mixObj[type];
    input.oninput = (e) => {
      mixObj[type] = Math.max(0, Number(e.target.value) || 0);
      onChange();
    };
    row.appendChild(name);
    row.appendChild(input);
    wrap.appendChild(row);
  }
  const note = document.createElement('div');
  note.className = 'prop-note';
  note.textContent = 'Percentages are weighted and auto-normalized in-game.';
  wrap.appendChild(note);
  parent.appendChild(wrap);
}

function normalizeStructure(st) {
  const out = { ...st };
  if (out.type === 'piratebase') {
    out.tier = normalizePirateBaseTier(out.tier);
    ensurePirateBaseSpawnDefaults(out);
  }
  return out;
}

// --- State ---
const state = {
  level: {
    width: CONSTANTS.DEFAULT_LEVEL_SIZE,
    height: CONSTANTS.DEFAULT_LEVEL_SIZE,
    seed: CONSTANTS.DEFAULT_SEED,
    asteroids: [],
    structures: []
  },
  camera: {
    x: 0,
    y: 0,
    zoom: 0.15
  },
  mouse: {
    x: 0,
    y: 0,
    inCanvas: false,
    isPanning: false,
    isErasing: false,
    isMoving: false,
    moveStartWorld: { x: 0, y: 0 },
    moveOriginalX: 0,
    moveOriginalY: 0,
    eraseNeedsSave: false,
    eraseLastSaveAt: 0,
    panStart: { x: 0, y: 0 },
    panCamStart: { x: 0, y: 0 }
  },
  tool: {
    selected: 'select',
    asteroidSize: 40,
    piratebaseTier: 2
  },
  selectedObject: null,
  clipboard: null, // { asteroids: [...], structures: [...] } with positions relative to center
  copySelectMode: false, // true when waiting for user to drag a selection rectangle
  copySelect: null, // { startX, startY } in world coords while dragging selection rect
  copySelectScreen: null, // { sx, sy } screen start for the drag
  pasteMode: false // true when in paste-preview mode
};

// --- Core Functions ---

function saveLevel() {
  const levelData = {
    width: state.level.width,
    height: state.level.height,
    seed: state.level.seed,
    asteroids: state.level.asteroids,
    structures: state.level.structures,
    spawnSettings: state.level.spawnSettings
  };
  localStorage.setItem(CONSTANTS.STORAGE_KEY, JSON.stringify(levelData));
}

function loadLevel() {
  try {
    const stored = localStorage.getItem(CONSTANTS.STORAGE_KEY);
    if (!stored) return;
    const levelData = JSON.parse(stored);
    state.level.width = levelData.width || CONSTANTS.DEFAULT_LEVEL_SIZE;
    state.level.height = levelData.height || CONSTANTS.DEFAULT_LEVEL_SIZE;
    state.level.seed = levelData.seed != null ? (levelData.seed >>> 0) : CONSTANTS.DEFAULT_SEED;
    state.level.asteroids = levelData.asteroids || [];
    state.level.structures = (levelData.structures || []).map(normalizeStructure);
    state.level.spawnSettings = ensureSpawnSettingsDefaults(levelData.spawnSettings || {
      initialDelay: 120,
      waveIntervalMin: 60,
      waveIntervalMax: 100,
      waveSizeMin: 2,
      waveSizeMax: 4,
      pirateTypePercentages: { ...DEFAULT_PIRATE_TYPE_PERCENTAGES },
      tiers: []
    });
    
    // Update UI inputs
    document.getElementById('level-width').value = state.level.width;
    document.getElementById('level-height').value = state.level.height;
  } catch (e) { /* ignore invalid stored data */ }
}

function resizeCanvas() {
  const container = document.getElementById('editor-container');
  const w = container.clientWidth || window.innerWidth - 240;
  const h = container.clientHeight || window.innerHeight;
  if (w > 0 && h > 0) {
    canvas.width = w;
    canvas.height = h;
  }
  render();
}

function screenToWorld(sx, sy) {
  return {
    x: (sx - canvas.width / 2) / state.camera.zoom + state.camera.x,
    y: (sy - canvas.height / 2) / state.camera.zoom + state.camera.y
  };
}

function worldToScreen(wx, wy) {
  return {
    x: (wx - state.camera.x) * state.camera.zoom + canvas.width / 2,
    y: (wy - state.camera.y) * state.camera.zoom + canvas.height / 2
  };
}

// --- Drawing Helpers ---

function drawAsteroid(ctx, x, y, radius, type, isPreview = false) {
  const s = worldToScreen(x, y);
  const r = radius * state.camera.zoom;
  const colors = ASTEROID_COLORS[type] || ASTEROID_COLORS.cuprite;
  
  ctx.fillStyle = isPreview ? colors.fill + '80' : colors.fill;
  ctx.strokeStyle = isPreview ? '#aaa' : colors.stroke;
  ctx.lineWidth = isPreview ? 1 : 2;
  
  ctx.beginPath();
  ctx.arc(s.x, s.y, r, 0, Math.PI * 2);
  ctx.fill();
  ctx.stroke();
}

function drawStructure(ctx, x, y, type, isPreview = false, tier = 2, pirateArchetype = 'standard') {
  const s = worldToScreen(x, y);
  const scale = getStructureDrawScale(type, tier);
  const r = CONSTANTS.STRUCTURE_SIZE * scale * state.camera.zoom;
  const style = getStructureStyle(type, pirateArchetype);

  // Draw interact/aggro radius rings (bright dashed)
  // - interactables: bright using structure stroke color
  // - piratebase: red aggro ring
  {
    const z = state.camera.zoom;
    const dashA = Math.max(2, 7 * z);
    const dashB = Math.max(2, 5 * z);

    if (INTERACTABLE_TYPES.has(type)) {
      const ir = INTERACT_RADIUS * z;
      ctx.strokeStyle = style.stroke;
      ctx.lineWidth = 2;
      ctx.globalAlpha = isPreview ? 0.65 : 0.95;
      ctx.setLineDash([dashA, dashB]);
      ctx.beginPath();
      ctx.arc(s.x, s.y, ir, 0, Math.PI * 2);
      ctx.stroke();
      ctx.setLineDash([]);
      ctx.globalAlpha = 1;
    }

    if (type === 'piratebase') {
      const ar = PIRATE_BASE_AGGRO_RADIUS * getPirateBaseTierScale(tier) * z;
      ctx.strokeStyle = normalizePirateBaseTier(tier) === 5 ? '#bb2222' : '#ff3333';
      ctx.lineWidth = 2;
      ctx.globalAlpha = isPreview ? 0.6 : 0.95;
      ctx.setLineDash([dashA, dashB]);
      ctx.beginPath();
      ctx.arc(s.x, s.y, ar, 0, Math.PI * 2);
      ctx.stroke();
      ctx.setLineDash([]);
      ctx.globalAlpha = 1;
    }
  }
  
  ctx.fillStyle = isPreview ? style.fill + '99' : style.fill;
  ctx.strokeStyle = style.stroke;
  ctx.lineWidth = isPreview ? 1 : 2;
  
  ctx.beginPath();
  ctx.rect(s.x - r, s.y - r * 0.6, r * 2, r * 1.2);
  ctx.fill();
  ctx.stroke();
  
  ctx.fillStyle = COLORS.TEXT_WHITE;
  ctx.font = `${Math.max(8, r * 0.4)}px Arial`;
  ctx.textAlign = 'center';
  ctx.textBaseline = 'middle';
  
  let label = type.charAt(0).toUpperCase();
  if (type === 'warpgate') label = 'W';
  if (type === 'piratebase') label = `P${normalizePirateBaseTier(tier)}`;
  
  ctx.fillText(label, s.x, s.y);
}

function drawGrid(ctx) {
  ctx.strokeStyle = COLORS.GRID;
  ctx.lineWidth = 1;
  
  const startX = Math.floor(-state.level.width / 2 / CONSTANTS.GRID_SIZE) * CONSTANTS.GRID_SIZE;
  const startY = Math.floor(-state.level.height / 2 / CONSTANTS.GRID_SIZE) * CONSTANTS.GRID_SIZE;
  
  // Vertical lines
  for (let gx = startX; gx <= state.level.width / 2; gx += CONSTANTS.GRID_SIZE) {
    const s1 = worldToScreen(gx, -state.level.height / 2);
    const s2 = worldToScreen(gx, state.level.height / 2);
    ctx.beginPath();
    ctx.moveTo(s1.x, s1.y);
    ctx.lineTo(s2.x, s2.y);
    ctx.stroke();
  }
  
  // Horizontal lines
  for (let gy = startY; gy <= state.level.height / 2; gy += CONSTANTS.GRID_SIZE) {
    const s1 = worldToScreen(-state.level.width / 2, gy);
    const s2 = worldToScreen(state.level.width / 2, gy);
    ctx.beginPath();
    ctx.moveTo(s1.x, s1.y);
    ctx.lineTo(s2.x, s2.y);
    ctx.stroke();
  }
}

// --- Render Loop ---

function drawBackground() {
  ctx.fillStyle = COLORS.BACKGROUND;
  ctx.fillRect(0, 0, canvas.width, canvas.height);
  
  // Draw level bounds
  const topLeft = worldToScreen(-state.level.width / 2, -state.level.height / 2);
  const bottomRight = worldToScreen(state.level.width / 2, state.level.height / 2);
  ctx.strokeStyle = COLORS.LEVEL_BOUNDS;
  ctx.lineWidth = 2;
  ctx.strokeRect(topLeft.x, topLeft.y, bottomRight.x - topLeft.x, bottomRight.y - topLeft.y);
}

function drawOrigin() {
  const origin = worldToScreen(0, 0);
  ctx.strokeStyle = COLORS.ORIGIN;
  ctx.beginPath();
  ctx.moveTo(origin.x - 15, origin.y);
  ctx.lineTo(origin.x + 15, origin.y);
  ctx.moveTo(origin.x, origin.y - 15);
  ctx.lineTo(origin.x, origin.y + 15);
  ctx.stroke();
}

function drawWorldObjects() {
  // Draw asteroids
  for (const ast of state.level.asteroids) {
    drawAsteroid(ctx, ast.x, ast.y, ast.radius, ast.oreType || 'cuprite');
  }
  
  // Draw structures
  for (const st of state.level.structures) {
    drawStructure(ctx, st.x, st.y, st.type, false, st.tier, st.pirateArchetype);
  }
}

function drawOverlay() {
  if (!state.mouse.inCanvas) return;
  
  // Draw viewport scale box
  const boxW = CONSTANTS.GAME_VIEW_WIDTH * state.camera.zoom;
  const boxH = CONSTANTS.GAME_VIEW_HEIGHT * state.camera.zoom;
  
  ctx.strokeStyle = COLORS.VIEWPORT_BOX;
  ctx.lineWidth = 2;
  ctx.setLineDash([4, 4]);
  ctx.strokeRect(state.mouse.x - boxW / 2, state.mouse.y - boxH / 2, boxW, boxH);
  ctx.setLineDash([]);
  
  // Draw tool preview
  const world = screenToWorld(state.mouse.x, state.mouse.y);
  
  if (state.tool.selected === 'eraser') {
    // Draw eraser cursor (circle with X)
    const r = ERASER_RADIUS_PX;
    ctx.strokeStyle = '#ff4444';
    ctx.lineWidth = 2;
    ctx.beginPath();
    ctx.arc(state.mouse.x, state.mouse.y, r, 0, Math.PI * 2);
    ctx.stroke();
    ctx.beginPath();
    ctx.moveTo(state.mouse.x - r * 0.5, state.mouse.y - r * 0.5);
    ctx.lineTo(state.mouse.x + r * 0.5, state.mouse.y + r * 0.5);
    ctx.moveTo(state.mouse.x + r * 0.5, state.mouse.y - r * 0.5);
    ctx.lineTo(state.mouse.x - r * 0.5, state.mouse.y + r * 0.5);
    ctx.stroke();
  } else if (state.tool.selected.startsWith('asteroid_')) {
    const type = state.tool.selected.replace('asteroid_', '');
    drawAsteroid(ctx, world.x, world.y, state.tool.asteroidSize, type, true);
  } else if (STRUCTURE_STYLES[state.tool.selected]) {
    drawStructure(ctx, world.x, world.y, state.tool.selected, true, state.tool.piratebaseTier, 'standard');
  }

  // Draw selection highlight
  if (state.selectedObject) {
    const sel = state.selectedObject;
    const s = worldToScreen(sel.x, sel.y);
    let r = 20;
    if (sel.radius) r = sel.radius * state.camera.zoom + 10;
    else r = (CONSTANTS.STRUCTURE_SIZE * getStructureDrawScale(sel.type, sel.tier) * state.camera.zoom) + 10;
    
    ctx.strokeStyle = '#fff';
    ctx.lineWidth = 2;
    ctx.setLineDash([5, 5]);
    ctx.beginPath();
    ctx.arc(s.x, s.y, r, 0, Math.PI * 2);
    ctx.stroke();
    ctx.setLineDash([]);
  }

  // Draw copy-selection rectangle while dragging
  if (state.copySelectScreen) {
    const sx = state.copySelectScreen.sx;
    const sy = state.copySelectScreen.sy;
    const ex = state.mouse.x;
    const ey = state.mouse.y;
    const rx = Math.min(sx, ex);
    const ry = Math.min(sy, ey);
    const rw = Math.abs(ex - sx);
    const rh = Math.abs(ey - sy);
    ctx.strokeStyle = '#44aaff';
    ctx.lineWidth = 2;
    ctx.setLineDash([6, 4]);
    ctx.strokeRect(rx, ry, rw, rh);
    ctx.fillStyle = 'rgba(68, 170, 255, 0.1)';
    ctx.fillRect(rx, ry, rw, rh);
    ctx.setLineDash([]);

    // Draw "Select area to copy" label
    ctx.fillStyle = '#44aaff';
    ctx.font = '12px Arial';
    ctx.fillText('Drag to select area', rx, ry - 6);
  }

  // Draw paste preview (ghost outlines at cursor)
  if (state.pasteMode && state.clipboard) {
    const cx = world.x;
    const cy = world.y;
    ctx.globalAlpha = 0.5;
    for (const a of state.clipboard.asteroids) {
      const type = a.oreType || 'cuprite';
      drawAsteroid(ctx, cx + a.rx, cy + a.ry, a.radius, type, true);
    }
    for (const s of state.clipboard.structures) {
      drawStructure(ctx, cx + s.rx, cy + s.ry, s.type, true, s.tier, s.pirateArchetype);
    }
    ctx.globalAlpha = 1.0;

    // Label
    const screenPos = worldToScreen(cx, cy);
    ctx.fillStyle = '#88ff88';
    ctx.font = '12px Arial';
    ctx.fillText('Click to paste (' + (state.clipboard.asteroids.length + state.clipboard.structures.length) + ' objects) â€” Esc to cancel', screenPos.x - 80, screenPos.y - 20);
  }
}

function drawUI() {
  ctx.fillStyle = COLORS.TEXT;
  ctx.font = '12px Arial';
  const infoText = `Asteroids: ${state.level.asteroids.length} | Structures: ${state.level.structures.length} | Zoom: ${(state.camera.zoom * 100).toFixed(0)}%`;
  ctx.fillText(infoText, 10, 20);

  // Mode indicator
  if (state.copySelectMode && !state.copySelectScreen) {
    ctx.fillStyle = '#44aaff';
    ctx.font = '14px Arial';
    ctx.fillText('COPY: Drag a rectangle to select objects (Esc to cancel)', 10, 40);
  } else if (state.pasteMode) {
    ctx.fillStyle = '#88ff88';
    ctx.font = '14px Arial';
    ctx.fillText('PASTE: Click to place copied objects (Esc to cancel)', 10, 40);
  }
}

function render() {
  drawBackground();
  drawGrid(ctx);
  drawOrigin();
  drawWorldObjects();
  drawOverlay();
  drawUI();
}

// --- Event Handlers ---

function handleMouseMove(e) {
  const rect = canvas.getBoundingClientRect();
  state.mouse.x = e.clientX - rect.left;
  state.mouse.y = e.clientY - rect.top;

  if (state.mouse.isPanning) {
    state.camera.x = state.mouse.panCamStart.x - (state.mouse.x - state.mouse.panStart.x) / state.camera.zoom;
    state.camera.y = state.mouse.panCamStart.y - (state.mouse.y - state.mouse.panStart.y) / state.camera.zoom;
  }

  // Move tool: drag selected object
  if (state.mouse.isMoving && state.selectedObject) {
    const world = screenToWorld(state.mouse.x, state.mouse.y);
    const dx = world.x - state.mouse.moveStartWorld.x;
    const dy = world.y - state.mouse.moveStartWorld.y;
    state.selectedObject.x = state.mouse.moveOriginalX + dx;
    state.selectedObject.y = state.mouse.moveOriginalY + dy;
  }

  // Eraser brush: continuously erase while held
  if (state.mouse.isErasing && state.tool.selected === 'eraser') {
    const world = screenToWorld(state.mouse.x, state.mouse.y);
    eraseBrushAt(world);
  }

  render();
}

function flushEraseSave(force = false) {
  if (!state.mouse.eraseNeedsSave) return;
  const now = performance.now();
  if (!force && now - state.mouse.eraseLastSaveAt < ERASE_SAVE_INTERVAL_MS) return;
  saveLevel();
  state.mouse.eraseNeedsSave = false;
  state.mouse.eraseLastSaveAt = now;
}

function eraseBrushAt(world) {
  const radiusWorld = ERASER_RADIUS_PX / state.camera.zoom;
  let removedAny = false;
  let removedSelected = false;

  // Asteroids: erase if brush intersects asteroid circle
  for (let i = state.level.asteroids.length - 1; i >= 0; i--) {
    const a = state.level.asteroids[i];
    const dx = a.x - world.x;
    const dy = a.y - world.y;
    if (Math.sqrt(dx * dx + dy * dy) <= a.radius + radiusWorld) {
      if (state.selectedObject === a) removedSelected = true;
      state.level.asteroids.splice(i, 1);
      removedAny = true;
    }
  }

  // Structures: erase if brush intersects structure rect
  const hw = CONSTANTS.STRUCTURE_SIZE;
  const hh = CONSTANTS.STRUCTURE_SIZE * 0.6;
  for (let i = state.level.structures.length - 1; i >= 0; i--) {
    const st = state.level.structures[i];
    const dx = Math.abs(st.x - world.x) - hw;
    const dy = Math.abs(st.y - world.y) - hh;
    const ax = Math.max(dx, 0);
    const ay = Math.max(dy, 0);
    if (Math.sqrt(ax * ax + ay * ay) <= radiusWorld) {
      if (state.selectedObject === st) removedSelected = true;
      state.level.structures.splice(i, 1);
      removedAny = true;
    }
  }

  if (!removedAny) return false;

  if (removedSelected) {
    state.selectedObject = null;
    updatePropertiesPanel();
  }

  state.mouse.eraseNeedsSave = true;
  flushEraseSave(false);
  return true;
}

function handleSelectObject(world) {
  let bestDist = Infinity;
  let bestObj = null;

  // Check structures first (priority)
  for (const st of state.level.structures) {
    const scale = getStructureDrawScale(st.type, st.tier);
    const structHalfW = CONSTANTS.STRUCTURE_SIZE * scale;
    const structHalfH = CONSTANTS.STRUCTURE_SIZE * 0.6 * scale;
    const dx = st.x - world.x;
    const dy = st.y - world.y;
    if (Math.abs(dx) < structHalfW && Math.abs(dy) < structHalfH) {
      const d = Math.sqrt(dx*dx + dy*dy);
      if (d < bestDist) {
        bestDist = d;
        bestObj = st;
      }
    }
  }

  // Check asteroids
  if (!bestObj) {
    for (const ast of state.level.asteroids) {
      const dx = ast.x - world.x;
      const dy = ast.y - world.y;
      const d = Math.sqrt(dx*dx + dy*dy);
      if (d < ast.radius) {
        if (d < bestDist) {
          bestDist = d;
          bestObj = ast;
        }
      }
    }
  }

  state.selectedObject = bestObj;
  updatePropertiesPanel();
  render();
}

function updatePropertiesPanel() {
  const panel = document.getElementById('properties-panel');
  const content = document.getElementById('properties-content');
  
  if (!state.selectedObject) {
    panel.style.display = 'none';
    return;
  }

  panel.style.display = 'flex';
  content.innerHTML = '';
  const obj = state.selectedObject;

  // Common properties
  addPropInput(content, 'X', obj.x, (v) => { obj.x = parseInt(v); render(); saveLevel(); });
  addPropInput(content, 'Y', obj.y, (v) => { obj.y = parseInt(v); render(); saveLevel(); });

  if (obj.radius) { // Asteroid
    addPropInput(content, 'Radius', obj.radius, (v) => { obj.radius = parseInt(v); render(); saveLevel(); });
    // Ore Type
    const oreDiv = document.createElement('div');
    oreDiv.className = 'prop-group';
    oreDiv.innerHTML = `<label>Ore Type</label>`;
    const select = document.createElement('select');
    ['cuprite', 'hematite', 'aurite', 'diamite', 'platinite'].forEach(type => {
      const opt = document.createElement('option');
      opt.value = type;
      opt.textContent = type;
      opt.selected = obj.oreType === type;
      select.appendChild(opt);
    });
    select.onchange = (e) => { obj.oreType = e.target.value; render(); saveLevel(); };
    oreDiv.appendChild(select);
    content.appendChild(oreDiv);
  } else { // Structure
    const typeDiv = document.createElement('div');
    typeDiv.className = 'prop-group';
    typeDiv.innerHTML = `<label>Type: ${obj.type}</label>`;
    content.appendChild(typeDiv);

    if (obj.type === 'shop') {
      renderShopProperties(content, obj);
    } else if (obj.type === 'crafting') {
      renderCraftingProperties(content, obj);
    } else if (obj.type === 'shipyard') {
      renderShipyardProperties(content, obj);
    } else if (obj.type === 'piratebase') {
      renderPirateBaseProperties(content, obj);
    } else if (obj.type === 'warpgate') {
      renderWarpGateProperties(content, obj);
    } else if (obj.type === 'refinery') {
      renderRefineryProperties(content, obj);
    }
  }
}

function addPropInput(parent, label, value, onChange) {
  const div = document.createElement('div');
  div.className = 'prop-group';
  div.innerHTML = `<label>${label}</label>`;
  const input = document.createElement('input');
  input.type = 'number';
  input.value = value;
  input.oninput = (e) => onChange(e.target.value);
  div.appendChild(input);
  parent.appendChild(div);
}

function buildShopInventoryItem(itemName) {
  const item = { item: itemName, quantity: 1 };
  if (itemName === 'small energy cell') { item.energy = 10; item.maxEnergy = 10; }
  else if (itemName === 'medium energy cell') { item.energy = 30; item.maxEnergy = 30; }
  else if (itemName === 'large energy cell') { item.energy = 60; item.maxEnergy = 60; }
  else if (itemName === 'fuel tank') { item.fuel = 10; item.maxFuel = 10; }
  else if (itemName === 'medium fuel tank') { item.fuel = 30; item.maxFuel = 30; }
  else if (itemName === 'large fuel tank') { item.fuel = 60; item.maxFuel = 60; }
  else if (itemName === 'oxygen canister') { item.oxygen = 10; item.maxOxygen = 10; }
  else if (itemName === 'medium oxygen canister') { item.oxygen = 30; item.maxOxygen = 30; }
  else if (itemName === 'large oxygen canister') { item.oxygen = 60; item.maxOxygen = 60; }
  else if (itemName === 'health pack') { item.health = 10; }
  else if (itemName === 'medium health pack') { item.health = 30; }
  else if (itemName === 'large health pack') { item.health = 60; }
  else if (itemName.includes('laser') || itemName.includes('blaster')) { item.heat = 0; item.overheated = false; }
  return item;
}

function renderShopProperties(parent, obj) {
  if (!obj.inventory) obj.inventory = [];
  if (!obj.prices) obj.prices = {};

  // Inventory
  const invDiv = document.createElement('div');
  invDiv.className = 'prop-group';
  invDiv.innerHTML = `<label>Inventory</label>`;
  const invList = document.createElement('div');
  invList.className = 'prop-list';
  
  let draggedIdx = null;
  
  const renderInvList = () => {
    invList.innerHTML = '';
    obj.inventory.forEach((item, idx) => {
      const itemRow = document.createElement('div');
      itemRow.className = 'prop-list-item';
      itemRow.draggable = true;
      itemRow.dataset.idx = idx;
      
      // Drag handle
      const dragHandle = document.createElement('span');
      dragHandle.className = 'drag-handle';
      dragHandle.textContent = 'â‰¡';
      
      const itemLabel = document.createElement('span');
      itemLabel.className = 'item-label';
      itemLabel.textContent = item.item;
      
      const qtyInput = document.createElement('input');
      qtyInput.type = 'number';
      qtyInput.min = '1';
      qtyInput.placeholder = 'Qty';
      qtyInput.value = item.quantity || 1;
      qtyInput.onchange = (e) => {
        item.quantity = Math.max(1, parseInt(e.target.value) || 1);
        saveLevel();
      };
      
      const delBtn = document.createElement('button');
      delBtn.textContent = 'Ã—';
      delBtn.onclick = () => {
        obj.inventory.splice(idx, 1);
        renderInvList();
        saveLevel();
      };
      
      // Drag events
      itemRow.ondragstart = (e) => {
        draggedIdx = idx;
        itemRow.style.opacity = '0.5';
        e.dataTransfer.effectAllowed = 'move';
      };
      itemRow.ondragend = () => {
        itemRow.style.opacity = '1';
        draggedIdx = null;
        // Remove all drag-over styling
        invList.querySelectorAll('.prop-list-item').forEach(el => el.style.borderTop = '');
      };
      itemRow.ondragover = (e) => {
        e.preventDefault();
        e.dataTransfer.dropEffect = 'move';
        const targetIdx = parseInt(itemRow.dataset.idx);
        if (draggedIdx !== null && targetIdx !== draggedIdx) {
          itemRow.style.borderTop = '2px solid #6699bb';
        }
      };
      itemRow.ondragleave = () => {
        itemRow.style.borderTop = '';
      };
      itemRow.ondrop = (e) => {
        e.preventDefault();
        const targetIdx = parseInt(itemRow.dataset.idx);
        if (draggedIdx !== null && targetIdx !== draggedIdx) {
          // Reorder array
          const [moved] = obj.inventory.splice(draggedIdx, 1);
          obj.inventory.splice(targetIdx, 0, moved);
          saveLevel();
          renderInvList();
        }
      };
      
      itemRow.appendChild(dragHandle);
      itemRow.appendChild(itemLabel);
      itemRow.appendChild(qtyInput);
      itemRow.appendChild(delBtn);
      invList.appendChild(itemRow);
    });
  };
  renderInvList();
  
  // Add item
  const addItemDiv = document.createElement('div');
  addItemDiv.className = 'prop-row-tight';
  const itemSelect = document.createElement('select');
  ALL_ITEM_NAMES.forEach(i => {
    const opt = document.createElement('option');
    opt.value = i;
    opt.textContent = i;
    itemSelect.appendChild(opt);
  });
  const addBtn = document.createElement('button');
  addBtn.className = 'add-btn';
  addBtn.textContent = 'Add Item';
  addBtn.onclick = () => {
    obj.inventory.push(buildShopInventoryItem(itemSelect.value));
    renderInvList();
    saveLevel();
  };
  
  addItemDiv.appendChild(itemSelect);
  addItemDiv.appendChild(addBtn);
  
  invDiv.appendChild(invList);
  invDiv.appendChild(addItemDiv);
  parent.appendChild(invDiv);

  // Prices override
  const priceDiv = document.createElement('div');
  priceDiv.className = 'prop-group';
  priceDiv.innerHTML = `<label>Price Overrides</label>`;
  const priceList = document.createElement('div');
  priceList.className = 'prop-list';
  
  const renderPriceList = () => {
    priceList.innerHTML = '';
    Object.keys(obj.prices).forEach(key => {
      const row = document.createElement('div');
      row.className = 'prop-list-item';
      row.innerHTML = `<span style="font-size:10px;flex:1;">${key}</span>`;
      const input = document.createElement('input');
      input.type = 'number';
      input.value = obj.prices[key];
      input.onchange = (e) => { obj.prices[key] = parseInt(e.target.value); saveLevel(); };
      const del = document.createElement('button');
      del.textContent = 'Ã—';
      del.onclick = () => { delete obj.prices[key]; renderPriceList(); saveLevel(); };
      row.appendChild(input);
      row.appendChild(del);
      priceList.appendChild(row);
    });
  };
  renderPriceList();

  const addPriceDiv = document.createElement('div');
  addPriceDiv.className = 'prop-row-tight';
  const priceSelect = document.createElement('select');
  // Add common items to price override list
  ALL_ITEM_NAMES.forEach(i => {
    const opt = document.createElement('option');
    opt.value = i;
    opt.textContent = i;
    priceSelect.appendChild(opt);
  });
  const addPriceBtn = document.createElement('button');
  addPriceBtn.className = 'add-btn';
  addPriceBtn.textContent = 'Add Price';
  addPriceBtn.onclick = () => {
    obj.prices[priceSelect.value] = 100;
    renderPriceList();
    saveLevel();
  };
  addPriceDiv.appendChild(priceSelect);
  addPriceDiv.appendChild(addPriceBtn);

  priceDiv.appendChild(priceList);
  priceDiv.appendChild(addPriceDiv);
  parent.appendChild(priceDiv);
}

// Master list of all items available for crafting recipe dropdowns
const ALL_ITEM_NAMES = [
  'mining laser', 'medium mining laser', 'large mining laser',
  'light blaster', 'medium blaster', 'large blaster',
  'small energy cell', 'medium energy cell', 'large energy cell',
  'oxygen canister', 'medium oxygen canister', 'large oxygen canister',
  'fuel tank', 'medium fuel tank', 'large fuel tank',
  'health pack', 'medium health pack', 'large health pack',
  'cuprite', 'hematite', 'aurite', 'diamite', 'platinite',
  'copper', 'iron', 'gold', 'diamond', 'platinum',
  'scrap', 'warp key', 'warp key fragment'
];

function createItemSelect(selectedValue) {
  const sel = document.createElement('select');
  sel.className = 'recipe-item-select';
  ALL_ITEM_NAMES.forEach(name => {
    const opt = document.createElement('option');
    opt.value = name;
    opt.textContent = name;
    if (name === selectedValue) opt.selected = true;
    sel.appendChild(opt);
  });
  return sel;
}

function createCraftingRecipeCard(recipe, idx, rerender) {
  const row = document.createElement('div');
  row.className = 'prop-list-item recipe-card';

  const headerDiv = document.createElement('div');
  headerDiv.className = 'recipe-header-row';
  const headerLabel = document.createElement('span');
  headerLabel.className = 'recipe-header-label';
  headerLabel.textContent = `Recipe ${idx + 1}`;
  const delBtn = document.createElement('button');
  delBtn.textContent = 'Ã—';
  delBtn.className = 'recipe-delete-btn';
  delBtn.onclick = () => {
    // parent rerender owns source recipe array; card just signals intent
    rerender('deleteRecipe', idx);
  };
  headerDiv.appendChild(headerLabel);
  headerDiv.appendChild(delBtn);
  row.appendChild(headerDiv);

  const inputsLabel = document.createElement('span');
  inputsLabel.className = 'recipe-section-label';
  inputsLabel.textContent = 'Inputs:';
  row.appendChild(inputsLabel);

  recipe.inputs.forEach((inp, iIdx) => {
    const inputRow = document.createElement('div');
    inputRow.className = 'recipe-input-row';

    const itemSel = createItemSelect(inp.item);
    itemSel.onchange = () => { inp.item = itemSel.value; saveLevel(); };

    const qtyInput = document.createElement('input');
    qtyInput.type = 'number';
    qtyInput.min = '1';
    qtyInput.value = inp.quantity;
    qtyInput.className = 'recipe-qty-input';
    qtyInput.onchange = () => { inp.quantity = Math.max(1, parseInt(qtyInput.value) || 1); saveLevel(); };

    const removeBtn = document.createElement('button');
    removeBtn.textContent = 'Ã—';
    removeBtn.className = 'recipe-remove-input-btn';
    removeBtn.onclick = () => { recipe.inputs.splice(iIdx, 1); saveLevel(); rerender(); };

    inputRow.appendChild(itemSel);
    inputRow.appendChild(qtyInput);
    inputRow.appendChild(removeBtn);
    row.appendChild(inputRow);
  });

  const addInputBtn = document.createElement('button');
  addInputBtn.textContent = '+ Add Input';
  addInputBtn.className = 'add-btn recipe-add-input-btn';
  addInputBtn.onclick = () => { recipe.inputs.push({ item: 'scrap', quantity: 1 }); saveLevel(); rerender(); };
  row.appendChild(addInputBtn);

  const outputLabel = document.createElement('span');
  outputLabel.className = 'recipe-section-label';
  outputLabel.textContent = 'Output:';
  row.appendChild(outputLabel);

  const outputRow = document.createElement('div');
  outputRow.className = 'recipe-output-row';

  const outSel = createItemSelect(recipe.output.item);
  outSel.onchange = () => { recipe.output.item = outSel.value; saveLevel(); };

  const outQty = document.createElement('input');
  outQty.type = 'number';
  outQty.min = '1';
  outQty.value = recipe.output.quantity;
  outQty.className = 'recipe-qty-input';
  outQty.onchange = () => { recipe.output.quantity = Math.max(1, parseInt(outQty.value) || 1); saveLevel(); };

  outputRow.appendChild(outSel);
  outputRow.appendChild(outQty);
  row.appendChild(outputRow);

  return row;
}

function renderCraftingProperties(parent, obj) {
  if (!obj.recipes) obj.recipes = [];

  const recipesDiv = document.createElement('div');
  recipesDiv.className = 'prop-group';
  recipesDiv.innerHTML = `<label>Recipes</label>`;
  const recipesList = document.createElement('div');
  recipesList.className = 'prop-list recipe-list';
  
  const renderRecipes = () => {
    recipesList.innerHTML = '';
    obj.recipes.forEach((recipe, idx) => {
      const row = createCraftingRecipeCard(recipe, idx, (action, actionIdx) => {
        if (action === 'deleteRecipe') {
          obj.recipes.splice(actionIdx, 1);
          saveLevel();
          renderRecipes();
          return;
        }
        renderRecipes();
      });
      recipesList.appendChild(row);
    });
  };
  renderRecipes();

  const addRecipeBtn = document.createElement('button');
  addRecipeBtn.className = 'add-btn';
  addRecipeBtn.textContent = 'Add Recipe';
  addRecipeBtn.onclick = () => {
    obj.recipes.push({
      inputs: [{ item: 'scrap', quantity: 5 }],
      output: { item: 'fuel tank', quantity: 1 }
    });
    saveLevel();
    renderRecipes();
  };

  recipesDiv.appendChild(recipesList);
  recipesDiv.appendChild(addRecipeBtn);
  parent.appendChild(recipesDiv);
}

function renderShipyardProperties(parent, obj) {
  if (!obj.availableShips) obj.availableShips = ['scout']; // Default

  const shipsDiv = document.createElement('div');
  shipsDiv.className = 'prop-group';
  shipsDiv.innerHTML = `<label>Available Ships</label>`;
  
  const shipTypes = ['scout', 'cutter', 'transport'];
  
  shipTypes.forEach(type => {
    const row = document.createElement('div');
    row.className = 'prop-inline-row';
    
    const cb = document.createElement('input');
    cb.type = 'checkbox';
    cb.checked = obj.availableShips.includes(type);
    cb.onchange = (e) => {
      if (e.target.checked) {
        if (!obj.availableShips.includes(type)) obj.availableShips.push(type);
      } else {
        obj.availableShips = obj.availableShips.filter(s => s !== type);
      }
      saveLevel();
    };
    
    const label = document.createElement('span');
    label.className = 'prop-small-label';
    label.textContent = type.charAt(0).toUpperCase() + type.slice(1);
    
    row.appendChild(cb);
    row.appendChild(label);
    shipsDiv.appendChild(row);
  });
  
  parent.appendChild(shipsDiv);
}

function renderPirateBaseProperties(parent, obj) {
  obj.tier = normalizePirateBaseTier(obj.tier);
  ensurePirateBaseSpawnDefaults(obj);
  const tierDiv = document.createElement('div');
  tierDiv.className = 'prop-group';
  tierDiv.innerHTML = `<label>Tier</label>`;
  const tierSelect = document.createElement('select');
  for (let i = 1; i <= 5; i++) {
    const opt = document.createElement('option');
    opt.value = String(i);
    opt.textContent = `Tier ${i}`;
    opt.selected = obj.tier === i;
    tierSelect.appendChild(opt);
  }
  tierSelect.onchange = (e) => { obj.tier = normalizePirateBaseTier(e.target.value); saveLevel(); render(); };
  tierDiv.appendChild(tierSelect);
  parent.appendChild(tierDiv);

  const archetypeDiv = document.createElement('div');
  archetypeDiv.className = 'prop-group';
  archetypeDiv.innerHTML = '<label>Pirate Archetype</label>';
  const archetypeSelect = document.createElement('select');
  const selectedArchetype = normalizePirateArchetype(obj.pirateArchetype);
  for (const archetype of PIRATE_ARCHETYPE_KEYS) {
    const opt = document.createElement('option');
    opt.value = archetype;
    opt.textContent = PIRATE_ARCHETYPE_LABELS[archetype];
    opt.selected = archetype === selectedArchetype;
    archetypeSelect.appendChild(opt);
  }
  archetypeSelect.onchange = (e) => { obj.pirateArchetype = normalizePirateArchetype(e.target.value); saveLevel(); render(); };
  archetypeDiv.appendChild(archetypeSelect);
  parent.appendChild(archetypeDiv);

  addPropInput(parent, 'Health', obj.health || 150, (v) => { obj.health = parseInt(v); saveLevel(); });
  addPropInput(parent, 'Defense Count', obj.defenseCount || 8, (v) => { obj.defenseCount = parseInt(v); saveLevel(); });
  renderPirateTypePercentagesEditor(parent, 'Defense Type Percentages', obj.defenseTypePercentages, () => { saveLevel(); });
  addPropInput(parent, 'Spawn Rate (s)', obj.spawnRate || 30, (v) => { obj.spawnRate = parseInt(v); saveLevel(); });
  addPropInput(parent, 'Wave Spawn Count', obj.waveSpawnCount || 4, (v) => { obj.waveSpawnCount = Math.max(1, parseInt(v) || 1); saveLevel(); });
  renderPirateTypePercentagesEditor(parent, 'Wave Spawn Type Percentages', obj.waveSpawnTypePercentages, () => { saveLevel(); });
  
  // Drops
  if (!obj.drops) obj.drops = [];
  const dropsDiv = document.createElement('div');
  dropsDiv.className = 'prop-group';
  dropsDiv.innerHTML = `<label>Drops</label>`;
  const dropsList = document.createElement('div');
  dropsList.className = 'prop-list';
  
  const renderDrops = () => {
    dropsList.innerHTML = '';
    obj.drops.forEach((d, idx) => {
      const row = document.createElement('div');
      row.className = 'prop-list-item';
      row.innerHTML = `<span style="font-size:10px;flex:1;">${d.item}</span>`;
      const qInput = document.createElement('input');
      qInput.type = 'number';
      qInput.value = d.quantity || 1;
      qInput.onchange = (e) => { d.quantity = parseInt(e.target.value); saveLevel(); };
      const del = document.createElement('button');
      del.textContent = 'Ã—';
      del.onclick = () => { obj.drops.splice(idx, 1); renderDrops(); saveLevel(); };
      row.appendChild(qInput);
      row.appendChild(del);
      dropsList.appendChild(row);
    });
  };
  renderDrops();

  const addDropDiv = document.createElement('div');
  addDropDiv.className = 'prop-row-tight';
  const dropSelect = document.createElement('select');
  ALL_ITEM_NAMES.forEach(i => {
    const opt = document.createElement('option');
    opt.value = i;
    opt.textContent = i;
    dropSelect.appendChild(opt);
  });
  const addDropBtn = document.createElement('button');
  addDropBtn.className = 'add-btn';
  addDropBtn.textContent = 'Add Drop';
  addDropBtn.onclick = () => {
    obj.drops.push({ item: dropSelect.value, quantity: 1 });
    renderDrops();
    saveLevel();
  };
  addDropDiv.appendChild(dropSelect);
  addDropDiv.appendChild(addDropBtn);

  dropsDiv.appendChild(dropsList);
  dropsDiv.appendChild(addDropDiv);
  parent.appendChild(dropsDiv);
}

function renderWarpGateProperties(parent, obj) {
  addPropInput(parent, 'Warp Cost', obj.warpCost || 3000, (v) => { obj.warpCost = parseInt(v); saveLevel(); });
  
  const destDiv = document.createElement('div');
  destDiv.className = 'prop-group';
  destDiv.innerHTML = `<label>Destination Level</label>`;
  const destInput = document.createElement('input');
  destInput.type = 'text'; // or number
  destInput.value = obj.warpDestination || 'level2';
  destInput.onchange = (e) => { obj.warpDestination = e.target.value; saveLevel(); };
  destDiv.appendChild(destInput);
  parent.appendChild(destDiv);
}

const RAW_ORE_TYPES = ['cuprite', 'hematite', 'aurite', 'diamite', 'platinite'];
const REFINED_ORE_NAMES = { cuprite: 'Copper', hematite: 'Iron', aurite: 'Gold', diamite: 'Diamond', platinite: 'Platinum' };

function renderRefineryProperties(parent, obj) {
  if (!obj.acceptedOres) obj.acceptedOres = ['cuprite'];

  const oreDiv = document.createElement('div');
  oreDiv.className = 'prop-group';
  oreDiv.innerHTML = `<label>Accepted Ores (raw -> refined at 2:1)</label>`;

  RAW_ORE_TYPES.forEach(ore => {
    const row = document.createElement('div');
    row.className = 'prop-inline-row';

    const cb = document.createElement('input');
    cb.type = 'checkbox';
    cb.checked = obj.acceptedOres.includes(ore);
    cb.onchange = () => {
      if (cb.checked) {
        if (!obj.acceptedOres.includes(ore)) obj.acceptedOres.push(ore);
      } else {
        obj.acceptedOres = obj.acceptedOres.filter(o => o !== ore);
      }
      saveLevel();
    };

    const label = document.createElement('span');
    label.className = 'prop-small-label';
    label.textContent = `${ore.charAt(0).toUpperCase() + ore.slice(1)} â†’ ${REFINED_ORE_NAMES[ore]}`;

    row.appendChild(cb);
    row.appendChild(label);
    oreDiv.appendChild(row);
  });

  parent.appendChild(oreDiv);
}

function handlePlaceObject(world) {
  if (state.tool.selected.startsWith('asteroid_')) {
    const oreType = state.tool.selected.replace('asteroid_', '');
    state.level.asteroids.push({ 
      x: world.x, 
      y: world.y, 
      radius: state.tool.asteroidSize, 
      oreType 
    });
  } else if (STRUCTURE_STYLES[state.tool.selected]) {
    // Initialize per-structure defaults so export/import round-trips reliably,
    // especially for multiple warp gates (each gate needs its own destination/cost).
    const type = state.tool.selected;
    const st = { x: world.x, y: world.y, type };
    if (type === 'warpgate') {
      st.warpCost = 3000;
      st.warpDestination = 'level2';
    }
    if (type === 'crafting') {
      st.recipes = [];
    }
    if (type === 'shipyard') {
      st.availableShips = ['scout', 'cutter', 'transport'];
    }
    if (type === 'refinery') {
      st.acceptedOres = ['cuprite'];
    }
    if (type === 'piratebase') {
      st.tier = normalizePirateBaseTier(state.tool.piratebaseTier);
      st.pirateArchetype = 'standard';
      ensurePirateBaseSpawnDefaults(st);
    }
    state.level.structures.push(st);
  }
  saveLevel();
}

function handleRemoveObject(world) {
  // Check asteroids
  for (let i = state.level.asteroids.length - 1; i >= 0; i--) {
    const a = state.level.asteroids[i];
    const dx = a.x - world.x;
    const dy = a.y - world.y;
    if (Math.sqrt(dx * dx + dy * dy) < a.radius) {
      state.level.asteroids.splice(i, 1);
      saveLevel();
      return;
    }
  }
  
  // Check structures
  for (let i = state.level.structures.length - 1; i >= 0; i--) {
    const st = state.level.structures[i];
    const scale = getStructureDrawScale(st.type, st.tier);
    const structHalfW = CONSTANTS.STRUCTURE_SIZE * scale;
    const structHalfH = CONSTANTS.STRUCTURE_SIZE * 0.6 * scale;
    const dx = st.x - world.x;
    const dy = st.y - world.y;
    if (Math.abs(dx) < structHalfW && Math.abs(dy) < structHalfH) {
      state.level.structures.splice(i, 1);
      saveLevel();
      return;
    }
  }
}

function stampClipboardAt(world) {
  if (!state.clipboard) return;
  for (const a of state.clipboard.asteroids) {
    const clone = JSON.parse(JSON.stringify(a));
    clone.x = world.x + a.rx;
    clone.y = world.y + a.ry;
    delete clone.rx;
    delete clone.ry;
    state.level.asteroids.push(clone);
  }
  for (const s of state.clipboard.structures) {
    const clone = JSON.parse(JSON.stringify(s));
    clone.x = world.x + s.rx;
    clone.y = world.y + s.ry;
    delete clone.rx;
    delete clone.ry;
    state.level.structures.push(clone);
  }
  saveLevel();
}

function startCopySelection(world) {
  state.copySelect = { startX: world.x, startY: world.y };
  state.copySelectScreen = { sx: state.mouse.x, sy: state.mouse.y };
}

function handleEditorToolLeftClick(world) {
  if (state.tool.selected === 'select') {
    handleSelectObject(world);
  } else if (state.tool.selected === 'move') {
    handleSelectObject(world);
    if (state.selectedObject) {
      state.mouse.isMoving = true;
      state.mouse.moveStartWorld = { x: world.x, y: world.y };
      state.mouse.moveOriginalX = state.selectedObject.x;
      state.mouse.moveOriginalY = state.selectedObject.y;
    }
  } else if (state.tool.selected === 'eraser') {
    state.mouse.isErasing = true;
    eraseBrushAt(world);
  } else {
    handlePlaceObject(world);
  }
}

function cancelCopyPasteModes() {
  if (!state.copySelectMode && !state.pasteMode) return false;
  state.copySelectMode = false;
  state.copySelect = null;
  state.copySelectScreen = null;
  state.pasteMode = false;
  return true;
}

function handleMouseDown(e) {
  e.preventDefault();
  canvas.focus();
  
  const rect = canvas.getBoundingClientRect();
  state.mouse.x = e.clientX - rect.left;
  state.mouse.y = e.clientY - rect.top;
  
  if (e.button === 0) { // Left click
    const world = screenToWorld(state.mouse.x, state.mouse.y);

    // If in paste mode, stamp down the clipboard contents
    if (state.pasteMode && state.clipboard) {
      stampClipboardAt(world);
      state.pasteMode = false;
      render();
      return;
    }

    // If in copy-select mode, start the drag rectangle
    if (state.copySelectMode) {
      startCopySelection(world);
      render();
      return;
    }

    handleEditorToolLeftClick(world);
    render();
  } else if (e.button === 2) { // Right click
    if (cancelCopyPasteModes()) {
      render();
      return;
    }
    const world = screenToWorld(state.mouse.x, state.mouse.y);
    handleRemoveObject(world);
    render();
  } else if (e.button === 1) { // Middle click
    state.mouse.isPanning = true;
    state.mouse.panStart.x = state.mouse.x;
    state.mouse.panStart.y = state.mouse.y;
    state.mouse.panCamStart.x = state.camera.x;
    state.mouse.panCamStart.y = state.camera.y;
  }
}

function handleWheel(e) {
  e.preventDefault();
  const zoomFactor = e.deltaY > 0 ? 0.9 : 1.1;
  state.camera.zoom = Math.max(CONSTANTS.ZOOM_MIN, Math.min(CONSTANTS.ZOOM_MAX, state.camera.zoom * zoomFactor));
  render();
}

function updateAsteroidSize(newSize) {
  state.tool.asteroidSize = Math.max(CONSTANTS.ASTEROID_SIZE_MIN, Math.min(CONSTANTS.ASTEROID_SIZE_MAX, newSize));
  document.getElementById('asteroid-size').value = state.tool.asteroidSize;
  document.getElementById('size-display').textContent = state.tool.asteroidSize;
  render();
}

// --- Initialization ---

// Canvas events
canvas.addEventListener('mousemove', handleMouseMove);
canvas.addEventListener('mousedown', handleMouseDown);
canvas.addEventListener('mouseup', (e) => {
  if (e.button === 1) state.mouse.isPanning = false;
  if (e.button === 0) {
    if (state.mouse.isMoving) {
      state.mouse.isMoving = false;
      saveLevel();
      updatePropertiesPanel();
    }
    if (state.mouse.isErasing) {
      state.mouse.isErasing = false;
      flushEraseSave(true);
    }
  }
  if (e.button === 0 && state.copySelect && state.copySelectMode) {
    // Finalize copy selection rectangle
    const world = screenToWorld(state.mouse.x, state.mouse.y);
    const x1 = Math.min(state.copySelect.startX, world.x);
    const y1 = Math.min(state.copySelect.startY, world.y);
    const x2 = Math.max(state.copySelect.startX, world.x);
    const y2 = Math.max(state.copySelect.startY, world.y);

    // Don't capture if rect is too tiny (accidental click)
    if (Math.abs(x2 - x1) < 5 && Math.abs(y2 - y1) < 5) {
      state.copySelect = null;
      state.copySelectScreen = null;
      render();
      return;
    }

    const centerX = (x1 + x2) / 2;
    const centerY = (y1 + y2) / 2;
    const capturedAsteroids = [];
    const capturedStructures = [];

    for (const a of state.level.asteroids) {
      if (a.x >= x1 && a.x <= x2 && a.y >= y1 && a.y <= y2) {
        const clone = JSON.parse(JSON.stringify(a));
        clone.rx = a.x - centerX;
        clone.ry = a.y - centerY;
        capturedAsteroids.push(clone);
      }
    }
    for (const s of state.level.structures) {
      if (s.x >= x1 && s.x <= x2 && s.y >= y1 && s.y <= y2) {
        const clone = JSON.parse(JSON.stringify(s));
        clone.rx = s.x - centerX;
        clone.ry = s.y - centerY;
        capturedStructures.push(clone);
      }
    }

    const total = capturedAsteroids.length + capturedStructures.length;
    if (total > 0) {
      state.clipboard = { asteroids: capturedAsteroids, structures: capturedStructures };
    }

    state.copySelect = null;
    state.copySelectScreen = null;
    state.copySelectMode = false;
    render();
  }
});
canvas.addEventListener('mouseenter', () => { state.mouse.inCanvas = true; render(); });
canvas.addEventListener('mouseleave', () => {
  state.mouse.inCanvas = false;
  state.mouse.isPanning = false;
  if (state.mouse.isMoving) {
    state.mouse.isMoving = false;
    saveLevel();
    updatePropertiesPanel();
  }
  if (state.mouse.isErasing) {
    state.mouse.isErasing = false;
    flushEraseSave(true);
  }
  render();
});
canvas.addEventListener('contextmenu', (e) => e.preventDefault());
canvas.addEventListener('wheel', handleWheel);

// Keyboard events
window.addEventListener('keydown', (e) => {
  if (e.key === 'ArrowUp') {
    e.preventDefault();
    updateAsteroidSize(state.tool.asteroidSize + CONSTANTS.ASTEROID_SIZE_STEP);
  } else if (e.key === 'ArrowDown') {
    e.preventDefault();
    updateAsteroidSize(state.tool.asteroidSize - CONSTANTS.ASTEROID_SIZE_STEP);
  } else if ((e.ctrlKey || e.metaKey) && e.key === 'c') {
    // Enter copy-select mode (drag rectangle)
    e.preventDefault();
    state.pasteMode = false;
    state.copySelectMode = true;
    state.copySelect = null;
    state.copySelectScreen = null;
    render();
  } else if ((e.ctrlKey || e.metaKey) && e.key === 'v') {
    // Enter paste mode if clipboard has content
    if (state.clipboard) {
      e.preventDefault();
      state.copySelectMode = false;
      state.copySelect = null;
      state.copySelectScreen = null;
      state.pasteMode = true;
      render();
    }
  } else if (e.key === 'Escape') {
    // Cancel copy-select or paste mode
    if (state.copySelectMode || state.pasteMode) {
      e.preventDefault();
      state.copySelectMode = false;
      state.copySelect = null;
      state.copySelectScreen = null;
      state.pasteMode = false;
      render();
    }
  } else if (e.key === 'Delete' || e.key === 'Backspace') {
    // If the user is typing in a form control, don't treat Backspace/Delete as "delete selected object"
    const ae = document.activeElement;
    const tag = ae && ae.tagName ? ae.tagName.toUpperCase() : '';
    const isTyping =
      tag === 'INPUT' ||
      tag === 'TEXTAREA' ||
      tag === 'SELECT' ||
      (ae && ae.isContentEditable);
    if (isTyping) return;

    // Delete selected object
    if (state.selectedObject) {
      e.preventDefault();
      const sel = state.selectedObject;
      // Check if it's an asteroid
      const astIdx = state.level.asteroids.indexOf(sel);
      if (astIdx !== -1) {
        state.level.asteroids.splice(astIdx, 1);
      } else {
        const stIdx = state.level.structures.indexOf(sel);
        if (stIdx !== -1) {
          state.level.structures.splice(stIdx, 1);
        }
      }
      state.selectedObject = null;
      document.getElementById('properties-panel').style.display = 'none';
      saveLevel();
      render();
    }
  }
});

// UI Controls
document.getElementById('asteroid-size').addEventListener('input', (e) => {
  updateAsteroidSize(parseInt(e.target.value));
});

const pirateTierSelect = document.getElementById('piratebase-tier-select');
if (pirateTierSelect) {
  pirateTierSelect.value = String(state.tool.piratebaseTier);
  pirateTierSelect.addEventListener('change', (e) => {
    state.tool.piratebaseTier = normalizePirateBaseTier(e.target.value);
    pirateTierSelect.value = String(state.tool.piratebaseTier);
    render();
  });
}

document.querySelectorAll('.palette-btn').forEach(btn => {
  btn.addEventListener('click', () => {
    state.tool.selected = btn.dataset.tool;
    if (state.tool.selected === 'piratebase' && pirateTierSelect) {
      state.tool.piratebaseTier = normalizePirateBaseTier(pirateTierSelect.value);
    }
    document.querySelectorAll('.palette-btn').forEach(b => b.classList.remove('selected'));
    btn.classList.add('selected');
    render();
  });
});

document.getElementById('apply-size').addEventListener('click', () => {
  state.level.width = parseInt(document.getElementById('level-width').value) || CONSTANTS.DEFAULT_LEVEL_SIZE;
  state.level.height = parseInt(document.getElementById('level-height').value) || CONSTANTS.DEFAULT_LEVEL_SIZE;
  saveLevel();
  render();
});

document.getElementById('clear-all').addEventListener('click', () => {
  const shouldClear = window.confirm('Clear all asteroids and structures? This cannot be undone.');
  if (!shouldClear) return;
  state.level.asteroids = [];
  state.level.structures = [];
  saveLevel();
  render();
});

document.getElementById('export-level').addEventListener('click', () => {
  const levelData = {
    width: state.level.width,
    height: state.level.height,
    seed: state.level.seed,
    asteroids: state.level.asteroids,
    structures: state.level.structures.map(s => {
      // Ensure we save all properties, not just x/y/type
      const out = { ...s };
      // Normalize warp gate defaults so exported JSON always contains them per gate.
      if (out.type === 'warpgate') {
        if (out.warpCost == null || Number.isNaN(out.warpCost)) out.warpCost = 3000;
        if (!out.warpDestination) out.warpDestination = 'level2';
      }
      return out;
    }),
    spawnSettings: state.level.spawnSettings || undefined,
  };
  const json = JSON.stringify(levelData, null, 2);
  const blob = new Blob([json], { type: 'application/json' });
  const url = URL.createObjectURL(blob);
  const a = document.createElement('a');
  a.href = url;
  const shopCount = levelData.structures.filter(s => s.type === 'shop').length;
  const ts = new Date().toISOString().replace(/[:.]/g, '-');
  a.download = `level-${shopCount}shops-${levelData.structures.length}structures-${ts}.json`;
  document.body.appendChild(a);
  a.click();
  // Revoke async to avoid races in some browsers.
  setTimeout(() => {
    URL.revokeObjectURL(url);
    a.remove();
  }, 0);
});

document.getElementById('import-level').addEventListener('click', () => {
  document.getElementById('import-file').click();
});

document.getElementById('copy-btn').addEventListener('click', () => {
  state.pasteMode = false;
  state.copySelectMode = true;
  state.copySelect = null;
  state.copySelectScreen = null;
  render();
});

document.getElementById('paste-btn').addEventListener('click', () => {
  if (state.clipboard) {
    state.copySelectMode = false;
    state.copySelect = null;
    state.copySelectScreen = null;
    state.pasteMode = true;
    render();
  }
});

document.getElementById('remove-overlaps-btn').addEventListener('click', () => {
  const asts = state.level.asteroids;
  if (asts.length < 2) return;

  // Build a set of indices to remove: for every pair where one asteroid is
  // fully inside the other, randomly pick one to keep and mark the other.
  const remove = new Set();
  for (let i = 0; i < asts.length; i++) {
    if (remove.has(i)) continue;
    for (let j = i + 1; j < asts.length; j++) {
      if (remove.has(j)) continue;
      const dx = asts[i].x - asts[j].x;
      const dy = asts[i].y - asts[j].y;
      const dist = Math.sqrt(dx * dx + dy * dy);
      const ri = asts[i].radius;
      const rj = asts[j].radius;
      // Check if i is fully inside j  (dist + ri <= rj)
      // or if j is fully inside i      (dist + rj <= ri)
      const iInsideJ = dist + ri <= rj;
      const jInsideI = dist + rj <= ri;
      if (iInsideJ || jInsideI) {
        // Randomly pick which one to remove
        if (Math.random() < 0.5) {
          remove.add(i);
        } else {
          remove.add(j);
        }
      }
    }
  }

  if (remove.size === 0) {
    alert('No fully overlapping asteroids found.');
    return;
  }

  state.level.asteroids = asts.filter((_, idx) => !remove.has(idx));
  saveLevel();
  render();
  alert(`Removed ${remove.size} fully overlapping asteroid(s).`);
});

document.getElementById('import-file').addEventListener('change', (e) => {
  const file = e.target.files[0];
  if (!file) return;
  const reader = new FileReader();
  reader.onload = (ev) => {
    try {
      const levelData = JSON.parse(ev.target.result);
      state.level.width = levelData.width || CONSTANTS.DEFAULT_LEVEL_SIZE;
      state.level.height = levelData.height || CONSTANTS.DEFAULT_LEVEL_SIZE;
      state.level.seed = levelData.seed != null ? (levelData.seed >>> 0) : CONSTANTS.DEFAULT_SEED;
      state.level.asteroids = levelData.asteroids || [];
      state.level.structures = (levelData.structures || []).map(normalizeStructure);
      state.level.spawnSettings = ensureSpawnSettingsDefaults(levelData.spawnSettings || {
        initialDelay: 120,
        waveIntervalMin: 60,
        waveIntervalMax: 100,
        waveSizeMin: 2,
        waveSizeMax: 4,
        pirateTypePercentages: { ...DEFAULT_PIRATE_TYPE_PERCENTAGES },
        tiers: []
      });
      
      document.getElementById('level-width').value = state.level.width;
      document.getElementById('level-height').value = state.level.height;
      
      saveLevel();
      render();
    } catch (err) {
      alert('Invalid level file');
    }
  };
  reader.readAsText(file);
  e.target.value = '';
});

document.getElementById('level-settings-btn').addEventListener('click', () => {
  state.selectedObject = null; // Deselect object
  render(); // Clear highlight
  
  const panel = document.getElementById('properties-panel');
  const content = document.getElementById('properties-content');
  
  panel.style.display = 'flex';
  content.innerHTML = '';
  
  // Render Spawn Settings
  state.level.spawnSettings = ensureSpawnSettingsDefaults(state.level.spawnSettings);
  const s = state.level.spawnSettings;
  
  const title = document.createElement('h4');
  title.textContent = 'Global Spawn Settings';
  title.style.color = '#fff';
  title.style.marginBottom = '10px';
  content.appendChild(title);

  // Initial Phase (Base Settings)
  const baseTitle = document.createElement('h5');
  baseTitle.textContent = 'Initial Phase (Start)';
  baseTitle.style.color = '#aaa';
  baseTitle.style.margin = '10px 0 5px 0';
  content.appendChild(baseTitle);

  addPropInput(content, 'Initial Delay (s)', s.initialDelay, (v) => { s.initialDelay = parseInt(v); saveLevel(); });
  addPropInput(content, 'Min Wave Interval (s)', s.waveIntervalMin, (v) => { s.waveIntervalMin = parseInt(v); saveLevel(); });
  addPropInput(content, 'Max Wave Interval (s)', s.waveIntervalMax, (v) => { s.waveIntervalMax = parseInt(v); saveLevel(); });
  addPropInput(content, 'Min Wave Size', s.waveSizeMin, (v) => { s.waveSizeMin = parseInt(v); saveLevel(); });
  addPropInput(content, 'Max Wave Size', s.waveSizeMax, (v) => { s.waveSizeMax = parseInt(v); saveLevel(); });
  renderPirateTypePercentagesEditor(content, 'Wave Pirate Type Percentages', s.pirateTypePercentages, () => { saveLevel(); });

  // Tiers
  const tiersTitle = document.createElement('h5');
  tiersTitle.textContent = 'Progressive Tiers';
  tiersTitle.style.color = '#aaa';
  tiersTitle.style.margin = '15px 0 5px 0';
  content.appendChild(tiersTitle);

  const tiersContainer = document.createElement('div');
  content.appendChild(tiersContainer);

  function renderTiers() {
    tiersContainer.innerHTML = '';
    s.tiers.sort((a, b) => a.startTime - b.startTime);
    
    s.tiers.forEach((tier, index) => {
      const tierBox = document.createElement('div');
      tierBox.className = 'spawn-tier';
      
      const tierHeader = document.createElement('h4');
      tierHeader.innerHTML = `<span>Phase ${index + 1}</span>`;
      
      const delBtn = document.createElement('button');
      delBtn.className = 'delete-tier-btn';
      delBtn.textContent = 'Delete';
      delBtn.onclick = () => {
        s.tiers.splice(index, 1);
        saveLevel();
        renderTiers();
      };
      tierHeader.appendChild(delBtn);
      tierBox.appendChild(tierHeader);

      addPropInput(tierBox, 'Start Time (s)', tier.startTime, (v) => { tier.startTime = parseInt(v); saveLevel(); });
      addPropInput(tierBox, 'Min Interval (s)', tier.waveIntervalMin, (v) => { tier.waveIntervalMin = parseInt(v); saveLevel(); });
      addPropInput(tierBox, 'Max Interval (s)', tier.waveIntervalMax, (v) => { tier.waveIntervalMax = parseInt(v); saveLevel(); });
      addPropInput(tierBox, 'Min Size', tier.waveSizeMin, (v) => { tier.waveSizeMin = parseInt(v); saveLevel(); });
      addPropInput(tierBox, 'Max Size', tier.waveSizeMax, (v) => { tier.waveSizeMax = parseInt(v); saveLevel(); });
      tier.pirateTypePercentages = normalizePirateTypePercentages(tier.pirateTypePercentages);
      renderPirateTypePercentagesEditor(tierBox, 'Wave Pirate Type Percentages', tier.pirateTypePercentages, () => { saveLevel(); });

      tiersContainer.appendChild(tierBox);
    });
  }
  renderTiers();

  const addTierBtn = document.createElement('button');
  addTierBtn.className = 'add-btn';
  addTierBtn.textContent = '+ Add Phase';
  addTierBtn.style.width = '100%';
  addTierBtn.onclick = () => {
    s.tiers.push({
      startTime: 300, // Default 5 mins
      waveIntervalMin: 45,
      waveIntervalMax: 80,
      waveSizeMin: 3,
      waveSizeMax: 6,
      pirateTypePercentages: { ...DEFAULT_PIRATE_TYPE_PERCENTAGES }
    });
    saveLevel();
    renderTiers();
  };
  content.appendChild(addTierBtn);
});

document.getElementById('close-properties').addEventListener('click', () => {
  document.getElementById('properties-panel').style.display = 'none';
  state.selectedObject = null;
  render();
});

// Window events
window.addEventListener('resize', resizeCanvas);
window.addEventListener('load', resizeCanvas);
setTimeout(resizeCanvas, 100);

// Start
loadLevel();
resizeCanvas();

```

## js\constants.js
```
export const WIDTH = 1200;
export const HEIGHT = 900;
export const ACCEL = 150;
export const FRICTION = 0.15;
export const BRAKE_FRICTION = 1.5;
export const MAX_SPEED_DEFAULT = 175;

export const BULLET_SPEED = 500;
export const FIRE_COOLDOWN = 0.03;

export const PIRATE_ACCEL = 150;
export const PIRATE_FRICTION = 0.15;
export const PIRATE_MAX_SPEED = 160;
export const PIRATE_HEALTH = 20;
export const PIRATE_BULLET_SPEED = 250;
export const PIRATE_BASE_AGGRO_RADIUS = 300;
export const BASE_DEFENSE_ORBIT_RADIUS = 100;
export const BASE_DEFENSE_ORBIT_SPEED = 0.3;

export const SHIP_SIZE = 10;
export const SHIP_COLLISION_RADIUS = 8;
export const SHIP_COLLECTION_RADIUS = 16;

export const LASER_HEAT_RATE = 1;
export const LASER_COOL_RATE = 1 / 3;
export const WEAPON_ENERGY_DRAIN = 1;

export const MINING_LASER_STATS = {
  'mining laser':       { heatRate: 1, coolRate: 1 / 3, dps: 7, energyDrain: 0.75 },
  'medium mining laser': { heatRate: 1 / 1.5, coolRate: 1 / 3, dps: 10, energyDrain: 0.9 },
  'large mining laser':  { heatRate: 1 / 2.2, coolRate: 1 / 3, dps: 16, energyDrain: 1.125 }
};

export const BLASTER_ENERGY_PER_SHOT = 0.15;
export const BLASTER_HEAT_PER_SHOT = 0.09;
export const BLASTER_COOL_RATE = 1 / 3;
export const BLASTER_FIRE_RATE = 10;

export const BLASTER_STATS = {
  'light blaster':  { energyPerShot: 0.15, heatPerShot: 0.09, coolRate: 1 / 3, fireRate: 10, pirateDmg: 3, asteroidDmg: 0.5 },
  'medium blaster': { energyPerShot: 0.225, heatPerShot: 0.08, coolRate: 1 / 3, fireRate: 10, pirateDmg: 5, asteroidDmg: 0.9 },
  'large blaster':  { energyPerShot: 0.375, heatPerShot: 0.07, coolRate: 1 / 3, fireRate: 10, pirateDmg: 9, asteroidDmg: 1.8 }
};

export const OXYGEN_DEPLETION_RATE = 1 / 25;
export const FUEL_DEPLETION_RATE = 1 / 4;

export const MAX_ORE_STACK = 20;
export const ORE_ITEMS = ['cuprite', 'hematite', 'aurite', 'diamite', 'platinite', 'scrap', 'copper', 'iron', 'gold', 'diamond', 'platinum'];

// --- Raw ore -> Refined ore mapping (used by Refinery) ---
export const RAW_TO_REFINED = {
  'cuprite': 'copper',
  'hematite': 'iron',
  'aurite': 'gold',
  'diamite': 'diamond',
  'platinite': 'platinum'
};
export const RAW_ORE_TYPES = ['cuprite', 'hematite', 'aurite', 'diamite', 'platinite'];

export const STRUCTURE_SIZE = 40;
export const STRUCTURE_RADIUS_3D = 54;
export const WARP_GATE_DASHED_EXTRA = 80;
export const SHOP_DASHED_EXTRA = 80;
export const WARP_GATE_DASHED_EXTRA_3D = 108;
export const SHOP_DASHED_EXTRA_3D = 108;
export const STRUCTURE_SIZE_COLL = 54;
export const PIRATE_BASE_HIT_RADIUS = 54;

export const STRUCTURE_STYLES = { 
  shop: '#446688', 
  shipyard: '#664466', 
  refinery: '#666644', 
  fueling: '#446644', 
  warpgate: '#6644aa', 
  piratebase: '#884422' 
};

export const SHIP_STATS = {
  'scout':     { name: 'Scout',     price: 0,     health: 50, fuel: 25, oxygen: 30, speed: 175, slots: 9,  collisionRadius: 8,  shipScale: 1.0, damageMult: 1.0, desc: 'Standard issue scout ship.' },
  'cutter':    { name: 'Cutter',    price: 5000,  health: 80, fuel: 40, oxygen: 35, speed: 175, slots: 14, collisionRadius: 11, shipScale: 1.3, damageMult: 1.3, desc: 'Sturdy mining vessel. 30% bonus weapon damage vs pirates and bases.' },
  'transport': { name: 'Transport', price: 5000, health: 60, fuel: 50, oxygen: 50, speed: 175, slots: 18, collisionRadius: 14, shipScale: 1.4, damageMult: 1.0, desc: 'Heavy transport with 18 inventory slots.' }
};

export const ITEM_USAGE = {
  'small energy cell': 'Powers mining lasers and blasters.',
  'medium energy cell': 'Powers mining lasers and blasters. Holds 3x more charge.',
  'large energy cell': 'Powers mining lasers and blasters. Holds 6x more charge.',
  'fuel tank': 'Drag to fuel bar to refill ship fuel.',
  'medium fuel tank': 'Medium capacity fuel tank.',
  'large fuel tank': 'Large capacity fuel tank.',
  'oxygen canister': 'Drag to O2 bar to refill ship oxygen.',
  'medium oxygen canister': 'Medium capacity oxygen canister.',
  'large oxygen canister': 'Large capacity oxygen canister.',
  'health pack': 'Drag to health bar to repair ship.',
  'medium health pack': 'Medium capacity repair kit.',
  'large health pack': 'Large capacity repair kit.',
  'light blaster': 'Select and left-click to fire rapid projectiles at enemies.',
  'medium blaster': 'Medium blaster. Higher damage per shot.',
  'large blaster': 'Heavy blaster. Devastating damage per shot.',
  'mining laser': 'Select and left-click to mine asteroids for ore.',
  'medium mining laser': 'Upgraded laser that mines faster.',
  'large mining laser': 'High-power laser. Mines the fastest.',
  'cuprite': 'Common ore. Sell at shops for credits.',
  'hematite': 'Uncommon ore. Worth more than cuprite.',
  'aurite': 'Rare golden ore. Valuable at shops.',
  'diamite': 'Precious ore. High value.',
  'platinite': 'Extremely rare ore. Most valuable.',
  'scrap': 'Salvaged material. Can be sold for credits.',
  'warp key': 'Required to activate warp gates.',
  'warp key fragment': 'A broken piece of a warp key. No known use yet.',
  'copper': 'Refined copper. More valuable than raw cuprite.',
  'iron': 'Refined iron. More valuable than raw hematite.',
  'gold': 'Refined gold. More valuable than raw aurite.',
  'diamond': 'Refined diamond. More valuable than raw diamite.',
  'platinum': 'Refined platinum. Most valuable refined ore.'
};

export const ITEM_DISPLAY_NAMES = {
  'small energy cell': 'Small Energy Cell',
  'medium energy cell': 'Medium Energy Cell',
  'large energy cell': 'Large Energy Cell',
  'fuel tank': 'Fuel Tank',
  'medium fuel tank': 'Medium Fuel Tank',
  'large fuel tank': 'Large Fuel Tank',
  'oxygen canister': 'Oxygen Canister',
  'medium oxygen canister': 'Medium Oxygen Canister',
  'large oxygen canister': 'Large Oxygen Canister',
  'health pack': 'Health Pack',
  'medium health pack': 'Medium Health Pack',
  'large health pack': 'Large Health Pack',
  'light blaster': 'Light Blaster',
  'medium blaster': 'Medium Blaster',
  'large blaster': 'Large Blaster',
  'mining laser': 'Mining Laser',
  'medium mining laser': 'Medium Mining Laser',
  'large mining laser': 'Large Mining Laser',
  'cuprite': 'Cuprite',
  'hematite': 'Hematite',
  'aurite': 'Aurite',
  'diamite': 'Diamite',
  'platinite': 'Platinite',
  'scrap': 'Scrap',
  'warp key': 'Warp Key',
  'warp key fragment': 'Warp Key Fragment',
  'copper': 'Copper',
  'iron': 'Iron',
  'gold': 'Gold',
  'diamond': 'Diamond',
  'platinum': 'Platinum'
};

// --- Collision constants ---
export const BOUNCE_RESTITUTION = 0.3;
export const MAX_COLLISION_DAMAGE = 20;
export const DAMAGE_PER_SPEED = 0.1; // 200 units/sec impact => 20 damage

// --- Floating item constants ---
export const MAGNET_RADIUS = 80;
export const MAGNET_STRENGTH = 600;
export const FLOAT_DRAG = 2.0;
export const FLOAT_STOP_SPEED = 0.05;
export const FLOAT_ITEM_RADIUS = 10;
export const FLOATING_ORE_SCALE = 15;

// --- Particle constants ---
export const PARTICLE_DRAG = 6;

// --- Pirate combat constants ---
export const PIRATE_FIRE_RANGE = 700;
export const PIRATE_AIM_SPREAD = 60;
export const PIRATE_TILT_SENSITIVITY = 8;
export const PIRATE_TILT_DECAY = 4;

// --- Interaction radius (structure radius + dashed ring) ---
export const INTERACT_RADIUS = STRUCTURE_SIZE_COLL + SHOP_DASHED_EXTRA_3D; // 54 + 108

// --- Item image paths (used for HUD, floating items, tooltips) ---
export const ITEM_IMAGE_PATHS = {
  'oxygen canister': 'assets/oxygen-can.png',
  'medium oxygen canister': 'assets/oxygen-can.png',
  'large oxygen canister': 'assets/oxygen-can.png',
  'fuel tank': 'assets/fuel-can.png',
  'medium fuel tank': 'assets/fuel-can.png',
  'large fuel tank': 'assets/fuel-can.png',
  'health pack': 'assets/health-pack.png',
  'medium health pack': 'assets/health-pack.png',
  'large health pack': 'assets/health-pack.png',
  'small energy cell': 'assets/energy-cell.png',
  'medium energy cell': 'assets/energy-cell.png',
  'large energy cell': 'assets/energy-cell.png',
  'mining laser': 'assets/laser.png',
  'medium mining laser': 'assets/laser.png',
  'large mining laser': 'assets/laser.png',
  'light blaster': 'assets/blaster.png',
  'medium blaster': 'assets/blaster.png',
  'large blaster': 'assets/blaster.png',
  'warp key': 'assets/warp-key.png',
  'warp key fragment': 'assets/warp-key-fragment.png'
};

// --- Item short labels (for HUD slot display) ---
export const ITEM_LABELS = {
  'mining laser': 'L',
  'medium mining laser': 'M',
  'large mining laser': 'XL',
  'light blaster': 'B',
  'medium blaster': 'MB',
  'large blaster': 'LB',
  'small energy cell': 'E',
  'medium energy cell': 'M',
  'large energy cell': 'L',
  'oxygen canister': 'O',
  'medium oxygen canister': 'MO',
  'large oxygen canister': 'LO',
  'fuel tank': 'F',
  'medium fuel tank': 'MF',
  'large fuel tank': 'LF',
  'health pack': 'H',
  'medium health pack': 'MH',
  'large health pack': 'LH',
  'cuprite': 'C',
  'hematite': 'H',
  'aurite': 'A',
  'diamite': 'D',
  'platinite': 'P',
  'scrap': 'S',
  'warp key': 'K',
  'warp key fragment': 'KF',
  'copper': 'Cu',
  'iron': 'Fe',
  'gold': 'Au',
  'diamond': 'Di',
  'platinum': 'Pt'
};

// --- Item default payloads (used when buying/creating items) ---
export const ITEM_DEFAULTS = {
  'small energy cell':    { energy: 10, maxEnergy: 10 },
  'medium energy cell':   { energy: 30, maxEnergy: 30 },
  'large energy cell':    { energy: 60, maxEnergy: 60 },
  'oxygen canister':      { oxygen: 10, maxOxygen: 10 },
  'medium oxygen canister': { oxygen: 30, maxOxygen: 30 },
  'large oxygen canister':{ oxygen: 60, maxOxygen: 60 },
  'fuel tank':            { fuel: 10, maxFuel: 10 },
  'medium fuel tank':     { fuel: 30, maxFuel: 30 },
  'large fuel tank':      { fuel: 60, maxFuel: 60 },
  'health pack':          { health: 10 },
  'medium health pack':   { health: 30 },
  'large health pack':    { health: 60 },
  'light blaster':        { heat: 0, overheated: false },
  'medium blaster':       { heat: 0, overheated: false },
  'large blaster':        { heat: 0, overheated: false },
  'medium mining laser':  { heat: 0, overheated: false },
  'large mining laser':   { heat: 0, overheated: false }
};

// --- Shop prices ---
export const ITEM_BUY_PRICE = {
  'small energy cell': 150,
  'medium energy cell': 550,
  'large energy cell': 1200,
  'oxygen canister': 500,
  'medium oxygen canister': 1250,
  'large oxygen canister': 2000,
  'fuel tank': 300,
  'medium fuel tank': 750,
  'large fuel tank': 1250,
  'light blaster': 1000,
  'medium blaster': 2500,
  'large blaster': 5000,
  'medium mining laser': 1500,
  'large mining laser': 3000,
  'health pack': 400,
  'medium health pack': 1000,
  'large health pack': 1750
};

export const ITEM_SELL_PRICE = {
  cuprite: 10, hematite: 20, aurite: 30, diamite: 40, platinite: 60,
  copper: 20, iron: 40, gold: 60, diamond: 80, platinum: 120,
  scrap: 40, 'warp key': 500, 'mining laser': 300,
  'light blaster': 500, 'medium blaster': 1250, 'large blaster': 2500,
  'medium mining laser': 750, 'large mining laser': 1500
};

// --- Collidable structure types ---
const COLLIDABLE_TYPES = new Set(['warpgate', 'shop', 'piratebase', 'crafting', 'shipyard', 'refinery']);

/** Returns true if a structure should participate in physics collision checks. */
export function isCollidableStructure(st) {
  if (!COLLIDABLE_TYPES.has(st.type)) return false;
  if (st.type === 'piratebase' && (st.dead || st.health <= 0)) return false;
  return true;
}

// --- Weapons that display a heat bar in HUD slots ---
export const HEAT_WEAPONS = ['mining laser', 'medium mining laser', 'large mining laser', 'light blaster', 'medium blaster', 'large blaster'];

// --- Master item list (used by editor dropdowns for crafting recipes, etc.) ---
export const ALL_ITEM_NAMES = [
  'mining laser', 'medium mining laser', 'large mining laser',
  'light blaster', 'medium blaster', 'large blaster',
  'small energy cell', 'medium energy cell', 'large energy cell',
  'oxygen canister', 'medium oxygen canister', 'large oxygen canister',
  'fuel tank', 'medium fuel tank', 'large fuel tank',
  'health pack', 'medium health pack', 'large health pack',
  'cuprite', 'hematite', 'aurite', 'diamite', 'platinite',
  'copper', 'iron', 'gold', 'diamond', 'platinum',
  'scrap', 'warp key', 'warp key fragment'
];

// --- Resource bar drop configuration (used by endDrag) ---
export const RESOURCE_BAR_CONFIG = {
  oxygen:  { items: ['oxygen canister', 'medium oxygen canister', 'large oxygen canister'], prop: 'oxygen', playerProp: 'oxygen', maxProp: 'maxOxygen' },
  fuel:    { items: ['fuel tank', 'medium fuel tank', 'large fuel tank'],                   prop: 'fuel',   playerProp: 'fuel',   maxProp: 'maxFuel' },
  health:  { items: ['health pack', 'medium health pack', 'large health pack'],             prop: 'health', playerProp: 'health', maxProp: 'maxHealth' }
};

```

## index.html
```
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Game</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Oxanium:wght@400;600&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="css/style.css">
</head>
<body>
  <div id="game-container">
    <div id="level-select-ui">
      <label for="level-select">Level:</label>
      <select id="level-select"></select>
      <a href="editor.html" class="level-editor-link">Level Editor</a>
    </div>
    <canvas id="game-canvas" tabindex="1"></canvas>
    <canvas id="ship-canvas"></canvas>
    <canvas id="ui-canvas"></canvas>
    <div id="main-menu-overlay">
      <div id="main-menu">
        <h1 class="main-menu-title">Space Jam</h1>
        <button type="button" id="main-menu-start-btn">Start Game</button>
      </div>
    </div>
    <div id="intro-cutscene-overlay" style="display: none;">
      <div id="intro-dialogue-box">
        <div id="intro-dialogue-header">// SHIP STATUS CONSOLE</div>
        <div id="intro-dialogue-text"></div>
      </div>
      <canvas id="intro-map-canvas"></canvas>
      <div id="intro-skip-hint">Press any key to skip</div>
    </div>
    <div id="start-menu-overlay" style="display: none;">
      <div id="start-menu">
        <div class="start-title">Click to start</div>
      </div>
    </div>
    <div id="warp-menu-overlay" style="display: none;">
      <div id="warp-menu">
        <p>Use warp gate?</p>
        <p>Cost: 3000 credits</p>
        <button type="button" id="warp-pay-btn">Pay 3000</button>
        <button type="button" id="warp-cancel-btn">Cancel</button>
      </div>
    </div>
    <div id="crafting-menu-overlay" style="display: none;">
      <div id="crafting-menu">
        <div id="crafting-header">
          <span>Crafting Station</span>
          <button type="button" id="crafting-close-btn">Close</button>
        </div>
        <div id="crafting-main">
          <div id="crafting-recipes-list">
            <!-- Recipes injected here -->
          </div>
          <div id="crafting-work-area">
            <div class="crafting-section-title">Input</div>
            <div id="crafting-input-grid">
              <div class="crafting-slot input-slot" data-craft-input="0"></div>
              <div class="crafting-slot input-slot" data-craft-input="1"></div>
              <div class="crafting-slot input-slot" data-craft-input="2"></div>
              <div class="crafting-slot input-slot" data-craft-input="3"></div>
              <div class="crafting-slot input-slot" data-craft-input="4"></div>
              <div class="crafting-slot input-slot" data-craft-input="5"></div>
              <div class="crafting-slot input-slot" data-craft-input="6"></div>
              <div class="crafting-slot input-slot" data-craft-input="7"></div>
              <div class="crafting-slot input-slot" data-craft-input="8"></div>
            </div>
            <div class="crafting-arrow">âžœ</div>
            <div class="crafting-section-title">Output</div>
            <div id="crafting-output-slot" class="crafting-slot output-slot"></div>
            <button id="craft-btn">Craft</button>
          </div>
        </div>
      </div>
    </div>
    <div id="shipyard-menu-overlay" style="display: none;">
      <div id="shipyard-menu">
        <div id="shipyard-header">
          <span class="shipyard-title-row">
            <span>Shipyard</span>
            <span id="shipyard-credits">0 credits</span>
          </span>
          <button type="button" id="shipyard-close-btn">Close</button>
        </div>
        <div id="shipyard-for-sale-section" style="display:none;">
          <div class="shipyard-section-label">For Sale</div>
          <div id="shipyard-for-sale" class="shipyard-cards"></div>
        </div>
        <div id="shipyard-owned-section" style="display:none;">
          <div class="shipyard-section-label">Your Ships</div>
          <div id="shipyard-owned" class="shipyard-cards"></div>
        </div>
      </div>
    </div>
    <div id="refinery-menu-overlay" style="display: none;">
      <div id="refinery-menu">
        <div id="refinery-header">
          <span>Refinery</span>
          <button type="button" id="refinery-close-btn">Close</button>
        </div>
        <div id="refinery-accepted-label">Accepts: ---</div>
        <div id="refinery-main">
          <div id="refinery-input-area">
            <div class="refinery-section-title">Raw Ore Input</div>
            <div id="refinery-input-grid">
              <div class="crafting-slot refinery-input-slot" data-refinery-input="0"></div>
              <div class="crafting-slot refinery-input-slot" data-refinery-input="1"></div>
              <div class="crafting-slot refinery-input-slot" data-refinery-input="2"></div>
              <div class="crafting-slot refinery-input-slot" data-refinery-input="3"></div>
            </div>
          </div>
          <div class="crafting-arrow">âžœ</div>
          <div id="refinery-output-area">
            <div class="refinery-section-title">Refined Output</div>
            <div id="refinery-output-slot" class="crafting-slot output-slot"></div>
          </div>
        </div>
        <button id="refine-btn">Refine</button>
      </div>
    </div>
    <div id="shop-menu-overlay" style="display: none;">
      <div id="shop-item-tooltip" style="display: none;"></div>
      <div id="shop-menu">
        <div id="shop-header">
          <span class="shop-title-row">
            <span>Shop</span>
            <span id="shop-credits-display">You have 0 credits</span>
          </span>
          <button type="button" id="shop-close-btn">Close</button>
        </div>
        <div id="shop-main">
          <div id="shop-buy-area">
            <div class="shop-section-title">Buy</div>
            <div id="shop-buy-slots">
              <div class="shop-buy-slot" data-buy-slot="0"></div>
              <div class="shop-buy-slot" data-buy-slot="1"></div>
              <div class="shop-buy-slot" data-buy-slot="2"></div>
              <div class="shop-buy-slot" data-buy-slot="3"></div>
              <div class="shop-buy-slot" data-buy-slot="4"></div>
              <div class="shop-buy-slot" data-buy-slot="5"></div>
              <div class="shop-buy-slot" data-buy-slot="6"></div>
              <div class="shop-buy-slot" data-buy-slot="7"></div>
              <div class="shop-buy-slot" data-buy-slot="8"></div>
              <div class="shop-buy-slot" data-buy-slot="9"></div>
              <div class="shop-buy-slot" data-buy-slot="10"></div>
              <div class="shop-buy-slot" data-buy-slot="11"></div>
              <div class="shop-buy-slot" data-buy-slot="12"></div>
              <div class="shop-buy-slot" data-buy-slot="13"></div>
              <div class="shop-buy-slot" data-buy-slot="14"></div>
              <div class="shop-buy-slot" data-buy-slot="15"></div>
              <div class="shop-buy-slot" data-buy-slot="16"></div>
              <div class="shop-buy-slot" data-buy-slot="17"></div>
              <div class="shop-buy-slot" data-buy-slot="18"></div>
              <div class="shop-buy-slot" data-buy-slot="19"></div>
              <div class="shop-buy-slot" data-buy-slot="20"></div>
              <div class="shop-buy-slot" data-buy-slot="21"></div>
              <div class="shop-buy-slot" data-buy-slot="22"></div>
              <div class="shop-buy-slot" data-buy-slot="23"></div>
            </div>
            <div id="shop-price-list"></div>
          </div>
          <div id="shop-sell-area">
            <div class="shop-section-title">Sell</div>
            <div id="shop-sell-slots">
              <div class="shop-sell-slot" data-sell-slot="0"></div>
              <div class="shop-sell-slot" data-sell-slot="1"></div>
              <div class="shop-sell-slot" data-sell-slot="2"></div>
              <div class="shop-sell-slot" data-sell-slot="3"></div>
              <div class="shop-sell-slot" data-sell-slot="4"></div>
              <div class="shop-sell-slot" data-sell-slot="5"></div>
              <div class="shop-sell-slot" data-sell-slot="6"></div>
              <div class="shop-sell-slot" data-sell-slot="7"></div>
              <div class="shop-sell-slot" data-sell-slot="8"></div>
              <div class="shop-sell-slot" data-sell-slot="9"></div>
              <div class="shop-sell-slot" data-sell-slot="10"></div>
              <div class="shop-sell-slot" data-sell-slot="11"></div>
              <div class="shop-sell-slot" data-sell-slot="12"></div>
              <div class="shop-sell-slot" data-sell-slot="13"></div>
              <div class="shop-sell-slot" data-sell-slot="14"></div>
              <div class="shop-sell-slot" data-sell-slot="15"></div>
              <div class="shop-sell-slot" data-sell-slot="16"></div>
              <div class="shop-sell-slot" data-sell-slot="17"></div>
              <div class="shop-sell-slot" data-sell-slot="18"></div>
              <div class="shop-sell-slot" data-sell-slot="19"></div>
              <div class="shop-sell-slot" data-sell-slot="20"></div>
              <div class="shop-sell-slot" data-sell-slot="21"></div>
              <div class="shop-sell-slot" data-sell-slot="22"></div>
              <div class="shop-sell-slot" data-sell-slot="23"></div>
            </div>
            <div id="shop-sell-total">Total: 0 credits</div>
            <button type="button" id="shop-sell-btn">Sell</button>
          </div>
        </div>
      </div>
    </div>
    <div id="death-menu-overlay" style="display: none;">
      <div id="death-menu">
        <div class="death-title">You Died</div>
        <div class="death-subtitle">Your ship was destroyed.</div>
        <button type="button" id="death-restart-btn">Restart</button>
      </div>
    </div>
    <div id="shop-drag-ghost" style="display: none;" aria-hidden="true"></div>
    <div id="oxygen-bar-drop-zone" aria-label="O2 bar - drop oxygen canister to refill"></div>
    <div id="health-bar-drop-zone" aria-label="Health bar - drop health pack to restore HP"></div>
    <div id="fuel-bar-drop-zone" aria-label="Fuel bar - drop fuel tank to refill"></div>
    <div id="hud-overlay" aria-label="Hotbar">
      <div id="extended-inventory">
        <div class="slot ext-slot" data-slot="9"></div>
        <div class="slot ext-slot" data-slot="10"></div>
        <div class="slot ext-slot" data-slot="11"></div>
        <div class="slot ext-slot" data-slot="12"></div>
        <div class="slot ext-slot" data-slot="13"></div>
        <div class="slot ext-slot" data-slot="14"></div>
        <div class="slot ext-slot" data-slot="15"></div>
        <div class="slot ext-slot" data-slot="16"></div>
        <div class="slot ext-slot" data-slot="17"></div>
      </div>
      <div id="hud-bottom-row">
        <div id="hotbar">
          <div class="slot" data-slot="0"></div>
          <div class="slot" data-slot="1"></div>
          <div class="slot" data-slot="2"></div>
          <div class="slot" data-slot="3"></div>
          <div class="slot" data-slot="4"></div>
          <div class="slot" data-slot="5"></div>
          <div class="slot" data-slot="6"></div>
          <div class="slot" data-slot="7"></div>
          <div class="slot" data-slot="8"></div>
        </div>
        <div id="hotbar-item-tooltip" style="display: none;"></div>
        <div id="credits">
          <div class="credits-label">Credits</div>
          <div class="credits-value">0</div>
        </div>
      </div>
    </div>
  </div>
  <script type="module" src="js/main.js"></script>
</body>
</html>

```

## editor.html
```
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Level Editor</title>
  <link rel="stylesheet" href="css/editor.css">
</head>
<body>
  <div id="toolbar">
    <h2>Level Editor</h2>
    <div class="tool-group">
      <label>Level Width: <input type="number" id="level-width" value="5000" min="1000" max="20000" step="500"></label>
      <label>Level Height: <input type="number" id="level-height" value="5000" min="1000" max="20000" step="500"></label>
      <button id="apply-size">Apply Size</button>
    </div>
    <div class="tool-group">
      <label>Asteroid Size: <input type="range" id="asteroid-size" min="10" max="300" step="10" value="40"></label>
      <span id="size-display">40</span>
    </div>
    <div class="tool-group">
      <button id="level-settings-btn">Level Settings</button>
      <button id="clear-all">Clear All</button>
      <button id="export-level">Export Level</button>
      <button id="import-level">Import Level</button>
      <input type="file" id="import-file" accept=".json" class="hidden-input">
    </div>
    <div class="tool-group">
      <button id="copy-btn" title="Copy selected object (Ctrl+C)">Copy</button>
      <button id="paste-btn" title="Paste at cursor (Ctrl+V)">Paste</button>
      <button id="remove-overlaps-btn" title="Remove asteroids fully contained inside other asteroids">Remove Overlaps</button>
    </div>
    <div class="tool-group">
      <a href="index.html">Back to Game</a>
    </div>
    <div id="instructions">
      <p>Left-click: Place selected object</p>
      <p>Move tool: Click and drag to move objects</p>
      <p>Right-click: Remove object</p>
      <p>Scroll: Zoom in/out</p>
      <p>Middle-click drag: Pan view</p>
      <p>Ctrl+C: Copy (drag to select area)</p>
      <p>Ctrl+V: Paste copied objects</p>
      <p>Esc: Cancel copy/paste</p>
      <p>Delete: Remove selected</p>
    </div>
  </div>
  <div id="editor-container">
    <canvas id="editor-canvas" tabindex="1"></canvas>
    <div id="tool-palette">
      <div class="palette-title">Tools</div>
      <div class="palette-grid palette-grid-bottom-gap">
        <button class="palette-btn selected" data-tool="select" title="Select Object">Select</button>
        <button class="palette-btn" data-tool="move" title="Move Object (click and drag)">Move</button>
        <button class="palette-btn" data-tool="eraser" title="Eraser (left-click to remove)">Eraser</button>
      </div>
      <div class="palette-title">Place</div>
      <div class="palette-grid">
        <button class="palette-btn" data-tool="asteroid_cuprite" data-asteroid-type="cuprite" title="Cuprite Asteroid">Cuprite</button>
        <button class="palette-btn" data-tool="asteroid_hematite" data-asteroid-type="hematite" title="Hematite Asteroid">Hematite</button>
        <button class="palette-btn" data-tool="asteroid_aurite" data-asteroid-type="aurite" title="Aurite Asteroid">Aurite</button>
        <button class="palette-btn" data-tool="asteroid_diamite" data-asteroid-type="diamite" title="Diamite Asteroid">Diamite</button>
        <button class="palette-btn" data-tool="asteroid_platinite" data-asteroid-type="platinite" title="Platinite Asteroid">Platinite</button>
        
        <button class="palette-btn" data-tool="shop" title="Shop Station">Shop</button>
        <button class="palette-btn" data-tool="shipyard" title="Shipyard">Shipyard</button>
        <button class="palette-btn" data-tool="refinery" title="Refinery">Refinery</button>
        <button class="palette-btn" data-tool="fueling" title="Fueling Station">Fueling</button>
        <button class="palette-btn" data-tool="crafting" title="Crafting Station">Crafting</button>
        <button class="palette-btn" data-tool="warpgate" title="Warp Gate">Warp Gate</button>
        <button class="palette-btn" data-tool="piratebase" title="Pirate Base">Pirate Base</button>
      </div>
      <div class="palette-title">Pirate Base Tier</div>
      <div class="palette-grid palette-grid-single-column">
        <select id="piratebase-tier-select" title="Tier used when placing Pirate Base">
          <option value="1">Tier 1 (80%)</option>
          <option value="2" selected>Tier 2 (100%)</option>
          <option value="3">Tier 3 (120%)</option>
          <option value="4">Tier 4 (140%)</option>
          <option value="5">Tier 5 (160%)</option>
        </select>
      </div>
    </div>
    
    <div id="properties-panel">
      <div class="panel-header">
        <h3>Properties</h3>
        <button id="close-properties">Ã—</button>
      </div>
      <div id="properties-content">
        <!-- Content injected by js -->
      </div>
    </div>
  </div>
  <script type="module" src="js/editor.js"></script>
</body>
</html>

```

## levels\level2.json
```
{
  "width": 10000,
  "height": 10000,
  "seed": 999,
  "asteroids": [
    {
      "x": 4477.477798017167,
      "y": -3312.909112318656,
      "radius": 80,
      "oreType": "cuprite"
    },
    {
      "x": -1016.7625433396954,
      "y": 72.11684194554202,
      "radius": 70,
      "oreType": "aurite"
    },
    {
      "x": 3791.502386744143,
      "y": -1785.3280764884883,
      "radius": 40,
      "oreType": "cuprite"
    },
    {
      "x": -895.5870187897741,
      "y": -2380.9465850302636,
      "radius": 70,
      "oreType": "hematite"
    },
    {
      "x": -2518.3340850713407,
      "y": 2702.1779866484508,
      "radius": 40,
      "oreType": "cuprite"
    },
    {
      "x": -2086.6726617960253,
      "y": -3080.2018080862404,
      "radius": 30,
      "oreType": "hematite"
    },
    {
      "x": -2835.7568579607805,
      "y": -1325.0950024348817,
      "radius": 80,
      "oreType": "cuprite"
    },
    {
      "x": -1674.4675375265006,
      "y": -2737.2787370632623,
      "radius": 70,
      "oreType": "cuprite"
    },
    {
      "x": -4662.8598756535175,
      "y": 4259.263243654734,
      "radius": 50,
      "oreType": "cuprite"
    },
    {
      "x": -3856.5500812958685,
      "y": -3041.7083294546087,
      "radius": 90,
      "oreType": "cuprite"
    },
    {
      "x": 4864.934052851319,
      "y": -2015.5694851876826,
      "radius": 60,
      "oreType": "cuprite"
    },
    {
      "x": -3682.918678698548,
      "y": -914.3828027972845,
      "radius": 80,
      "oreType": "aurite"
    },
    {
      "x": 1153.8549560817191,
      "y": -4620.2264564272655,
      "radius": 100,
      "oreType": "aurite"
    },
    {
      "x": -794.4670849355928,
      "y": 3602.429297483203,
      "radius": 30,
      "oreType": "aurite"
    },
    {
      "x": -3735.266013608194,
      "y": -4515.695730334366,
      "radius": 30,
      "oreType": "hematite"
    },
    {
      "x": -1593.7985175308468,
      "y": -4584.292843912388,
      "radius": 40,
      "oreType": "hematite"
    },
    {
      "x": 3890.1758347254913,
      "y": 3928.062531418297,
      "radius": 60,
      "oreType": "aurite"
    },
    {
      "x": -1990.4565334528136,
      "y": -1244.4687234916141,
      "radius": 70,
      "oreType": "cuprite"
    },
    {
      "x": 1703.6190228780113,
      "y": 909.5430588611708,
      "radius": 100,
      "oreType": "cuprite"
    },
    {
      "x": 4301.094058454249,
      "y": -1348.990690971723,
      "radius": 50,
      "oreType": "aurite"
    },
    {
      "x": 2667.39889573977,
      "y": -3009.3049554573727,
      "radius": 60,
      "oreType": "hematite"
    },
    {
      "x": 4807.035681104772,
      "y": -2655.133697574892,
      "radius": 10,
      "oreType": "hematite"
    },
    {
      "x": -1592.2630362036693,
      "y": 4475.370658133699,
      "radius": 50,
      "oreType": "hematite"
    },
    {
      "x": -146.23011813127863,
      "y": 2533.013616021269,
      "radius": 50,
      "oreType": "cuprite"
    },
    {
      "x": -3245.576301513751,
      "y": -4722.658166698137,
      "radius": 100,
      "oreType": "cuprite"
    },
    {
      "x": -617.8754492104943,
      "y": 2306.982016727881,
      "radius": 90,
      "oreType": "hematite"
    },
    {
      "x": 4870.869562241906,
      "y": -588.5065550631285,
      "radius": 90,
      "oreType": "aurite"
    },
    {
      "x": 4640.353914569672,
      "y": -4837.944431614634,
      "radius": 40,
      "oreType": "cuprite"
    },
    {
      "x": -958.7056428425989,
      "y": -607.726245917255,
      "radius": 40,
      "oreType": "hematite"
    },
    {
      "x": 643.9915481060599,
      "y": 951.7175344409856,
      "radius": 20,
      "oreType": "cuprite"
    },
    {
      "x": -1769.2191218718522,
      "y": -174.4710782466008,
      "radius": 30,
      "oreType": "hematite"
    },
    {
      "x": 4547.123053852507,
      "y": -4514.207299354358,
      "radius": 70,
      "oreType": "cuprite"
    },
    {
      "x": 2015.140547748937,
      "y": -3592.019099832318,
      "radius": 20,
      "oreType": "hematite"
    },
    {
      "x": -4194.051091454254,
      "y": -3887.1793399485077,
      "radius": 30,
      "oreType": "cuprite"
    },
    {
      "x": -3171.120356078838,
      "y": -2415.2874862842855,
      "radius": 40,
      "oreType": "cuprite"
    },
    {
      "x": 4356.16354124905,
      "y": -4553.113566275282,
      "radius": 50,
      "oreType": "cuprite"
    },
    {
      "x": -2757.1412953035447,
      "y": 3321.3777317719196,
      "radius": 60,
      "oreType": "cuprite"
    },
    {
      "x": 2557.6083788637648,
      "y": -2478.506952716986,
      "radius": 50,
      "oreType": "hematite"
    },
    {
      "x": -2574.175806526617,
      "y": -1741.972020688951,
      "radius": 80,
      "oreType": "cuprite"
    },
    {
      "x": -1304.9469254987134,
      "y": 2786.0643339197954,
      "radius": 70,
      "oreType": "aurite"
    },
    {
      "x": 1174.9623806698417,
      "y": -3612.3759803147213,
      "radius": 60,
      "oreType": "cuprite"
    },
    {
      "x": 2042.9030180369634,
      "y": 622.8438536766046,
      "radius": 10,
      "oreType": "cuprite"
    },
    {
      "x": -2011.7413366386172,
      "y": 1495.7471905674602,
      "radius": 90,
      "oreType": "aurite"
    },
    {
      "x": -1857.0905963709029,
      "y": -3333.4677767326084,
      "radius": 20,
      "oreType": "aurite"
    },
    {
      "x": 2527.943240519348,
      "y": -4383.6934340887665,
      "radius": 70,
      "oreType": "hematite"
    },
    {
      "x": 471.01810279389645,
      "y": 2222.68770337412,
      "radius": 30,
      "oreType": "aurite"
    },
    {
      "x": -2990.5451609477773,
      "y": 1830.078951323888,
      "radius": 20,
      "oreType": "cuprite"
    },
    {
      "x": 3240.065117783364,
      "y": -2418.93172652939,
      "radius": 30,
      "oreType": "cuprite"
    },
    {
      "x": -4945.1454939827545,
      "y": -2717.277012733319,
      "radius": 30,
      "oreType": "cuprite"
    },
    {
      "x": -1230.3338750006553,
      "y": -190.94062674314793,
      "radius": 30,
      "oreType": "aurite"
    },
    {
      "x": -3122.413546588072,
      "y": 3877.5921457047557,
      "radius": 50,
      "oreType": "cuprite"
    },
    {
      "x": 1659.1499243219564,
      "y": 264.85579233292975,
      "radius": 70,
      "oreType": "hematite"
    },
    {
      "x": -4793.3757279060665,
      "y": 4841.351933412863,
      "radius": 60,
      "oreType": "cuprite"
    },
    {
      "x": 3250.118248466547,
      "y": -3523.3587756317575,
      "radius": 20,
      "oreType": "aurite"
    },
    {
      "x": -1955.4262918843012,
      "y": -4388.928857018326,
      "radius": 30,
      "oreType": "aurite"
    },
    {
      "x": 311.98648607137835,
      "y": -4272.057524268959,
      "radius": 60,
      "oreType": "hematite"
    },
    {
      "x": -1016.4480308476786,
      "y": 1930.554436136358,
      "radius": 90,
      "oreType": "aurite"
    },
    {
      "x": 4871.060757534091,
      "y": -3153.7435065224818,
      "radius": 50,
      "oreType": "cuprite"
    },
    {
      "x": 1019.5230015436318,
      "y": -3026.8602071683913,
      "radius": 50,
      "oreType": "cuprite"
    },
    {
      "x": -3967.9020081980807,
      "y": 266.4837415357457,
      "radius": 90,
      "oreType": "cuprite"
    },
    {
      "x": -230.532198577178,
      "y": 4906.134070366244,
      "radius": 100,
      "oreType": "cuprite"
    },
    {
      "x": 4946.751882517279,
      "y": -2183.409290770324,
      "radius": 80,
      "oreType": "hematite"
    },
    {
      "x": -4756.103328477017,
      "y": 253.752563792744,
      "radius": 50,
      "oreType": "cuprite"
    },
    {
      "x": 2527.888947481063,
      "y": -3707.6179217359327,
      "radius": 80,
      "oreType": "hematite"
    },
    {
      "x": -2217.5798377281053,
      "y": -395.12564934160554,
      "radius": 20,
      "oreType": "aurite"
    },
    {
      "x": -459.22480791917855,
      "y": 2742.719459402421,
      "radius": 80,
      "oreType": "hematite"
    },
    {
      "x": -4404.883703728231,
      "y": 3079.7200910860265,
      "radius": 80,
      "oreType": "cuprite"
    },
    {
      "x": 1441.3093735479542,
      "y": -4079.8573938942486,
      "radius": 90,
      "oreType": "cuprite"
    },
    {
      "x": 1840.8528871180986,
      "y": -3086.188185494723,
      "radius": 50,
      "oreType": "aurite"
    },
    {
      "x": 499.4989427759089,
      "y": -4140.334804165417,
      "radius": 30,
      "oreType": "cuprite"
    },
    {
      "x": 4758.077722660878,
      "y": -4875.918853738719,
      "radius": 40,
      "oreType": "aurite"
    },
    {
      "x": -4039.0043105556583,
      "y": 3730.922992118195,
      "radius": 10,
      "oreType": "aurite"
    },
    {
      "x": -1938.6178229572738,
      "y": 2607.8358377375976,
      "radius": 40,
      "oreType": "hematite"
    },
    {
      "x": 2565.145963861939,
      "y": 646.873214657675,
      "radius": 60,
      "oreType": "aurite"
    },
    {
      "x": -1630.0807695868168,
      "y": -556.8721062950033,
      "radius": 40,
      "oreType": "aurite"
    },
    {
      "x": 4304.278404761581,
      "y": -4897.034001735538,
      "radius": 20,
      "oreType": "cuprite"
    },
    {
      "x": -4585.711058146134,
      "y": 415.7525227425429,
      "radius": 80,
      "oreType": "cuprite"
    },
    {
      "x": 1236.8693059655577,
      "y": 163.8417268625614,
      "radius": 90,
      "oreType": "aurite"
    },
    {
      "x": -4487.5034698009285,
      "y": -1113.6668563167661,
      "radius": 30,
      "oreType": "aurite"
    },
    {
      "x": -824.3914337332736,
      "y": 4263.607492011543,
      "radius": 80,
      "oreType": "hematite"
    },
    {
      "x": -4300.990001209284,
      "y": 2294.588578043668,
      "radius": 70,
      "oreType": "cuprite"
    },
    {
      "x": -4182.67130864558,
      "y": 2154.9128501873183,
      "radius": 50,
      "oreType": "hematite"
    },
    {
      "x": 3496.610188616209,
      "y": 1132.6704009631205,
      "radius": 60,
      "oreType": "aurite"
    },
    {
      "x": -2543.4991432480115,
      "y": -1174.302458624419,
      "radius": 60,
      "oreType": "hematite"
    },
    {
      "x": 4473.029211559206,
      "y": 976.0580140367204,
      "radius": 40,
      "oreType": "aurite"
    },
    {
      "x": 3488.5063809075323,
      "y": 4506.35668306863,
      "radius": 40,
      "oreType": "hematite"
    },
    {
      "x": -1810.5200076735773,
      "y": -3223.461172846782,
      "radius": 60,
      "oreType": "cuprite"
    },
    {
      "x": 2091.8335234427077,
      "y": -2427.264277584478,
      "radius": 80,
      "oreType": "cuprite"
    },
    {
      "x": -2657.572053353088,
      "y": 618.8846701971551,
      "radius": 20,
      "oreType": "cuprite"
    },
    {
      "x": -3019.9538139556225,
      "y": -1559.446559449711,
      "radius": 40,
      "oreType": "cuprite"
    },
    {
      "x": 144.19695384866537,
      "y": -1691.538362876175,
      "radius": 20,
      "oreType": "aurite"
    },
    {
      "x": -2848.136167455462,
      "y": 3992.496994578043,
      "radius": 70,
      "oreType": "cuprite"
    },
    {
      "x": -806.0572062202809,
      "y": 2223.2495908376413,
      "radius": 40,
      "oreType": "cuprite"
    },
    {
      "x": -4683.391957978398,
      "y": 3249.3574322707473,
      "radius": 40,
      "oreType": "hematite"
    },
    {
      "x": 2871.5287551475076,
      "y": -3512.0236279618266,
      "radius": 40,
      "oreType": "aurite"
    },
    {
      "x": 3918.6332373636533,
      "y": -2941.520924747267,
      "radius": 80,
      "oreType": "hematite"
    },
    {
      "x": -2141.1774235771118,
      "y": 2966.577013453964,
      "radius": 30,
      "oreType": "cuprite"
    },
    {
      "x": 2637.753387824511,
      "y": -1507.9920076896735,
      "radius": 70,
      "oreType": "cuprite"
    },
    {
      "x": 3621.034799757028,
      "y": 984.3922429686613,
      "radius": 60,
      "oreType": "aurite"
    },
    {
      "x": 2515.4742016646715,
      "y": -3865.8283133234872,
      "radius": 20,
      "oreType": "aurite"
    },
    {
      "x": -4804.761643052515,
      "y": 1152.1938851369716,
      "radius": 30,
      "oreType": "cuprite"
    },
    {
      "x": -1420.7462580996544,
      "y": 1192.5179714354606,
      "radius": 50,
      "oreType": "cuprite"
    },
    {
      "x": -3234.684394926757,
      "y": 4518.000590475915,
      "radius": 80,
      "oreType": "hematite"
    },
    {
      "x": 200.0676244247668,
      "y": -4093.156823678494,
      "radius": 30,
      "oreType": "hematite"
    },
    {
      "x": 1500.6257926910837,
      "y": 44.446673476823406,
      "radius": 70,
      "oreType": "cuprite"
    },
    {
      "x": -2944.202509487561,
      "y": 3802.1168049931384,
      "radius": 30,
      "oreType": "cuprite"
    },
    {
      "x": -1279.0008366006634,
      "y": -4518.217528652613,
      "radius": 40,
      "oreType": "cuprite"
    },
    {
      "x": 3374.011127159271,
      "y": -3708.7276405721536,
      "radius": 90,
      "oreType": "cuprite"
    },
    {
      "x": 3223.5803524285743,
      "y": -2250.00914547405,
      "radius": 90,
      "oreType": "cuprite"
    },
    {
      "x": -2719.9377295388417,
      "y": -863.0594372365796,
      "radius": 60,
      "oreType": "cuprite"
    },
    {
      "x": 2019.5854113711453,
      "y": 363.8649906360159,
      "radius": 60,
      "oreType": "aurite"
    },
    {
      "x": 2682.8320783640056,
      "y": -1039.7430940663965,
      "radius": 50,
      "oreType": "cuprite"
    },
    {
      "x": 3799.6197515856543,
      "y": -1262.1690203607773,
      "radius": 80,
      "oreType": "hematite"
    },
    {
      "x": 3497.4093931142393,
      "y": -4606.146301717174,
      "radius": 10,
      "oreType": "hematite"
    },
    {
      "x": 1256.1132739568138,
      "y": 4990.930370247984,
      "radius": 50,
      "oreType": "cuprite"
    },
    {
      "x": -4366.97667225958,
      "y": -1596.9761329333498,
      "radius": 90,
      "oreType": "hematite"
    },
    {
      "x": 4479.581037371226,
      "y": -110.9145314540605,
      "radius": 50,
      "oreType": "hematite"
    },
    {
      "x": 3322.031611453591,
      "y": -1819.0428793124825,
      "radius": 30,
      "oreType": "aurite"
    },
    {
      "x": -1457.8299544507067,
      "y": 3200.315828067024,
      "radius": 40,
      "oreType": "cuprite"
    },
    {
      "x": 2028.6674911860957,
      "y": -4047.4927842076136,
      "radius": 40,
      "oreType": "cuprite"
    },
    {
      "x": -4536.258103870845,
      "y": 4814.882383574038,
      "radius": 20,
      "oreType": "hematite"
    },
    {
      "x": -3090.907740185882,
      "y": 452.40415513627454,
      "radius": 30,
      "oreType": "aurite"
    },
    {
      "x": -2055.68959333692,
      "y": -352.88116837788766,
      "radius": 80,
      "oreType": "cuprite"
    },
    {
      "x": -4352.36579189862,
      "y": -2818.997538218899,
      "radius": 40,
      "oreType": "hematite"
    },
    {
      "x": -824.6260463346733,
      "y": -4646.5184125425285,
      "radius": 10,
      "oreType": "aurite"
    },
    {
      "x": 3867.856502318372,
      "y": 3112.947867150506,
      "radius": 50,
      "oreType": "cuprite"
    },
    {
      "x": 2149.384658915894,
      "y": -4346.543688518636,
      "radius": 100,
      "oreType": "hematite"
    },
    {
      "x": -4708.567079680494,
      "y": -3921.9659238496242,
      "radius": 40,
      "oreType": "hematite"
    },
    {
      "x": 3313.146831863725,
      "y": -2543.554964917301,
      "radius": 60,
      "oreType": "hematite"
    },
    {
      "x": -4379.867326426745,
      "y": 2656.1951810805785,
      "radius": 90,
      "oreType": "aurite"
    },
    {
      "x": -1143.5563743285736,
      "y": -1302.2138920571779,
      "radius": 50,
      "oreType": "cuprite"
    },
    {
      "x": 4805.4931047158325,
      "y": -1144.4773923808737,
      "radius": 80,
      "oreType": "hematite"
    },
    {
      "x": 3117.5253658628035,
      "y": 1477.1971607518308,
      "radius": 10,
      "oreType": "hematite"
    },
    {
      "x": -4240.5572845754195,
      "y": -4118.457278915348,
      "radius": 10,
      "oreType": "cuprite"
    },
    {
      "x": 3420.065468879807,
      "y": -4476.566469969476,
      "radius": 30,
      "oreType": "cuprite"
    },
    {
      "x": 576.8956233704037,
      "y": -4552.383584572892,
      "radius": 100,
      "oreType": "cuprite"
    },
    {
      "x": -1940.867144055689,
      "y": -2584.6710691373696,
      "radius": 60,
      "oreType": "cuprite"
    },
    {
      "x": 1320.4452443088455,
      "y": -1197.651607329462,
      "radius": 80,
      "oreType": "cuprite"
    },
    {
      "x": -4760.4696846387,
      "y": 2121.2088514503557,
      "radius": 30,
      "oreType": "cuprite"
    },
    {
      "x": 2973.8231029251438,
      "y": 3680.2926542805703,
      "radius": 50,
      "oreType": "hematite"
    },
    {
      "x": -1371.5855995935856,
      "y": 2125.1170168911426,
      "radius": 30,
      "oreType": "hematite"
    },
    {
      "x": 2122.552984546289,
      "y": 900.0651294513706,
      "radius": 70,
      "oreType": "aurite"
    },
    {
      "x": 4160.8089395858315,
      "y": -167.3873564394812,
      "radius": 40,
      "oreType": "cuprite"
    },
    {
      "x": 4979.261794411163,
      "y": -1415.0839842518837,
      "radius": 50,
      "oreType": "hematite"
    },
    {
      "x": -3822.014502326876,
      "y": -1550.8998047231025,
      "radius": 60,
      "oreType": "hematite"
    },
    {
      "x": 2839.7129146609277,
      "y": 3959.939132573309,
      "radius": 50,
      "oreType": "cuprite"
    },
    {
      "x": 1546.0785518990638,
      "y": -2408.9353046503347,
      "radius": 80,
      "oreType": "cuprite"
    },
    {
      "x": 4274.3875649257525,
      "y": 2656.97139929987,
      "radius": 30,
      "oreType": "hematite"
    },
    {
      "x": 3549.2767164895245,
      "y": -1041.2307060984149,
      "radius": 70,
      "oreType": "cuprite"
    },
    {
      "x": 1692.005512349557,
      "y": 4414.841356418049,
      "radius": 30,
      "oreType": "cuprite"
    },
    {
      "x": -2832.9288702677345,
      "y": -697.8877369845616,
      "radius": 90,
      "oreType": "cuprite"
    },
    {
      "x": 3645.9416064219586,
      "y": 1805.6812860490322,
      "radius": 40,
      "oreType": "aurite"
    },
    {
      "x": 1597.9002265359466,
      "y": -2730.4715198438134,
      "radius": 20,
      "oreType": "cuprite"
    },
    {
      "x": -4282.073617177104,
      "y": 1158.5996066552018,
      "radius": 90,
      "oreType": "aurite"
    },
    {
      "x": 469.55647445800383,
      "y": -1688.8057560016434,
      "radius": 40,
      "oreType": "cuprite"
    },
    {
      "x": -2471.1760542608754,
      "y": 3244.0766257810096,
      "radius": 60,
      "oreType": "cuprite"
    },
    {
      "x": 4783.705756176247,
      "y": 2087.9686655046203,
      "radius": 90,
      "oreType": "hematite"
    },
    {
      "x": -1170.3276209526869,
      "y": 4415.65046121021,
      "radius": 30,
      "oreType": "aurite"
    },
    {
      "x": 4428.397584982365,
      "y": -2591.5716184544444,
      "radius": 10,
      "oreType": "aurite"
    },
    {
      "x": 3235.2497212234766,
      "y": -953.1422875789585,
      "radius": 20,
      "oreType": "aurite"
    },
    {
      "x": -4977.473085177527,
      "y": 2662.3405631120268,
      "radius": 40,
      "oreType": "cuprite"
    },
    {
      "x": 4002.2717360232173,
      "y": 4362.314553783429,
      "radius": 30,
      "oreType": "aurite"
    },
    {
      "x": -4221.896345540013,
      "y": 4001.3815172586533,
      "radius": 20,
      "oreType": "cuprite"
    },
    {
      "x": -3368.069292378857,
      "y": -611.9645907301119,
      "radius": 40,
      "oreType": "hematite"
    },
    {
      "x": -721.6004285130007,
      "y": 3463.0872608337195,
      "radius": 80,
      "oreType": "cuprite"
    },
    {
      "x": 2200.479928575816,
      "y": -3025.704996295877,
      "radius": 10,
      "oreType": "hematite"
    },
    {
      "x": -4115.103260908038,
      "y": -1184.4424639132822,
      "radius": 50,
      "oreType": "cuprite"
    },
    {
      "x": 1632.1404558620368,
      "y": -3636.502799728831,
      "radius": 70,
      "oreType": "hematite"
    },
    {
      "x": 3534.6172500128328,
      "y": -32.53458289126154,
      "radius": 60,
      "oreType": "hematite"
    },
    {
      "x": -4032.27664926167,
      "y": 4156.790181409806,
      "radius": 30,
      "oreType": "cuprite"
    },
    {
      "x": -134.95734214430843,
      "y": -2245.1378587749305,
      "radius": 80,
      "oreType": "cuprite"
    },
    {
      "x": -3223.111364794291,
      "y": -4942.324370209197,
      "radius": 40,
      "oreType": "hematite"
    },
    {
      "x": -1122.912196677579,
      "y": 1626.228123876614,
      "radius": 50,
      "oreType": "cuprite"
    },
    {
      "x": -3953.128706069422,
      "y": 4351.209197151642,
      "radius": 70,
      "oreType": "cuprite"
    },
    {
      "x": -331.35221756304566,
      "y": 4243.437963474797,
      "radius": 90,
      "oreType": "cuprite"
    },
    {
      "x": -1044.588301691789,
      "y": 4191.33291913313,
      "radius": 70,
      "oreType": "cuprite"
    },
    {
      "x": -421.3132951420162,
      "y": 3688.4697600569693,
      "radius": 20,
      "oreType": "cuprite"
    },
    {
      "x": 3900.811450224555,
      "y": 3740.860303426177,
      "radius": 60,
      "oreType": "cuprite"
    },
    {
      "x": 3557.9577953334997,
      "y": 92.7261381985245,
      "radius": 10,
      "oreType": "hematite"
    },
    {
      "x": -1051.9463120679661,
      "y": 258.9711091343072,
      "radius": 90,
      "oreType": "cuprite"
    },
    {
      "x": -2419.174185861104,
      "y": 1058.1024705918485,
      "radius": 20,
      "oreType": "cuprite"
    },
    {
      "x": -2543.2536134375127,
      "y": -2743.559986866726,
      "radius": 70,
      "oreType": "cuprite"
    },
    {
      "x": 4034.1118658376727,
      "y": 3253.9525040510807,
      "radius": 50,
      "oreType": "cuprite"
    },
    {
      "x": -184.94433757263673,
      "y": 3055.604519134014,
      "radius": 20,
      "oreType": "cuprite"
    },
    {
      "x": 720.493328095766,
      "y": -4316.123113034482,
      "radius": 60,
      "oreType": "hematite"
    },
    {
      "x": 831.6583309338022,
      "y": -4118.4675296189125,
      "radius": 50,
      "oreType": "cuprite"
    },
    {
      "x": -1152.2516974053865,
      "y": 1225.3068346184225,
      "radius": 60,
      "oreType": "hematite"
    },
    {
      "x": 1114.2093458619938,
      "y": -519.1058572770136,
      "radius": 50,
      "oreType": "cuprite"
    },
    {
      "x": -125.31736754821665,
      "y": 2963.472463639987,
      "radius": 30,
      "oreType": "hematite"
    },
    {
      "x": -1148.0028582333946,
      "y": -2493.6103489203297,
      "radius": 90,
      "oreType": "cuprite"
    },
    {
      "x": -3518.2540354580483,
      "y": 2305.3470146008694,
      "radius": 80,
      "oreType": "aurite"
    },
    {
      "x": -1661.524427055463,
      "y": -718.7009606388161,
      "radius": 10,
      "oreType": "cuprite"
    },
    {
      "x": 1241.0628833823823,
      "y": 601.4342922473314,
      "radius": 90,
      "oreType": "hematite"
    },
    {
      "x": -1285.9019429263396,
      "y": 3491.772937881927,
      "radius": 60,
      "oreType": "hematite"
    },
    {
      "x": 1161.5950693974253,
      "y": -4407.299637217945,
      "radius": 40,
      "oreType": "hematite"
    },
    {
      "x": -1313.4531377513504,
      "y": -3713.3516826254386,
      "radius": 90,
      "oreType": "aurite"
    },
    {
      "x": -939.731179194967,
      "y": -2874.6846988342136,
      "radius": 90,
      "oreType": "cuprite"
    },
    {
      "x": 3512.08007910252,
      "y": 676.1014369583962,
      "radius": 40,
      "oreType": "hematite"
    },
    {
      "x": 2200.509904071999,
      "y": -3799.4680295338744,
      "radius": 30,
      "oreType": "hematite"
    },
    {
      "x": 2990.415166279763,
      "y": -3100.2888963851683,
      "radius": 50,
      "oreType": "hematite"
    },
    {
      "x": 3514.11063428654,
      "y": -4976.578064958823,
      "radius": 20,
      "oreType": "cuprite"
    },
    {
      "x": 1703.6091903029348,
      "y": -1805.0435694975108,
      "radius": 30,
      "oreType": "cuprite"
    },
    {
      "x": -4978.035610496802,
      "y": 559.3286251166707,
      "radius": 50,
      "oreType": "aurite"
    },
    {
      "x": 4178.39321885082,
      "y": 186.90550054477617,
      "radius": 50,
      "oreType": "cuprite"
    },
    {
      "x": 4653.8552075586285,
      "y": -2427.13976781042,
      "radius": 10,
      "oreType": "hematite"
    },
    {
      "x": -746.7474889984115,
      "y": 2377.66919201017,
      "radius": 20,
      "oreType": "hematite"
    },
    {
      "x": -1347.1401125500627,
      "y": 773.2504069890211,
      "radius": 10,
      "oreType": "cuprite"
    },
    {
      "x": 1064.558347953628,
      "y": 3816.0849348297775,
      "radius": 20,
      "oreType": "cuprite"
    },
    {
      "x": -254.86420996639225,
      "y": 2269.1318858763543,
      "radius": 40,
      "oreType": "cuprite"
    },
    {
      "x": -4513.450770511591,
      "y": -2472.8118216915072,
      "radius": 40,
      "oreType": "hematite"
    },
    {
      "x": 3142.391654429537,
      "y": -870.1275460747238,
      "radius": 80,
      "oreType": "cuprite"
    },
    {
      "x": -2116.8988126160125,
      "y": 63.18524116007529,
      "radius": 100,
      "oreType": "cuprite"
    },
    {
      "x": 2125.7787087839074,
      "y": -4118.520144852427,
      "radius": 60,
      "oreType": "hematite"
    },
    {
      "x": 2906.658379167946,
      "y": -263.11132516996014,
      "radius": 80,
      "oreType": "aurite"
    },
    {
      "x": -4454.40612690531,
      "y": 611.7801435613934,
      "radius": 60,
      "oreType": "hematite"
    },
    {
      "x": 574.8636279158869,
      "y": -1664.7859665491228,
      "radius": 10,
      "oreType": "cuprite"
    },
    {
      "x": 1757.380665852113,
      "y": 4677.293549272495,
      "radius": 30,
      "oreType": "aurite"
    },
    {
      "x": 2919.7765317411627,
      "y": -1402.219003838192,
      "radius": 100,
      "oreType": "cuprite"
    },
    {
      "x": -3004.054339015101,
      "y": 743.2209879464824,
      "radius": 50,
      "oreType": "aurite"
    },
    {
      "x": 1350.0155874290986,
      "y": 4198.025025746714,
      "radius": 40,
      "oreType": "hematite"
    },
    {
      "x": 3858.0155859480956,
      "y": -4101.434561985813,
      "radius": 20,
      "oreType": "cuprite"
    },
    {
      "x": -2634.394255910486,
      "y": -609.4605199593594,
      "radius": 30,
      "oreType": "cuprite"
    },
    {
      "x": 2974.514689200829,
      "y": -2943.613704814003,
      "radius": 40,
      "oreType": "cuprite"
    },
    {
      "x": 1643.878937173011,
      "y": -2975.6332664986608,
      "radius": 50,
      "oreType": "cuprite"
    },
    {
      "x": 1080.7928465616644,
      "y": -3803.2821901780476,
      "radius": 20,
      "oreType": "cuprite"
    },
    {
      "x": -969.8457925274217,
      "y": 3031.18531732395,
      "radius": 60,
      "oreType": "cuprite"
    },
    {
      "x": 2707.8251641731167,
      "y": -585.9690826864372,
      "radius": 20,
      "oreType": "cuprite"
    },
    {
      "x": 2376.2942492932602,
      "y": 3734.396060688554,
      "radius": 10,
      "oreType": "aurite"
    },
    {
      "x": -728.3752549106049,
      "y": -3173.482318059917,
      "radius": 80,
      "oreType": "cuprite"
    },
    {
      "x": 3511.9050382310625,
      "y": -3443.4073198041483,
      "radius": 40,
      "oreType": "aurite"
    },
    {
      "x": -1284.1010715070488,
      "y": 2627.146744553965,
      "radius": 60,
      "oreType": "hematite"
    },
    {
      "x": -3333.550630811146,
      "y": 1722.2704457186544,
      "radius": 30,
      "oreType": "cuprite"
    },
    {
      "x": 4303.50254881052,
      "y": -603.5764311055281,
      "radius": 20,
      "oreType": "cuprite"
    },
    {
      "x": 1930.9960156542006,
      "y": -3115.523045046007,
      "radius": 10,
      "oreType": "hematite"
    },
    {
      "x": -2490.59220611358,
      "y": 323.18278510922613,
      "radius": 30,
      "oreType": "cuprite"
    },
    {
      "x": -1705.0488130683216,
      "y": -236.824325321241,
      "radius": 40,
      "oreType": "cuprite"
    },
    {
      "x": 2373.8956257758946,
      "y": -4169.407534567497,
      "radius": 60,
      "oreType": "cuprite"
    },
    {
      "x": -1694.2515271939994,
      "y": 1303.2424038535062,
      "radius": 10,
      "oreType": "cuprite"
    },
    {
      "x": 1030.763372047465,
      "y": 4273.455220349442,
      "radius": 10,
      "oreType": "aurite"
    },
    {
      "x": -4364.308872088121,
      "y": -89.72896863156609,
      "radius": 90,
      "oreType": "hematite"
    },
    {
      "x": 3667.231508002986,
      "y": 3529.1621202910674,
      "radius": 40,
      "oreType": "hematite"
    },
    {
      "x": -1407.4505920648096,
      "y": -38.54967401293541,
      "radius": 30,
      "oreType": "cuprite"
    },
    {
      "x": -1465.0685672747609,
      "y": -4971.929408529661,
      "radius": 90,
      "oreType": "cuprite"
    },
    {
      "x": -2274.3109024485466,
      "y": -1603.471985248952,
      "radius": 20,
      "oreType": "cuprite"
    },
    {
      "x": 414.13170261023646,
      "y": -4678.957713456591,
      "radius": 50,
      "oreType": "aurite"
    },
    {
      "x": 3207.0128536924103,
      "y": 1321.9590044368347,
      "radius": 30,
      "oreType": "hematite"
    },
    {
      "x": -2095.466120758436,
      "y": 1061.7909420342153,
      "radius": 60,
      "oreType": "aurite"
    },
    {
      "x": 778.8370441782599,
      "y": -525.6507269562927,
      "radius": 90,
      "oreType": "cuprite"
    },
    {
      "x": 615.0368930053496,
      "y": 1722.6578868846066,
      "radius": 60,
      "oreType": "cuprite"
    },
    {
      "x": -2891.0186641813552,
      "y": 176.46403795423817,
      "radius": 70,
      "oreType": "aurite"
    },
    {
      "x": -4183.330202943232,
      "y": 3495.8541565976197,
      "radius": 90,
      "oreType": "cuprite"
    },
    {
      "x": -3102.0202082618553,
      "y": 4154.350532815525,
      "radius": 20,
      "oreType": "cuprite"
    },
    {
      "x": -2834.1164583913846,
      "y": 3017.8573352703665,
      "radius": 20,
      "oreType": "hematite"
    },
    {
      "x": 859.4268152692108,
      "y": -3955.8886816422746,
      "radius": 50,
      "oreType": "hematite"
    },
    {
      "x": -2045.6422099934102,
      "y": 2909.8728754908598,
      "radius": 40,
      "oreType": "hematite"
    },
    {
      "x": -2741.224910855171,
      "y": 1345.2543458186783,
      "radius": 60,
      "oreType": "cuprite"
    },
    {
      "x": 2971.457719980881,
      "y": 4032.3234748402847,
      "radius": 20,
      "oreType": "cuprite"
    },
    {
      "x": 4149.7317581201405,
      "y": 1384.3029884102398,
      "radius": 70,
      "oreType": "cuprite"
    },
    {
      "x": 3180.335795497373,
      "y": -3144.01077319304,
      "radius": 50,
      "oreType": "cuprite"
    },
    {
      "x": 1368.5008622634953,
      "y": -4821.713146000244,
      "radius": 60,
      "oreType": "hematite"
    },
    {
      "x": -4874.434256321157,
      "y": -542.8506940067579,
      "radius": 80,
      "oreType": "hematite"
    },
    {
      "x": 3708.8802982432444,
      "y": -88.61290923639187,
      "radius": 30,
      "oreType": "cuprite"
    },
    {
      "x": 4099.665610225538,
      "y": -3400.817302857415,
      "radius": 100,
      "oreType": "cuprite"
    },
    {
      "x": -3372.5122055911115,
      "y": -1488.6008620984148,
      "radius": 10,
      "oreType": "cuprite"
    },
    {
      "x": -4988.139378624554,
      "y": -1596.8736122158723,
      "radius": 30,
      "oreType": "cuprite"
    },
    {
      "x": -702.2863731750296,
      "y": -4816.745165219585,
      "radius": 70,
      "oreType": "cuprite"
    },
    {
      "x": 3411.87624533815,
      "y": 4964.424857530849,
      "radius": 40,
      "oreType": "cuprite"
    },
    {
      "x": -4331.7189353156045,
      "y": -1385.7431628539962,
      "radius": 70,
      "oreType": "hematite"
    },
    {
      "x": -614.3879395038088,
      "y": 4310.602350105286,
      "radius": 80,
      "oreType": "hematite"
    },
    {
      "x": 2897.3791140380636,
      "y": 1219.6742203950416,
      "radius": 20,
      "oreType": "cuprite"
    },
    {
      "x": -4006.4356870110387,
      "y": 1090.650471208734,
      "radius": 20,
      "oreType": "cuprite"
    },
    {
      "x": 140.20670191299934,
      "y": -645.8059877831101,
      "radius": 10,
      "oreType": "cuprite"
    },
    {
      "x": 4386.890653874214,
      "y": -2708.9707107673335,
      "radius": 20,
      "oreType": "hematite"
    },
    {
      "x": -3284.335352483003,
      "y": 1584.5347517294672,
      "radius": 40,
      "oreType": "cuprite"
    },
    {
      "x": -3939.3003139851967,
      "y": -4443.242288749459,
      "radius": 90,
      "oreType": "aurite"
    },
    {
      "x": 4684.5721518742375,
      "y": 2910.2979002917605,
      "radius": 50,
      "oreType": "hematite"
    },
    {
      "x": 3441.0470535092454,
      "y": -2230.283788021239,
      "radius": 40,
      "oreType": "hematite"
    },
    {
      "x": 1478.4996406905736,
      "y": 2689.1266139898385,
      "radius": 40,
      "oreType": "cuprite"
    },
    {
      "x": -491.28028714376717,
      "y": -4518.526187807548,
      "radius": 20,
      "oreType": "hematite"
    },
    {
      "x": 1409.56765336395,
      "y": -2906.770564849479,
      "radius": 40,
      "oreType": "aurite"
    },
    {
      "x": -3950.9836067767146,
      "y": -690.8231928289842,
      "radius": 30,
      "oreType": "cuprite"
    },
    {
      "x": -2490.919479237048,
      "y": 4864.820876951597,
      "radius": 20,
      "oreType": "cuprite"
    },
    {
      "x": -4292.828690332971,
      "y": -4405.2336090601775,
      "radius": 80,
      "oreType": "hematite"
    },
    {
      "x": -4133.289532922108,
      "y": 3037.3395658759537,
      "radius": 30,
      "oreType": "cuprite"
    },
    {
      "x": 3331.5140164775435,
      "y": -1629.4686922087908,
      "radius": 90,
      "oreType": "aurite"
    },
    {
      "x": -4901.855930909837,
      "y": 1601.700141245732,
      "radius": 90,
      "oreType": "cuprite"
    },
    {
      "x": -1565.0987700846274,
      "y": 441.40764831313237,
      "radius": 100,
      "oreType": "cuprite"
    },
    {
      "x": -2417.758701585533,
      "y": 4425.405316100019,
      "radius": 40,
      "oreType": "aurite"
    },
    {
      "x": -1582.9088993213159,
      "y": 3405.609576911073,
      "radius": 40,
      "oreType": "aurite"
    },
    {
      "x": -3541.760760417827,
      "y": 4450.667908078165,
      "radius": 80,
      "oreType": "aurite"
    },
    {
      "x": 3859.089439791612,
      "y": -2640.061156045621,
      "radius": 50,
      "oreType": "cuprite"
    },
    {
      "x": 4244.519530124074,
      "y": -3696.669795307603,
      "radius": 30,
      "oreType": "hematite"
    },
    {
      "x": 698.6071959296769,
      "y": 4734.859393289106,
      "radius": 80,
      "oreType": "hematite"
    },
    {
      "x": -4274.682650964459,
      "y": 4708.308536563725,
      "radius": 80,
      "oreType": "hematite"
    },
    {
      "x": 3108.5165631295754,
      "y": 4899.526764972784,
      "radius": 40,
      "oreType": "cuprite"
    },
    {
      "x": 4037.7740462705015,
      "y": 3648.092368778546,
      "radius": 40,
      "oreType": "cuprite"
    },
    {
      "x": -1228.5980900857928,
      "y": 2208.2147659199113,
      "radius": 90,
      "oreType": "hematite"
    },
    {
      "x": -4148.2897228776965,
      "y": 1662.9971269505672,
      "radius": 60,
      "oreType": "cuprite"
    },
    {
      "x": -976.1990190888125,
      "y": -2682.9134847224245,
      "radius": 30,
      "oreType": "cuprite"
    },
    {
      "x": 951.9989494816583,
      "y": -4436.528658077809,
      "radius": 60,
      "oreType": "hematite"
    },
    {
      "x": -2056.0788715022873,
      "y": -2914.574507721961,
      "radius": 60,
      "oreType": "cuprite"
    },
    {
      "x": 2353.958688467963,
      "y": 300.4258187611053,
      "radius": 80,
      "oreType": "cuprite"
    },
    {
      "x": -462.22872094134226,
      "y": 4771.292325133043,
      "radius": 70,
      "oreType": "cuprite"
    },
    {
      "x": -4612.089392894399,
      "y": 4522.255976754912,
      "radius": 80,
      "oreType": "aurite"
    },
    {
      "x": 4388.174688516567,
      "y": -2396.7516088621796,
      "radius": 60,
      "oreType": "aurite"
    },
    {
      "x": 4813.105520221977,
      "y": 4465.981606308717,
      "radius": 10,
      "oreType": "cuprite"
    },
    {
      "x": -2127.9370530488186,
      "y": -2532.503376957542,
      "radius": 60,
      "oreType": "hematite"
    },
    {
      "x": -668.2131157109983,
      "y": 2732.485798964186,
      "radius": 40,
      "oreType": "cuprite"
    },
    {
      "x": -2678.3986692166595,
      "y": 256.96105994300166,
      "radius": 80,
      "oreType": "cuprite"
    },
    {
      "x": -3107.659844235071,
      "y": -2014.7508848913808,
      "radius": 30,
      "oreType": "aurite"
    },
    {
      "x": 3678.1791215952067,
      "y": -4723.526238977587,
      "radius": 40,
      "oreType": "cuprite"
    },
    {
      "x": 970.9593587573618,
      "y": -1830.5650693805387,
      "radius": 70,
      "oreType": "hematite"
    },
    {
      "x": -4557.792531046303,
      "y": -2799.4764216206613,
      "radius": 80,
      "oreType": "aurite"
    },
    {
      "x": 4492.659542799577,
      "y": -4171.146335285632,
      "radius": 90,
      "oreType": "cuprite"
    },
    {
      "x": -4680.678198860913,
      "y": -39.661976168563484,
      "radius": 30,
      "oreType": "cuprite"
    },
    {
      "x": 924.4108714339561,
      "y": -3227.775112576232,
      "radius": 60,
      "oreType": "cuprite"
    },
    {
      "x": 3286.2458678964003,
      "y": 2178.3351116346307,
      "radius": 20,
      "oreType": "hematite"
    },
    {
      "x": 2701.0683456866436,
      "y": 4445.168434285407,
      "radius": 90,
      "oreType": "cuprite"
    },
    {
      "x": 1404.35133374615,
      "y": -4520.595261029901,
      "radius": 90,
      "oreType": "aurite"
    },
    {
      "x": 3065.7873338528207,
      "y": -4877.544475096746,
      "radius": 70,
      "oreType": "hematite"
    },
    {
      "x": -4218.980034575637,
      "y": -3594.13801748558,
      "radius": 30,
      "oreType": "aurite"
    },
    {
      "x": -639.9790349157408,
      "y": 518.7869835065006,
      "radius": 30,
      "oreType": "hematite"
    },
    {
      "x": 2663.328902346982,
      "y": 3823.166593029901,
      "radius": 70,
      "oreType": "cuprite"
    },
    {
      "x": 92.15376048312463,
      "y": 4241.573087048531,
      "radius": 80,
      "oreType": "cuprite"
    },
    {
      "x": 4072.2514164058034,
      "y": 4933.166895427213,
      "radius": 50,
      "oreType": "cuprite"
    },
    {
      "x": -4310.184498300553,
      "y": 1702.710099890945,
      "radius": 30,
      "oreType": "hematite"
    },
    {
      "x": 3979.9803478069175,
      "y": 2019.0000082793147,
      "radius": 40,
      "oreType": "hematite"
    },
    {
      "x": 1583.797239552207,
      "y": 1259.8533615370156,
      "radius": 100,
      "oreType": "hematite"
    },
    {
      "x": 3110.947272746727,
      "y": -2746.2607825800187,
      "radius": 80,
      "oreType": "aurite"
    },
    {
      "x": 4228.7760586020795,
      "y": -447.6795067764439,
      "radius": 60,
      "oreType": "cuprite"
    },
    {
      "x": 4481.375459356765,
      "y": -1608.1293594122071,
      "radius": 70,
      "oreType": "cuprite"
    },
    {
      "x": -2056.6573371520412,
      "y": 4980.684019268622,
      "radius": 60,
      "oreType": "cuprite"
    },
    {
      "x": -4507.012488710902,
      "y": 2281.704978027297,
      "radius": 80,
      "oreType": "cuprite"
    },
    {
      "x": 3353.735682729295,
      "y": -1928.7969056167253,
      "radius": 40,
      "oreType": "cuprite"
    },
    {
      "x": 2308.5612560706536,
      "y": -4773.841089591248,
      "radius": 60,
      "oreType": "aurite"
    },
    {
      "x": 473.43372953214225,
      "y": 4862.7478101149045,
      "radius": 50,
      "oreType": "cuprite"
    },
    {
      "x": -4378.948982016655,
      "y": -3748.8430004015895,
      "radius": 80,
      "oreType": "cuprite"
    },
    {
      "x": 3257.7965582811853,
      "y": 14.215226528726532,
      "radius": 70,
      "oreType": "aurite"
    },
    {
      "x": 3062.7449607084413,
      "y": -3859.0764748344573,
      "radius": 20,
      "oreType": "cuprite"
    },
    {
      "x": -472.7625433576588,
      "y": -4342.683266225576,
      "radius": 90,
      "oreType": "cuprite"
    },
    {
      "x": -3364.8627629449356,
      "y": 4338.779112390321,
      "radius": 60,
      "oreType": "hematite"
    },
    {
      "x": 4962.817351146098,
      "y": -4842.773227220297,
      "radius": 80,
      "oreType": "hematite"
    },
    {
      "x": 4181.947081331712,
      "y": -3873.5000474722224,
      "radius": 50,
      "oreType": "hematite"
    },
    {
      "x": -3774.4822633826348,
      "y": -677.3899464442223,
      "radius": 10,
      "oreType": "hematite"
    },
    {
      "x": 540.0145605644036,
      "y": 2013.451737893166,
      "radius": 100,
      "oreType": "cuprite"
    },
    {
      "x": -2890.0003836044075,
      "y": -347.08324566564255,
      "radius": 100,
      "oreType": "cuprite"
    },
    {
      "x": -1797.8740106996006,
      "y": 297.1381013752339,
      "radius": 70,
      "oreType": "hematite"
    },
    {
      "x": -4978.2775679806,
      "y": 1341.3811634106087,
      "radius": 40,
      "oreType": "cuprite"
    },
    {
      "x": 2874.948549116567,
      "y": 1362.1572818736126,
      "radius": 80,
      "oreType": "aurite"
    },
    {
      "x": 955.6108837577759,
      "y": 610.7781070026697,
      "radius": 70,
      "oreType": "aurite"
    },
    {
      "x": 1033.059268440444,
      "y": -2483.657550657552,
      "radius": 70,
      "oreType": "aurite"
    },
    {
      "x": -4607.090564738994,
      "y": -3434.9664356585176,
      "radius": 80,
      "oreType": "cuprite"
    },
    {
      "x": -4787.586182150738,
      "y": 2960.6719666836902,
      "radius": 60,
      "oreType": "aurite"
    },
    {
      "x": 579.0944523918795,
      "y": -4784.196314437657,
      "radius": 40,
      "oreType": "aurite"
    },
    {
      "x": -1297.3334574135342,
      "y": -4322.394579447797,
      "radius": 90,
      "oreType": "cuprite"
    },
    {
      "x": 4991.0846951957665,
      "y": -3732.833260922612,
      "radius": 50,
      "oreType": "cuprite"
    },
    {
      "x": 3830.061921795398,
      "y": -4906.039640691156,
      "radius": 40,
      "oreType": "aurite"
    },
    {
      "x": 1016.3486979704617,
      "y": -4102.791149853824,
      "radius": 60,
      "oreType": "hematite"
    },
    {
      "x": 2844.6649288709837,
      "y": -3167.749330834373,
      "radius": 30,
      "oreType": "aurite"
    },
    {
      "x": 1533.8613786891165,
      "y": -4253.936433175216,
      "radius": 20,
      "oreType": "hematite"
    },
    {
      "x": 2856.0683575004655,
      "y": -2825.6326379426832,
      "radius": 90,
      "oreType": "hematite"
    },
    {
      "x": 3971.471774747053,
      "y": 2685.021044243521,
      "radius": 50,
      "oreType": "cuprite"
    },
    {
      "x": 781.2544252427545,
      "y": -3293.360497281277,
      "radius": 20,
      "oreType": "cuprite"
    },
    {
      "x": -2523.0738328766633,
      "y": -2117.5038056629523,
      "radius": 40,
      "oreType": "aurite"
    },
    {
      "x": -4199.369290358901,
      "y": -989.7630881764496,
      "radius": 50,
      "oreType": "hematite"
    },
    {
      "x": 3784.1588586495354,
      "y": 2133.8392738179878,
      "radius": 30,
      "oreType": "cuprite"
    },
    {
      "x": -488.6754672297555,
      "y": 67.74183476584206,
      "radius": 70,
      "oreType": "hematite"
    },
    {
      "x": -4006.636834506172,
      "y": -3385.0605712711413,
      "radius": 50,
      "oreType": "cuprite"
    },
    {
      "x": -3951.9035604381347,
      "y": 4641.742239394366,
      "radius": 90,
      "oreType": "cuprite"
    },
    {
      "x": 3000.9140278760183,
      "y": -619.7813438919453,
      "radius": 30,
      "oreType": "aurite"
    },
    {
      "x": 1339.8545625152235,
      "y": -3679.669595932509,
      "radius": 40,
      "oreType": "hematite"
    },
    {
      "x": 2064.0366735280622,
      "y": 2903.633005762891,
      "radius": 40,
      "oreType": "hematite"
    },
    {
      "x": -1544.5821051731778,
      "y": 3705.787805978793,
      "radius": 50,
      "oreType": "aurite"
    },
    {
      "x": 2444.3139589263697,
      "y": 4317.147426392145,
      "radius": 30,
      "oreType": "cuprite"
    },
    {
      "x": 1404.7393057589286,
      "y": 2229.677626672402,
      "radius": 60,
      "oreType": "cuprite"
    },
    {
      "x": 3080.96467909891,
      "y": 731.0682191350693,
      "radius": 80,
      "oreType": "hematite"
    },
    {
      "x": -4479.422276417964,
      "y": 1908.060541765022,
      "radius": 100,
      "oreType": "cuprite"
    },
    {
      "x": -749.0575930408183,
      "y": 1670.1923360867288,
      "radius": 60,
      "oreType": "aurite"
    },
    {
      "x": -1885.2365844991016,
      "y": -3839.106451091283,
      "radius": 50,
      "oreType": "hematite"
    },
    {
      "x": -980.5122496270901,
      "y": -452.5677629376967,
      "radius": 30,
      "oreType": "cuprite"
    },
    {
      "x": -1248.6835268500363,
      "y": 626.598543810355,
      "radius": 70,
      "oreType": "cuprite"
    },
    {
      "x": 973.0245065146903,
      "y": -3603.3897748784248,
      "radius": 30,
      "oreType": "hematite"
    },
    {
      "x": -4114.235528004022,
      "y": 2576.266466998327,
      "radius": 10,
      "oreType": "cuprite"
    },
    {
      "x": -3357.9703186690367,
      "y": 2929.416396121807,
      "radius": 80,
      "oreType": "aurite"
    },
    {
      "x": -4604.007815050979,
      "y": 2826.4300964707513,
      "radius": 100,
      "oreType": "cuprite"
    },
    {
      "x": 951.5920260893384,
      "y": -4977.39702436993,
      "radius": 20,
      "oreType": "cuprite"
    },
    {
      "x": 1897.757865552241,
      "y": -3189.514140517269,
      "radius": 20,
      "oreType": "aurite"
    },
    {
      "x": 1921.767898166711,
      "y": 4216.847821288327,
      "radius": 60,
      "oreType": "cuprite"
    },
    {
      "x": -2814.850902368844,
      "y": 4421.781962185687,
      "radius": 10,
      "oreType": "aurite"
    },
    {
      "x": -729.1833297961658,
      "y": 3855.7557244573013,
      "radius": 70,
      "oreType": "cuprite"
    },
    {
      "x": -1208.4800439036703,
      "y": 1061.0155350814198,
      "radius": 80,
      "oreType": "cuprite"
    },
    {
      "x": -3016.4089716360377,
      "y": -2123.49378232813,
      "radius": 10,
      "oreType": "cuprite"
    },
    {
      "x": 3321.8189055308976,
      "y": -3242.5302111559627,
      "radius": 10,
      "oreType": "hematite"
    },
    {
      "x": -3975.670654607051,
      "y": 2787.4282985803457,
      "radius": 100,
      "oreType": "cuprite"
    },
    {
      "x": 4295.443852187848,
      "y": -3925.399040979731,
      "radius": 30,
      "oreType": "hematite"
    },
    {
      "x": -311.57972419857407,
      "y": 2907.391813493163,
      "radius": 30,
      "oreType": "hematite"
    },
    {
      "x": 4798.041724114765,
      "y": -1460.69284574758,
      "radius": 30,
      "oreType": "cuprite"
    },
    {
      "x": 2143.554309716702,
      "y": -3211.7275431624616,
      "radius": 70,
      "oreType": "cuprite"
    },
    {
      "x": -3227.106683793677,
      "y": -974.6368224668878,
      "radius": 90,
      "oreType": "cuprite"
    },
    {
      "x": 1243.8634678754522,
      "y": -1692.5280864103365,
      "radius": 20,
      "oreType": "cuprite"
    },
    {
      "x": 1268.2547313195669,
      "y": 3864.6292103439528,
      "radius": 40,
      "oreType": "cuprite"
    },
    {
      "x": -3811.1443092133413,
      "y": 1972.6505019204233,
      "radius": 80,
      "oreType": "hematite"
    },
    {
      "x": 1455.805109149828,
      "y": 2868.3217619711754,
      "radius": 70,
      "oreType": "cuprite"
    },
    {
      "x": -3349.3209687524895,
      "y": 2313.71283138573,
      "radius": 60,
      "oreType": "aurite"
    },
    {
      "x": 1584.1375172687444,
      "y": 3430.5805096269282,
      "radius": 60,
      "oreType": "cuprite"
    },
    {
      "x": -4251.744760415757,
      "y": 3315.062722693829,
      "radius": 70,
      "oreType": "hematite"
    },
    {
      "x": -3435.4386217431497,
      "y": -4081.578762198137,
      "radius": 40,
      "oreType": "hematite"
    },
    {
      "x": 776.2852767701345,
      "y": 664.7438487307467,
      "radius": 50,
      "oreType": "hematite"
    },
    {
      "x": 4423.290801859263,
      "y": 646.7505209066027,
      "radius": 40,
      "oreType": "hematite"
    },
    {
      "x": -2190.564713148735,
      "y": -2123.0917611293476,
      "radius": 30,
      "oreType": "cuprite"
    },
    {
      "x": -3855.348739361968,
      "y": 3177.821221129249,
      "radius": 30,
      "oreType": "cuprite"
    },
    {
      "x": -171.79094154034402,
      "y": -4113.129348073044,
      "radius": 80,
      "oreType": "cuprite"
    },
    {
      "x": -2580.9815296615902,
      "y": -2870.807404891922,
      "radius": 20,
      "oreType": "cuprite"
    },
    {
      "x": -3715.3251221479345,
      "y": -4691.9721714363695,
      "radius": 50,
      "oreType": "cuprite"
    },
    {
      "x": 3401.865809391997,
      "y": 2704.018875175238,
      "radius": 70,
      "oreType": "hematite"
    },
    {
      "x": 3095.7836358907985,
      "y": -4348.3138737893005,
      "radius": 60,
      "oreType": "cuprite"
    },
    {
      "x": -1411.1589170609063,
      "y": 1503.957806368188,
      "radius": 20,
      "oreType": "hematite"
    },
    {
      "x": 4713.889740059815,
      "y": 1404.9018607274345,
      "radius": 80,
      "oreType": "hematite"
    },
    {
      "x": -1943.7536995836258,
      "y": -2303.8760389442923,
      "radius": 10,
      "oreType": "cuprite"
    },
    {
      "x": -2950.959174628911,
      "y": -1953.2003558266786,
      "radius": 70,
      "oreType": "hematite"
    },
    {
      "x": 2560.967024336285,
      "y": 4300.749434374569,
      "radius": 60,
      "oreType": "cuprite"
    },
    {
      "x": 2975.166090924939,
      "y": 126.79676105824544,
      "radius": 20,
      "oreType": "cuprite"
    },
    {
      "x": 3791.2660414338716,
      "y": 2515.686191443924,
      "radius": 100,
      "oreType": "cuprite"
    },
    {
      "x": 3431.934655832678,
      "y": 45.14105277829028,
      "radius": 40,
      "oreType": "aurite"
    },
    {
      "x": 3123.934829232513,
      "y": 1742.8344660865646,
      "radius": 40,
      "oreType": "aurite"
    },
    {
      "x": 131.04730916992935,
      "y": -2183.2120034168056,
      "radius": 90,
      "oreType": "hematite"
    },
    {
      "x": 2810.8879649741116,
      "y": -4762.923299675898,
      "radius": 50,
      "oreType": "aurite"
    },
    {
      "x": -4391.514380039663,
      "y": 2128.384577660696,
      "radius": 70,
      "oreType": "cuprite"
    },
    {
      "x": 3588.8506453105706,
      "y": -4033.60526166189,
      "radius": 90,
      "oreType": "hematite"
    },
    {
      "x": 2718.149020391707,
      "y": -2467.3649577154433,
      "radius": 80,
      "oreType": "cuprite"
    },
    {
      "x": -3933.5550965913344,
      "y": 4045.1265083592334,
      "radius": 40,
      "oreType": "hematite"
    },
    {
      "x": 3120.5370726433525,
      "y": 552.5753892125751,
      "radius": 70,
      "oreType": "cuprite"
    },
    {
      "x": 2541.712545506336,
      "y": 3102.830120079052,
      "radius": 50,
      "oreType": "cuprite"
    },
    {
      "x": 2502.0800508666975,
      "y": 4791.4055602774,
      "radius": 30,
      "oreType": "cuprite"
    },
    {
      "x": 3225.410659089327,
      "y": -3834.995256837257,
      "radius": 30,
      "oreType": "cuprite"
    },
    {
      "x": -1054.1106208097563,
      "y": -2267.477937660112,
      "radius": 30,
      "oreType": "cuprite"
    },
    {
      "x": -3717.691701402139,
      "y": 741.2380201889457,
      "radius": 80,
      "oreType": "cuprite"
    },
    {
      "x": -1965.3852798201465,
      "y": -2405.8628327658594,
      "radius": 40,
      "oreType": "cuprite"
    },
    {
      "x": -4230.935343216848,
      "y": 135.68398023839688,
      "radius": 10,
      "oreType": "hematite"
    },
    {
      "x": 1579.9073910157113,
      "y": 4548.525355127733,
      "radius": 40,
      "oreType": "cuprite"
    },
    {
      "x": 3778.226161977971,
      "y": 4954.458998194004,
      "radius": 40,
      "oreType": "aurite"
    },
    {
      "x": -825.0083786130125,
      "y": 800.5592186441057,
      "radius": 20,
      "oreType": "cuprite"
    },
    {
      "x": 4807.539424004812,
      "y": -4151.748411496976,
      "radius": 90,
      "oreType": "cuprite"
    },
    {
      "x": -677.8163766259393,
      "y": 4748.948594286601,
      "radius": 80,
      "oreType": "cuprite"
    },
    {
      "x": -4534.919523905969,
      "y": 4398.235012467227,
      "radius": 40,
      "oreType": "aurite"
    },
    {
      "x": -4813.877123811545,
      "y": -4548.280445114812,
      "radius": 60,
      "oreType": "aurite"
    },
    {
      "x": 2489.179778089199,
      "y": -3511.5775064693257,
      "radius": 20,
      "oreType": "hematite"
    },
    {
      "x": -898.0884393341704,
      "y": -3896.029120126916,
      "radius": 40,
      "oreType": "hematite"
    },
    {
      "x": 2166.9701628410867,
      "y": 3738.133700997881,
      "radius": 100,
      "oreType": "cuprite"
    },
    {
      "x": -3905.8459073722006,
      "y": 1353.2750767908674,
      "radius": 40,
      "oreType": "aurite"
    },
    {
      "x": -426.27360629094557,
      "y": -2167.6811196011213,
      "radius": 40,
      "oreType": "cuprite"
    },
    {
      "x": 3442.6475485363617,
      "y": -3040.655131415091,
      "radius": 20,
      "oreType": "hematite"
    },
    {
      "x": 3238.883065061937,
      "y": 2537.1379582140976,
      "radius": 30,
      "oreType": "cuprite"
    },
    {
      "x": -4588.941968818112,
      "y": -3698.345806193304,
      "radius": 50,
      "oreType": "hematite"
    },
    {
      "x": 3872.943324808431,
      "y": 1629.445020013427,
      "radius": 30,
      "oreType": "cuprite"
    },
    {
      "x": -3586.782091043754,
      "y": 2629.061687403651,
      "radius": 70,
      "oreType": "cuprite"
    },
    {
      "x": -3720.834249935796,
      "y": 83.32074882347884,
      "radius": 80,
      "oreType": "cuprite"
    },
    {
      "x": -3024.1315336034068,
      "y": 3504.2786520635173,
      "radius": 60,
      "oreType": "hematite"
    },
    {
      "x": 3387.9443546135126,
      "y": -712.8949373592386,
      "radius": 60,
      "oreType": "aurite"
    },
    {
      "x": 2816.7599821906465,
      "y": -814.6745771077657,
      "radius": 60,
      "oreType": "cuprite"
    },
    {
      "x": 1238.3701865594833,
      "y": -2883.7101782613204,
      "radius": 100,
      "oreType": "hematite"
    },
    {
      "x": -4697.268743182541,
      "y": 3954.7579962414025,
      "radius": 70,
      "oreType": "cuprite"
    },
    {
      "x": 3399.8394050547076,
      "y": 3491.5011208936185,
      "radius": 50,
      "oreType": "cuprite"
    },
    {
      "x": -1807.4058103263746,
      "y": 3915.1877466378805,
      "radius": 90,
      "oreType": "cuprite"
    },
    {
      "x": -4393.787403096554,
      "y": -4924.937331936834,
      "radius": 60,
      "oreType": "cuprite"
    },
    {
      "x": -4172.839469805791,
      "y": 4136.2487301249275,
      "radius": 50,
      "oreType": "hematite"
    },
    {
      "x": 3641.615173381341,
      "y": 535.9481212065309,
      "radius": 70,
      "oreType": "cuprite"
    },
    {
      "x": -3114.2237931808213,
      "y": 2659.2817387187774,
      "radius": 20,
      "oreType": "cuprite"
    },
    {
      "x": -4386.92154540062,
      "y": -3339.7542412977386,
      "radius": 60,
      "oreType": "cuprite"
    },
    {
      "x": 4082.5180726156905,
      "y": 2776.1711907109275,
      "radius": 40,
      "oreType": "aurite"
    },
    {
      "x": -1797.7607439724675,
      "y": 1718.4531986048034,
      "radius": 60,
      "oreType": "aurite"
    },
    {
      "x": -4045.7828069920197,
      "y": -1267.1771943177323,
      "radius": 40,
      "oreType": "aurite"
    },
    {
      "x": -1765.3668875362505,
      "y": 4691.255503522502,
      "radius": 20,
      "oreType": "cuprite"
    },
    {
      "x": -3757.14883675071,
      "y": 3003.9965575687756,
      "radius": 70,
      "oreType": "cuprite"
    },
    {
      "x": -2474.904500347612,
      "y": -529.1163814642008,
      "radius": 90,
      "oreType": "aurite"
    },
    {
      "x": 4728.400521078704,
      "y": 168.6390633692203,
      "radius": 60,
      "oreType": "cuprite"
    },
    {
      "x": -3773.3502180571145,
      "y": -3329.48487630363,
      "radius": 70,
      "oreType": "hematite"
    },
    {
      "x": -462.2185591138783,
      "y": 4369.278048046519,
      "radius": 60,
      "oreType": "hematite"
    },
    {
      "x": -4438.965100949495,
      "y": 4696.6961604998005,
      "radius": 40,
      "oreType": "aurite"
    },
    {
      "x": -4826.299342497105,
      "y": 1905.7921128577227,
      "radius": 30,
      "oreType": "cuprite"
    },
    {
      "x": -441.59006238173595,
      "y": 1733.9212040175078,
      "radius": 80,
      "oreType": "cuprite"
    },
    {
      "x": 3310.679458051258,
      "y": 2330.2153121734937,
      "radius": 30,
      "oreType": "cuprite"
    },
    {
      "x": 3336.020465649845,
      "y": -3088.7844063419625,
      "radius": 30,
      "oreType": "cuprite"
    },
    {
      "x": 3383.3725184485397,
      "y": 2013.279311034486,
      "radius": 50,
      "oreType": "hematite"
    },
    {
      "x": 2831.911044472404,
      "y": -3748.36754762248,
      "radius": 70,
      "oreType": "cuprite"
    },
    {
      "x": -3346.714977908498,
      "y": -1881.1774041779672,
      "radius": 70,
      "oreType": "cuprite"
    },
    {
      "x": -1964.7365424140562,
      "y": -3282.3132737803353,
      "radius": 40,
      "oreType": "aurite"
    },
    {
      "x": 2299.831006002213,
      "y": -775.9461809153523,
      "radius": 70,
      "oreType": "aurite"
    },
    {
      "x": -3177.353235878233,
      "y": -1720.1865350839562,
      "radius": 90,
      "oreType": "cuprite"
    },
    {
      "x": 2870.5970162547546,
      "y": 364.8616309148767,
      "radius": 90,
      "oreType": "aurite"
    },
    {
      "x": 374.9235009500218,
      "y": -4062.9601097089107,
      "radius": 70,
      "oreType": "hematite"
    },
    {
      "x": -4680.13847363341,
      "y": -2463.4901225658323,
      "radius": 40,
      "oreType": "cuprite"
    },
    {
      "x": -3512.8831884930255,
      "y": -204.28151342906986,
      "radius": 30,
      "oreType": "aurite"
    },
    {
      "x": -3103.513781892162,
      "y": -1412.653217534967,
      "radius": 10,
      "oreType": "hematite"
    },
    {
      "x": 2579.068952886603,
      "y": -374.7856252787129,
      "radius": 20,
      "oreType": "hematite"
    },
    {
      "x": -1169.5720131364262,
      "y": 4791.304137394365,
      "radius": 90,
      "oreType": "aurite"
    },
    {
      "x": -4760.150768337534,
      "y": 2654.2260841138263,
      "radius": 50,
      "oreType": "cuprite"
    },
    {
      "x": 4016.6078477551137,
      "y": 1062.7579886722538,
      "radius": 90,
      "oreType": "cuprite"
    },
    {
      "x": -3645.7659165909886,
      "y": 3809.087140320393,
      "radius": 60,
      "oreType": "hematite"
    },
    {
      "x": 1090.007270084481,
      "y": 1658.894387288179,
      "radius": 100,
      "oreType": "cuprite"
    },
    {
      "x": 2269.4740250318855,
      "y": -2977.0734940798093,
      "radius": 50,
      "oreType": "cuprite"
    },
    {
      "x": 834.121427439134,
      "y": 4241.190319857484,
      "radius": 70,
      "oreType": "hematite"
    },
    {
      "x": 813.3280108095553,
      "y": 1755.8919659240812,
      "radius": 90,
      "oreType": "hematite"
    },
    {
      "x": -4443.329385354397,
      "y": -3084.219735924332,
      "radius": 100,
      "oreType": "hematite"
    },
    {
      "x": 2908.4549270934535,
      "y": 2988.9682453915457,
      "radius": 10,
      "oreType": "cuprite"
    },
    {
      "x": 3400.555865949375,
      "y": -558.0795479860012,
      "radius": 40,
      "oreType": "aurite"
    },
    {
      "x": 1685.340434171736,
      "y": 2813.1313367123244,
      "radius": 90,
      "oreType": "hematite"
    },
    {
      "x": 3926.6156896275484,
      "y": 2865.57879735704,
      "radius": 40,
      "oreType": "cuprite"
    },
    {
      "x": 2294.7409618630754,
      "y": 824.3697135712624,
      "radius": 40,
      "oreType": "cuprite"
    },
    {
      "x": -1781.4753487676783,
      "y": -900.3721989825864,
      "radius": 50,
      "oreType": "cuprite"
    },
    {
      "x": -3230.803785474097,
      "y": 3705.9314718389546,
      "radius": 80,
      "oreType": "aurite"
    },
    {
      "x": 2008.198502257672,
      "y": 4745.580613675884,
      "radius": 20,
      "oreType": "aurite"
    },
    {
      "x": 1461.8293470998412,
      "y": 4880.697200972615,
      "radius": 30,
      "oreType": "cuprite"
    },
    {
      "x": 4179.0168454151935,
      "y": -808.6206888726944,
      "radius": 40,
      "oreType": "cuprite"
    },
    {
      "x": 2240.696640383488,
      "y": -2823.9083400966524,
      "radius": 30,
      "oreType": "hematite"
    },
    {
      "x": 4262.931864203312,
      "y": 2890.159953328555,
      "radius": 30,
      "oreType": "aurite"
    },
    {
      "x": -1731.7012426279632,
      "y": -3326.8134015800397,
      "radius": 20,
      "oreType": "hematite"
    },
    {
      "x": 1245.7455880760858,
      "y": -3169.528028880024,
      "radius": 90,
      "oreType": "hematite"
    },
    {
      "x": 1447.3747196473319,
      "y": -3399.0369979841216,
      "radius": 50,
      "oreType": "cuprite"
    },
    {
      "x": -2808.3177701939844,
      "y": 2855.205472599667,
      "radius": 20,
      "oreType": "hematite"
    },
    {
      "x": -3339.499620970827,
      "y": 3366.020139374939,
      "radius": 50,
      "oreType": "aurite"
    },
    {
      "x": 1879.4019290344077,
      "y": -702.2828093986799,
      "radius": 40,
      "oreType": "cuprite"
    },
    {
      "x": -3801.151954996387,
      "y": 3592.900851747294,
      "radius": 50,
      "oreType": "aurite"
    },
    {
      "x": 2431.232000372798,
      "y": 3416.980044902471,
      "radius": 40,
      "oreType": "cuprite"
    },
    {
      "x": 4134.596968317761,
      "y": -2944.517826955846,
      "radius": 50,
      "oreType": "hematite"
    },
    {
      "x": 3522.5978056752806,
      "y": -2310.6920024221076,
      "radius": 20,
      "oreType": "hematite"
    },
    {
      "x": -1676.533386201422,
      "y": -383.36791083152025,
      "radius": 60,
      "oreType": "cuprite"
    },
    {
      "x": 2249.5176129456486,
      "y": 4243.681810894737,
      "radius": 80,
      "oreType": "aurite"
    },
    {
      "x": 1712.7990160221507,
      "y": 3685.125785312704,
      "radius": 20,
      "oreType": "hematite"
    },
    {
      "x": 4408.838731578746,
      "y": 3842.1386760852383,
      "radius": 50,
      "oreType": "cuprite"
    },
    {
      "x": -1843.124156107232,
      "y": 896.9658844103967,
      "radius": 80,
      "oreType": "cuprite"
    },
    {
      "x": 580.5158635965024,
      "y": 850.8827228143923,
      "radius": 10,
      "oreType": "aurite"
    },
    {
      "x": -3632.32400981234,
      "y": 1401.8385514556587,
      "radius": 20,
      "oreType": "cuprite"
    },
    {
      "x": 199.69982205215507,
      "y": 1954.647734989281,
      "radius": 50,
      "oreType": "cuprite"
    },
    {
      "x": 3737.88291755363,
      "y": -1127.0206337129919,
      "radius": 10,
      "oreType": "cuprite"
    },
    {
      "x": -4959.063020678258,
      "y": -4104.812798088724,
      "radius": 30,
      "oreType": "aurite"
    },
    {
      "x": 492.3979720012039,
      "y": 4336.475740651671,
      "radius": 60,
      "oreType": "hematite"
    },
    {
      "x": 1487.7574182513076,
      "y": 2014.915265403936,
      "radius": 50,
      "oreType": "cuprite"
    },
    {
      "x": -1038.9269719173976,
      "y": -3324.729526772818,
      "radius": 30,
      "oreType": "aurite"
    },
    {
      "x": 3656.4880596315306,
      "y": -593.5426821955847,
      "radius": 60,
      "oreType": "aurite"
    },
    {
      "x": -1550.7321992540258,
      "y": 3299.8579998680098,
      "radius": 50,
      "oreType": "cuprite"
    },
    {
      "x": -2703.7447808918837,
      "y": -1166.9756348978888,
      "radius": 10,
      "oreType": "aurite"
    },
    {
      "x": -773.2658481216071,
      "y": -150.53400405906413,
      "radius": 50,
      "oreType": "cuprite"
    },
    {
      "x": 3119.5328303140045,
      "y": -1361.8988664019516,
      "radius": 90,
      "oreType": "cuprite"
    },
    {
      "x": -2848.126227836245,
      "y": 1249.4037669824488,
      "radius": 20,
      "oreType": "hematite"
    },
    {
      "x": -4513.748099806058,
      "y": -4126.035443390312,
      "radius": 70,
      "oreType": "cuprite"
    },
    {
      "x": -4042.9095227047096,
      "y": -2440.5080810707536,
      "radius": 10,
      "oreType": "hematite"
    },
    {
      "x": 3427.3973207698627,
      "y": 1729.3190799786685,
      "radius": 90,
      "oreType": "cuprite"
    },
    {
      "x": 3964.958745670297,
      "y": 2389.629067622896,
      "radius": 40,
      "oreType": "cuprite"
    },
    {
      "x": 3729.7958138773456,
      "y": -3699.3527947680627,
      "radius": 90,
      "oreType": "hematite"
    },
    {
      "x": -1120.4927444728075,
      "y": -4235.210054859186,
      "radius": 30,
      "oreType": "hematite"
    },
    {
      "x": 3512.1992076773045,
      "y": 869.5396489131424,
      "radius": 70,
      "oreType": "hematite"
    },
    {
      "x": -1308.0808863541858,
      "y": 1140.4073454890274,
      "radius": 10,
      "oreType": "hematite"
    },
    {
      "x": -3657.194963109942,
      "y": -40.13663359073938,
      "radius": 30,
      "oreType": "cuprite"
    },
    {
      "x": 2326.2955236933626,
      "y": -551.4749916975825,
      "radius": 80,
      "oreType": "aurite"
    },
    {
      "x": -3295.874891527244,
      "y": -1288.299978659566,
      "radius": 30,
      "oreType": "cuprite"
    },
    {
      "x": 1268.706213229862,
      "y": 2433.6771746744225,
      "radius": 80,
      "oreType": "cuprite"
    },
    {
      "x": 2503.5271208277045,
      "y": -3289.2726408362983,
      "radius": 10,
      "oreType": "hematite"
    },
    {
      "x": -3751.810971561578,
      "y": 4477.004022308719,
      "radius": 30,
      "oreType": "cuprite"
    },
    {
      "x": -3939.538561360847,
      "y": 2345.255176871048,
      "radius": 100,
      "oreType": "cuprite"
    },
    {
      "x": -4223.332442048098,
      "y": -2065.3876322390306,
      "radius": 100,
      "oreType": "aurite"
    },
    {
      "x": 2147.759211484548,
      "y": -4835.415143688641,
      "radius": 70,
      "oreType": "aurite"
    },
    {
      "x": -3194.6105117721913,
      "y": 3052.4075099474103,
      "radius": 100,
      "oreType": "hematite"
    },
    {
      "x": -865.5349728420236,
      "y": 3693.759150243596,
      "radius": 20,
      "oreType": "cuprite"
    },
    {
      "x": 1759.2246498579734,
      "y": -3912.2860604214106,
      "radius": 40,
      "oreType": "aurite"
    },
    {
      "x": -3112.092454670223,
      "y": -295.6764494507769,
      "radius": 50,
      "oreType": "hematite"
    },
    {
      "x": 3644.320156888854,
      "y": -1710.5372582269163,
      "radius": 30,
      "oreType": "cuprite"
    },
    {
      "x": 1422.90039784851,
      "y": 2390.1288391908724,
      "radius": 30,
      "oreType": "cuprite"
    },
    {
      "x": -1174.4158797059945,
      "y": -3258.898678967177,
      "radius": 70,
      "oreType": "cuprite"
    },
    {
      "x": 3476.3832180232844,
      "y": -2591.7445405517815,
      "radius": 20,
      "oreType": "aurite"
    },
    {
      "x": -3247.934134993904,
      "y": 3350.204457065942,
      "radius": 20,
      "oreType": "cuprite"
    },
    {
      "x": -1748.8395998618312,
      "y": 1399.8776776651955,
      "radius": 30,
      "oreType": "aurite"
    },
    {
      "x": -3244.52888969319,
      "y": 2849.718409637276,
      "radius": 20,
      "oreType": "hematite"
    },
    {
      "x": -1145.5753745320396,
      "y": -2931.587667716535,
      "radius": 40,
      "oreType": "cuprite"
    },
    {
      "x": 266.46793932470825,
      "y": 4224.949541346164,
      "radius": 60,
      "oreType": "cuprite"
    },
    {
      "x": -2918.3824912000246,
      "y": 3595.2042027029684,
      "radius": 60,
      "oreType": "aurite"
    },
    {
      "x": -4420.1631436173575,
      "y": -572.6809426537071,
      "radius": 20,
      "oreType": "hematite"
    },
    {
      "x": 4560.008467965364,
      "y": -868.705288281122,
      "radius": 70,
      "oreType": "hematite"
    },
    {
      "x": -1502.84640665743,
      "y": -3178.830751811619,
      "radius": 80,
      "oreType": "cuprite"
    },
    {
      "x": -3438.482915947598,
      "y": -4780.652579423546,
      "radius": 60,
      "oreType": "cuprite"
    },
    {
      "x": -1915.0270278352255,
      "y": -4987.084353399742,
      "radius": 60,
      "oreType": "hematite"
    },
    {
      "x": -4770.836712976922,
      "y": -1430.1588228497296,
      "radius": 40,
      "oreType": "aurite"
    },
    {
      "x": -2573.323789982864,
      "y": 1078.4487383516405,
      "radius": 20,
      "oreType": "hematite"
    },
    {
      "x": 842.4311408552421,
      "y": -4770.9869267740105,
      "radius": 10,
      "oreType": "aurite"
    },
    {
      "x": 4098.741079830211,
      "y": -3653.520208829639,
      "radius": 60,
      "oreType": "hematite"
    },
    {
      "x": 4056.2915072955884,
      "y": 744.5275020801123,
      "radius": 60,
      "oreType": "aurite"
    },
    {
      "x": -15.878202565073885,
      "y": -776.5940071009592,
      "radius": 10,
      "oreType": "aurite"
    },
    {
      "x": 2177.6346875197096,
      "y": -2606.81823176482,
      "radius": 70,
      "oreType": "aurite"
    },
    {
      "x": 2800.7920410750307,
      "y": 4148.0169586917955,
      "radius": 100,
      "oreType": "hematite"
    },
    {
      "x": -612.5704954774247,
      "y": 1831.4505823805782,
      "radius": 60,
      "oreType": "cuprite"
    },
    {
      "x": -2359.8675512905866,
      "y": 3853.52773670794,
      "radius": 50,
      "oreType": "aurite"
    },
    {
      "x": 627.9792726964017,
      "y": -1512.1268887438232,
      "radius": 40,
      "oreType": "aurite"
    },
    {
      "x": -3952.9030571103863,
      "y": 1162.74644393076,
      "radius": 30,
      "oreType": "cuprite"
    },
    {
      "x": -108.52755105057454,
      "y": -2408.9145219896336,
      "radius": 20,
      "oreType": "cuprite"
    },
    {
      "x": -1813.185499282366,
      "y": -2583.0056188671047,
      "radius": 30,
      "oreType": "hematite"
    },
    {
      "x": -4824.961055779185,
      "y": -231.81864830757348,
      "radius": 50,
      "oreType": "hematite"
    },
    {
      "x": -4426.719279590458,
      "y": -402.2935162156349,
      "radius": 90,
      "oreType": "cuprite"
    },
    {
      "x": 288.87496039195605,
      "y": 4455.59883620815,
      "radius": 70,
      "oreType": "hematite"
    },
    {
      "x": 4512.077616614963,
      "y": 779.9914700140321,
      "radius": 80,
      "oreType": "aurite"
    },
    {
      "x": 4760.217353986735,
      "y": 3522.2052034290873,
      "radius": 20,
      "oreType": "hematite"
    },
    {
      "x": -1866.4248094824832,
      "y": -982.9583253287489,
      "radius": 30,
      "oreType": "cuprite"
    },
    {
      "x": -1816.9469007951777,
      "y": -2169.167822214251,
      "radius": 10,
      "oreType": "cuprite"
    },
    {
      "x": 1097.6792501159505,
      "y": -1170.9314851439933,
      "radius": 50,
      "oreType": "cuprite"
    },
    {
      "x": 4107.926892141203,
      "y": 2997.866473683917,
      "radius": 70,
      "oreType": "hematite"
    },
    {
      "x": 978.1129378746933,
      "y": -1394.058281533732,
      "radius": 40,
      "oreType": "hematite"
    },
    {
      "x": -4791.350149081745,
      "y": -3436.4003399865383,
      "radius": 80,
      "oreType": "cuprite"
    },
    {
      "x": -3348.6919584645893,
      "y": -4213.02154427154,
      "radius": 70,
      "oreType": "cuprite"
    },
    {
      "x": 2902.0154800269115,
      "y": 808.5210977272972,
      "radius": 40,
      "oreType": "aurite"
    },
    {
      "x": 4534.295071334249,
      "y": 1946.0245428133248,
      "radius": 90,
      "oreType": "cuprite"
    },
    {
      "x": -2755.1725761201064,
      "y": 985.7320489631594,
      "radius": 60,
      "oreType": "cuprite"
    },
    {
      "x": 3516.786067233975,
      "y": -1881.5072580349135,
      "radius": 60,
      "oreType": "cuprite"
    },
    {
      "x": 4289.001486777996,
      "y": -714.0460052979037,
      "radius": 40,
      "oreType": "cuprite"
    },
    {
      "x": 1443.3487637631836,
      "y": 678.6570044404194,
      "radius": 80,
      "oreType": "cuprite"
    },
    {
      "x": -653.7628617129632,
      "y": -414.9374219991664,
      "radius": 30,
      "oreType": "cuprite"
    },
    {
      "x": 1371.1626798140153,
      "y": 1596.5504857490953,
      "radius": 80,
      "oreType": "hematite"
    },
    {
      "x": 1054.0495560099039,
      "y": 3649.8438902607,
      "radius": 30,
      "oreType": "cuprite"
    },
    {
      "x": -2580.055748472412,
      "y": -4640.366083328684,
      "radius": 50,
      "oreType": "cuprite"
    },
    {
      "x": -4215.040004983941,
      "y": 3756.5907412053566,
      "radius": 70,
      "oreType": "hematite"
    },
    {
      "x": 529.7595371099617,
      "y": 3383.2752053575146,
      "radius": 10,
      "oreType": "hematite"
    },
    {
      "x": -2098.2551529973457,
      "y": 795.1011194639545,
      "radius": 80,
      "oreType": "cuprite"
    },
    {
      "x": 2266.3120221103195,
      "y": 3104.2508214391164,
      "radius": 80,
      "oreType": "cuprite"
    },
    {
      "x": 3231.7059719949693,
      "y": 1539.3246223842505,
      "radius": 40,
      "oreType": "aurite"
    },
    {
      "x": -2202.2608355298034,
      "y": 3696.747422543136,
      "radius": 70,
      "oreType": "cuprite"
    },
    {
      "x": -2678.4065163774785,
      "y": -4436.401336049922,
      "radius": 40,
      "oreType": "cuprite"
    },
    {
      "x": 1301.7005999862286,
      "y": 1821.296668108534,
      "radius": 50,
      "oreType": "cuprite"
    },
    {
      "x": -1530.1620677975136,
      "y": 1608.971071689047,
      "radius": 30,
      "oreType": "hematite"
    },
    {
      "x": -1782.5661338192144,
      "y": -3036.3965195754527,
      "radius": 10,
      "oreType": "aurite"
    },
    {
      "x": -1162.915678602956,
      "y": 3481.8616952980474,
      "radius": 30,
      "oreType": "cuprite"
    },
    {
      "x": -2762.700003014256,
      "y": 4604.17343114982,
      "radius": 60,
      "oreType": "hematite"
    },
    {
      "x": -4429.628548137694,
      "y": -1931.6750567377294,
      "radius": 30,
      "oreType": "cuprite"
    },
    {
      "x": 3797.759454394218,
      "y": -904.7621736020051,
      "radius": 70,
      "oreType": "aurite"
    },
    {
      "x": 4615.361716485138,
      "y": -4227.182297553647,
      "radius": 20,
      "oreType": "aurite"
    },
    {
      "x": 4547.16426413817,
      "y": -1352.3334417199108,
      "radius": 30,
      "oreType": "hematite"
    },
    {
      "x": 2466.992649805446,
      "y": -2887.6506156603377,
      "radius": 20,
      "oreType": "cuprite"
    },
    {
      "x": -1908.667832105455,
      "y": 2097.595344339946,
      "radius": 40,
      "oreType": "hematite"
    },
    {
      "x": 1609.3718360863884,
      "y": 3224.193594224931,
      "radius": 50,
      "oreType": "aurite"
    },
    {
      "x": -3029.5220727077376,
      "y": -1451.7074362935566,
      "radius": 20,
      "oreType": "hematite"
    },
    {
      "x": -4546.3079138293015,
      "y": 3270.3713941232104,
      "radius": 80,
      "oreType": "cuprite"
    },
    {
      "x": 526.8552068811383,
      "y": 2394.8933566461815,
      "radius": 50,
      "oreType": "aurite"
    },
    {
      "x": -555.2443054430256,
      "y": -2117.4840089509894,
      "radius": 50,
      "oreType": "cuprite"
    },
    {
      "x": 3696.644004987164,
      "y": -2324.0880671744744,
      "radius": 80,
      "oreType": "cuprite"
    },
    {
      "x": -769.9849096351263,
      "y": 4942.759862545143,
      "radius": 90,
      "oreType": "cuprite"
    },
    {
      "x": -2696.6735450722636,
      "y": -2830.4501848717377,
      "radius": 30,
      "oreType": "cuprite"
    },
    {
      "x": 2526.980263117924,
      "y": -3065.0499571951564,
      "radius": 50,
      "oreType": "cuprite"
    },
    {
      "x": -1484.8051728840805,
      "y": -3597.2745253176377,
      "radius": 90,
      "oreType": "aurite"
    },
    {
      "x": 4094.050633465305,
      "y": 436.19265257724084,
      "radius": 80,
      "oreType": "cuprite"
    },
    {
      "x": 3627.3088770996465,
      "y": -2581.8588737041546,
      "radius": 30,
      "oreType": "aurite"
    },
    {
      "x": 3809.732492514073,
      "y": -2483.209006626339,
      "radius": 50,
      "oreType": "cuprite"
    },
    {
      "x": -2121.4458144111427,
      "y": -1812.5505253731444,
      "radius": 80,
      "oreType": "cuprite"
    },
    {
      "x": 4116.327959982684,
      "y": 1218.8856375950375,
      "radius": 40,
      "oreType": "cuprite"
    },
    {
      "x": -106.50500266905283,
      "y": -1079.3865601029818,
      "radius": 30,
      "oreType": "cuprite"
    },
    {
      "x": -1152.468722193558,
      "y": 3351.5868353944265,
      "radius": 50,
      "oreType": "cuprite"
    },
    {
      "x": 3419.7302718844226,
      "y": 4760.9462561008195,
      "radius": 40,
      "oreType": "cuprite"
    },
    {
      "x": 1487.125756136105,
      "y": -1533.1762082598789,
      "radius": 30,
      "oreType": "cuprite"
    },
    {
      "x": -4027.5511571083134,
      "y": -2198.0591955351692,
      "radius": 70,
      "oreType": "hematite"
    },
    {
      "x": -4886.0811607398455,
      "y": 2304.453922363885,
      "radius": 100,
      "oreType": "cuprite"
    },
    {
      "x": -727.345057858988,
      "y": -1570.330759692602,
      "radius": 30,
      "oreType": "cuprite"
    },
    {
      "x": -1480.0280934116183,
      "y": 2157.593782272658,
      "radius": 30,
      "oreType": "cuprite"
    },
    {
      "x": 4907.402048978136,
      "y": 4046.9896465878173,
      "radius": 80,
      "oreType": "aurite"
    },
    {
      "x": 2361.0122672542834,
      "y": -219.39385767102192,
      "radius": 10,
      "oreType": "cuprite"
    },
    {
      "x": -2659.9417059714715,
      "y": 3898.9326804726134,
      "radius": 90,
      "oreType": "hematite"
    },
    {
      "x": -2479.54548042959,
      "y": -4932.902818070864,
      "radius": 30,
      "oreType": "hematite"
    },
    {
      "x": 3740.2521900071497,
      "y": 4451.575191120019,
      "radius": 30,
      "oreType": "cuprite"
    },
    {
      "x": -3622.585415720541,
      "y": -2009.1159143632065,
      "radius": 40,
      "oreType": "hematite"
    },
    {
      "x": -3931.299592814508,
      "y": -4968.328840551426,
      "radius": 80,
      "oreType": "cuprite"
    },
    {
      "x": 362.36935419664775,
      "y": 2390.1233561373992,
      "radius": 70,
      "oreType": "cuprite"
    },
    {
      "x": 4829.00789141556,
      "y": -4600.346244568871,
      "radius": 70,
      "oreType": "hematite"
    },
    {
      "x": -1395.6406720274183,
      "y": 1409.2327663787273,
      "radius": 40,
      "oreType": "hematite"
    },
    {
      "x": -1548.1216039547573,
      "y": 894.8377306846611,
      "radius": 80,
      "oreType": "hematite"
    },
    {
      "x": 89.10530235196612,
      "y": 4473.403413856463,
      "radius": 50,
      "oreType": "cuprite"
    },
    {
      "x": 4648.1452175758295,
      "y": 1789.6581601227467,
      "radius": 40,
      "oreType": "hematite"
    },
    {
      "x": -2277.520823586703,
      "y": 1309.7532867129669,
      "radius": 100,
      "oreType": "aurite"
    },
    {
      "x": 4651.325804733122,
      "y": 4080.680571489148,
      "radius": 80,
      "oreType": "aurite"
    },
    {
      "x": -4463.383210590444,
      "y": -1762.148245151256,
      "radius": 40,
      "oreType": "hematite"
    },
    {
      "x": -1525.9572201711412,
      "y": 747.7586247681445,
      "radius": 20,
      "oreType": "hematite"
    },
    {
      "x": 3562.1112376218257,
      "y": 1335.69901705747,
      "radius": 70,
      "oreType": "cuprite"
    },
    {
      "x": 3537.5383352392673,
      "y": -358.5095298109775,
      "radius": 60,
      "oreType": "cuprite"
    },
    {
      "x": -955.1813271938792,
      "y": 749.6391096080667,
      "radius": 10,
      "oreType": "hematite"
    },
    {
      "x": -414.2242067480928,
      "y": 2940.3958700540356,
      "radius": 30,
      "oreType": "cuprite"
    },
    {
      "x": -4583.283486676124,
      "y": 889.5641964961753,
      "radius": 100,
      "oreType": "hematite"
    },
    {
      "x": -3670.255244358305,
      "y": 3337.409595579768,
      "radius": 60,
      "oreType": "hematite"
    },
    {
      "x": -2990.1767345303833,
      "y": 3278.546947785164,
      "radius": 20,
      "oreType": "cuprite"
    },
    {
      "x": 3526.5046393454268,
      "y": 2494.348448114656,
      "radius": 40,
      "oreType": "cuprite"
    },
    {
      "x": -4706.584031661733,
      "y": 1997.1797366821509,
      "radius": 50,
      "oreType": "aurite"
    },
    {
      "x": -2612.8798906263896,
      "y": 4374.670386569502,
      "radius": 40,
      "oreType": "hematite"
    },
    {
      "x": 3283.241827926691,
      "y": -4731.417655188239,
      "radius": 40,
      "oreType": "hematite"
    },
    {
      "x": 4358.068043545569,
      "y": 361.98218781787307,
      "radius": 10,
      "oreType": "hematite"
    },
    {
      "x": 2001.696897074563,
      "y": 3275.5183096080254,
      "radius": 20,
      "oreType": "cuprite"
    },
    {
      "x": -1007.8866538900133,
      "y": 4577.449220290435,
      "radius": 60,
      "oreType": "hematite"
    },
    {
      "x": 3798.8558814896,
      "y": -2186.852021130201,
      "radius": 40,
      "oreType": "hematite"
    },
    {
      "x": -852.2527779692068,
      "y": -2526.356119641875,
      "radius": 40,
      "oreType": "aurite"
    },
    {
      "x": 4445.267283988504,
      "y": -4383.874907298932,
      "radius": 20,
      "oreType": "aurite"
    },
    {
      "x": 3339.3252032422183,
      "y": -2894.087810027153,
      "radius": 20,
      "oreType": "cuprite"
    },
    {
      "x": -3929.615462675926,
      "y": 3731.975709885613,
      "radius": 40,
      "oreType": "cuprite"
    },
    {
      "x": 4911.857735992262,
      "y": 1174.984265523722,
      "radius": 40,
      "oreType": "aurite"
    },
    {
      "x": -4242.50497407217,
      "y": -4549.14537582611,
      "radius": 40,
      "oreType": "aurite"
    },
    {
      "x": -448.3630788535597,
      "y": -2467.1128158536603,
      "radius": 90,
      "oreType": "hematite"
    },
    {
      "x": 3179.6104831876405,
      "y": -378.03643348701456,
      "radius": 30,
      "oreType": "hematite"
    },
    {
      "x": 2061.702817206801,
      "y": -1545.8278089483724,
      "radius": 90,
      "oreType": "cuprite"
    },
    {
      "x": -4023.3619276186937,
      "y": 2175.7186067253497,
      "radius": 50,
      "oreType": "hematite"
    },
    {
      "x": -4885.911326358152,
      "y": 3273.0619386543312,
      "radius": 80,
      "oreType": "aurite"
    },
    {
      "x": 4364.477567967182,
      "y": -1722.3937800273447,
      "radius": 70,
      "oreType": "hematite"
    },
    {
      "x": 3440.5802632894965,
      "y": -4898.602415669573,
      "radius": 60,
      "oreType": "hematite"
    },
    {
      "x": 805.2486386460922,
      "y": -4582.700695234794,
      "radius": 20,
      "oreType": "hematite"
    },
    {
      "x": 1942.906469014174,
      "y": -897.0006018538857,
      "radius": 90,
      "oreType": "cuprite"
    },
    {
      "x": -4597.955162533378,
      "y": -1303.5711776775804,
      "radius": 50,
      "oreType": "aurite"
    },
    {
      "x": -4154.21538993465,
      "y": 4049.8901625609874,
      "radius": 20,
      "oreType": "cuprite"
    },
    {
      "x": 3981.083574024704,
      "y": -342.6675590911832,
      "radius": 60,
      "oreType": "cuprite"
    },
    {
      "x": -1092.1929870804493,
      "y": 2278.3090525767725,
      "radius": 20,
      "oreType": "cuprite"
    },
    {
      "x": 1819.3298801331891,
      "y": 1243.8046941558366,
      "radius": 70,
      "oreType": "aurite"
    },
    {
      "x": -469.4811172640523,
      "y": -4756.301867889374,
      "radius": 60,
      "oreType": "cuprite"
    },
    {
      "x": -2240.2206401902226,
      "y": -850.4160976227259,
      "radius": 60,
      "oreType": "cuprite"
    },
    {
      "x": 1094.3491268592797,
      "y": -3202.5534852172923,
      "radius": 10,
      "oreType": "cuprite"
    },
    {
      "x": -907.7043041465105,
      "y": 4046.803228373046,
      "radius": 80,
      "oreType": "aurite"
    },
    {
      "x": -4013.4833230410827,
      "y": 875.3877068120164,
      "radius": 80,
      "oreType": "hematite"
    },
    {
      "x": 4216.003072678906,
      "y": 1723.8101857238087,
      "radius": 60,
      "oreType": "cuprite"
    },
    {
      "x": -4945.602247428291,
      "y": 4126.366282170921,
      "radius": 80,
      "oreType": "cuprite"
    },
    {
      "x": -1800.9691218708078,
      "y": -4791.440814247103,
      "radius": 60,
      "oreType": "cuprite"
    },
    {
      "x": 921.3760821845218,
      "y": -3029.11237321426,
      "radius": 20,
      "oreType": "hematite"
    },
    {
      "x": -4483.431167464504,
      "y": 4977.915533689375,
      "radius": 30,
      "oreType": "cuprite"
    },
    {
      "x": 4447.416617043565,
      "y": 1079.531174034638,
      "radius": 20,
      "oreType": "hematite"
    },
    {
      "x": 4931.488464682534,
      "y": -1525.7784465456293,
      "radius": 30,
      "oreType": "aurite"
    },
    {
      "x": 3014.817342497591,
      "y": 3332.3740269938717,
      "radius": 80,
      "oreType": "cuprite"
    },
    {
      "x": -2155.2506825790374,
      "y": 2302.3548320362265,
      "radius": 20,
      "oreType": "aurite"
    },
    {
      "x": -983.8048178241321,
      "y": -4326.700359262192,
      "radius": 30,
      "oreType": "hematite"
    },
    {
      "x": -3726.053241676375,
      "y": -610.0724210115671,
      "radius": 30,
      "oreType": "hematite"
    },
    {
      "x": -1605.657426085394,
      "y": 2009.2882644938204,
      "radius": 50,
      "oreType": "cuprite"
    },
    {
      "x": 3630.0742743229785,
      "y": 4301.02773216299,
      "radius": 30,
      "oreType": "aurite"
    },
    {
      "x": 4275.412348785401,
      "y": -1986.841289339225,
      "radius": 80,
      "oreType": "cuprite"
    },
    {
      "x": 4135.203430669412,
      "y": -1552.2207660836718,
      "radius": 10,
      "oreType": "cuprite"
    },
    {
      "x": -4003.0749376124495,
      "y": 3389.4187700702914,
      "radius": 80,
      "oreType": "hematite"
    },
    {
      "x": -1356.0495055079546,
      "y": 4830.381921125429,
      "radius": 10,
      "oreType": "cuprite"
    },
    {
      "x": 2216.492262821412,
      "y": -1490.3920163257012,
      "radius": 20,
      "oreType": "cuprite"
    },
    {
      "x": -1545.4858688588401,
      "y": 2102.682754592369,
      "radius": 10,
      "oreType": "hematite"
    },
    {
      "x": 4955.820729397984,
      "y": 703.7713848359273,
      "radius": 20,
      "oreType": "cuprite"
    },
    {
      "x": 2957.356781392204,
      "y": 1521.583991640556,
      "radius": 50,
      "oreType": "cuprite"
    },
    {
      "x": -2633.7703095572974,
      "y": 2447.046763832419,
      "radius": 20,
      "oreType": "aurite"
    },
    {
      "x": -2292.266258266942,
      "y": 4232.99132240895,
      "radius": 40,
      "oreType": "cuprite"
    },
    {
      "x": -2177.246715087722,
      "y": -4488.079041836201,
      "radius": 50,
      "oreType": "hematite"
    },
    {
      "x": 4036.2438268047463,
      "y": 38.245001914238856,
      "radius": 20,
      "oreType": "cuprite"
    },
    {
      "x": 2548.4958096238984,
      "y": -168.29698082211132,
      "radius": 30,
      "oreType": "cuprite"
    },
    {
      "x": -3904.9875148632273,
      "y": -856.2310195009703,
      "radius": 80,
      "oreType": "cuprite"
    },
    {
      "x": 4963.297592157407,
      "y": 3173.9068247265755,
      "radius": 70,
      "oreType": "hematite"
    },
    {
      "x": 1538.8927186738388,
      "y": -3218.818948075879,
      "radius": 30,
      "oreType": "cuprite"
    },
    {
      "x": -2336.6019182903888,
      "y": -4673.954127768229,
      "radius": 60,
      "oreType": "cuprite"
    },
    {
      "x": 1285.6259009140135,
      "y": 2692.3364093857517,
      "radius": 10,
      "oreType": "hematite"
    },
    {
      "x": 3255.0507344387916,
      "y": 3568.086233738297,
      "radius": 20,
      "oreType": "hematite"
    },
    {
      "x": 4486.950062087029,
      "y": -3639.4499439385017,
      "radius": 40,
      "oreType": "cuprite"
    },
    {
      "x": -3283.291956363001,
      "y": -734.6597967421586,
      "radius": 80,
      "oreType": "aurite"
    },
    {
      "x": 1152.2170606730708,
      "y": 4201.247215677304,
      "radius": 60,
      "oreType": "hematite"
    },
    {
      "x": 3570.290608482052,
      "y": -175.7402287785581,
      "radius": 30,
      "oreType": "hematite"
    },
    {
      "x": 2796.140602167998,
      "y": -1671.9601323768552,
      "radius": 40,
      "oreType": "cuprite"
    },
    {
      "x": 4763.933101671822,
      "y": -2174.76527121782,
      "radius": 80,
      "oreType": "cuprite"
    },
    {
      "x": -2960.2756200306544,
      "y": -910.7363029505167,
      "radius": 20,
      "oreType": "cuprite"
    },
    {
      "x": 3677.237830980791,
      "y": 4689.962248905055,
      "radius": 20,
      "oreType": "aurite"
    },
    {
      "x": 846.2473129470793,
      "y": -2442.250470272147,
      "radius": 70,
      "oreType": "cuprite"
    },
    {
      "x": 3294.5185942973667,
      "y": 291.66357725411984,
      "radius": 20,
      "oreType": "cuprite"
    },
    {
      "x": 3250.607048218206,
      "y": 2780.538861435384,
      "radius": 60,
      "oreType": "aurite"
    },
    {
      "x": 1362.1715275179035,
      "y": 1133.4824300233138,
      "radius": 90,
      "oreType": "cuprite"
    },
    {
      "x": 1758.3468634536237,
      "y": -1573.7482492319366,
      "radius": 90,
      "oreType": "cuprite"
    },
    {
      "x": 3769.307085357365,
      "y": -1927.5736548915345,
      "radius": 80,
      "oreType": "cuprite"
    },
    {
      "x": 1721.3392270854677,
      "y": 459.27410108275615,
      "radius": 20,
      "oreType": "aurite"
    },
    {
      "x": 2759.3196862456757,
      "y": -4358.601457966769,
      "radius": 50,
      "oreType": "cuprite"
    },
    {
      "x": -1865.300332243358,
      "y": 420.9529309882454,
      "radius": 10,
      "oreType": "hematite"
    },
    {
      "x": -1523.4460594732923,
      "y": 4283.349741136346,
      "radius": 60,
      "oreType": "hematite"
    },
    {
      "x": 3434.1153881493346,
      "y": 603.849700705843,
      "radius": 20,
      "oreType": "hematite"
    },
    {
      "x": 1498.7470021468384,
      "y": -4647.067534845602,
      "radius": 40,
      "oreType": "hematite"
    },
    {
      "x": 2471.0493651417178,
      "y": -4941.261561913692,
      "radius": 90,
      "oreType": "aurite"
    },
    {
      "x": -3425.731560210601,
      "y": 990.6808550985979,
      "radius": 50,
      "oreType": "cuprite"
    },
    {
      "x": -4847.275786065479,
      "y": -4202.847893741994,
      "radius": 10,
      "oreType": "aurite"
    },
    {
      "x": -2584.0786166478956,
      "y": 2563.5279931897803,
      "radius": 10,
      "oreType": "aurite"
    },
    {
      "x": 3837.806224071236,
      "y": 1264.8660964702829,
      "radius": 70,
      "oreType": "cuprite"
    },
    {
      "x": -3989.9417937656854,
      "y": -214.0221444635171,
      "radius": 40,
      "oreType": "cuprite"
    },
    {
      "x": 3688.5366180255464,
      "y": 2789.997829287687,
      "radius": 100,
      "oreType": "cuprite"
    },
    {
      "x": 2886.686737011748,
      "y": 1474.900298275903,
      "radius": 10,
      "oreType": "hematite"
    },
    {
      "x": -4840.290893054131,
      "y": 3749.270891800114,
      "radius": 70,
      "oreType": "cuprite"
    },
    {
      "x": 2292.8005206564217,
      "y": -3567.120724801023,
      "radius": 60,
      "oreType": "cuprite"
    },
    {
      "x": 2669.6960998980335,
      "y": 283.49584870192456,
      "radius": 40,
      "oreType": "cuprite"
    },
    {
      "x": 1954.9700355951227,
      "y": 3718.940249096725,
      "radius": 70,
      "oreType": "cuprite"
    },
    {
      "x": -398.52177517826215,
      "y": 3532.367883391241,
      "radius": 70,
      "oreType": "cuprite"
    },
    {
      "x": 1765.6342622950394,
      "y": -4344.04128695481,
      "radius": 40,
      "oreType": "hematite"
    },
    {
      "x": 2979.855970538232,
      "y": 4787.721715418607,
      "radius": 60,
      "oreType": "cuprite"
    },
    {
      "x": 1354.8586303907362,
      "y": 3751.9258804080246,
      "radius": 30,
      "oreType": "hematite"
    },
    {
      "x": -3428.0936107790394,
      "y": 363.1189811804614,
      "radius": 20,
      "oreType": "aurite"
    },
    {
      "x": -3365.644255055198,
      "y": 2088.692668547243,
      "radius": 90,
      "oreType": "hematite"
    },
    {
      "x": 4682.335357587497,
      "y": 1912.6579767343198,
      "radius": 10,
      "oreType": "hematite"
    },
    {
      "x": 4566.12170291337,
      "y": 2154.1097752450924,
      "radius": 50,
      "oreType": "cuprite"
    },
    {
      "x": -850.4328623557145,
      "y": 4521.035790755599,
      "radius": 60,
      "oreType": "hematite"
    },
    {
      "x": 1423.897285468625,
      "y": 1298.746645165385,
      "radius": 30,
      "oreType": "cuprite"
    },
    {
      "x": 0.0687116029429724,
      "y": 2438.9566605819546,
      "radius": 60,
      "oreType": "hematite"
    },
    {
      "x": -4053.5781103087843,
      "y": -2067.3918755512545,
      "radius": 30,
      "oreType": "cuprite"
    },
    {
      "x": 3036.775398276501,
      "y": -3446.5732868762866,
      "radius": 50,
      "oreType": "hematite"
    },
    {
      "x": 1910.388421837652,
      "y": -3853.3257218294125,
      "radius": 70,
      "oreType": "cuprite"
    },
    {
      "x": -728.5672812793042,
      "y": 3084.451959994077,
      "radius": 20,
      "oreType": "cuprite"
    },
    {
      "x": -4866.7036728738085,
      "y": -1394.6288734459467,
      "radius": 20,
      "oreType": "hematite"
    },
    {
      "x": 2566.891290107147,
      "y": -4202.535751190024,
      "radius": 70,
      "oreType": "aurite"
    },
    {
      "x": 496.6184492683556,
      "y": -263.74809677506715,
      "radius": 100,
      "oreType": "cuprite"
    },
    {
      "x": 2717.395119381627,
      "y": 4720.677946758707,
      "radius": 20,
      "oreType": "hematite"
    },
    {
      "x": 3349.3330611410597,
      "y": -4304.224234686034,
      "radius": 20,
      "oreType": "hematite"
    },
    {
      "x": -4136.279328449104,
      "y": 36.96584602252307,
      "radius": 20,
      "oreType": "aurite"
    },
    {
      "x": -313.25713080953886,
      "y": 3328.7696352035323,
      "radius": 20,
      "oreType": "aurite"
    },
    {
      "x": -2216.469365718321,
      "y": 2539.4634408996562,
      "radius": 70,
      "oreType": "cuprite"
    },
    {
      "x": -296.0394453592419,
      "y": -4355.180675612955,
      "radius": 10,
      "oreType": "hematite"
    },
    {
      "x": -4163.124013354558,
      "y": -404.7756085566179,
      "radius": 20,
      "oreType": "aurite"
    },
    {
      "x": -4324.537059519378,
      "y": 193.8873254102047,
      "radius": 10,
      "oreType": "hematite"
    },
    {
      "x": -3766.4585050553587,
      "y": -4214.619929375885,
      "radius": 40,
      "oreType": "cuprite"
    },
    {
      "x": 3336.863191922539,
      "y": 719.4775035953827,
      "radius": 10,
      "oreType": "cuprite"
    },
    {
      "x": -4454.8233493838825,
      "y": -3513.7445204467977,
      "radius": 70,
      "oreType": "cuprite"
    },
    {
      "x": 4894.959940482506,
      "y": 4750.380951475337,
      "radius": 100,
      "oreType": "cuprite"
    },
    {
      "x": -3157.914086881064,
      "y": 1926.26584026935,
      "radius": 80,
      "oreType": "aurite"
    },
    {
      "x": -3935.9253989673325,
      "y": -3333.9921471408384,
      "radius": 10,
      "oreType": "cuprite"
    },
    {
      "x": -1947.749488991759,
      "y": -4591.076042147451,
      "radius": 90,
      "oreType": "cuprite"
    },
    {
      "x": -2207.5648513337496,
      "y": 2655.912221812633,
      "radius": 10,
      "oreType": "hematite"
    },
    {
      "x": 4627.864234458961,
      "y": 3433.917337873016,
      "radius": 90,
      "oreType": "cuprite"
    },
    {
      "x": -1543.3719993562645,
      "y": 212.58811210548066,
      "radius": 20,
      "oreType": "aurite"
    },
    {
      "x": -1200.6847089714045,
      "y": -4801.053366858927,
      "radius": 40,
      "oreType": "hematite"
    },
    {
      "x": 3422.0720732452637,
      "y": -231.76525672596648,
      "radius": 40,
      "oreType": "hematite"
    },
    {
      "x": 4648.978775579202,
      "y": 497.43268058941806,
      "radius": 90,
      "oreType": "hematite"
    },
    {
      "x": 3232.190887579269,
      "y": 4536.948072028664,
      "radius": 20,
      "oreType": "aurite"
    },
    {
      "x": 686.8998872004939,
      "y": -1578.1806140157405,
      "radius": 20,
      "oreType": "cuprite"
    },
    {
      "x": -3295.666018295158,
      "y": 989.2054134543948,
      "radius": 40,
      "oreType": "cuprite"
    },
    {
      "x": 3977.3581660395107,
      "y": 1713.1292771090666,
      "radius": 30,
      "oreType": "aurite"
    },
    {
      "x": -2827.24652425576,
      "y": 2690.727837316882,
      "radius": 50,
      "oreType": "hematite"
    },
    {
      "x": 1716.0952119437245,
      "y": 4814.381111906405,
      "radius": 50,
      "oreType": "cuprite"
    },
    {
      "x": -461.28376217046576,
      "y": 3971.5337323921985,
      "radius": 60,
      "oreType": "hematite"
    },
    {
      "x": -1161.3293245605894,
      "y": -4098.98777692206,
      "radius": 20,
      "oreType": "cuprite"
    },
    {
      "x": -876.0437955612921,
      "y": 360.0054760072391,
      "radius": 30,
      "oreType": "cuprite"
    },
    {
      "x": -3239.825375443568,
      "y": -4151.949547683609,
      "radius": 10,
      "oreType": "aurite"
    },
    {
      "x": 2049.9830648204397,
      "y": 4416.914671259014,
      "radius": 20,
      "oreType": "cuprite"
    },
    {
      "x": 119.96791533027684,
      "y": -105.86471339828707,
      "radius": 10,
      "oreType": "cuprite"
    },
    {
      "x": -3388.409070836249,
      "y": 3082.4303731627388,
      "radius": 50,
      "oreType": "cuprite"
    },
    {
      "x": -2207.182099969005,
      "y": -2661.5152088794434,
      "radius": 30,
      "oreType": "cuprite"
    },
    {
      "x": 1908.5525912559299,
      "y": -4715.854870045168,
      "radius": 60,
      "oreType": "cuprite"
    },
    {
      "x": -3108.932202053396,
      "y": 1579.4760633786798,
      "radius": 30,
      "oreType": "hematite"
    },
    {
      "x": 4554.49473890363,
      "y": 2709.7896419912627,
      "radius": 70,
      "oreType": "cuprite"
    },
    {
      "x": -1936.0174925008055,
      "y": 1353.2433967975987,
      "radius": 30,
      "oreType": "cuprite"
    },
    {
      "x": 1690.5696167046335,
      "y": -3188.9304851607835,
      "radius": 60,
      "oreType": "hematite"
    },
    {
      "x": 624.8625735505619,
      "y": -2470.4594858736127,
      "radius": 10,
      "oreType": "cuprite"
    },
    {
      "x": -4757.973873355081,
      "y": -3746.9350106533716,
      "radius": 80,
      "oreType": "cuprite"
    },
    {
      "x": 4528.067133348228,
      "y": -1804.9877529169778,
      "radius": 60,
      "oreType": "hematite"
    },
    {
      "x": 1787.324652589477,
      "y": 4763.932122918979,
      "radius": 20,
      "oreType": "hematite"
    },
    {
      "x": -336.32298121554436,
      "y": -1788.4211760112655,
      "radius": 10,
      "oreType": "cuprite"
    },
    {
      "x": -1788.1176598845605,
      "y": 4378.734018283723,
      "radius": 100,
      "oreType": "hematite"
    },
    {
      "x": -742.1981581395243,
      "y": 2563.8153947903766,
      "radius": 20,
      "oreType": "cuprite"
    },
    {
      "x": -4967.445105544092,
      "y": -2122.398172888709,
      "radius": 20,
      "oreType": "hematite"
    },
    {
      "x": 4772.797072593431,
      "y": 1748.060992335969,
      "radius": 60,
      "oreType": "cuprite"
    },
    {
      "x": -3892.707028336033,
      "y": -3639.2044513856513,
      "radius": 50,
      "oreType": "cuprite"
    },
    {
      "x": -3079.61066708865,
      "y": 627.0989766273294,
      "radius": 50,
      "oreType": "hematite"
    },
    {
      "x": -1505.1535933618209,
      "y": 2727.254940394299,
      "radius": 70,
      "oreType": "hematite"
    },
    {
      "x": 3285.653201384262,
      "y": 3819.6647008725827,
      "radius": 30,
      "oreType": "cuprite"
    },
    {
      "x": -795.5265075446971,
      "y": -4196.178578061105,
      "radius": 60,
      "oreType": "aurite"
    },
    {
      "x": 3120.472570146322,
      "y": 4572.522303120043,
      "radius": 70,
      "oreType": "cuprite"
    },
    {
      "x": -985.2950835893259,
      "y": -1280.3990777567597,
      "radius": 30,
      "oreType": "cuprite"
    },
    {
      "x": 630.9742227252113,
      "y": -1007.5358329821227,
      "radius": 30,
      "oreType": "aurite"
    },
    {
      "x": 1104.5960234439533,
      "y": 697.5781122836767,
      "radius": 60,
      "oreType": "hematite"
    },
    {
      "x": 2567.7797323626874,
      "y": 3497.5380923021103,
      "radius": 70,
      "oreType": "cuprite"
    },
    {
      "x": -3058.7905507078194,
      "y": -4328.657104275513,
      "radius": 20,
      "oreType": "hematite"
    },
    {
      "x": -2585.6523914623185,
      "y": -4.669474384166872,
      "radius": 70,
      "oreType": "cuprite"
    },
    {
      "x": -208.17923099856418,
      "y": -386.0017366623558,
      "radius": 40,
      "oreType": "hematite"
    },
    {
      "x": -2050.507221172448,
      "y": -875.4361857907522,
      "radius": 40,
      "oreType": "aurite"
    },
    {
      "x": 3659.132047075293,
      "y": 4208.862629671055,
      "radius": 50,
      "oreType": "aurite"
    },
    {
      "x": 4281.706181361979,
      "y": 636.5996654288253,
      "radius": 60,
      "oreType": "aurite"
    },
    {
      "x": -1479.1308834036122,
      "y": -1729.0463073144058,
      "radius": 80,
      "oreType": "cuprite"
    },
    {
      "x": 3503.6687991353665,
      "y": 2927.666699552323,
      "radius": 10,
      "oreType": "aurite"
    },
    {
      "x": 243.75016545830962,
      "y": -4477.930734959387,
      "radius": 30,
      "oreType": "cuprite"
    },
    {
      "x": -3703.089044299368,
      "y": -2501.5120345560103,
      "radius": 50,
      "oreType": "hematite"
    },
    {
      "x": -926.4378125587225,
      "y": -1396.285700841091,
      "radius": 40,
      "oreType": "hematite"
    },
    {
      "x": -673.1604461702844,
      "y": 3707.055808368096,
      "radius": 50,
      "oreType": "cuprite"
    },
    {
      "x": 4963.691526896982,
      "y": 132.68458300083051,
      "radius": 50,
      "oreType": "aurite"
    },
    {
      "x": 1713.3509368463783,
      "y": 3932.5550110693007,
      "radius": 50,
      "oreType": "cuprite"
    },
    {
      "x": 3685.843102349524,
      "y": -4231.062540786028,
      "radius": 10,
      "oreType": "aurite"
    },
    {
      "x": -113.79361008501121,
      "y": -4285.015032557504,
      "radius": 80,
      "oreType": "hematite"
    },
    {
      "x": -1157.520411319366,
      "y": -4673.6339117129,
      "radius": 50,
      "oreType": "cuprite"
    },
    {
      "x": -4950.2606429340985,
      "y": 831.394902575826,
      "radius": 60,
      "oreType": "aurite"
    },
    {
      "x": -3500.5861733378697,
      "y": -1207.0839221939812,
      "radius": 60,
      "oreType": "cuprite"
    },
    {
      "x": 2258.0997792443736,
      "y": 1024.5721890982672,
      "radius": 20,
      "oreType": "hematite"
    },
    {
      "x": 3572.2546552309777,
      "y": -2943.763420059757,
      "radius": 20,
      "oreType": "cuprite"
    },
    {
      "x": 4748.651867575255,
      "y": -2874.2121306207723,
      "radius": 30,
      "oreType": "cuprite"
    },
    {
      "x": 2288.504686939277,
      "y": 78.09767394333144,
      "radius": 90,
      "oreType": "cuprite"
    },
    {
      "x": -3461.1182323406188,
      "y": 4039.7590457990386,
      "radius": 30,
      "oreType": "hematite"
    },
    {
      "x": 2618.1222235439636,
      "y": -4599.4327894692515,
      "radius": 20,
      "oreType": "cuprite"
    },
    {
      "x": -1084.8511843464448,
      "y": 4426.295059160337,
      "radius": 30,
      "oreType": "hematite"
    },
    {
      "x": 2706.390262619205,
      "y": -3817.1596585682855,
      "radius": 40,
      "oreType": "cuprite"
    },
    {
      "x": -4816.86538519982,
      "y": -3057.8508854453903,
      "radius": 40,
      "oreType": "cuprite"
    },
    {
      "x": -4630.684689494759,
      "y": -2327.042584084664,
      "radius": 40,
      "oreType": "cuprite"
    },
    {
      "x": 3999.856174940817,
      "y": -3518.215743915689,
      "radius": 30,
      "oreType": "aurite"
    },
    {
      "x": 4460.648885316554,
      "y": 3994.855711626912,
      "radius": 50,
      "oreType": "hematite"
    },
    {
      "x": -2501.9409953094596,
      "y": -915.9519877711131,
      "radius": 20,
      "oreType": "cuprite"
    },
    {
      "x": 4437.011227687846,
      "y": 4483.608125066565,
      "radius": 40,
      "oreType": "cuprite"
    },
    {
      "x": -1602.9035577536588,
      "y": 3040.4954351925007,
      "radius": 40,
      "oreType": "aurite"
    },
    {
      "x": -282.235222046725,
      "y": -4042.596149162074,
      "radius": 10,
      "oreType": "cuprite"
    },
    {
      "x": -2366.1489027630078,
      "y": 1137.2803895984896,
      "radius": 30,
      "oreType": "cuprite"
    },
    {
      "x": 3625.355911911272,
      "y": -4421.90081440289,
      "radius": 100,
      "oreType": "cuprite"
    },
    {
      "x": 4566.208585195306,
      "y": 4674.473257012916,
      "radius": 10,
      "oreType": "aurite"
    },
    {
      "x": -4792.168480328099,
      "y": 1405.7228500878227,
      "radius": 20,
      "oreType": "hematite"
    },
    {
      "x": -3552.0778816142906,
      "y": 4171.109410144655,
      "radius": 20,
      "oreType": "cuprite"
    },
    {
      "x": 1325.5157374493142,
      "y": -256.33427081645397,
      "radius": 40,
      "oreType": "hematite"
    },
    {
      "x": 2396.6815316338198,
      "y": 4575.844199816379,
      "radius": 80,
      "oreType": "cuprite"
    },
    {
      "x": -2792.413480171132,
      "y": -2583.526085575596,
      "radius": 90,
      "oreType": "hematite"
    },
    {
      "x": -1421.6771642848091,
      "y": -4485.016763929075,
      "radius": 80,
      "oreType": "cuprite"
    },
    {
      "x": -3853.6315514175135,
      "y": 1766.196884985891,
      "radius": 80,
      "oreType": "cuprite"
    },
    {
      "x": -1401.5659110503354,
      "y": -3063.1799900349743,
      "radius": 30,
      "oreType": "cuprite"
    },
    {
      "x": 2358.4431413728325,
      "y": 960.3973774726793,
      "radius": 60,
      "oreType": "cuprite"
    },
    {
      "x": 1738.1597817287031,
      "y": -4882.753424112716,
      "radius": 80,
      "oreType": "hematite"
    },
    {
      "x": -1855.5341677844938,
      "y": 3556.9704057756726,
      "radius": 40,
      "oreType": "hematite"
    },
    {
      "x": 4833.549344588512,
      "y": -801.0183012033178,
      "radius": 20,
      "oreType": "hematite"
    },
    {
      "x": -339.89725693363005,
      "y": 3738.501460030037,
      "radius": 30,
      "oreType": "hematite"
    },
    {
      "x": 3156.5470942105667,
      "y": -3646.1672324453452,
      "radius": 90,
      "oreType": "hematite"
    },
    {
      "x": 4267.48608502495,
      "y": 2554.8564618004434,
      "radius": 50,
      "oreType": "cuprite"
    },
    {
      "x": -3818.847987482339,
      "y": 4212.253692904753,
      "radius": 70,
      "oreType": "aurite"
    },
    {
      "x": -3059.907995737663,
      "y": -194.83512414998793,
      "radius": 20,
      "oreType": "hematite"
    },
    {
      "x": -3564.58741676833,
      "y": -4109.836358140049,
      "radius": 10,
      "oreType": "aurite"
    },
    {
      "x": 4874.3592652457955,
      "y": 911.1541390371447,
      "radius": 90,
      "oreType": "hematite"
    },
    {
      "x": 2687.655241037412,
      "y": 3662.0314191582493,
      "radius": 30,
      "oreType": "hematite"
    },
    {
      "x": 4860.7307191105665,
      "y": 1482.6665999171018,
      "radius": 40,
      "oreType": "cuprite"
    },
    {
      "x": 4338.581970953974,
      "y": 4198.108519376978,
      "radius": 30,
      "oreType": "cuprite"
    },
    {
      "x": -2900.254266866806,
      "y": 2555.304233923221,
      "radius": 20,
      "oreType": "cuprite"
    },
    {
      "x": -1898.7709420473254,
      "y": -3650.80562288882,
      "radius": 40,
      "oreType": "cuprite"
    },
    {
      "x": -1822.6907163541316,
      "y": 2704.5032035507675,
      "radius": 70,
      "oreType": "cuprite"
    },
    {
      "x": -4098.208238813232,
      "y": -3207.2504974446892,
      "radius": 90,
      "oreType": "hematite"
    },
    {
      "x": 34.38708325391504,
      "y": 3447.301335778181,
      "radius": 30,
      "oreType": "hematite"
    },
    {
      "x": -3877.0512968612916,
      "y": -3400.7421188228905,
      "radius": 20,
      "oreType": "cuprite"
    },
    {
      "x": 4929.223222093755,
      "y": -4272.663386990359,
      "radius": 30,
      "oreType": "cuprite"
    },
    {
      "x": 4642.873611912321,
      "y": -361.32945117281156,
      "radius": 80,
      "oreType": "cuprite"
    },
    {
      "x": 2780.088135754486,
      "y": 1108.1801752607423,
      "radius": 90,
      "oreType": "cuprite"
    },
    {
      "x": -4583.041907332501,
      "y": -2064.7211469438575,
      "radius": 60,
      "oreType": "cuprite"
    },
    {
      "x": 4030.9204525369523,
      "y": -2392.865672672155,
      "radius": 80,
      "oreType": "cuprite"
    },
    {
      "x": 4323.638994707637,
      "y": -2272.4309395548125,
      "radius": 20,
      "oreType": "hematite"
    },
    {
      "x": 3819.6100313996626,
      "y": 1025.3514009682774,
      "radius": 50,
      "oreType": "hematite"
    },
    {
      "x": 2617.215160785791,
      "y": -729.6608704064233,
      "radius": 60,
      "oreType": "aurite"
    },
    {
      "x": -3449.286962349505,
      "y": 3710.341389187577,
      "radius": 100,
      "oreType": "cuprite"
    },
    {
      "x": 3448.7005904365465,
      "y": 4652.876751668109,
      "radius": 20,
      "oreType": "cuprite"
    },
    {
      "x": 225.242034180817,
      "y": 3923.459598511023,
      "radius": 30,
      "oreType": "hematite"
    },
    {
      "x": 1470.0711396368415,
      "y": 4483.287102958076,
      "radius": 30,
      "oreType": "cuprite"
    },
    {
      "x": 1265.7173642409614,
      "y": -2515.803081361592,
      "radius": 20,
      "oreType": "cuprite"
    },
    {
      "x": -2756.954263082407,
      "y": 680.7301070621663,
      "radius": 50,
      "oreType": "aurite"
    },
    {
      "x": -4620.257032332187,
      "y": -4957.22779678281,
      "radius": 90,
      "oreType": "aurite"
    },
    {
      "x": 489.3024040387095,
      "y": 4454.577577567733,
      "radius": 20,
      "oreType": "cuprite"
    },
    {
      "x": 1487.2704076235977,
      "y": -4761.65894219603,
      "radius": 50,
      "oreType": "cuprite"
    },
    {
      "x": -2496.527696879085,
      "y": 2571.347664930381,
      "radius": 20,
      "oreType": "cuprite"
    },
    {
      "x": -804.9691350584176,
      "y": 495.31442807285276,
      "radius": 50,
      "oreType": "cuprite"
    },
    {
      "x": 1866.8816010680955,
      "y": -3276.2995420863185,
      "radius": 40,
      "oreType": "cuprite"
    },
    {
      "x": 4882.38559811589,
      "y": -3010.8413751389685,
      "radius": 30,
      "oreType": "cuprite"
    },
    {
      "x": -189.14928429055067,
      "y": -1090.3697340298725,
      "radius": 20,
      "oreType": "hematite"
    },
    {
      "x": -3388.892801620993,
      "y": 4838.372643085978,
      "radius": 50,
      "oreType": "hematite"
    },
    {
      "x": -774.2060400802164,
      "y": -4568.989651911524,
      "radius": 20,
      "oreType": "aurite"
    },
    {
      "x": -1856.1068199626663,
      "y": -1685.5409314719493,
      "radius": 40,
      "oreType": "hematite"
    },
    {
      "x": -984.270997038268,
      "y": 3326.2421855876,
      "radius": 60,
      "oreType": "cuprite"
    },
    {
      "x": 4681.66915745142,
      "y": -3121.7200280584148,
      "radius": 20,
      "oreType": "cuprite"
    },
    {
      "x": -2513.9914235128667,
      "y": 674.8838114322342,
      "radius": 70,
      "oreType": "cuprite"
    },
    {
      "x": -1062.5519121015702,
      "y": -529.7982252744471,
      "radius": 20,
      "oreType": "cuprite"
    },
    {
      "x": -1526.2317660378333,
      "y": -2540.0022441896253,
      "radius": 50,
      "oreType": "cuprite"
    },
    {
      "x": 248.6693846077026,
      "y": 2171.865598169729,
      "radius": 50,
      "oreType": "cuprite"
    },
    {
      "x": 1980.9983483137316,
      "y": 3996.5111471880487,
      "radius": 20,
      "oreType": "aurite"
    },
    {
      "x": -1770.0024859587747,
      "y": -2192.348485016957,
      "radius": 10,
      "oreType": "cuprite"
    },
    {
      "x": 1790.7629837083184,
      "y": -4202.37446525846,
      "radius": 20,
      "oreType": "cuprite"
    },
    {
      "x": 3080.217326026078,
      "y": -4702.624635954196,
      "radius": 70,
      "oreType": "cuprite"
    },
    {
      "x": -2828.4400157300624,
      "y": -1501.7241939199132,
      "radius": 20,
      "oreType": "cuprite"
    },
    {
      "x": -2225.21420224957,
      "y": -520.1859426695421,
      "radius": 30,
      "oreType": "cuprite"
    },
    {
      "x": 3837.5700186509243,
      "y": -4228.719941762993,
      "radius": 20,
      "oreType": "cuprite"
    },
    {
      "x": 4287.575722361809,
      "y": 859.3102257503605,
      "radius": 90,
      "oreType": "cuprite"
    },
    {
      "x": -4137.396801328572,
      "y": -4896.076491535577,
      "radius": 30,
      "oreType": "hematite"
    },
    {
      "x": 2214.360586787061,
      "y": 1182.7809698475833,
      "radius": 30,
      "oreType": "cuprite"
    },
    {
      "x": -3449.514611705213,
      "y": -1687.7484219976657,
      "radius": 80,
      "oreType": "cuprite"
    },
    {
      "x": -577.0559884840166,
      "y": 237.04903548189105,
      "radius": 30,
      "oreType": "aurite"
    },
    {
      "x": 4676.410896102947,
      "y": -675.1741452886683,
      "radius": 10,
      "oreType": "cuprite"
    },
    {
      "x": 2420.6264336005966,
      "y": -452.4841153700243,
      "radius": 10,
      "oreType": "cuprite"
    },
    {
      "x": -1274.7007698044843,
      "y": -2366.2707575188647,
      "radius": 20,
      "oreType": "cuprite"
    },
    {
      "x": -4150.716865652959,
      "y": -775.725643836167,
      "radius": 70,
      "oreType": "cuprite"
    },
    {
      "x": 3261.2504576251245,
      "y": 3157.5612991489656,
      "radius": 20,
      "oreType": "aurite"
    },
    {
      "x": 4305.527312722764,
      "y": -3432.8756854170874,
      "radius": 70,
      "oreType": "cuprite"
    },
    {
      "x": -1806.5598002590532,
      "y": 4796.9984360114995,
      "radius": 50,
      "oreType": "aurite"
    },
    {
      "x": 4337.269666553041,
      "y": -58.720245918713054,
      "radius": 70,
      "oreType": "cuprite"
    },
    {
      "x": 3444.695447372963,
      "y": 2593.734010108899,
      "radius": 10,
      "oreType": "cuprite"
    },
    {
      "x": -4557.79824797202,
      "y": 4039.495837787326,
      "radius": 40,
      "oreType": "cuprite"
    },
    {
      "x": 927.6172361332335,
      "y": 4619.740590976742,
      "radius": 40,
      "oreType": "cuprite"
    },
    {
      "x": 3844.327882182086,
      "y": -3229.302652898236,
      "radius": 70,
      "oreType": "cuprite"
    },
    {
      "x": 1579.593805456523,
      "y": 3589.4211061697347,
      "radius": 70,
      "oreType": "cuprite"
    },
    {
      "x": 4965.8322595506825,
      "y": 3646.0381493466352,
      "radius": 70,
      "oreType": "aurite"
    },
    {
      "x": -1197.636241581821,
      "y": 1449.1631330730836,
      "radius": 40,
      "oreType": "hematite"
    },
    {
      "x": -2715.0854383002797,
      "y": 3136.574532203302,
      "radius": 20,
      "oreType": "cuprite"
    },
    {
      "x": -4514.829090131145,
      "y": 3605.547427073006,
      "radius": 60,
      "oreType": "aurite"
    },
    {
      "x": 1455.2053875731308,
      "y": -129.55878063030335,
      "radius": 60,
      "oreType": "hematite"
    },
    {
      "x": 3756.06136212002,
      "y": 3029.9793784628814,
      "radius": 60,
      "oreType": "cuprite"
    },
    {
      "x": 4815.361554050201,
      "y": 2760.27721368981,
      "radius": 50,
      "oreType": "cuprite"
    },
    {
      "x": -4012.862023991592,
      "y": -457.13861723800653,
      "radius": 80,
      "oreType": "cuprite"
    },
    {
      "x": 1372.183613999085,
      "y": 3918.941219572123,
      "radius": 30,
      "oreType": "cuprite"
    },
    {
      "x": 4153.943129700741,
      "y": -2145.8656564988355,
      "radius": 60,
      "oreType": "aurite"
    },
    {
      "x": -1499.2519844992546,
      "y": 2918.068407625367,
      "radius": 70,
      "oreType": "aurite"
    },
    {
      "x": 4611.944492451625,
      "y": 1681.3989507718197,
      "radius": 30,
      "oreType": "cuprite"
    },
    {
      "x": 4012.15471725916,
      "y": -4195.248338008668,
      "radius": 50,
      "oreType": "cuprite"
    },
    {
      "x": -2254.075847267922,
      "y": 661.5279181264256,
      "radius": 60,
      "oreType": "cuprite"
    },
    {
      "x": -1169.1322041193696,
      "y": 3639.627107819805,
      "radius": 60,
      "oreType": "cuprite"
    },
    {
      "x": -824.5974415661706,
      "y": -3678.7049823425245,
      "radius": 90,
      "oreType": "hematite"
    },
    {
      "x": -2447.8134642951277,
      "y": -1974.2440428015539,
      "radius": 80,
      "oreType": "cuprite"
    },
    {
      "x": -3751.091765496093,
      "y": 281.3885116033732,
      "radius": 60,
      "oreType": "hematite"
    },
    {
      "x": -1507.4331507171369,
      "y": -577.6713335263084,
      "radius": 50,
      "oreType": "cuprite"
    },
    {
      "x": 194.7139838125511,
      "y": 4755.297234371583,
      "radius": 20,
      "oreType": "cuprite"
    },
    {
      "x": 4831.398475234619,
      "y": 1847.1592042783525,
      "radius": 30,
      "oreType": "hematite"
    },
    {
      "x": -4387.3608315964475,
      "y": 3499.1447950022934,
      "radius": 80,
      "oreType": "cuprite"
    },
    {
      "x": 4225.53429546946,
      "y": -4262.500452947853,
      "radius": 50,
      "oreType": "cuprite"
    },
    {
      "x": -3562.338221628223,
      "y": 1662.49325035988,
      "radius": 90,
      "oreType": "cuprite"
    },
    {
      "x": 2307.8412521919913,
      "y": -3367.7100967514084,
      "radius": 70,
      "oreType": "hematite"
    },
    {
      "x": 1408.3811038552985,
      "y": -2745.9492244270023,
      "radius": 10,
      "oreType": "hematite"
    },
    {
      "x": 3810.486972380929,
      "y": -4609.387977366914,
      "radius": 60,
      "oreType": "cuprite"
    },
    {
      "x": -4833.031416417626,
      "y": 559.6306786129279,
      "radius": 20,
      "oreType": "aurite"
    },
    {
      "x": -4105.109245205931,
      "y": 2042.915056599972,
      "radius": 10,
      "oreType": "cuprite"
    },
    {
      "x": -3721.30327564838,
      "y": -1237.328925434269,
      "radius": 80,
      "oreType": "hematite"
    },
    {
      "x": 1266.934701114708,
      "y": -4931.597574935793,
      "radius": 60,
      "oreType": "cuprite"
    },
    {
      "x": 2150.4872419032386,
      "y": -3609.2462510230216,
      "radius": 70,
      "oreType": "hematite"
    },
    {
      "x": -1605.7308391607705,
      "y": -4225.32801312558,
      "radius": 60,
      "oreType": "aurite"
    },
    {
      "x": -2230.0897996294534,
      "y": 3889.450402573078,
      "radius": 60,
      "oreType": "cuprite"
    },
    {
      "x": -1103.4890342404346,
      "y": -3088.566958068155,
      "radius": 20,
      "oreType": "hematite"
    },
    {
      "x": -260.03690736522645,
      "y": -1868.222051598152,
      "radius": 20,
      "oreType": "cuprite"
    },
    {
      "x": 1232.9574268799636,
      "y": -428.6599671065749,
      "radius": 40,
      "oreType": "aurite"
    },
    {
      "x": 4656.308168849634,
      "y": 3021.6640841602025,
      "radius": 10,
      "oreType": "cuprite"
    },
    {
      "x": 2753.579693472168,
      "y": 432.62203419025093,
      "radius": 30,
      "oreType": "cuprite"
    },
    {
      "x": 4145.871079377943,
      "y": 666.8091070671367,
      "radius": 30,
      "oreType": "hematite"
    },
    {
      "x": -3792.1941964502316,
      "y": 2637.7750826940073,
      "radius": 50,
      "oreType": "cuprite"
    },
    {
      "x": -3353.9031246223994,
      "y": 3928.599037132119,
      "radius": 20,
      "oreType": "cuprite"
    },
    {
      "x": 148.36990700344722,
      "y": -4308.911899726917,
      "radius": 50,
      "oreType": "hematite"
    },
    {
      "x": -247.2611692021065,
      "y": -4896.623897798311,
      "radius": 20,
      "oreType": "cuprite"
    },
    {
      "x": 2410.8322644472023,
      "y": 3007.026147972127,
      "radius": 70,
      "oreType": "cuprite"
    },
    {
      "x": -3883.5550315322243,
      "y": -981.8276769379008,
      "radius": 20,
      "oreType": "hematite"
    },
    {
      "x": -4039.9317790171053,
      "y": 1411.9698468284448,
      "radius": 80,
      "oreType": "aurite"
    },
    {
      "x": 440.582900028339,
      "y": 4084.323168174524,
      "radius": 30,
      "oreType": "cuprite"
    },
    {
      "x": -123.09294622717681,
      "y": 2189.8280267562463,
      "radius": 30,
      "oreType": "cuprite"
    },
    {
      "x": -4112.513861428264,
      "y": -2337.6904141869613,
      "radius": 40,
      "oreType": "cuprite"
    },
    {
      "x": -4477.268731564388,
      "y": 1587.960210994963,
      "radius": 70,
      "oreType": "cuprite"
    },
    {
      "x": 3565.3460080321443,
      "y": 4172.707046929285,
      "radius": 20,
      "oreType": "cuprite"
    },
    {
      "x": -875.5872361496308,
      "y": 940.3427315349422,
      "radius": 40,
      "oreType": "cuprite"
    },
    {
      "x": -3169.613704586247,
      "y": 4833.720897976126,
      "radius": 90,
      "oreType": "cuprite"
    },
    {
      "x": 565.3076257798251,
      "y": 3311.9826966563105,
      "radius": 40,
      "oreType": "hematite"
    },
    {
      "x": 1358.177232461244,
      "y": -2682.3370658926924,
      "radius": 40,
      "oreType": "hematite"
    },
    {
      "x": -1110.5902478142182,
      "y": 2130.89736476624,
      "radius": 10,
      "oreType": "hematite"
    },
    {
      "x": 4636.221481419431,
      "y": 4492.804892635382,
      "radius": 90,
      "oreType": "aurite"
    },
    {
      "x": -3562.687039437038,
      "y": 585.6899580021624,
      "radius": 50,
      "oreType": "hematite"
    },
    {
      "x": 2661.9120189862388,
      "y": 3208.564431499583,
      "radius": 80,
      "oreType": "cuprite"
    },
    {
      "x": -3764.6982486263214,
      "y": -2164.8894098956894,
      "radius": 40,
      "oreType": "aurite"
    },
    {
      "x": 998.8605359854241,
      "y": 3990.6198127756866,
      "radius": 50,
      "oreType": "cuprite"
    },
    {
      "x": 2058.673738169552,
      "y": 3046.573490048543,
      "radius": 20,
      "oreType": "hematite"
    },
    {
      "x": -3033.32808323308,
      "y": -1289.7005667558092,
      "radius": 80,
      "oreType": "hematite"
    },
    {
      "x": 3913.3524308247725,
      "y": 433.9059221386909,
      "radius": 50,
      "oreType": "aurite"
    },
    {
      "x": -4679.235704028404,
      "y": -4446.72601531475,
      "radius": 40,
      "oreType": "cuprite"
    },
    {
      "x": -1405.7368449545327,
      "y": 4088.9475010940846,
      "radius": 20,
      "oreType": "hematite"
    },
    {
      "x": -3882.05523361951,
      "y": -1324.0480486518602,
      "radius": 40,
      "oreType": "hematite"
    },
    {
      "x": 2957.47106484733,
      "y": -1041.8353556478976,
      "radius": 70,
      "oreType": "hematite"
    },
    {
      "x": -3465.6045574669015,
      "y": -839.4217684063809,
      "radius": 40,
      "oreType": "cuprite"
    },
    {
      "x": -4062.602092303027,
      "y": -3618.660623924601,
      "radius": 100,
      "oreType": "cuprite"
    },
    {
      "x": -1451.6973583595473,
      "y": 3422.5940029863123,
      "radius": 40,
      "oreType": "aurite"
    },
    {
      "x": -1897.5174652056714,
      "y": -3998.5016117468276,
      "radius": 90,
      "oreType": "cuprite"
    },
    {
      "x": -1824.1255945692126,
      "y": -3733.9607460954194,
      "radius": 50,
      "oreType": "cuprite"
    },
    {
      "x": 1130.3408947657333,
      "y": -4019.94605396458,
      "radius": 50,
      "oreType": "cuprite"
    },
    {
      "x": 3262.954879482285,
      "y": -4103.638511635512,
      "radius": 60,
      "oreType": "cuprite"
    },
    {
      "x": 3581.403775853631,
      "y": -1462.0252666714762,
      "radius": 20,
      "oreType": "cuprite"
    },
    {
      "x": 1531.7852457816095,
      "y": -1996.7365754974553,
      "radius": 20,
      "oreType": "cuprite"
    },
    {
      "x": -878.5053970345214,
      "y": -4548.587410123379,
      "radius": 30,
      "oreType": "cuprite"
    },
    {
      "x": -1116.626780395391,
      "y": -399.49633662239137,
      "radius": 30,
      "oreType": "aurite"
    },
    {
      "x": 4219.310870822186,
      "y": 4066.828300560208,
      "radius": 40,
      "oreType": "cuprite"
    },
    {
      "x": 1355.1448109414132,
      "y": 2058.695169569136,
      "radius": 20,
      "oreType": "hematite"
    },
    {
      "x": 4596.076117769537,
      "y": -3130.1560386113824,
      "radius": 30,
      "oreType": "cuprite"
    },
    {
      "x": -116.87461111735465,
      "y": 2334.0963666012526,
      "radius": 10,
      "oreType": "cuprite"
    },
    {
      "x": 4613.00235015047,
      "y": 3118.4016157003593,
      "radius": 50,
      "oreType": "cuprite"
    },
    {
      "x": -2914.9406954875913,
      "y": -4264.2803260273495,
      "radius": 70,
      "oreType": "hematite"
    },
    {
      "x": 3859.5835068992756,
      "y": 610.2075708265287,
      "radius": 80,
      "oreType": "hematite"
    },
    {
      "x": 0.06658701714234994,
      "y": 4727.286040354302,
      "radius": 40,
      "oreType": "cuprite"
    },
    {
      "x": 4348.083691036815,
      "y": -3079.965566279681,
      "radius": 30,
      "oreType": "hematite"
    },
    {
      "x": 1403.094845834838,
      "y": 2555.0127694126813,
      "radius": 80,
      "oreType": "cuprite"
    },
    {
      "x": 64.25758924145653,
      "y": 4855.442142671855,
      "radius": 60,
      "oreType": "cuprite"
    },
    {
      "x": 4882.146960417617,
      "y": 2971.24673925105,
      "radius": 40,
      "oreType": "cuprite"
    },
    {
      "x": -1178.3355559449826,
      "y": -643.6034466299944,
      "radius": 20,
      "oreType": "hematite"
    },
    {
      "x": -3463.129107147962,
      "y": -264.94042521393754,
      "radius": 20,
      "oreType": "hematite"
    },
    {
      "x": -4648.800639627342,
      "y": -1901.0832291315971,
      "radius": 30,
      "oreType": "hematite"
    },
    {
      "x": 1082.52099951357,
      "y": 2046.071196331647,
      "radius": 90,
      "oreType": "hematite"
    },
    {
      "x": -3681.1363096861683,
      "y": 3957.8073765170398,
      "radius": 60,
      "oreType": "cuprite"
    },
    {
      "x": -2014.9834055003812,
      "y": 556.7689990754343,
      "radius": 90,
      "oreType": "cuprite"
    },
    {
      "x": 3084.889858002604,
      "y": 898.1326624821628,
      "radius": 40,
      "oreType": "hematite"
    },
    {
      "x": 1878.856821994659,
      "y": 4572.9340775331575,
      "radius": 70,
      "oreType": "cuprite"
    },
    {
      "x": -3103.200382696496,
      "y": 219.00513675786382,
      "radius": 100,
      "oreType": "hematite"
    },
    {
      "x": -211.76516162488167,
      "y": 16.895349235275248,
      "radius": 30,
      "oreType": "cuprite"
    },
    {
      "x": -1362.9065914273374,
      "y": -1280.4372358480753,
      "radius": 20,
      "oreType": "hematite"
    },
    {
      "x": 3431.903484982699,
      "y": 397.83218994797085,
      "radius": 70,
      "oreType": "cuprite"
    },
    {
      "x": -4763.436891674249,
      "y": -1138.9382798690174,
      "radius": 20,
      "oreType": "aurite"
    },
    {
      "x": 822.1845729800892,
      "y": -1782.5220583900502,
      "radius": 40,
      "oreType": "cuprite"
    },
    {
      "x": 3606.182434188474,
      "y": 2284.0538557661193,
      "radius": 40,
      "oreType": "aurite"
    },
    {
      "x": -1273.7126093039142,
      "y": 107.59549951068425,
      "radius": 80,
      "oreType": "hematite"
    },
    {
      "x": 2755.4840432484816,
      "y": 4907.976087934907,
      "radius": 20,
      "oreType": "cuprite"
    },
    {
      "x": 4260.176677358744,
      "y": -4071.1583859036127,
      "radius": 40,
      "oreType": "cuprite"
    },
    {
      "x": 3922.9888473956407,
      "y": -3579.551067800071,
      "radius": 20,
      "oreType": "aurite"
    },
    {
      "x": 4896.301168909525,
      "y": 4348.002588881383,
      "radius": 90,
      "oreType": "hematite"
    },
    {
      "x": -1376.8313546150869,
      "y": -2829.825926157794,
      "radius": 50,
      "oreType": "aurite"
    },
    {
      "x": 1816.853462261845,
      "y": -2745.261915787911,
      "radius": 70,
      "oreType": "aurite"
    },
    {
      "x": 1174.0057237832514,
      "y": 4406.654273419739,
      "radius": 80,
      "oreType": "cuprite"
    },
    {
      "x": -2132.3047693404806,
      "y": 4369.133777457979,
      "radius": 100,
      "oreType": "cuprite"
    },
    {
      "x": -4661.370102360449,
      "y": 1425.8984134103182,
      "radius": 30,
      "oreType": "cuprite"
    },
    {
      "x": -3835.2980455354577,
      "y": 4431.436947085161,
      "radius": 10,
      "oreType": "aurite"
    },
    {
      "x": -1395.7137897295247,
      "y": -4042.2904192867513,
      "radius": 40,
      "oreType": "hematite"
    },
    {
      "x": 1107.1902651528799,
      "y": -343.7084816173175,
      "radius": 10,
      "oreType": "cuprite"
    },
    {
      "x": -2812.591326825682,
      "y": -4814.532542068355,
      "radius": 30,
      "oreType": "cuprite"
    },
    {
      "x": -1040.562873398012,
      "y": -1443.957292768594,
      "radius": 20,
      "oreType": "cuprite"
    },
    {
      "x": 2529.575559637822,
      "y": -4639.761507958693,
      "radius": 40,
      "oreType": "cuprite"
    },
    {
      "x": 4516.956014525571,
      "y": 4214.025147830245,
      "radius": 90,
      "oreType": "aurite"
    },
    {
      "x": -1237.0320788310041,
      "y": -3999.184924204495,
      "radius": 70,
      "oreType": "hematite"
    },
    {
      "x": 4643.024984748829,
      "y": -1717.3682843390802,
      "radius": 60,
      "oreType": "hematite"
    },
    {
      "x": 1845.036368817543,
      "y": 2751.265658078923,
      "radius": 60,
      "oreType": "cuprite"
    },
    {
      "x": -3916.318710118687,
      "y": -310.5184569776553,
      "radius": 40,
      "oreType": "hematite"
    },
    {
      "x": 4364.7012271140475,
      "y": -1436.1203552130441,
      "radius": 20,
      "oreType": "aurite"
    },
    {
      "x": -4642.529542205051,
      "y": -737.3595401079824,
      "radius": 10,
      "oreType": "cuprite"
    },
    {
      "x": -848.5738492265793,
      "y": -3487.3391590917645,
      "radius": 20,
      "oreType": "aurite"
    },
    {
      "x": -3076.6179032173004,
      "y": -1152.7255983707319,
      "radius": 20,
      "oreType": "hematite"
    },
    {
      "x": 4087.704532109029,
      "y": -4006.1708300187047,
      "radius": 30,
      "oreType": "cuprite"
    },
    {
      "x": 3859.735472355412,
      "y": -3778.1493786344768,
      "radius": 40,
      "oreType": "aurite"
    },
    {
      "x": -3560.5184483002026,
      "y": 1123.937918025315,
      "radius": 90,
      "oreType": "cuprite"
    },
    {
      "x": -3708.8803604357513,
      "y": 2128.4758881419584,
      "radius": 20,
      "oreType": "hematite"
    },
    {
      "x": 4929.106776161143,
      "y": -4391.127841627751,
      "radius": 60,
      "oreType": "aurite"
    },
    {
      "x": -2640.548215492355,
      "y": -1932.1601357418406,
      "radius": 80,
      "oreType": "hematite"
    },
    {
      "x": -2560.172007792849,
      "y": 3574.04281067198,
      "radius": 80,
      "oreType": "aurite"
    },
    {
      "x": 1920.6170884344576,
      "y": -20.62830285868067,
      "radius": 80,
      "oreType": "aurite"
    },
    {
      "x": 2866.1844677911995,
      "y": 631.140605649323,
      "radius": 50,
      "oreType": "cuprite"
    },
    {
      "x": -1169.7825721884558,
      "y": -1766.28652024722,
      "radius": 90,
      "oreType": "cuprite"
    },
    {
      "x": -1322.7997710561913,
      "y": 1501.773190690936,
      "radius": 40,
      "oreType": "cuprite"
    },
    {
      "x": 1885.2377204173188,
      "y": 107.34447216853793,
      "radius": 30,
      "oreType": "cuprite"
    },
    {
      "x": -4226.883225997642,
      "y": 785.469447082392,
      "radius": 20,
      "oreType": "cuprite"
    },
    {
      "x": 4286.686633603212,
      "y": -3272.5167477056893,
      "radius": 40,
      "oreType": "cuprite"
    },
    {
      "x": -2381.7070730429023,
      "y": 4787.359121876151,
      "radius": 80,
      "oreType": "aurite"
    },
    {
      "x": -4166.183184190304,
      "y": -1766.350649212085,
      "radius": 30,
      "oreType": "aurite"
    },
    {
      "x": -2279.147129839816,
      "y": 2212.269324980001,
      "radius": 90,
      "oreType": "aurite"
    },
    {
      "x": 4300.8911538081375,
      "y": 4538.862600797668,
      "radius": 80,
      "oreType": "cuprite"
    },
    {
      "x": -1533.6016630922745,
      "y": 4577.446706963661,
      "radius": 40,
      "oreType": "cuprite"
    },
    {
      "x": -2355.539598620169,
      "y": 806.587867641333,
      "radius": 30,
      "oreType": "hematite"
    },
    {
      "x": -64.24750299330206,
      "y": 3442.349339316286,
      "radius": 30,
      "oreType": "hematite"
    },
    {
      "x": -1377.0119542281357,
      "y": -3450.9769710300798,
      "radius": 30,
      "oreType": "aurite"
    },
    {
      "x": -4933.810290218185,
      "y": -932.6925098843897,
      "radius": 50,
      "oreType": "cuprite"
    },
    {
      "x": -166.07879302159122,
      "y": 4385.9834061626325,
      "radius": 90,
      "oreType": "aurite"
    },
    {
      "x": -2702.2695471978263,
      "y": 1614.7451940988456,
      "radius": 60,
      "oreType": "aurite"
    },
    {
      "x": -1823.6182343325092,
      "y": 1601.5757610932835,
      "radius": 10,
      "oreType": "cuprite"
    },
    {
      "x": 1227.504643981374,
      "y": -264.05815403729883,
      "radius": 10,
      "oreType": "cuprite"
    },
    {
      "x": -329.2560416739088,
      "y": 2487.6662841580787,
      "radius": 70,
      "oreType": "hematite"
    },
    {
      "x": 2579.283602721565,
      "y": 4570.738136279478,
      "radius": 60,
      "oreType": "aurite"
    },
    {
      "x": 112.81009909714479,
      "y": -2425.0862773757963,
      "radius": 40,
      "oreType": "aurite"
    },
    {
      "x": -2906.4222104499527,
      "y": 467.27704655247226,
      "radius": 80,
      "oreType": "aurite"
    },
    {
      "x": -661.6707895060281,
      "y": 175.07438221680215,
      "radius": 40,
      "oreType": "hematite"
    },
    {
      "x": 1980.1226321523834,
      "y": -3753.080306710841,
      "radius": 20,
      "oreType": "aurite"
    },
    {
      "x": -2368.4755732589124,
      "y": -2197.7520499456136,
      "radius": 90,
      "oreType": "cuprite"
    },
    {
      "x": -4947.319564296242,
      "y": -4452.68710123897,
      "radius": 50,
      "oreType": "cuprite"
    },
    {
      "x": -3911.4871367166693,
      "y": 4932.715325381667,
      "radius": 30,
      "oreType": "cuprite"
    },
    {
      "x": 2827.101113254296,
      "y": 4660.07670805777,
      "radius": 40,
      "oreType": "cuprite"
    },
    {
      "x": -3214.445195524689,
      "y": -69.7047038860199,
      "radius": 80,
      "oreType": "hematite"
    },
    {
      "x": -4183.905941864343,
      "y": -1611.3879634965444,
      "radius": 20,
      "oreType": "aurite"
    },
    {
      "x": -4990.590317831549,
      "y": -1274.3133027497854,
      "radius": 10,
      "oreType": "cuprite"
    },
    {
      "x": 2743.2165580497704,
      "y": 881.0902313474589,
      "radius": 20,
      "oreType": "aurite"
    },
    {
      "x": -2056.177554715919,
      "y": 2349.0925111724505,
      "radius": 30,
      "oreType": "hematite"
    },
    {
      "x": -1293.1521936053468,
      "y": 3917.977547193563,
      "radius": 80,
      "oreType": "hematite"
    },
    {
      "x": 4440.454201930777,
      "y": -3521.5148744286284,
      "radius": 30,
      "oreType": "hematite"
    },
    {
      "x": 4596.053211484598,
      "y": 259.7676274278604,
      "radius": 60,
      "oreType": "cuprite"
    },
    {
      "x": -2624.7986231813793,
      "y": 3326.137946781278,
      "radius": 50,
      "oreType": "hematite"
    },
    {
      "x": 1364.6154491184382,
      "y": -2579.6971532687116,
      "radius": 10,
      "oreType": "cuprite"
    },
    {
      "x": -1666.7277963427684,
      "y": 1525.021510326714,
      "radius": 90,
      "oreType": "aurite"
    },
    {
      "x": 4146.789054068851,
      "y": 2367.685636618604,
      "radius": 90,
      "oreType": "cuprite"
    },
    {
      "x": -1907.0149262951409,
      "y": -383.6481389684909,
      "radius": 10,
      "oreType": "cuprite"
    },
    {
      "x": 3493.5058273074305,
      "y": 2378.5339375154767,
      "radius": 40,
      "oreType": "aurite"
    },
    {
      "x": 1746.3171346436068,
      "y": -356.4656349758533,
      "radius": 10,
      "oreType": "hematite"
    },
    {
      "x": -4199.954850764207,
      "y": 2721.075177006633,
      "radius": 60,
      "oreType": "hematite"
    },
    {
      "x": 3846.3001502063744,
      "y": 2.732923594144232,
      "radius": 70,
      "oreType": "cuprite"
    },
    {
      "x": 3642.8496738151252,
      "y": 3154.739547094534,
      "radius": 50,
      "oreType": "cuprite"
    },
    {
      "x": 4134.881073658429,
      "y": 1571.289882923197,
      "radius": 40,
      "oreType": "cuprite"
    },
    {
      "x": -1318.5581325356234,
      "y": -3556.370555171455,
      "radius": 30,
      "oreType": "cuprite"
    },
    {
      "x": -1630.7421902012732,
      "y": -3974.8305721351794,
      "radius": 30,
      "oreType": "aurite"
    },
    {
      "x": 3143.3362636415495,
      "y": -281.77736095030605,
      "radius": 40,
      "oreType": "cuprite"
    },
    {
      "x": 783.966382643062,
      "y": -1869.0107090550168,
      "radius": 20,
      "oreType": "aurite"
    },
    {
      "x": -4381.143426378145,
      "y": 311.73604081254246,
      "radius": 60,
      "oreType": "cuprite"
    },
    {
      "x": -4543.538229599338,
      "y": -4455.040494212283,
      "radius": 30,
      "oreType": "cuprite"
    },
    {
      "x": 3551.929450051934,
      "y": -2808.509255181426,
      "radius": 40,
      "oreType": "cuprite"
    },
    {
      "x": -4522.387052939652,
      "y": 1314.4628197889085,
      "radius": 30,
      "oreType": "cuprite"
    },
    {
      "x": 4134.037494547338,
      "y": -1033.6521775335304,
      "radius": 70,
      "oreType": "cuprite"
    },
    {
      "x": 647.5293373794866,
      "y": 2455.3417135741042,
      "radius": 40,
      "oreType": "hematite"
    },
    {
      "x": -4475.9816410032545,
      "y": -1195.1151841051756,
      "radius": 20,
      "oreType": "aurite"
    },
    {
      "x": 3627.063358476825,
      "y": 1703.0881499148597,
      "radius": 40,
      "oreType": "cuprite"
    },
    {
      "x": -1461.9560035742363,
      "y": 4830.462752676614,
      "radius": 70,
      "oreType": "cuprite"
    },
    {
      "x": -1995.0328621915457,
      "y": 4628.627326085874,
      "radius": 100,
      "oreType": "hematite"
    },
    {
      "x": -4851.861920016098,
      "y": 2539.0684679464657,
      "radius": 80,
      "oreType": "cuprite"
    },
    {
      "x": -871.4892353450066,
      "y": -4009.4350819730385,
      "radius": 50,
      "oreType": "cuprite"
    },
    {
      "x": 974.710875541136,
      "y": -440.630040517247,
      "radius": 80,
      "oreType": "cuprite"
    },
    {
      "x": 4412.122594924399,
      "y": 3591.3945361566603,
      "radius": 20,
      "oreType": "cuprite"
    },
    {
      "x": -2815.477062432108,
      "y": -1809.7646181934924,
      "radius": 50,
      "oreType": "aurite"
    },
    {
      "x": 957.6479308561114,
      "y": -651.0395352617504,
      "radius": 40,
      "oreType": "cuprite"
    },
    {
      "x": -4426.777551271215,
      "y": 1385.9740533500476,
      "radius": 70,
      "oreType": "cuprite"
    },
    {
      "x": -2801.516746394768,
      "y": 1771.1484484290563,
      "radius": 60,
      "oreType": "aurite"
    },
    {
      "x": -3416.510271510613,
      "y": -556.3347807096463,
      "radius": 10,
      "oreType": "cuprite"
    },
    {
      "x": 1840.1944666928925,
      "y": 297.569634740551,
      "radius": 90,
      "oreType": "cuprite"
    },
    {
      "x": 4924.831741733864,
      "y": 2481.359244201209,
      "radius": 10,
      "oreType": "hematite"
    },
    {
      "x": 4055.842331649564,
      "y": 3851.5863488829514,
      "radius": 70,
      "oreType": "hematite"
    },
    {
      "x": 4644.624930157613,
      "y": -1582.5149663008276,
      "radius": 60,
      "oreType": "cuprite"
    },
    {
      "x": 3615.5587107019073,
      "y": 2092.589475130111,
      "radius": 60,
      "oreType": "cuprite"
    },
    {
      "x": 1578.2399582447426,
      "y": 3744.8784511430877,
      "radius": 30,
      "oreType": "cuprite"
    },
    {
      "x": -580.5764063239005,
      "y": -4862.018955173539,
      "radius": 10,
      "oreType": "cuprite"
    },
    {
      "x": 1237.280228369777,
      "y": 3413.069541133618,
      "radius": 20,
      "oreType": "hematite"
    },
    {
      "x": 4744.055030021743,
      "y": -4482.46874403424,
      "radius": 40,
      "oreType": "aurite"
    },
    {
      "x": -634.5565699932276,
      "y": -4254.869566292481,
      "radius": 30,
      "oreType": "aurite"
    },
    {
      "x": -3227.0559224314675,
      "y": -1488.7302677980617,
      "radius": 10,
      "oreType": "aurite"
    },
    {
      "x": -3594.393402226277,
      "y": -4722.072641123005,
      "radius": 20,
      "oreType": "hematite"
    },
    {
      "x": 1803.079655657849,
      "y": -1330.611600457532,
      "radius": 70,
      "oreType": "cuprite"
    },
    {
      "x": 933.3663654459623,
      "y": -2176.627408056997,
      "radius": 60,
      "oreType": "cuprite"
    },
    {
      "x": 2142.677479506283,
      "y": -1395.9109023692663,
      "radius": 10,
      "oreType": "cuprite"
    },
    {
      "x": -4829.771020688851,
      "y": -42.43360067980318,
      "radius": 70,
      "oreType": "hematite"
    },
    {
      "x": -2796.0713593914365,
      "y": 3782.2994919844223,
      "radius": 20,
      "oreType": "cuprite"
    },
    {
      "x": -3863.572473319965,
      "y": -3184.8161100081616,
      "radius": 20,
      "oreType": "hematite"
    },
    {
      "x": 4431.436427740214,
      "y": 3233.7094601220206,
      "radius": 50,
      "oreType": "cuprite"
    },
    {
      "x": 4156.098139514366,
      "y": -4095.747894577353,
      "radius": 30,
      "oreType": "cuprite"
    },
    {
      "x": -522.8566621284192,
      "y": -2198.3348920618596,
      "radius": 10,
      "oreType": "aurite"
    },
    {
      "x": 3062.5799380652643,
      "y": -4136.578149634922,
      "radius": 50,
      "oreType": "cuprite"
    },
    {
      "x": -4501.868784624196,
      "y": -3618.208395161853,
      "radius": 10,
      "oreType": "hematite"
    },
    {
      "x": 3003.499567111556,
      "y": 4303.319355461516,
      "radius": 30,
      "oreType": "cuprite"
    },
    {
      "x": 2610.0941440193483,
      "y": -3880.125338875051,
      "radius": 20,
      "oreType": "cuprite"
    },
    {
      "x": 4927.861375239315,
      "y": 3407.313190162955,
      "radius": 70,
      "oreType": "aurite"
    },
    {
      "x": 4551.938206371659,
      "y": -1148.0659489321977,
      "radius": 60,
      "oreType": "cuprite"
    },
    {
      "x": 2462.035236955493,
      "y": -755.0473464115215,
      "radius": 50,
      "oreType": "cuprite"
    },
    {
      "x": 1471.9958841329085,
      "y": 4149.2274093606675,
      "radius": 50,
      "oreType": "hematite"
    },
    {
      "x": 3318.8525129285163,
      "y": 4062.7028484812054,
      "radius": 70,
      "oreType": "hematite"
    },
    {
      "x": 19.298751237535328,
      "y": 4118.474195346284,
      "radius": 20,
      "oreType": "aurite"
    },
    {
      "x": -4982.243069734093,
      "y": -607.7553586768114,
      "radius": 20,
      "oreType": "aurite"
    },
    {
      "x": 3735.6884276274504,
      "y": -1467.2982505527355,
      "radius": 10,
      "oreType": "aurite"
    },
    {
      "x": -4009.4711926225737,
      "y": -1409.4977773151563,
      "radius": 70,
      "oreType": "cuprite"
    },
    {
      "x": -4758.8548028594605,
      "y": -4248.0353534744445,
      "radius": 60,
      "oreType": "cuprite"
    },
    {
      "x": 1066.9109888225757,
      "y": 3462.3415963818707,
      "radius": 20,
      "oreType": "hematite"
    },
    {
      "x": 3351.134629469994,
      "y": -2046.534812605827,
      "radius": 10,
      "oreType": "aurite"
    },
    {
      "x": -3465.6070506117185,
      "y": 1920.7807089165608,
      "radius": 50,
      "oreType": "cuprite"
    },
    {
      "x": -4434.854486747986,
      "y": 4082.706046999334,
      "radius": 60,
      "oreType": "cuprite"
    },
    {
      "x": -68.51034093437124,
      "y": -2057.6027897123026,
      "radius": 10,
      "oreType": "cuprite"
    },
    {
      "x": 1261.1447271969478,
      "y": -4818.7365027996675,
      "radius": 10,
      "oreType": "hematite"
    },
    {
      "x": 1440.9363521338726,
      "y": -853.148235006711,
      "radius": 50,
      "oreType": "cuprite"
    },
    {
      "x": -165.71019196166327,
      "y": -4989.869619190972,
      "radius": 60,
      "oreType": "hematite"
    },
    {
      "x": -1849.1203763883557,
      "y": 708.7366398715989,
      "radius": 50,
      "oreType": "hematite"
    },
    {
      "x": 1552.79971746759,
      "y": 450.04669161242464,
      "radius": 20,
      "oreType": "aurite"
    },
    {
      "x": 3824.6979482518673,
      "y": 3314.842681758774,
      "radius": 80,
      "oreType": "cuprite"
    },
    {
      "x": -1599.1202718442432,
      "y": -3372.481653959283,
      "radius": 50,
      "oreType": "cuprite"
    },
    {
      "x": -2177.0820997116825,
      "y": -1100.7676153747025,
      "radius": 40,
      "oreType": "cuprite"
    },
    {
      "x": 791.0190896819436,
      "y": 844.329497103462,
      "radius": 70,
      "oreType": "hematite"
    },
    {
      "x": 3275.6983676013383,
      "y": 384.1386376119083,
      "radius": 50,
      "oreType": "hematite"
    },
    {
      "x": 3873.6382274522607,
      "y": 1118.0306729968813,
      "radius": 30,
      "oreType": "cuprite"
    },
    {
      "x": 3356.3340547450894,
      "y": 4327.866139325079,
      "radius": 60,
      "oreType": "cuprite"
    },
    {
      "x": 1384.285596403574,
      "y": -3007.802602714167,
      "radius": 30,
      "oreType": "aurite"
    },
    {
      "x": 2172.440910438438,
      "y": 591.615557891867,
      "radius": 70,
      "oreType": "cuprite"
    },
    {
      "x": 1608.3601059343166,
      "y": -3911.8891611724994,
      "radius": 20,
      "oreType": "cuprite"
    },
    {
      "x": 2245.8645441882295,
      "y": 3352.616403123416,
      "radius": 30,
      "oreType": "hematite"
    },
    {
      "x": -4481.713135173839,
      "y": -2638.1457394401564,
      "radius": 20,
      "oreType": "hematite"
    },
    {
      "x": -2706.1700653001885,
      "y": 2986.360334070817,
      "radius": 40,
      "oreType": "hematite"
    },
    {
      "x": -634.0839990809832,
      "y": 2089.0502639559404,
      "radius": 50,
      "oreType": "hematite"
    },
    {
      "x": 864.7765886639314,
      "y": 4980.995253466464,
      "radius": 30,
      "oreType": "aurite"
    },
    {
      "x": -1867.9149571636522,
      "y": 4200.389375111169,
      "radius": 80,
      "oreType": "hematite"
    },
    {
      "x": -4798.3277339837,
      "y": -655.3768524311621,
      "radius": 30,
      "oreType": "hematite"
    },
    {
      "x": 3884.648177438226,
      "y": -175.56624483160422,
      "radius": 80,
      "oreType": "hematite"
    },
    {
      "x": -104.18521978564178,
      "y": 407.6812948133809,
      "radius": 300,
      "oreType": "cuprite"
    },
    {
      "x": 511.86651459902265,
      "y": 534.5154754219883,
      "radius": 200,
      "oreType": "cuprite"
    },
    {
      "x": 201.9990172525001,
      "y": 1099.4883217541146,
      "radius": 260,
      "oreType": "hematite"
    },
    {
      "x": -605.9970517575005,
      "y": 1258.0191960535449,
      "radius": 290,
      "oreType": "cuprite"
    },
    {
      "x": 288.62079952878446,
      "y": 1633.0408069067826,
      "radius": 190,
      "oreType": "aurite"
    },
    {
      "x": -245.3428721494784,
      "y": 886.003278605937,
      "radius": 130,
      "oreType": "cuprite"
    },
    {
      "x": -265.460521270241,
      "y": 1965.650448086863,
      "radius": 140,
      "oreType": "cuprite"
    },
    {
      "x": 887.9513616534811,
      "y": 1234.7091966991552,
      "radius": 280,
      "oreType": "cuprite"
    },
    {
      "x": -146.9573735442297,
      "y": 1561.9469416700986,
      "radius": 150,
      "oreType": "hematite"
    },
    {
      "x": 793.5698171388404,
      "y": 58.78294941769195,
      "radius": 220,
      "oreType": "cuprite"
    },
    {
      "x": 363.9551850376298,
      "y": 112.36200343443605,
      "radius": 80,
      "oreType": "aurite"
    },
    {
      "x": -1336.119264972113,
      "y": -391.3320022930875,
      "radius": 10,
      "oreType": "aurite"
    },
    {
      "x": -1291.3956075671886,
      "y": -603.7693749664777,
      "radius": 10,
      "oreType": "aurite"
    },
    {
      "x": -1003.3261192555187,
      "y": -153.90389650969897,
      "radius": 10,
      "oreType": "aurite"
    },
    {
      "x": -767.2822027682842,
      "y": 68.25508371358065,
      "radius": 10,
      "oreType": "hematite"
    },
    {
      "x": -1287.9673126665957,
      "y": 366.7812133886126,
      "radius": 10,
      "oreType": "hematite"
    },
    {
      "x": -1183.8302906869335,
      "y": 12.715338657760743,
      "radius": 10,
      "oreType": "hematite"
    },
    {
      "x": -1378.219398382303,
      "y": -140.01896024574398,
      "radius": 10,
      "oreType": "hematite"
    },
    {
      "x": -1607.3208467375603,
      "y": -181.67376903760893,
      "radius": 10,
      "oreType": "hematite"
    },
    {
      "x": -1551.7811016817404,
      "y": -362.17794046902367,
      "radius": 10,
      "oreType": "hematite"
    },
    {
      "x": -1468.4714840980105,
      "y": -244.1559822254063,
      "radius": 10,
      "oreType": "hematite"
    },
    {
      "x": -1274.0823764026409,
      "y": -459.37249431670847,
      "radius": 10,
      "oreType": "hematite"
    },
    {
      "x": -933.9014379357438,
      "y": -278.86832288529376,
      "radius": 10,
      "oreType": "cuprite"
    },
    {
      "x": -829.7644159560816,
      "y": -362.17794046902367,
      "radius": 10,
      "oreType": "cuprite"
    },
    {
      "x": -677.0301170525768,
      "y": -292.7532591492488,
      "radius": 10,
      "oreType": "cuprite"
    },
    {
      "x": -850.591820352014,
      "y": -237.2135140934288,
      "radius": 10,
      "oreType": "cuprite"
    },
    {
      "x": -1072.7508005752936,
      "y": -216.38610969749635,
      "radius": 10,
      "oreType": "cuprite"
    },
    {
      "x": -1232.427567610776,
      "y": -313.5806635451812,
      "radius": 10,
      "oreType": "cuprite"
    },
    {
      "x": -1336.5645895904381,
      "y": -299.69572728122625,
      "radius": 10,
      "oreType": "cuprite"
    },
    {
      "x": -1385.1618665142805,
      "y": -181.67376903760893,
      "radius": 10,
      "oreType": "cuprite"
    },
    {
      "x": -1281.0248445346183,
      "y": -84.4792151899241,
      "radius": 10,
      "oreType": "cuprite"
    },
    {
      "x": -1100.5206731032035,
      "y": -133.0764921137665,
      "radius": 10,
      "oreType": "cuprite"
    },
    {
      "x": -1010.2685873874963,
      "y": -42.82440639805916,
      "radius": 10,
      "oreType": "cuprite"
    },
    {
      "x": -1128.2905456311137,
      "y": -15.054533870149207,
      "radius": 10,
      "oreType": "cuprite"
    },
    {
      "x": -1274.0823764026409,
      "y": -49.76687453003665,
      "radius": 10,
      "oreType": "cuprite"
    },
    {
      "x": -1454.5865478340556,
      "y": -459.37249431670847,
      "radius": 10,
      "oreType": "cuprite"
    },
    {
      "x": -1440.7016115701006,
      "y": -341.3505360730912,
      "radius": 10,
      "oreType": "cuprite"
    },
    {
      "x": -1732.2852731131552,
      "y": 5.772870525783254,
      "radius": 10,
      "oreType": "cuprite"
    },
    {
      "x": -1794.7674863009524,
      "y": 5.772870525783254,
      "radius": 10,
      "oreType": "cuprite"
    },
    {
      "x": -1891.9620401486372,
      "y": -133.0764921137665,
      "radius": 10,
      "oreType": "cuprite"
    },
    {
      "x": -1801.7099544329299,
      "y": -542.6821119004383,
      "radius": 10,
      "oreType": "cuprite"
    },
    {
      "x": -1815.5948906968847,
      "y": -695.416410803943,
      "radius": 10,
      "oreType": "cuprite"
    },
    {
      "x": -1940.5593170724796,
      "y": -251.09845035738383,
      "radius": 10,
      "oreType": "cuprite"
    },
    {
      "x": -1912.7894445445695,
      "y": -15.054533870149207,
      "radius": 10,
      "oreType": "cuprite"
    },
    {
      "x": -1780.8825500369976,
      "y": -341.3505360730912,
      "radius": 10,
      "oreType": "cuprite"
    },
    {
      "x": -1801.7099544329299,
      "y": -674.5890064080105,
      "radius": 10,
      "oreType": "cuprite"
    },
    {
      "x": -1558.7235698137179,
      "y": -133.0764921137665,
      "radius": 10,
      "oreType": "cuprite"
    },
    {
      "x": -1072.7508005752936,
      "y": -639.8766657481231,
      "radius": 10,
      "oreType": "cuprite"
    },
    {
      "x": -1468.4714840980105,
      "y": -716.2438151998755,
      "radius": 10,
      "oreType": "cuprite"
    },
    {
      "x": -1364.3344621183483,
      "y": -625.9917294841681,
      "radius": 10,
      "oreType": "cuprite"
    },
    {
      "x": -1225.4850994787985,
      "y": -584.3369206923032,
      "radius": 10,
      "oreType": "cuprite"
    },
    {
      "x": -1142.1754818950685,
      "y": -653.7616020120781,
      "radius": 10,
      "oreType": "cuprite"
    },
    {
      "x": -892.246629143879,
      "y": -202.5011734335414,
      "radius": 10,
      "oreType": "cuprite"
    },
    {
      "x": -1197.7152269508883,
      "y": -306.63819541320373,
      "radius": 10,
      "oreType": "cuprite"
    },
    {
      "x": -1204.657695082866,
      "y": -514.9122393725283,
      "radius": 10,
      "oreType": "cuprite"
    },
    {
      "x": -1392.1043346462582,
      "y": -494.0848349765959,
      "radius": 10,
      "oreType": "cuprite"
    },
    {
      "x": -1371.2769302503257,
      "y": -494.0848349765959,
      "radius": 10,
      "oreType": "cuprite"
    },
    {
      "x": -1468.4714840980105,
      "y": 179.33457382522047,
      "radius": 10,
      "oreType": "cuprite"
    },
    {
      "x": -1253.2549720067084,
      "y": 220.9893826170854,
      "radius": 10,
      "oreType": "cuprite"
    },
    {
      "x": -1586.4934423416278,
      "y": 12.715338657760743,
      "radius": 10,
      "oreType": "cuprite"
    },
    {
      "x": -1385.1618665142805,
      "y": 151.5647012973105,
      "radius": 10,
      "oreType": "cuprite"
    },
    {
      "x": -1600.3783786055828,
      "y": 102.96742437346808,
      "radius": 10,
      "oreType": "cuprite"
    },
    {
      "x": -1655.9181236614027,
      "y": 123.79482876940057,
      "radius": 10,
      "oreType": "cuprite"
    },
    {
      "x": -1371.2769302503257,
      "y": -21.9970020021267,
      "radius": 10,
      "oreType": "cuprite"
    },
    {
      "x": -1246.3125038747307,
      "y": -28.939470134104184,
      "radius": 10,
      "oreType": "cuprite"
    },
    {
      "x": -1024.1535236514512,
      "y": -84.4792151899241,
      "radius": 10,
      "oreType": "cuprite"
    },
    {
      "x": -704.7999895804868,
      "y": -313.5806635451812,
      "radius": 10,
      "oreType": "cuprite"
    },
    {
      "x": -906.1315654078339,
      "y": -403.8327492608886,
      "radius": 10,
      "oreType": "cuprite"
    },
    {
      "x": -1017.2110555194738,
      "y": -306.63819541320373,
      "radius": 10,
      "oreType": "cuprite"
    },
    {
      "x": -947.7863741996989,
      "y": -278.86832288529376,
      "radius": 10,
      "oreType": "cuprite"
    },
    {
      "x": -940.8439060677214,
      "y": -494.0848349765959,
      "radius": 10,
      "oreType": "cuprite"
    },
    {
      "x": -1128.2905456311137,
      "y": -584.3369206923032,
      "radius": 10,
      "oreType": "cuprite"
    },
    {
      "x": -1371.2769302503257,
      "y": -702.3588789359205,
      "radius": 10,
      "oreType": "cuprite"
    },
    {
      "x": -1655.9181236614027,
      "y": -716.2438151998755,
      "radius": 10,
      "oreType": "cuprite"
    },
    {
      "x": -1808.6524225649073,
      "y": -598.2218569562582,
      "radius": 10,
      "oreType": "cuprite"
    },
    {
      "x": -1739.2277412451326,
      "y": -577.3944525603257,
      "radius": 10,
      "oreType": "cuprite"
    },
    {
      "x": -1489.298888493943,
      "y": -750.9561558597629,
      "radius": 10,
      "oreType": "cuprite"
    },
    {
      "x": -1885.0195720166598,
      "y": -632.9341976161456,
      "radius": 10,
      "oreType": "cuprite"
    },
    {
      "x": -1982.2141258643446,
      "y": -591.2793888242807,
      "radius": 10,
      "oreType": "cuprite"
    },
    {
      "x": -2044.6963390521419,
      "y": -584.3369206923032,
      "radius": 10,
      "oreType": "cuprite"
    },
    {
      "x": -822.8219478241041,
      "y": -452.430026184731,
      "radius": 20,
      "oreType": "cuprite"
    },
    {
      "x": -1760.0551456410649,
      "y": 130.73729690137804,
      "radius": 20,
      "oreType": "cuprite"
    },
    {
      "x": -1891.9620401486372,
      "y": 123.79482876940057,
      "radius": 20,
      "oreType": "cuprite"
    },
    {
      "x": -1760.0551456410649,
      "y": -70.59427892596912,
      "radius": 20,
      "oreType": "cuprite"
    },
    {
      "x": -1600.3783786055828,
      "y": -42.82440639805916,
      "radius": 20,
      "oreType": "cuprite"
    },
    {
      "x": -1676.7455280573352,
      "y": -21.9970020021267,
      "radius": 20,
      "oreType": "cuprite"
    },
    {
      "x": -1815.5948906968847,
      "y": -112.24908771783404,
      "radius": 20,
      "oreType": "cuprite"
    },
    {
      "x": -1843.3647632247948,
      "y": -348.29300420506866,
      "radius": 20,
      "oreType": "cuprite"
    },
    {
      "x": -2037.7538709201644,
      "y": -105.30661958585654,
      "radius": 20,
      "oreType": "cuprite"
    },
    {
      "x": -1940.5593170724796,
      "y": -389.9478129969336,
      "radius": 20,
      "oreType": "cuprite"
    },
    {
      "x": -1947.501785204457,
      "y": -473.2574305806635,
      "radius": 20,
      "oreType": "cuprite"
    },
    {
      "x": -2051.6388071841193,
      "y": -528.7971756364833,
      "radius": 20,
      "oreType": "cuprite"
    },
    {
      "x": -1996.0990621282995,
      "y": -723.186283331853,
      "radius": 20,
      "oreType": "cuprite"
    },
    {
      "x": -1718.4003368492,
      "y": -827.3233053115154,
      "radius": 20,
      "oreType": "cuprite"
    },
    {
      "x": -1614.2633148695377,
      "y": -792.6109646516279,
      "radius": 20,
      "oreType": "cuprite"
    },
    {
      "x": -1711.4578687172225,
      "y": -612.1067932202131,
      "radius": 20,
      "oreType": "cuprite"
    },
    {
      "x": -1593.4359104736054,
      "y": -730.1287514638304,
      "radius": 20,
      "oreType": "cuprite"
    },
    {
      "x": -1530.9536972858077,
      "y": -764.8410921237179,
      "radius": 20,
      "oreType": "cuprite"
    },
    {
      "x": -1753.1126775090875,
      "y": -688.4739426719656,
      "radius": 20,
      "oreType": "cuprite"
    },
    {
      "x": -1544.838633549763,
      "y": -674.5890064080105,
      "radius": 20,
      "oreType": "cuprite"
    },
    {
      "x": -1239.3700357427533,
      "y": -466.31496244868595,
      "radius": 20,
      "oreType": "cuprite"
    },
    {
      "x": -1343.5070577224155,
      "y": -424.660153656821,
      "radius": 20,
      "oreType": "cuprite"
    },
    {
      "x": -1510.1262928898755,
      "y": -285.8107910172713,
      "radius": 20,
      "oreType": "cuprite"
    },
    {
      "x": -1628.1482511334927,
      "y": -119.19155584981152,
      "radius": 20,
      "oreType": "cuprite"
    },
    {
      "x": -1218.542631346821,
      "y": -383.0053448649561,
      "radius": 20,
      "oreType": "cuprite"
    },
    {
      "x": -1830.6612462184603,
      "y": -435.8953725571061,
      "radius": 20,
      "oreType": "hematite"
    },
    {
      "x": -1528.1344606026119,
      "y": -461.9752678688171,
      "radius": 20,
      "oreType": "hematite"
    },
    {
      "x": -1502.0545652909007,
      "y": -195.9603356893642,
      "radius": 20,
      "oreType": "hematite"
    },
    {
      "x": -1460.326732792163,
      "y": -91.64075444251992,
      "radius": 20,
      "oreType": "hematite"
    },
    {
      "x": -1829.448364535669,
      "y": 57.055796678075836,
      "radius": 20,
      "oreType": "aurite"
    },
    {
      "x": -1849.0425758893211,
      "y": -197.66895091940265,
      "radius": 20,
      "oreType": "aurite"
    },
    {
      "x": -1598.2366705625732,
      "y": -283.8834808754723,
      "radius": 20,
      "oreType": "aurite"
    },
    {
      "x": -1719.7207809552165,
      "y": -499.41980576564646,
      "radius": 20,
      "oreType": "aurite"
    },
    {
      "x": -1312.161184799251,
      "y": -209.42547773159396,
      "radius": 20,
      "oreType": "aurite"
    },
    {
      "x": -1609.9931973747643,
      "y": -456.31254078761157,
      "radius": 20,
      "oreType": "cuprite"
    },
    {
      "x": -1406.2133992967815,
      "y": -374.01685310227236,
      "radius": 20,
      "oreType": "cuprite"
    },
    {
      "x": -2016.0443478175052,
      "y": -200.75295869215606,
      "radius": 20,
      "oreType": "cuprite"
    },
    {
      "x": -1951.984598299777,
      "y": -65.8903281285177,
      "radius": 20,
      "oreType": "cuprite"
    },
    {
      "x": -1938.4983352434133,
      "y": 68.97230243512064,
      "radius": 20,
      "oreType": "cuprite"
    },
    {
      "x": -2113.819754976143,
      "y": -183.89512987170124,
      "radius": 10,
      "oreType": "cuprite"
    },
    {
      "x": -2076.7325315711423,
      "y": -234.46861633306563,
      "radius": 10,
      "oreType": "cuprite"
    },
    {
      "x": -1965.4708613561409,
      "y": -140.06477493851878,
      "radius": 10,
      "oreType": "cuprite"
    },
    {
      "x": -1978.9571244125045,
      "y": 28.513513266029122,
      "radius": 10,
      "oreType": "cuprite"
    },
    {
      "x": -2171.136372965689,
      "y": -86.11972271306342,
      "radius": 10,
      "oreType": "cuprite"
    },
    {
      "x": -2225.0814251911447,
      "y": -217.61078751261084,
      "radius": 10,
      "oreType": "cuprite"
    },
    {
      "x": -1483.3369570911339,
      "y": -25.431538959426177,
      "radius": 10,
      "oreType": "cuprite"
    },
    {
      "x": -1520.4241804961343,
      "y": 18.398815973756257,
      "radius": 10,
      "oreType": "cuprite"
    },
    {
      "x": -1520.4241804961343,
      "y": -59.1471966003358,
      "radius": 10,
      "oreType": "cuprite"
    },
    {
      "x": -1635.8871643285856,
      "y": -930.5931079929705,
      "radius": 10,
      "oreType": "cuprite"
    },
    {
      "x": -1883.3108008179556,
      "y": -1101.8863947933037,
      "radius": 10,
      "oreType": "cuprite"
    },
    {
      "x": -1781.8036678992398,
      "y": -1152.6399612526618,
      "radius": 10,
      "oreType": "cuprite"
    },
    {
      "x": -1972.1295421218324,
      "y": -1019.4118492968471,
      "radius": 10,
      "oreType": "cuprite"
    },
    {
      "x": -2010.1947169663508,
      "y": -1108.2305906007236,
      "radius": 10,
      "oreType": "cuprite"
    },
    {
      "x": -2230.361190627223,
      "y": -1250.1159450971047,
      "radius": 10,
      "oreType": "cuprite"
    },
    {
      "x": -2347.356810325559,
      "y": -1037.7905612001252,
      "radius": 10,
      "oreType": "cuprite"
    },
    {
      "x": -2382.0221791250656,
      "y": -959.7934814012349,
      "radius": 10,
      "oreType": "cuprite"
    },
    {
      "x": -2338.690468125682,
      "y": -951.1271392013582,
      "radius": 10,
      "oreType": "cuprite"
    },
    {
      "x": -2217.3616773274084,
      "y": -994.4588502007418,
      "radius": 10,
      "oreType": "cuprite"
    },
    {
      "x": -2113.365570928888,
      "y": -951.1271392013582,
      "radius": 10,
      "oreType": "cuprite"
    },
    {
      "x": -2078.7002021293806,
      "y": -968.4598236011116,
      "radius": 10,
      "oreType": "cuprite"
    },
    {
      "x": -2265.0265594267303,
      "y": -1003.1251924006185,
      "radius": 10,
      "oreType": "cuprite"
    },
    {
      "x": -2308.3582704261134,
      "y": -1124.4539831988925,
      "radius": 10,
      "oreType": "cuprite"
    },
    {
      "x": -2408.021205724696,
      "y": -1115.7876409990158,
      "radius": 10,
      "oreType": "cuprite"
    },
    {
      "x": -2278.026072726545,
      "y": -1211.1174051976595,
      "radius": 10,
      "oreType": "cuprite"
    },
    {
      "x": -2386.3553502250043,
      "y": -1224.1169184974747,
      "radius": 10,
      "oreType": "cuprite"
    },
    {
      "x": -2351.689981425497,
      "y": -842.7978617028994,
      "radius": 10,
      "oreType": "cuprite"
    },
    {
      "x": -2243.3607039270382,
      "y": -678.1373599052419,
      "radius": 10,
      "oreType": "cuprite"
    },
    {
      "x": -2125.465805464468,
      "y": -819.379618655722,
      "radius": 10,
      "oreType": "cuprite"
    },
    {
      "x": -2125.465805464468,
      "y": -700.9950520294436,
      "radius": 10,
      "oreType": "cuprite"
    },
    {
      "x": -2048.515837157387,
      "y": -772.0257920052106,
      "radius": 10,
      "oreType": "cuprite"
    },
    {
      "x": -1959.727412187678,
      "y": -810.500776158751,
      "radius": 10,
      "oreType": "cuprite"
    },
    {
      "x": -1891.656286377568,
      "y": -686.1969812011588,
      "radius": 10,
      "oreType": "cuprite"
    },
    {
      "x": -1835.423617230086,
      "y": -769.0661778395537,
      "radius": 10,
      "oreType": "cuprite"
    },
    {
      "x": -1811.7467039048302,
      "y": -810.500776158751,
      "radius": 10,
      "oreType": "cuprite"
    },
    {
      "x": -1918.2928138684806,
      "y": -887.450744465832,
      "radius": 10,
      "oreType": "cuprite"
    },
    {
      "x": -1900.535128874539,
      "y": -822.3392328213789,
      "radius": 10,
      "oreType": "cuprite"
    },
    {
      "x": -2066.2735221513285,
      "y": -647.7219970476183,
      "radius": 10,
      "oreType": "cuprite"
    },
    {
      "x": -2202.4157737715486,
      "y": -591.4893279001361,
      "radius": 10,
      "oreType": "cuprite"
    },
    {
      "x": -2412.548379533193,
      "y": -627.0046978880196,
      "radius": 10,
      "oreType": "cuprite"
    },
    {
      "x": -2501.336804502902,
      "y": -798.6623194961232,
      "radius": 10,
      "oreType": "cuprite"
    },
    {
      "x": -2628.600213626151,
      "y": -757.2277211769258,
      "radius": 10,
      "oreType": "cuprite"
    },
    {
      "x": -2459.902206183704,
      "y": -807.5411619930942,
      "radius": 10,
      "oreType": "cuprite"
    },
    {
      "x": -2377.0330095453096,
      "y": -683.2373670355018,
      "radius": 10,
      "oreType": "cuprite"
    },
    {
      "x": -2320.8003403978273,
      "y": -674.3585245385309,
      "radius": 10,
      "oreType": "cuprite"
    },
    {
      "x": -2311.921497900856,
      "y": -514.5393595930552,
      "radius": 10,
      "oreType": "cuprite"
    },
    {
      "x": -2306.0022695695425,
      "y": -334.00289548798065,
      "radius": 10,
      "oreType": "cuprite"
    },
    {
      "x": -2430.306064527135,
      "y": -289.60868300312626,
      "radius": 10,
      "oreType": "cuprite"
    },
    {
      "x": -2513.1752611655297,
      "y": -390.2355646354629,
      "radius": 10,
      "oreType": "cuprite"
    },
    {
      "x": -2587.1656153069534,
      "y": -248.17408468392884,
      "radius": 10,
      "oreType": "cuprite"
    },
    {
      "x": -2442.1445211897626,
      "y": -194.90102970210359,
      "radius": 10,
      "oreType": "cuprite"
    },
    {
      "x": -2388.8714662079374,
      "y": -191.94141553644658,
      "radius": 10,
      "oreType": "cuprite"
    },
    {
      "x": -2510.2156469998727,
      "y": -218.57794302735923,
      "radius": 10,
      "oreType": "cuprite"
    },
    {
      "x": -2516.1348753311863,
      "y": -280.72984050615537,
      "radius": 10,
      "oreType": "cuprite"
    },
    {
      "x": -2557.5694736503838,
      "y": -328.0836671566667,
      "radius": 10,
      "oreType": "cuprite"
    },
    {
      "x": -2667.0751977796913,
      "y": -200.82025803341747,
      "radius": 10,
      "oreType": "cuprite"
    },
    {
      "x": -2717.3886385958594,
      "y": -103.1529905667378,
      "radius": 10,
      "oreType": "cuprite"
    },
    {
      "x": -2764.742465246371,
      "y": -120.91067556067958,
      "radius": 10,
      "oreType": "cuprite"
    },
    {
      "x": -2664.115583614034,
      "y": -304.40675383141104,
      "radius": 10,
      "oreType": "cuprite"
    },
    {
      "x": -2684.832882773633,
      "y": -405.03363546374766,
      "radius": 10,
      "oreType": "cuprite"
    },
    {
      "x": -2678.913654442319,
      "y": -437.5893912859742,
      "radius": 10,
      "oreType": "cuprite"
    },
    {
      "x": -2590.1252294726105,
      "y": -351.7605804819224,
      "radius": 10,
      "oreType": "cuprite"
    },
    {
      "x": -2385.9118520422803,
      "y": -410.9528637950616,
      "radius": 10,
      "oreType": "cuprite"
    },
    {
      "x": -2350.396482054397,
      "y": -375.43749380717804,
      "radius": 10,
      "oreType": "cuprite"
    },
    {
      "x": -2344.477253723083,
      "y": -171.22411637684786,
      "radius": 10,
      "oreType": "cuprite"
    },
    {
      "x": -2412.548379533193,
      "y": -100.19337640108085,
      "radius": 10,
      "oreType": "cuprite"
    },
    {
      "x": -2456.9425920180474,
      "y": -144.58758888593525,
      "radius": 10,
      "oreType": "cuprite"
    },
    {
      "x": -2569.407930313012,
      "y": -174.18373054250486,
      "radius": 10,
      "oreType": "cuprite"
    },
    {
      "x": -2604.9233003008953,
      "y": -150.5068172172492,
      "radius": 10,
      "oreType": "cuprite"
    },
    {
      "x": -2705.550181933232,
      "y": -289.60868300312626,
      "radius": 10,
      "oreType": "cuprite"
    },
    {
      "x": -2732.1867094241443,
      "y": -233.37601385564403,
      "radius": 10,
      "oreType": "cuprite"
    },
    {
      "x": -2744.0251660867725,
      "y": -384.316336304149,
      "radius": 10,
      "oreType": "cuprite"
    },
    {
      "x": -2806.1770635655685,
      "y": -476.0643754395147,
      "radius": 10,
      "oreType": "cuprite"
    },
    {
      "x": -2912.723173529219,
      "y": -508.6201312617412,
      "radius": 10,
      "oreType": "cuprite"
    },
    {
      "x": -2779.540536074656,
      "y": -561.8931862435666,
      "radius": 10,
      "oreType": "cuprite"
    },
    {
      "x": -2889.0462602039634,
      "y": -473.1047612738577,
      "radius": 10,
      "oreType": "cuprite"
    },
    {
      "x": -3010.3904409958986,
      "y": -570.7720287405374,
      "radius": 10,
      "oreType": "cuprite"
    },
    {
      "x": -2974.8750710080153,
      "y": -769.0661778395537,
      "radius": 10,
      "oreType": "cuprite"
    },
    {
      "x": -2912.723173529219,
      "y": -831.2180753183497,
      "radius": 10,
      "oreType": "cuprite"
    },
    {
      "x": -2868.3289610443644,
      "y": -851.9353744779485,
      "radius": 10,
      "oreType": "cuprite"
    },
    {
      "x": -3028.1481259898405,
      "y": -668.439296207217,
      "radius": 10,
      "oreType": "cuprite"
    },
    {
      "x": -2983.753913504986,
      "y": -656.6008395445892,
      "radius": 10,
      "oreType": "cuprite"
    },
    {
      "x": -2992.632756001957,
      "y": -656.6008395445892,
      "radius": 10,
      "oreType": "cuprite"
    },
    {
      "x": -3087.3404093029794,
      "y": -464.22591877688683,
      "radius": 10,
      "oreType": "cuprite"
    },
    {
      "x": -3007.4308268302416,
      "y": -490.8624462677995,
      "radius": 10,
      "oreType": "cuprite"
    },
    {
      "x": -2971.9154568423583,
      "y": -505.6605170960843,
      "radius": 10,
      "oreType": "cuprite"
    },
    {
      "x": -2782.500150240313,
      "y": -502.70090293042733,
      "radius": 10,
      "oreType": "cuprite"
    },
    {
      "x": -2729.2270952584877,
      "y": -627.0046978880196,
      "radius": 10,
      "oreType": "cuprite"
    },
    {
      "x": -2619.72137112918,
      "y": -733.5508078516701,
      "radius": 10,
      "oreType": "cuprite"
    },
    {
      "x": -2530.932946159471,
      "y": -801.6219336617802,
      "radius": 10,
      "oreType": "cuprite"
    },
    {
      "x": -2851.4925547581597,
      "y": -892.6295133552496,
      "radius": 10,
      "oreType": "cuprite"
    },
    {
      "x": -2889.9002244169824,
      "y": -1060.4103860753696,
      "radius": 10,
      "oreType": "cuprite"
    },
    {
      "x": -2853.514011055993,
      "y": -1129.1399002016838,
      "radius": 10,
      "oreType": "cuprite"
    },
    {
      "x": -2792.87032212101,
      "y": -955.2946585880655,
      "radius": 10,
      "oreType": "cuprite"
    },
    {
      "x": -2681.690225740207,
      "y": -1042.2172793948746,
      "radius": 10,
      "oreType": "cuprite"
    },
    {
      "x": -2643.2825560813844,
      "y": -979.5521341620588,
      "radius": 10,
      "oreType": "cuprite"
    },
    {
      "x": -2594.767604933398,
      "y": -902.7367948444135,
      "radius": 10,
      "oreType": "cuprite"
    },
    {
      "x": -2477.5231396590975,
      "y": -1026.0456290122124,
      "radius": 10,
      "oreType": "cuprite"
    },
    {
      "x": -2590.7246923377324,
      "y": -1017.9598038208815,
      "radius": 10,
      "oreType": "cuprite"
    },
    {
      "x": -2712.012070207699,
      "y": -1066.474754968868,
      "radius": 10,
      "oreType": "cuprite"
    },
    {
      "x": -2760.527021355685,
      "y": -1072.539123862366,
      "radius": 10,
      "oreType": "cuprite"
    },
    {
      "x": -2738.291002079525,
      "y": -975.5092215663933,
      "radius": 10,
      "oreType": "cuprite"
    },
    {
      "x": -2817.1277976950028,
      "y": -1080.6249490536973,
      "radius": 10,
      "oreType": "cuprite"
    },
    {
      "x": -2778.72012803618,
      "y": -1019.9812601187141,
      "radius": 20,
      "oreType": "cuprite"
    },
    {
      "x": -2649.346924974883,
      "y": -1076.5820364580318,
      "radius": 20,
      "oreType": "cuprite"
    },
    {
      "x": -2521.9951782114185,
      "y": -1078.6034927558644,
      "radius": 20,
      "oreType": "cuprite"
    },
    {
      "x": -2420.92236331978,
      "y": -1044.2387356927075,
      "radius": 20,
      "oreType": "cuprite"
    },
    {
      "x": -2475.501683361265,
      "y": -712.7199028481332,
      "radius": 20,
      "oreType": "cuprite"
    },
    {
      "x": -2327.9353736194726,
      "y": -745.0632036134575,
      "radius": 20,
      "oreType": "cuprite"
    },
    {
      "x": -2146.0043068145233,
      "y": -506.53136046919064,
      "radius": 20,
      "oreType": "cuprite"
    },
    {
      "x": -2582.6388671464015,
      "y": -447.9091278320403,
      "radius": 20,
      "oreType": "cuprite"
    },
    {
      "x": -2433.0511011067765,
      "y": -381.2010700035589,
      "radius": 20,
      "oreType": "cuprite"
    },
    {
      "x": -2293.5706165563156,
      "y": -272.04242992058937,
      "radius": 20,
      "oreType": "cuprite"
    },
    {
      "x": -2519.5326741022236,
      "y": -125.07106486880093,
      "radius": 20,
      "oreType": "cuprite"
    },
    {
      "x": -2405.5349862195644,
      "y": 13.574771745243595,
      "radius": 20,
      "oreType": "cuprite"
    },
    {
      "x": -2297.699335519752,
      "y": -60.369674448913486,
      "radius": 20,
      "oreType": "cuprite"
    },
    {
      "x": -2269.970168196943,
      "y": -134.31412064307057,
      "radius": 20,
      "oreType": "cuprite"
    },
    {
      "x": -2824.5535146531215,
      "y": -199.01551106295807,
      "radius": 20,
      "oreType": "cuprite"
    },
    {
      "x": -2266.88914960552,
      "y": -442.41597978539187,
      "radius": 20,
      "oreType": "cuprite"
    },
    {
      "x": -2901.578979438702,
      "y": -984.6752518758774,
      "radius": 10,
      "oreType": "hematite"
    },
    {
      "x": -2593.4771202963807,
      "y": -833.7053408961399,
      "radius": 10,
      "oreType": "hematite"
    },
    {
      "x": -2574.991008747841,
      "y": -944.6220101873755,
      "radius": 10,
      "oreType": "hematite"
    },
    {
      "x": -2427.102116359527,
      "y": -889.1636755417577,
      "radius": 10,
      "oreType": "hematite"
    },
    {
      "x": -2547.2618414250323,
      "y": -633.439132453631,
      "radius": 10,
      "oreType": "hematite"
    },
    {
      "x": -2152.891461722861,
      "y": -655.0062625935935,
      "radius": 10,
      "oreType": "hematite"
    },
    {
      "x": -2177.539610454247,
      "y": -303.7701431713473,
      "radius": 10,
      "oreType": "hematite"
    },
    {
      "x": -2470.236376639452,
      "y": -322.25625471988656,
      "radius": 10,
      "oreType": "hematite"
    },
    {
      "x": -2584.234064522111,
      "y": -294.52708739707765,
      "radius": 10,
      "oreType": "hematite"
    },
    {
      "x": -2125.1622944000524,
      "y": -436.2539426025454,
      "radius": 10,
      "oreType": "hematite"
    },
    {
      "x": -1887.9238628604649,
      "y": -500.9553330224329,
      "radius": 10,
      "oreType": "hematite"
    },
    {
      "x": -1863.2757141290792,
      "y": -260.6358828914223,
      "radius": 10,
      "oreType": "hematite"
    },
    {
      "x": -2192.9447034113628,
      "y": -137.3951392344938,
      "radius": 10,
      "oreType": "hematite"
    },
    {
      "x": -2328.5095214339844,
      "y": 13.574771745243595,
      "radius": 10,
      "oreType": "hematite"
    },
    {
      "x": -2729.041938319002,
      "y": -467.06412851677754,
      "radius": 10,
      "oreType": "hematite"
    },
    {
      "x": -3160.384541118252,
      "y": -722.7886716049043,
      "radius": 10,
      "oreType": "hematite"
    },
    {
      "x": -2571.909990156418,
      "y": -1080.186828209997,
      "radius": 10,
      "oreType": "hematite"
    },
    {
      "x": -2445.5882279080665,
      "y": -963.1081217359148,
      "radius": 20,
      "oreType": "hematite"
    },
    {
      "x": -2180.6206290456703,
      "y": -935.3789544131059,
      "radius": 20,
      "oreType": "hematite"
    },
    {
      "x": -1980.3544206031613,
      "y": -956.9460845530684,
      "radius": 20,
      "oreType": "hematite"
    },
    {
      "x": -2340.833595799677,
      "y": -439.33496119396864,
      "radius": 20,
      "oreType": "hematite"
    },
    {
      "x": -2319.2664656597144,
      "y": -621.1150580879382,
      "radius": 20,
      "oreType": "hematite"
    },
    {
      "x": -2753.690087050388,
      "y": -306.8511617627705,
      "radius": 20,
      "oreType": "hematite"
    },
    {
      "x": -2673.583603673384,
      "y": -534.8465375280882,
      "radius": 20,
      "oreType": "hematite"
    },
    {
      "x": -2596.5581388878036,
      "y": -516.360425979549,
      "radius": 20,
      "oreType": "hematite"
    },
    {
      "x": -2880.0118492987394,
      "y": -537.9275561195115,
      "radius": 20,
      "oreType": "hematite"
    },
    {
      "x": -2701.3127709961927,
      "y": -707.3835786477881,
      "radius": 20,
      "oreType": "hematite"
    },
    {
      "x": -2994.009537181398,
      "y": -987.7562704673005,
      "radius": 20,
      "oreType": "aurite"
    },
    {
      "x": -2248.4030380569807,
      "y": -1064.7817352528807,
      "radius": 20,
      "oreType": "aurite"
    },
    {
      "x": -2242.2410008741344,
      "y": -725.8696901963274,
      "radius": 20,
      "oreType": "aurite"
    },
    {
      "x": -1927.9771045489665,
      "y": -303.7701431713473,
      "radius": 20,
      "oreType": "aurite"
    },
    {
      "x": -2633.5303619848823,
      "y": -383.8766265483508,
      "radius": 20,
      "oreType": "aurite"
    },
    {
      "x": -2414.7780419938344,
      "y": -750.5178389277131,
      "radius": 20,
      "oreType": "aurite"
    },
    {
      "x": -2578.0720273392644,
      "y": -701.2215414649418,
      "radius": 20,
      "oreType": "aurite"
    },
    {
      "x": -2525.69471128507,
      "y": -1009.323400607263,
      "radius": 20,
      "oreType": "aurite"
    },
    {
      "x": -2682.8266594476536,
      "y": -950.784047370222,
      "radius": 20,
      "oreType": "aurite"
    },
    {
      "x": -2812.2294402874286,
      "y": -916.8928428645665,
      "radius": 20,
      "oreType": "aurite"
    },
    {
      "x": -2941.6322211272036,
      "y": -581.0618163994365,
      "radius": 20,
      "oreType": "aurite"
    },
    {
      "x": -2460.9933208651823,
      "y": -48.04560008322062,
      "radius": 20,
      "oreType": "aurite"
    },
    {
      "x": -2303.9927401488744,
      "y": 123.19891372547318,
      "radius": 20,
      "oreType": "aurite"
    },
    {
      "x": -2169.320874133852,
      "y": 217.96800462493326,
      "radius": 20,
      "oreType": "cuprite"
    },
    {
      "x": -2039.6368550082752,
      "y": 217.96800462493326,
      "radius": 20,
      "oreType": "cuprite"
    },
    {
      "x": -2328.9319745961006,
      "y": 212.98015773548798,
      "radius": 10,
      "oreType": "cuprite"
    },
    {
      "x": -2413.7253717166705,
      "y": 98.25967927824684,
      "radius": 10,
      "oreType": "cuprite"
    },
    {
      "x": -2279.0535057016477,
      "y": 198.0166170671522,
      "radius": 10,
      "oreType": "cuprite"
    },
    {
      "x": -2134.4059459077353,
      "y": 347.65202375051024,
      "radius": 10,
      "oreType": "cuprite"
    },
    {
      "x": -1999.734079892713,
      "y": 302.7614017455028,
      "radius": 10,
      "oreType": "cuprite"
    },
    {
      "x": -1939.8799172193699,
      "y": 282.8100141877217,
      "radius": 10,
      "oreType": "cuprite"
    },
    {
      "x": -2074.551783234392,
      "y": 347.65202375051024,
      "radius": 10,
      "oreType": "cuprite"
    },
    {
      "x": -2199.2479554705237,
      "y": 317.7249424138386,
      "radius": 10,
      "oreType": "cuprite"
    },
    {
      "x": -2124.4302521288446,
      "y": 327.7006361927291,
      "radius": 10,
      "oreType": "cuprite"
    },
    {
      "x": -2114.454558349954,
      "y": 277.8221672982765,
      "radius": 10,
      "oreType": "cuprite"
    },
    {
      "x": -2044.6247018977206,
      "y": 277.8221672982765,
      "radius": 10,
      "oreType": "cuprite"
    },
    {
      "x": -1855.0865200988003,
      "y": 133.1746075043637,
      "radius": 10,
      "oreType": "cuprite"
    },
    {
      "x": -2014.6976205610488,
      "y": 163.1016888410353,
      "radius": 10,
      "oreType": "cuprite"
    },
    {
      "x": -1999.734079892713,
      "y": 193.02877017770692,
      "radius": 10,
      "oreType": "cuprite"
    },
    {
      "x": -1934.8920703299245,
      "y": 217.96800462493326,
      "radius": 10,
      "oreType": "cuprite"
    },
    {
      "x": -2229.1750368071953,
      "y": 262.85862662994066,
      "radius": 10,
      "oreType": "cuprite"
    },
    {
      "x": -2303.9927401488744,
      "y": 252.88293285105013,
      "radius": 10,
      "oreType": "cuprite"
    },
    {
      "x": -2214.2114961388597,
      "y": 188.04092328826164,
      "radius": 10,
      "oreType": "aurite"
    },
    {
      "x": -2104.4788645710637,
      "y": 237.91939218271432,
      "radius": 10,
      "oreType": "hematite"
    },
    {
      "x": -1984.7705392243772,
      "y": 257.8707797404954,
      "radius": 10,
      "oreType": "hematite"
    },
    {
      "x": -1151.757258695395,
      "y": -83.87385513677953,
      "radius": 10,
      "oreType": "hematite"
    },
    {
      "x": -933.5603881401812,
      "y": -337.8940924995657,
      "radius": 10,
      "oreType": "hematite"
    },
    {
      "x": 382.81796158145085,
      "y": -958.382419005038,
      "radius": 70,
      "oreType": "aurite"
    },
    {
      "x": 123.26785020200782,
      "y": -2015.700910574195,
      "radius": 60,
      "oreType": "hematite"
    },
    {
      "x": 440.8748620785474,
      "y": -1638.225506867835,
      "radius": 40,
      "oreType": "hematite"
    },
    {
      "x": -369.6386169507059,
      "y": -1204.970339197181,
      "radius": 30,
      "oreType": "hematite"
    },
    {
      "x": 169.24662992049093,
      "y": -1221.439887693728,
      "radius": 30,
      "oreType": "aurite"
    },
    {
      "x": -817.999332806959,
      "y": -1425.6249102921856,
      "radius": 20,
      "oreType": "aurite"
    },
    {
      "x": -230.50026466567056,
      "y": -1587.3713672455833,
      "radius": 40,
      "oreType": "aurite"
    },
    {
      "x": -1320.3572246176955,
      "y": -1893.5586981871597,
      "radius": 60,
      "oreType": "cuprite"
    },
    {
      "x": -656.1090884157738,
      "y": -1383.3804293284677,
      "radius": 80,
      "oreType": "cuprite"
    },
    {
      "x": 347.63419285318014,
      "y": -771.5281518162728,
      "radius": 90,
      "oreType": "cuprite"
    },
    {
      "x": 772.313561517607,
      "y": -1796.1861482348693,
      "radius": 10,
      "oreType": "cuprite"
    },
    {
      "x": -261.94392213431684,
      "y": -1749.2002215893963,
      "radius": 10,
      "oreType": "cuprite"
    },
    {
      "x": -717.3183076948662,
      "y": -967.3140197905047,
      "radius": 100,
      "oreType": "cuprite"
    },
    {
      "x": -1234.81375098934,
      "y": -1639.9597809099396,
      "radius": 30,
      "oreType": "cuprite"
    },
    {
      "x": 540.4716630513794,
      "y": -1826.703954617209,
      "radius": 60,
      "oreType": "aurite"
    },
    {
      "x": -1091.0117011924335,
      "y": -707.3164758413538,
      "radius": 30,
      "oreType": "cuprite"
    },
    {
      "x": -305.4683081471753,
      "y": -1267.3235862718211,
      "radius": 40,
      "oreType": "cuprite"
    },
    {
      "x": -7.870087143663341,
      "y": -1069.0489349635154,
      "radius": 30,
      "oreType": "cuprite"
    },
    {
      "x": -1491.438159260209,
      "y": -854.0352229963419,
      "radius": 70,
      "oreType": "aurite"
    },
    {
      "x": 719.1087422732212,
      "y": -2148.688314690555,
      "radius": 90,
      "oreType": "cuprite"
    },
    {
      "x": -1278.8181642955133,
      "y": -773.5382010075784,
      "radius": 80,
      "oreType": "cuprite"
    },
    {
      "x": -1490.4198786832612,
      "y": -1377.5825066162226,
      "radius": 100,
      "oreType": "cuprite"
    },
    {
      "x": -398.29350577845435,
      "y": -733.3611595753462,
      "radius": 70,
      "oreType": "hematite"
    },
    {
      "x": 419.06825529405614,
      "y": -1483.0670238882767,
      "radius": 30,
      "oreType": "cuprite"
    },
    {
      "x": -1075.323995426466,
      "y": -1559.6156424147807,
      "radius": 90,
      "oreType": "aurite"
    },
    {
      "x": -381.894843846532,
      "y": -1930.8714599331665,
      "radius": 50,
      "oreType": "cuprite"
    },
    {
      "x": -276.95288128027573,
      "y": -1413.8671717821003,
      "radius": 60,
      "oreType": "cuprite"
    },
    {
      "x": 626.3146567995392,
      "y": -1181.033265009644,
      "radius": 50,
      "oreType": "cuprite"
    },
    {
      "x": -466.8443045613369,
      "y": -2013.457586279329,
      "radius": 30,
      "oreType": "cuprite"
    },
    {
      "x": 745.8176432081832,
      "y": -1445.4366829497465,
      "radius": 30,
      "oreType": "cuprite"
    },
    {
      "x": 35.82663409110614,
      "y": -1867.6243321065285,
      "radius": 70,
      "oreType": "cuprite"
    },
    {
      "x": -840.6401352690764,
      "y": -1880.915358573306,
      "radius": 60,
      "oreType": "cuprite"
    },
    {
      "x": -1560.6951151095082,
      "y": -1941.2355639010966,
      "radius": 20,
      "oreType": "cuprite"
    },
    {
      "x": -465.7198273222118,
      "y": -609.5463299623347,
      "radius": 10,
      "oreType": "hematite"
    },
    {
      "x": -143.79149443511824,
      "y": -817.9111488450994,
      "radius": 20,
      "oreType": "aurite"
    },
    {
      "x": 523.5367093598542,
      "y": -670.4937849433409,
      "radius": 30,
      "oreType": "cuprite"
    },
    {
      "x": -650.926716251302,
      "y": -1905.9354467413323,
      "radius": 40,
      "oreType": "aurite"
    },
    {
      "x": -1102.3604903883133,
      "y": -1946.451248721693,
      "radius": 20,
      "oreType": "cuprite"
    },
    {
      "x": 337.02859281957603,
      "y": -1560.2974862250271,
      "radius": 20,
      "oreType": "cuprite"
    },
    {
      "x": -825.6336973284238,
      "y": -1550.6852036201221,
      "radius": 30,
      "oreType": "cuprite"
    },
    {
      "x": 822.5245164371297,
      "y": -793.450225468689,
      "radius": 30,
      "oreType": "aurite"
    },
    {
      "x": -107.85264579599061,
      "y": -1608.1705944768885,
      "radius": 50,
      "oreType": "cuprite"
    },
    {
      "x": -78.0453293212936,
      "y": -2148.392195422054,
      "radius": 50,
      "oreType": "cuprite"
    },
    {
      "x": 282.9537245257552,
      "y": -1429.9955975729713,
      "radius": 30,
      "oreType": "aurite"
    },
    {
      "x": 221.24494897616364,
      "y": -1674.1027075805746,
      "radius": 20,
      "oreType": "hematite"
    },
    {
      "x": 125.86789561723208,
      "y": -922.9037614398958,
      "radius": 80,
      "oreType": "hematite"
    },
    {
      "x": 737.9097154151182,
      "y": -855.4248787337779,
      "radius": 40,
      "oreType": "hematite"
    },
    {
      "x": -507.4344213739946,
      "y": -1414.147399919071,
      "radius": 10,
      "oreType": "cuprite"
    },
    {
      "x": -777.5015947905363,
      "y": -2131.2668763252823,
      "radius": 40,
      "oreType": "cuprite"
    },
    {
      "x": 63.46123994903337,
      "y": -1421.8312632436675,
      "radius": 10,
      "oreType": "aurite"
    },
    {
      "x": 108.1848973539577,
      "y": -1634.2686359170577,
      "radius": 10,
      "oreType": "aurite"
    },
    {
      "x": 396.2543856656275,
      "y": -1184.403157460279,
      "radius": 10,
      "oreType": "aurite"
    },
    {
      "x": 632.2983021528621,
      "y": -962.2441772369993,
      "radius": 10,
      "oreType": "hematite"
    },
    {
      "x": 111.61319225455054,
      "y": -663.7180475619674,
      "radius": 10,
      "oreType": "hematite"
    },
    {
      "x": 215.75021423421276,
      "y": -1017.7839222928193,
      "radius": 10,
      "oreType": "hematite"
    },
    {
      "x": 21.36110653884316,
      "y": -1170.518221196324,
      "radius": 10,
      "oreType": "hematite"
    },
    {
      "x": -207.740341816414,
      "y": -1212.173029988189,
      "radius": 10,
      "oreType": "hematite"
    },
    {
      "x": -152.20059676059418,
      "y": -1392.6772014196038,
      "radius": 10,
      "oreType": "hematite"
    },
    {
      "x": -68.89097917686422,
      "y": -1274.6552431759862,
      "radius": 10,
      "oreType": "hematite"
    },
    {
      "x": 125.49812851850538,
      "y": -1489.8717552672886,
      "radius": 10,
      "oreType": "hematite"
    },
    {
      "x": 465.6790669854024,
      "y": -1309.3675838358738,
      "radius": 10,
      "oreType": "cuprite"
    },
    {
      "x": 569.8160889650646,
      "y": -1392.6772014196038,
      "radius": 10,
      "oreType": "cuprite"
    },
    {
      "x": 722.5503878685695,
      "y": -1323.2525200998289,
      "radius": 10,
      "oreType": "cuprite"
    },
    {
      "x": 548.9886845691323,
      "y": -1267.7127750440088,
      "radius": 10,
      "oreType": "cuprite"
    },
    {
      "x": 326.82970434585263,
      "y": -1246.8853706480763,
      "radius": 10,
      "oreType": "cuprite"
    },
    {
      "x": 167.15293731037036,
      "y": -1344.0799244957611,
      "radius": 10,
      "oreType": "cuprite"
    },
    {
      "x": 63.01591533070814,
      "y": -1330.1949882318063,
      "radius": 10,
      "oreType": "cuprite"
    },
    {
      "x": 14.418638406865739,
      "y": -1212.173029988189,
      "radius": 10,
      "oreType": "cuprite"
    },
    {
      "x": 118.55566038652796,
      "y": -1114.9784761405042,
      "radius": 10,
      "oreType": "cuprite"
    },
    {
      "x": 299.0598318179427,
      "y": -1163.5757530643466,
      "radius": 10,
      "oreType": "cuprite"
    },
    {
      "x": 389.31191753365,
      "y": -1073.3236673486392,
      "radius": 10,
      "oreType": "cuprite"
    },
    {
      "x": 271.2899592900326,
      "y": -1045.5537948207293,
      "radius": 10,
      "oreType": "cuprite"
    },
    {
      "x": 125.49812851850538,
      "y": -1080.2661354806166,
      "radius": 10,
      "oreType": "cuprite"
    },
    {
      "x": -55.00604291290938,
      "y": -1489.8717552672886,
      "radius": 10,
      "oreType": "cuprite"
    },
    {
      "x": -41.12110664895431,
      "y": -1371.8497970236713,
      "radius": 10,
      "oreType": "cuprite"
    },
    {
      "x": -332.70476819200894,
      "y": -1024.7263904247968,
      "radius": 10,
      "oreType": "cuprite"
    },
    {
      "x": -395.1869813798062,
      "y": -1024.7263904247968,
      "radius": 10,
      "oreType": "cuprite"
    },
    {
      "x": -492.381535227491,
      "y": -1163.5757530643466,
      "radius": 10,
      "oreType": "cuprite"
    },
    {
      "x": -402.1294495117836,
      "y": -1573.1813728510183,
      "radius": 10,
      "oreType": "cuprite"
    },
    {
      "x": -416.01438577573845,
      "y": -1725.915671754523,
      "radius": 10,
      "oreType": "cuprite"
    },
    {
      "x": -540.9788121513334,
      "y": -1281.597711307964,
      "radius": 10,
      "oreType": "cuprite"
    },
    {
      "x": -513.2089396234232,
      "y": -1045.5537948207293,
      "radius": 10,
      "oreType": "cuprite"
    },
    {
      "x": -381.30204511585134,
      "y": -1371.8497970236713,
      "radius": 10,
      "oreType": "cuprite"
    },
    {
      "x": -402.1294495117836,
      "y": -1705.0882673585907,
      "radius": 10,
      "oreType": "cuprite"
    },
    {
      "x": -159.1430648925716,
      "y": -1163.5757530643466,
      "radius": 10,
      "oreType": "cuprite"
    },
    {
      "x": 326.82970434585263,
      "y": -1670.375926698703,
      "radius": 10,
      "oreType": "cuprite"
    },
    {
      "x": -68.89097917686422,
      "y": -1746.7430761504556,
      "radius": 10,
      "oreType": "cuprite"
    },
    {
      "x": 35.246042802798,
      "y": -1656.4909904347483,
      "radius": 10,
      "oreType": "cuprite"
    },
    {
      "x": 174.09540544234778,
      "y": -1614.8361816428833,
      "radius": 10,
      "oreType": "cuprite"
    },
    {
      "x": 257.40502302607774,
      "y": -1684.2608629626582,
      "radius": 10,
      "oreType": "cuprite"
    },
    {
      "x": 451.79413072144735,
      "y": -1746.7430761504556,
      "radius": 10,
      "oreType": "cuprite"
    },
    {
      "x": 507.3338757772673,
      "y": -1233.0004343841215,
      "radius": 10,
      "oreType": "cuprite"
    },
    {
      "x": 201.86527797025792,
      "y": -1337.1374563637837,
      "radius": 10,
      "oreType": "cuprite"
    },
    {
      "x": 194.92280983828027,
      "y": -1545.4115003231084,
      "radius": 10,
      "oreType": "cuprite"
    },
    {
      "x": 7.476170274888091,
      "y": -1524.584095927176,
      "radius": 10,
      "oreType": "cuprite"
    },
    {
      "x": 28.30357467082058,
      "y": -1524.584095927176,
      "radius": 10,
      "oreType": "cuprite"
    },
    {
      "x": -68.89097917686422,
      "y": -851.1646871253596,
      "radius": 10,
      "oreType": "cuprite"
    },
    {
      "x": 146.32553291443787,
      "y": -809.5098783334946,
      "radius": 10,
      "oreType": "cuprite"
    },
    {
      "x": -186.9129374204815,
      "y": -1017.7839222928193,
      "radius": 10,
      "oreType": "cuprite"
    },
    {
      "x": 14.418638406865739,
      "y": -878.9345596532695,
      "radius": 10,
      "oreType": "cuprite"
    },
    {
      "x": -200.79787368443658,
      "y": -927.531836577112,
      "radius": 10,
      "oreType": "cuprite"
    },
    {
      "x": -256.3376187402564,
      "y": -906.7044321811795,
      "radius": 10,
      "oreType": "cuprite"
    },
    {
      "x": 28.30357467082058,
      "y": -1052.4962629527067,
      "radius": 10,
      "oreType": "cuprite"
    },
    {
      "x": 153.26800104641552,
      "y": -1059.4387310846842,
      "radius": 10,
      "oreType": "cuprite"
    },
    {
      "x": 375.42698126969503,
      "y": -1114.9784761405042,
      "radius": 10,
      "oreType": "cuprite"
    },
    {
      "x": 694.7805153406593,
      "y": -1344.0799244957611,
      "radius": 10,
      "oreType": "cuprite"
    },
    {
      "x": 493.4489395133123,
      "y": -1434.3320102114685,
      "radius": 10,
      "oreType": "cuprite"
    },
    {
      "x": 382.36944940167245,
      "y": -1337.1374563637837,
      "radius": 10,
      "oreType": "cuprite"
    },
    {
      "x": 451.79413072144735,
      "y": -1309.3675838358738,
      "radius": 10,
      "oreType": "cuprite"
    },
    {
      "x": 458.7365988534249,
      "y": -1524.584095927176,
      "radius": 10,
      "oreType": "cuprite"
    },
    {
      "x": 271.2899592900326,
      "y": -1614.8361816428833,
      "radius": 10,
      "oreType": "cuprite"
    },
    {
      "x": 28.30357467082058,
      "y": -1732.8581398865006,
      "radius": 10,
      "oreType": "cuprite"
    },
    {
      "x": -256.3376187402564,
      "y": -1746.7430761504556,
      "radius": 10,
      "oreType": "cuprite"
    },
    {
      "x": -409.071917643761,
      "y": -1628.7211179068381,
      "radius": 10,
      "oreType": "cuprite"
    },
    {
      "x": -339.64723632398636,
      "y": -1607.8937135109059,
      "radius": 10,
      "oreType": "cuprite"
    },
    {
      "x": -89.71838357279671,
      "y": -1781.455416810343,
      "radius": 10,
      "oreType": "cuprite"
    },
    {
      "x": -485.43906709551356,
      "y": -1663.4334585667257,
      "radius": 10,
      "oreType": "cuprite"
    },
    {
      "x": -582.6336209431984,
      "y": -1621.7786497748607,
      "radius": 10,
      "oreType": "cuprite"
    },
    {
      "x": -645.1158341309956,
      "y": -1614.8361816428833,
      "radius": 10,
      "oreType": "cuprite"
    },
    {
      "x": 576.7585570970422,
      "y": -1482.929287135311,
      "radius": 20,
      "oreType": "cuprite"
    },
    {
      "x": -360.4746407199186,
      "y": -899.761964049202,
      "radius": 20,
      "oreType": "cuprite"
    },
    {
      "x": -492.381535227491,
      "y": -906.7044321811795,
      "radius": 20,
      "oreType": "cuprite"
    },
    {
      "x": -360.4746407199186,
      "y": -1101.0935398765491,
      "radius": 20,
      "oreType": "cuprite"
    },
    {
      "x": -277.1650231361889,
      "y": -1052.4962629527067,
      "radius": 20,
      "oreType": "cuprite"
    },
    {
      "x": -416.01438577573845,
      "y": -1142.748348668414,
      "radius": 20,
      "oreType": "cuprite"
    },
    {
      "x": -443.7842583036486,
      "y": -1378.7922651556487,
      "radius": 20,
      "oreType": "cuprite"
    },
    {
      "x": -638.1733659990182,
      "y": -1135.8058805364367,
      "radius": 20,
      "oreType": "cuprite"
    },
    {
      "x": -540.9788121513334,
      "y": -1420.4470739475137,
      "radius": 20,
      "oreType": "cuprite"
    },
    {
      "x": -547.9212802833108,
      "y": -1503.7566915312436,
      "radius": 20,
      "oreType": "cuprite"
    },
    {
      "x": -652.058302262973,
      "y": -1559.2964365870635,
      "radius": 20,
      "oreType": "cuprite"
    },
    {
      "x": -596.5185572071532,
      "y": -1753.685544282433,
      "radius": 20,
      "oreType": "cuprite"
    },
    {
      "x": -318.81983192805365,
      "y": -1857.8225662620953,
      "radius": 20,
      "oreType": "cuprite"
    },
    {
      "x": -214.68280994839142,
      "y": -1823.110225602208,
      "radius": 20,
      "oreType": "cuprite"
    },
    {
      "x": -311.8773637960762,
      "y": -1642.6060541707932,
      "radius": 20,
      "oreType": "cuprite"
    },
    {
      "x": -193.85540555245916,
      "y": -1760.6280124144105,
      "radius": 20,
      "oreType": "cuprite"
    },
    {
      "x": -131.37319236466146,
      "y": -1795.340353074298,
      "radius": 20,
      "oreType": "cuprite"
    },
    {
      "x": -353.5321725879412,
      "y": -1718.9732036225455,
      "radius": 20,
      "oreType": "cuprite"
    },
    {
      "x": -152.20059676059418,
      "y": -1934.1897157138478,
      "radius": 20,
      "oreType": "cuprite"
    },
    {
      "x": -145.25812862861676,
      "y": -1705.0882673585907,
      "radius": 20,
      "oreType": "cuprite"
    },
    {
      "x": 160.21046917839294,
      "y": -1496.814223399266,
      "radius": 20,
      "oreType": "cuprite"
    },
    {
      "x": 56.07344719873072,
      "y": -1455.159414607401,
      "radius": 20,
      "oreType": "cuprite"
    },
    {
      "x": -110.5457879687292,
      "y": -1316.3100519678515,
      "radius": 20,
      "oreType": "cuprite"
    },
    {
      "x": -228.5677462123465,
      "y": -1149.6908168003915,
      "radius": 20,
      "oreType": "cuprite"
    },
    {
      "x": 181.0378735743252,
      "y": -1413.5046058155363,
      "radius": 20,
      "oreType": "cuprite"
    },
    {
      "x": -431.08074129731403,
      "y": -1466.3946335076862,
      "radius": 20,
      "oreType": "hematite"
    },
    {
      "x": -128.5539556814656,
      "y": -1492.4745288193972,
      "radius": 20,
      "oreType": "hematite"
    },
    {
      "x": -102.4740603697544,
      "y": -1226.4595966399443,
      "radius": 20,
      "oreType": "hematite"
    },
    {
      "x": -60.7462278710168,
      "y": -1122.1400153931,
      "radius": 20,
      "oreType": "hematite"
    },
    {
      "x": 137.4609764979873,
      "y": -1727.1935866247968,
      "radius": 20,
      "oreType": "hematite"
    },
    {
      "x": -429.8678596145228,
      "y": -973.4434642725042,
      "radius": 20,
      "oreType": "aurite"
    },
    {
      "x": -449.4620709681749,
      "y": -1228.1682118699828,
      "radius": 20,
      "oreType": "aurite"
    },
    {
      "x": -198.65616564142692,
      "y": -1314.3827418260523,
      "radius": 20,
      "oreType": "aurite"
    },
    {
      "x": -320.1402760340702,
      "y": -1529.9190667162266,
      "radius": 20,
      "oreType": "aurite"
    },
    {
      "x": 87.41932012189523,
      "y": -1239.924738682174,
      "radius": 20,
      "oreType": "aurite"
    },
    {
      "x": -210.4126924536181,
      "y": -1486.8118017381917,
      "radius": 20,
      "oreType": "cuprite"
    },
    {
      "x": -6.63289437563526,
      "y": -1404.5161140528523,
      "radius": 20,
      "oreType": "cuprite"
    },
    {
      "x": -616.463842896359,
      "y": -1231.252219642736,
      "radius": 20,
      "oreType": "cuprite"
    },
    {
      "x": -552.4040933786307,
      "y": -1096.3895890790977,
      "radius": 20,
      "oreType": "cuprite"
    },
    {
      "x": -538.917830322267,
      "y": -961.5269585154595,
      "radius": 20,
      "oreType": "cuprite"
    },
    {
      "x": -714.2392500549968,
      "y": -1214.3943908222814,
      "radius": 10,
      "oreType": "cuprite"
    },
    {
      "x": -677.1520266499961,
      "y": -1264.9678772836457,
      "radius": 10,
      "oreType": "cuprite"
    },
    {
      "x": -565.8903564349946,
      "y": -1170.5640358890987,
      "radius": 10,
      "oreType": "cuprite"
    },
    {
      "x": -579.3766194913583,
      "y": -1001.9857476845509,
      "radius": 10,
      "oreType": "cuprite"
    },
    {
      "x": -771.5558680445429,
      "y": -1116.6189836636436,
      "radius": 10,
      "oreType": "cuprite"
    },
    {
      "x": -825.5009202699985,
      "y": -1248.1100484631909,
      "radius": 10,
      "oreType": "cuprite"
    },
    {
      "x": -120.84367557498808,
      "y": -1012.1004449768238,
      "radius": 10,
      "oreType": "cuprite"
    },
    {
      "x": -293.40442167421725,
      "y": -2107.008872514205,
      "radius": 10,
      "oreType": "cuprite"
    },
    {
      "x": -236.30665940743938,
      "y": -1961.0923689435506,
      "radius": 10,
      "oreType": "cuprite"
    },
    {
      "x": -185.55309294808148,
      "y": -2075.287893477106,
      "radius": 10,
      "oreType": "cuprite"
    },
    {
      "x": -483.73029589680937,
      "y": -2132.385655743884,
      "radius": 10,
      "oreType": "cuprite"
    },
    {
      "x": -382.22316297809357,
      "y": -2183.139222203242,
      "radius": 10,
      "oreType": "cuprite"
    },
    {
      "x": -572.5490372006861,
      "y": -2049.911110247427,
      "radius": 10,
      "oreType": "cuprite"
    },
    {
      "x": -610.6142120452046,
      "y": -2138.729851551304,
      "radius": 10,
      "oreType": "cuprite"
    },
    {
      "x": -947.7763054044126,
      "y": -2068.2898221507053,
      "radius": 10,
      "oreType": "cuprite"
    },
    {
      "x": -982.4416742039193,
      "y": -1990.292742351815,
      "radius": 10,
      "oreType": "cuprite"
    },
    {
      "x": -939.1099632045357,
      "y": -1981.6264001519382,
      "radius": 10,
      "oreType": "cuprite"
    },
    {
      "x": -817.7811724062622,
      "y": -2024.9581111513219,
      "radius": 10,
      "oreType": "cuprite"
    },
    {
      "x": -713.7850660077415,
      "y": -1981.6264001519382,
      "radius": 10,
      "oreType": "cuprite"
    },
    {
      "x": -679.1196972082344,
      "y": -1998.9590845516916,
      "radius": 10,
      "oreType": "cuprite"
    },
    {
      "x": -865.446054505584,
      "y": -2033.6244533511986,
      "radius": 10,
      "oreType": "cuprite"
    },
    {
      "x": -908.7777655049672,
      "y": -2154.9532441494725,
      "radius": 10,
      "oreType": "cuprite"
    },
    {
      "x": -1008.4407008035496,
      "y": -2146.2869019495956,
      "radius": 10,
      "oreType": "cuprite"
    },
    {
      "x": -952.1094765043508,
      "y": -1873.2971226534794,
      "radius": 10,
      "oreType": "cuprite"
    },
    {
      "x": -843.780199005892,
      "y": -1708.636620855822,
      "radius": 10,
      "oreType": "cuprite"
    },
    {
      "x": -725.8853005433216,
      "y": -1849.878879606302,
      "radius": 10,
      "oreType": "cuprite"
    },
    {
      "x": -725.8853005433216,
      "y": -1731.4943129800236,
      "radius": 10,
      "oreType": "cuprite"
    },
    {
      "x": -648.9353322362408,
      "y": -1802.5250529557907,
      "radius": 10,
      "oreType": "cuprite"
    },
    {
      "x": -560.1469072665318,
      "y": -1841.000037109331,
      "radius": 10,
      "oreType": "cuprite"
    },
    {
      "x": -492.07578145642174,
      "y": -1716.6962421517387,
      "radius": 10,
      "oreType": "cuprite"
    },
    {
      "x": -435.8431123089397,
      "y": -1799.5654387901336,
      "radius": 10,
      "oreType": "cuprite"
    },
    {
      "x": -412.1661989836839,
      "y": -1841.000037109331,
      "radius": 10,
      "oreType": "cuprite"
    },
    {
      "x": -518.7123089473343,
      "y": -1917.950005416412,
      "radius": 10,
      "oreType": "cuprite"
    },
    {
      "x": -500.9546239533927,
      "y": -1852.8384937719588,
      "radius": 10,
      "oreType": "cuprite"
    },
    {
      "x": -666.6930172301822,
      "y": -1678.2212579981983,
      "radius": 10,
      "oreType": "cuprite"
    },
    {
      "x": -802.8352688504024,
      "y": -1621.988588850716,
      "radius": 10,
      "oreType": "cuprite"
    },
    {
      "x": -1012.9678746120467,
      "y": -1657.5039588385996,
      "radius": 10,
      "oreType": "cuprite"
    },
    {
      "x": -1060.3217012625578,
      "y": -1838.0404229436742,
      "radius": 10,
      "oreType": "cuprite"
    },
    {
      "x": -977.4525046241633,
      "y": -1713.7366279860819,
      "radius": 10,
      "oreType": "cuprite"
    },
    {
      "x": -921.219835476681,
      "y": -1704.857785489111,
      "radius": 10,
      "oreType": "cuprite"
    },
    {
      "x": -912.3409929797099,
      "y": -1545.0386205436353,
      "radius": 10,
      "oreType": "cuprite"
    },
    {
      "x": -1030.7255596059886,
      "y": -1320.1079439537064,
      "radius": 10,
      "oreType": "cuprite"
    },
    {
      "x": -1113.5947562443835,
      "y": -1420.734825586043,
      "radius": 10,
      "oreType": "cuprite"
    },
    {
      "x": -1042.5640162686163,
      "y": -1225.4002906526837,
      "radius": 10,
      "oreType": "cuprite"
    },
    {
      "x": -989.2909612867911,
      "y": -1222.4406764870266,
      "radius": 10,
      "oreType": "cuprite"
    },
    {
      "x": -1110.6351420787264,
      "y": -1249.0772039779392,
      "radius": 10,
      "oreType": "cuprite"
    },
    {
      "x": -1157.9889687292375,
      "y": -1358.5829281072467,
      "radius": 10,
      "oreType": "cuprite"
    },
    {
      "x": -1267.494692858545,
      "y": -1231.3195189839976,
      "radius": 10,
      "oreType": "cuprite"
    },
    {
      "x": -1317.8081336747132,
      "y": -1133.6522515173178,
      "radius": 10,
      "oreType": "cuprite"
    },
    {
      "x": -1365.1619603252248,
      "y": -1151.4099365112597,
      "radius": 10,
      "oreType": "cuprite"
    },
    {
      "x": -1264.535078692888,
      "y": -1334.906014781991,
      "radius": 10,
      "oreType": "cuprite"
    },
    {
      "x": -1285.252377852487,
      "y": -1435.5328964143278,
      "radius": 10,
      "oreType": "cuprite"
    },
    {
      "x": -1279.3331495211728,
      "y": -1468.0886522365543,
      "radius": 10,
      "oreType": "cuprite"
    },
    {
      "x": -1190.5447245514642,
      "y": -1382.2598414325025,
      "radius": 10,
      "oreType": "cuprite"
    },
    {
      "x": -986.3313471211341,
      "y": -1441.4521247456416,
      "radius": 10,
      "oreType": "cuprite"
    },
    {
      "x": -944.8967488019366,
      "y": -1201.723377327428,
      "radius": 10,
      "oreType": "cuprite"
    },
    {
      "x": -1012.9678746120467,
      "y": -1130.6926373516608,
      "radius": 10,
      "oreType": "cuprite"
    },
    {
      "x": -1057.3620870969012,
      "y": -1175.0868498365153,
      "radius": 10,
      "oreType": "cuprite"
    },
    {
      "x": -1169.8274253918657,
      "y": -1204.682991493085,
      "radius": 10,
      "oreType": "cuprite"
    },
    {
      "x": -1205.342795379749,
      "y": -1181.0060781678292,
      "radius": 10,
      "oreType": "cuprite"
    },
    {
      "x": -1305.9696770120859,
      "y": -1320.1079439537064,
      "radius": 10,
      "oreType": "cuprite"
    },
    {
      "x": -1332.606204502998,
      "y": -1263.875274806224,
      "radius": 10,
      "oreType": "cuprite"
    },
    {
      "x": -1344.4446611656263,
      "y": -1414.815597254729,
      "radius": 10,
      "oreType": "cuprite"
    },
    {
      "x": -1406.5965586444222,
      "y": -1506.5636363900949,
      "radius": 10,
      "oreType": "cuprite"
    },
    {
      "x": -1513.1426686080727,
      "y": -1539.1193922123211,
      "radius": 10,
      "oreType": "cuprite"
    },
    {
      "x": -1379.9600311535096,
      "y": -1592.3924471941466,
      "radius": 10,
      "oreType": "cuprite"
    },
    {
      "x": -1489.465755282817,
      "y": -1503.6040222244378,
      "radius": 10,
      "oreType": "cuprite"
    },
    {
      "x": -1575.294566086869,
      "y": -1799.5654387901336,
      "radius": 10,
      "oreType": "cuprite"
    },
    {
      "x": -1513.1426686080727,
      "y": -1861.7173362689298,
      "radius": 10,
      "oreType": "cuprite"
    },
    {
      "x": -1468.7484561232181,
      "y": -1882.4346354285285,
      "radius": 10,
      "oreType": "cuprite"
    },
    {
      "x": -1584.1734085838398,
      "y": -1687.1001004951693,
      "radius": 10,
      "oreType": "cuprite"
    },
    {
      "x": -1593.052251080811,
      "y": -1687.1001004951693,
      "radius": 10,
      "oreType": "cuprite"
    },
    {
      "x": -1607.8503219090953,
      "y": -1521.3617072183795,
      "radius": 10,
      "oreType": "cuprite"
    },
    {
      "x": -1572.334951921212,
      "y": -1536.1597780466643,
      "radius": 10,
      "oreType": "cuprite"
    },
    {
      "x": -1382.9196453191666,
      "y": -1533.2001638810075,
      "radius": 10,
      "oreType": "cuprite"
    },
    {
      "x": -1329.6465903373414,
      "y": -1657.5039588385996,
      "radius": 10,
      "oreType": "cuprite"
    },
    {
      "x": -1451.9120498370135,
      "y": -1923.1287743058297,
      "radius": 10,
      "oreType": "cuprite"
    },
    {
      "x": -1490.3197194958361,
      "y": -2090.9096470259497,
      "radius": 10,
      "oreType": "cuprite"
    },
    {
      "x": -1453.9335061348465,
      "y": -2159.639161152264,
      "radius": 10,
      "oreType": "cuprite"
    },
    {
      "x": -1393.2898171998636,
      "y": -1985.7939195386457,
      "radius": 10,
      "oreType": "cuprite"
    },
    {
      "x": -1282.1097208190608,
      "y": -2072.7165403454546,
      "radius": 10,
      "oreType": "cuprite"
    },
    {
      "x": -1243.7020511602382,
      "y": -2010.0513951126388,
      "radius": 10,
      "oreType": "cuprite"
    },
    {
      "x": -1195.187100012252,
      "y": -1933.2360557949935,
      "radius": 10,
      "oreType": "cuprite"
    },
    {
      "x": -1077.9426347379513,
      "y": -2056.5448899627927,
      "radius": 10,
      "oreType": "cuprite"
    },
    {
      "x": -1191.1441874165862,
      "y": -2048.4590647714613,
      "radius": 10,
      "oreType": "cuprite"
    },
    {
      "x": -1312.4315652865525,
      "y": -2096.974015919448,
      "radius": 10,
      "oreType": "cuprite"
    },
    {
      "x": -1360.9465164345388,
      "y": -2103.038384812946,
      "radius": 10,
      "oreType": "cuprite"
    },
    {
      "x": -1338.7104971583785,
      "y": -2006.0084825169733,
      "radius": 10,
      "oreType": "cuprite"
    },
    {
      "x": -1417.5472927738565,
      "y": -2111.1242100042773,
      "radius": 10,
      "oreType": "cuprite"
    },
    {
      "x": -1379.1396231150338,
      "y": -2050.480521069294,
      "radius": 20,
      "oreType": "cuprite"
    },
    {
      "x": -1249.766420053737,
      "y": -2107.081297408612,
      "radius": 20,
      "oreType": "cuprite"
    },
    {
      "x": -1122.4146732902723,
      "y": -2109.1027537064447,
      "radius": 20,
      "oreType": "cuprite"
    },
    {
      "x": -1021.3418583986336,
      "y": -2074.7379966432873,
      "radius": 20,
      "oreType": "cuprite"
    },
    {
      "x": -928.3548686983263,
      "y": -1775.5624645640376,
      "radius": 20,
      "oreType": "cuprite"
    },
    {
      "x": -746.423801893377,
      "y": -1537.0306214197708,
      "radius": 20,
      "oreType": "cuprite"
    },
    {
      "x": -1183.0583622252552,
      "y": -1478.4083887826205,
      "radius": 20,
      "oreType": "cuprite"
    },
    {
      "x": -1033.4705961856303,
      "y": -1411.700330954139,
      "radius": 20,
      "oreType": "cuprite"
    },
    {
      "x": -893.9901116351693,
      "y": -1302.5416908711695,
      "radius": 20,
      "oreType": "cuprite"
    },
    {
      "x": -1119.9521691810774,
      "y": -1155.570325819381,
      "radius": 20,
      "oreType": "cuprite"
    },
    {
      "x": -1005.9544812984182,
      "y": -1016.9244892053364,
      "radius": 20,
      "oreType": "cuprite"
    },
    {
      "x": -898.1188305986057,
      "y": -1090.8689353994935,
      "radius": 20,
      "oreType": "cuprite"
    },
    {
      "x": -870.3896632757969,
      "y": -1164.8133815936505,
      "radius": 20,
      "oreType": "cuprite"
    },
    {
      "x": -1424.9730097319753,
      "y": -1229.514772013538,
      "radius": 20,
      "oreType": "cuprite"
    },
    {
      "x": -867.3086446843736,
      "y": -1472.915240735972,
      "radius": 20,
      "oreType": "cuprite"
    },
    {
      "x": -1501.9984745175557,
      "y": -2015.1745128264574,
      "radius": 10,
      "oreType": "hematite"
    },
    {
      "x": -1193.8966153752344,
      "y": -1864.20460184672,
      "radius": 10,
      "oreType": "hematite"
    },
    {
      "x": -1175.4105038266948,
      "y": -1975.1212711379555,
      "radius": 10,
      "oreType": "hematite"
    },
    {
      "x": -1027.5216114383807,
      "y": -1919.6629364923378,
      "radius": 10,
      "oreType": "hematite"
    },
    {
      "x": -1147.681336503886,
      "y": -1663.9383934042112,
      "radius": 10,
      "oreType": "hematite"
    },
    {
      "x": -753.3109568017148,
      "y": -1685.5055235441737,
      "radius": 10,
      "oreType": "hematite"
    },
    {
      "x": -777.9591055331007,
      "y": -1334.2694041219274,
      "radius": 10,
      "oreType": "hematite"
    },
    {
      "x": -1070.6558717183057,
      "y": -1352.7555156704666,
      "radius": 10,
      "oreType": "hematite"
    },
    {
      "x": -725.5817894789061,
      "y": -1466.7532035531253,
      "radius": 10,
      "oreType": "hematite"
    },
    {
      "x": -488.3433579393186,
      "y": -1531.4545939730128,
      "radius": 10,
      "oreType": "hematite"
    },
    {
      "x": -463.695209207933,
      "y": -1291.1351438420024,
      "radius": 10,
      "oreType": "hematite"
    },
    {
      "x": -793.3641984902165,
      "y": -1167.894400185074,
      "radius": 10,
      "oreType": "hematite"
    },
    {
      "x": -928.9290165128382,
      "y": -1016.9244892053364,
      "radius": 10,
      "oreType": "hematite"
    },
    {
      "x": -1329.4614333978557,
      "y": -1497.5633894673576,
      "radius": 10,
      "oreType": "hematite"
    },
    {
      "x": -1172.329485235272,
      "y": -2110.686089160577,
      "radius": 10,
      "oreType": "hematite"
    },
    {
      "x": -1046.0077229869203,
      "y": -1993.607382686495,
      "radius": 20,
      "oreType": "hematite"
    },
    {
      "x": -781.040124124524,
      "y": -1965.878215363686,
      "radius": 20,
      "oreType": "hematite"
    },
    {
      "x": -580.7739156820151,
      "y": -1987.4453455036485,
      "radius": 20,
      "oreType": "hematite"
    },
    {
      "x": -941.2530908785307,
      "y": -1469.8342221445487,
      "radius": 20,
      "oreType": "hematite"
    },
    {
      "x": -919.6859607385682,
      "y": -1651.6143190385183,
      "radius": 20,
      "oreType": "hematite"
    },
    {
      "x": -1354.1095821292415,
      "y": -1337.3504227133506,
      "radius": 20,
      "oreType": "hematite"
    },
    {
      "x": -1274.0030987522377,
      "y": -1565.3457984786683,
      "radius": 20,
      "oreType": "hematite"
    },
    {
      "x": -1196.9776339666573,
      "y": -1546.859686930129,
      "radius": 20,
      "oreType": "hematite"
    },
    {
      "x": -1480.4313443775932,
      "y": -1568.4268170700916,
      "radius": 20,
      "oreType": "hematite"
    },
    {
      "x": -1301.7322660750465,
      "y": -1737.8828395983683,
      "radius": 20,
      "oreType": "hematite"
    },
    {
      "x": -1594.429032260252,
      "y": -2018.2555314178805,
      "radius": 20,
      "oreType": "aurite"
    },
    {
      "x": -848.8225331358344,
      "y": -2095.2809962034607,
      "radius": 20,
      "oreType": "aurite"
    },
    {
      "x": -842.6604959529882,
      "y": -1756.3689511469074,
      "radius": 20,
      "oreType": "aurite"
    },
    {
      "x": -528.3965996278203,
      "y": -1334.2694041219274,
      "radius": 20,
      "oreType": "aurite"
    },
    {
      "x": -1233.949857063736,
      "y": -1414.3758874989308,
      "radius": 20,
      "oreType": "aurite"
    },
    {
      "x": -1015.1975370726882,
      "y": -1781.0170998782933,
      "radius": 20,
      "oreType": "aurite"
    },
    {
      "x": -1126.1142063639236,
      "y": -2039.822661557843,
      "radius": 20,
      "oreType": "aurite"
    },
    {
      "x": -1283.2461545265073,
      "y": -1981.283308320802,
      "radius": 20,
      "oreType": "aurite"
    },
    {
      "x": -1412.6489353662823,
      "y": -1947.3921038151466,
      "radius": 20,
      "oreType": "aurite"
    },
    {
      "x": -1542.0517162060573,
      "y": -1611.5610773500166,
      "radius": 20,
      "oreType": "aurite"
    },
    {
      "x": -1061.412815944036,
      "y": -1078.5448610338008,
      "radius": 20,
      "oreType": "aurite"
    },
    {
      "x": -904.4122352277282,
      "y": -907.3003472251069,
      "radius": 20,
      "oreType": "aurite"
    },
    {
      "x": -769.7403692127059,
      "y": -812.5312563256468,
      "radius": 20,
      "oreType": "cuprite"
    },
    {
      "x": -640.056350087129,
      "y": -812.5312563256468,
      "radius": 20,
      "oreType": "cuprite"
    },
    {
      "x": -1014.1448667955242,
      "y": -932.2395816723332,
      "radius": 10,
      "oreType": "cuprite"
    },
    {
      "x": -879.4730007805015,
      "y": -832.4826438834278,
      "radius": 10,
      "oreType": "cuprite"
    },
    {
      "x": -734.825440986589,
      "y": -682.8472372000698,
      "radius": 10,
      "oreType": "cuprite"
    },
    {
      "x": -600.1535749715667,
      "y": -727.7378592050773,
      "radius": 10,
      "oreType": "cuprite"
    },
    {
      "x": -540.2994122982236,
      "y": -747.6892467628584,
      "radius": 10,
      "oreType": "cuprite"
    },
    {
      "x": -674.9712783132459,
      "y": -682.8472372000698,
      "radius": 10,
      "oreType": "cuprite"
    },
    {
      "x": -724.8497472076983,
      "y": -702.7986247578509,
      "radius": 10,
      "oreType": "cuprite"
    },
    {
      "x": -714.8740534288077,
      "y": -752.6770936523035,
      "radius": 10,
      "oreType": "cuprite"
    },
    {
      "x": -645.0441969765743,
      "y": -752.6770936523035,
      "radius": 10,
      "oreType": "cuprite"
    },
    {
      "x": -455.50601517765404,
      "y": -897.3246534462163,
      "radius": 10,
      "oreType": "cuprite"
    },
    {
      "x": -615.1171156399025,
      "y": -867.3975721095447,
      "radius": 10,
      "oreType": "cuprite"
    },
    {
      "x": -600.1535749715667,
      "y": -837.4704907728731,
      "radius": 10,
      "oreType": "cuprite"
    },
    {
      "x": -535.3115654087783,
      "y": -812.5312563256468,
      "radius": 10,
      "oreType": "cuprite"
    },
    {
      "x": -829.594531886049,
      "y": -767.6406343206394,
      "radius": 10,
      "oreType": "cuprite"
    },
    {
      "x": -814.6309912177135,
      "y": -842.4583376623184,
      "radius": 10,
      "oreType": "aurite"
    },
    {
      "x": -704.8983596499174,
      "y": -792.5798687678657,
      "radius": 10,
      "oreType": "hematite"
    },
    {
      "x": -585.190034303231,
      "y": -772.6284812100846,
      "radius": 10,
      "oreType": "hematite"
    },
    {
      "x": 247.8232462257513,
      "y": -1114.3731160873594,
      "radius": 10,
      "oreType": "hematite"
    },
    {
      "x": 466.02011678096505,
      "y": -1368.3933534501457,
      "radius": 10,
      "oreType": "hematite"
    },
    {
      "x": -1769.4635248427119,
      "y": -1460.5788411344772,
      "radius": 70,
      "oreType": "aurite"
    },
    {
      "x": -1636.1867679556904,
      "y": -1815.8523035294045,
      "radius": 10,
      "oreType": "cuprite"
    },
    {
      "x": -1678.0137040566124,
      "y": -1673.640720786269,
      "radius": 10,
      "oreType": "cuprite"
    },
    {
      "x": -1648.734848785967,
      "y": -1623.448397465162,
      "radius": 10,
      "oreType": "cuprite"
    },
    {
      "x": -1619.4559935153213,
      "y": -1778.2080610385744,
      "radius": 10,
      "oreType": "cuprite"
    },
    {
      "x": -1636.1867679556904,
      "y": -1698.7368824468222,
      "radius": 10,
      "oreType": "cuprite"
    },
    {
      "x": -1703.1098657171658,
      "y": -1774.0253674284822,
      "radius": 10,
      "oreType": "cuprite"
    },
    {
      "x": -1686.3790912767968,
      "y": -1912.0542565615256,
      "radius": 10,
      "oreType": "cuprite"
    },
    {
      "x": -1636.1867679556904,
      "y": -1389.217555299998,
      "radius": 10,
      "oreType": "cuprite"
    },
    {
      "x": -1703.1098657171658,
      "y": -1606.7176230247933,
      "radius": 10,
      "oreType": "aurite"
    },
    {
      "x": -1694.7444784969814,
      "y": -1836.7657715798655,
      "radius": 10,
      "oreType": "aurite"
    },
    {
      "x": -1594.3598318547681,
      "y": -1874.4100140706955,
      "radius": 10,
      "oreType": "aurite"
    },
    {
      "x": -1648.734848785967,
      "y": -1339.025231978891,
      "radius": 10,
      "oreType": "hematite"
    },
    {
      "x": -651.6520774840377,
      "y": -1851.0533035721362,
      "radius": 10,
      "oreType": "hematite"
    },
    {
      "x": -618.3977507068902,
      "y": -653.5678521257157,
      "radius": 30,
      "oreType": "aurite"
    },
    {
      "x": -797.3769216086567,
      "y": -703.9845199853683,
      "radius": 30,
      "oreType": "aurite"
    },
    {
      "x": -908.2935908998924,
      "y": -794.7345221327429,
      "radius": 30,
      "oreType": "aurite"
    },
    {
      "x": -681.418585531456,
      "y": -484.6720147958797,
      "radius": 30,
      "oreType": "aurite"
    },
    {
      "x": -827.6269223244483,
      "y": -535.0886826555322,
      "radius": 30,
      "oreType": "aurite"
    },
    {
      "x": -1014.1685934051627,
      "y": -678.776186055542,
      "radius": 30,
      "oreType": "aurite"
    },
    {
      "x": -1147.772763233242,
      "y": -794.7345221327429,
      "radius": 30,
      "oreType": "aurite"
    },
    {
      "x": -1102.3977621595548,
      "y": -973.7136930345094,
      "radius": 30,
      "oreType": "aurite"
    },
    {
      "x": -1205.7519312718425,
      "y": -1087.1511957187276,
      "radius": 30,
      "oreType": "aurite"
    },
    {
      "x": -1382.2102687806264,
      "y": -890.5261910660827,
      "radius": 30,
      "oreType": "aurite"
    },
    {
      "x": -1500.6894382508099,
      "y": -986.3178599994226,
      "radius": 30,
      "oreType": "aurite"
    },
    {
      "x": -1679.6686091525764,
      "y": -988.8386933924052,
      "radius": 30,
      "oreType": "aurite"
    },
    {
      "x": -1740.1686105841595,
      "y": -1074.5470287538146,
      "radius": 30,
      "oreType": "aurite"
    },
    {
      "x": -1351.9602680648347,
      "y": -1094.7136958976755,
      "radius": 30,
      "oreType": "aurite"
    },
    {
      "x": -1465.397770749053,
      "y": -1160.255364115224,
      "radius": 30,
      "oreType": "aurite"
    },
    {
      "x": -1551.1061061104624,
      "y": -1223.2761989397895,
      "radius": 30,
      "oreType": "aurite"
    },
    {
      "x": -1704.8769430824027,
      "y": -1281.25536697839,
      "radius": 30,
      "oreType": "aurite"
    },
    {
      "x": -1873.7727804122387,
      "y": -1187.9845314380327,
      "radius": 30,
      "oreType": "aurite"
    },
    {
      "x": -344.15442157551047,
      "y": -367.4146485603519,
      "radius": 10,
      "oreType": "cuprite"
    },
    {
      "x": -191.42012267200585,
      "y": -221.6228177888246,
      "radius": 20,
      "oreType": "cuprite"
    },
    {
      "x": -323.3270171795782,
      "y": -228.56528592080213,
      "radius": 20,
      "oreType": "cuprite"
    },
    {
      "x": -260.81334156661,
      "y": -295.3043180121268,
      "radius": 20,
      "oreType": "aurite"
    },
    {
      "x": -369.86331227435426,
      "y": -283.38781225508205,
      "radius": 20,
      "oreType": "cuprite"
    },
    {
      "x": -410.3221014434455,
      "y": -323.8466014241735,
      "radius": 10,
      "oreType": "cuprite"
    },
    {
      "x": -286.45149712974126,
      "y": -219.1855071858389,
      "radius": 10,
      "oreType": "cuprite"
    },
    {
      "x": -557.5732915079727,
      "y": -242.5141433525909,
      "radius": 40,
      "oreType": "cuprite"
    },
    {
      "x": -371.2873212072423,
      "y": -607.3241685248545,
      "radius": 30,
      "oreType": "aurite"
    },
    {
      "x": -511.0017989327901,
      "y": -436.5620290825184,
      "radius": 30,
      "oreType": "aurite"
    },
    {
      "x": -332.47774406125683,
      "y": -417.1572405095256,
      "radius": 30,
      "oreType": "aurite"
    },
    {
      "x": -200.52518176490616,
      "y": -622.8479993832487,
      "radius": 30,
      "oreType": "aurite"
    },
    {
      "x": -22.00112689337294,
      "y": -580.1574645226647,
      "radius": 30,
      "oreType": "aurite"
    },
    {
      "x": -111.26315432913955,
      "y": -331.7761707883575,
      "radius": 30,
      "oreType": "aurite"
    },
    {
      "x": -223.81092805249747,
      "y": -735.3957731066066,
      "radius": 30,
      "oreType": "cuprite"
    },
    {
      "x": -60.81070403935843,
      "y": -665.5385342438327,
      "radius": 20,
      "oreType": "cuprite"
    },
    {
      "x": -1585.22646841409,
      "y": -902.3262085587967,
      "radius": 20,
      "oreType": "cuprite"
    },
    {
      "x": -2508.406158255021,
      "y": -1413.07245611881,
      "radius": 30,
      "oreType": "aurite"
    },
    {
      "x": 1347.3590561840588,
      "y": -1449.4109670501127,
      "radius": 40,
      "oreType": "cuprite"
    },
    {
      "x": 1533.719074657285,
      "y": -1356.2309578134996,
      "radius": 60,
      "oreType": "cuprite"
    },
    {
      "x": 2005.4428714176388,
      "y": -1268.8746991541748,
      "radius": 50,
      "oreType": "cuprite"
    },
    {
      "x": 1941.3816150674672,
      "y": -1437.763465895536,
      "radius": 40,
      "oreType": "cuprite"
    },
    {
      "x": 1644.3703356257631,
      "y": -1175.6946899175618,
      "radius": 70,
      "oreType": "cuprite"
    },
    {
      "x": 1679.312839089493,
      "y": -1350.4072072362114,
      "radius": 10,
      "oreType": "cuprite"
    },
    {
      "x": 1487.1290700389784,
      "y": -1694.008491296222,
      "radius": 10,
      "oreType": "cuprite"
    },
    {
      "x": 1883.144109294584,
      "y": -1694.008491296222,
      "radius": 10,
      "oreType": "cuprite"
    },
    {
      "x": 2383.9866589413796,
      "y": -1327.112204927058,
      "radius": 50,
      "oreType": "cuprite"
    },
    {
      "x": 2121.917882963405,
      "y": -1088.338431258237,
      "radius": 50,
      "oreType": "cuprite"
    },
    {
      "x": 2226.745393354595,
      "y": -1222.2846945358683,
      "radius": 60,
      "oreType": "cuprite"
    },
    {
      "x": 1498.7765711935551,
      "y": -1041.7484266399304,
      "radius": 60,
      "oreType": "cuprite"
    },
    {
      "x": 1376.4778090705004,
      "y": -1653.242237255204,
      "radius": 60,
      "oreType": "cuprite"
    },
    {
      "x": 2261.6878968183246,
      "y": -1670.7134889870688,
      "radius": 70,
      "oreType": "cuprite"
    },
    {
      "x": 2343.2204049003612,
      "y": -1490.1772210911308,
      "radius": 40,
      "oreType": "cuprite"
    },
    {
      "x": 2366.5154072095147,
      "y": -1181.51844049485,
      "radius": 40,
      "oreType": "cuprite"
    },
    {
      "x": 1609.4278321620332,
      "y": -1501.8247222457076,
      "radius": 40,
      "oreType": "cuprite"
    },
    {
      "x": 1452.1865665752487,
      "y": -1874.54475919216,
      "radius": 40,
      "oreType": "cuprite"
    },
    {
      "x": 1586.13282985288,
      "y": -1758.0697476463936,
      "radius": 40,
      "oreType": "cuprite"
    },
    {
      "x": 1923.5269351837692,
      "y": -1949.5509153139894,
      "radius": 120,
      "oreType": "cuprite"
    },
    {
      "x": 1129.9269799153303,
      "y": -1489.3963194020375,
      "radius": 120,
      "oreType": "cuprite"
    },
    {
      "x": 2196.9521298560885,
      "y": -962.5526516187881,
      "radius": 80,
      "oreType": "cuprite"
    },
    {
      "x": 1690.1151836342283,
      "y": -949.2148372445287,
      "radius": 80,
      "oreType": "cuprite"
    },
    {
      "x": 2050.8499655522105,
      "y": -511.3588949635315,
      "radius": 80,
      "oreType": "cuprite"
    },
    {
      "x": 1655.129282029493,
      "y": -691.8630663949464,
      "radius": 110,
      "oreType": "cuprite"
    },
    {
      "x": 1988.3677523644128,
      "y": -303.0848510042066,
      "radius": 50,
      "oreType": "cuprite"
    },
    {
      "x": 1849.518389724863,
      "y": -539.1287674914415,
      "radius": 50,
      "oreType": "cuprite"
    },
    {
      "x": 2224.411668851648,
      "y": -351.6821279280491,
      "radius": 30,
      "oreType": "cuprite"
    },
    {
      "x": 2099.447242476053,
      "y": -754.3452795827438,
      "radius": 10,
      "oreType": "cuprite"
    },
    {
      "x": 2148.0445193998953,
      "y": -650.2082576030814,
      "radius": 10,
      "oreType": "cuprite"
    },
    {
      "x": 2134.1595831359405,
      "y": -254.4875740803642,
      "radius": 10,
      "oreType": "cuprite"
    },
    {
      "x": 2460.455585338883,
      "y": -997.3316642019563,
      "radius": 80,
      "oreType": "cuprite"
    },
    {
      "x": 2564.592607318545,
      "y": -1219.490644425236,
      "radius": 30,
      "oreType": "cuprite"
    },
    {
      "x": 2321.6062226993326,
      "y": -1885.9675850950757,
      "radius": 30,
      "oreType": "cuprite"
    },
    {
      "x": 2154.9869875318727,
      "y": -1899.8525213590308,
      "radius": 30,
      "oreType": "cuprite"
    },
    {
      "x": 1682.899154557403,
      "y": -1990.1046070747384,
      "radius": 40,
      "oreType": "cuprite"
    },
    {
      "x": 1259.408598506776,
      "y": -1948.4497982828734,
      "radius": 40,
      "oreType": "cuprite"
    },
    {
      "x": 1308.0058754306183,
      "y": -2198.3786510340633,
      "radius": 60,
      "oreType": "cuprite"
    },
    {
      "x": 1724.553963349268,
      "y": -2240.0334598259283,
      "radius": 60,
      "oreType": "cuprite"
    },
    {
      "x": 1995.3102204963905,
      "y": -2212.263587298018,
      "radius": 90,
      "oreType": "cuprite"
    },
    {
      "x": 2460.455585338883,
      "y": -1670.7510730037734,
      "radius": 50,
      "oreType": "cuprite"
    },
    {
      "x": 2550.7076710545903,
      "y": -1879.0251169630983,
      "radius": 80,
      "oreType": "cuprite"
    },
    {
      "x": 2210.526732587693,
      "y": -2115.0690334503333,
      "radius": 100,
      "oreType": "cuprite"
    },
    {
      "x": 2814.521460069735,
      "y": -2260.8608642218605,
      "radius": 90,
      "oreType": "cuprite"
    },
    {
      "x": 3085.277717216857,
      "y": -1594.3839235520209,
      "radius": 90,
      "oreType": "cuprite"
    },
    {
      "x": 2988.0831633691723,
      "y": -1781.8305631154135,
      "radius": 40,
      "oreType": "cuprite"
    },
    {
      "x": 2807.5789919377576,
      "y": -1885.9675850950757,
      "radius": 30,
      "oreType": "cuprite"
    },
    {
      "x": 2960.3132908412626,
      "y": -2045.6443521305582,
      "radius": 20,
      "oreType": "cuprite"
    },
    {
      "x": 3113.0475897447673,
      "y": -1913.7374576229859,
      "radius": 20,
      "oreType": "cuprite"
    },
    {
      "x": 2661.78716116623,
      "y": -2115.0690334503333,
      "radius": 10,
      "oreType": "cuprite"
    },
    {
      "x": 2502.1103941307474,
      "y": -2156.7238422421983,
      "radius": 10,
      "oreType": "cuprite"
    },
    {
      "x": 2432.6857128109727,
      "y": -2288.6307367497707,
      "radius": 30,
      "oreType": "cuprite"
    },
    {
      "x": 3106.10512161279,
      "y": -2052.5868202625356,
      "radius": 30,
      "oreType": "cuprite"
    },
    {
      "x": 2592.3624798464552,
      "y": -2191.4361829020854,
      "radius": 20,
      "oreType": "cuprite"
    },
    {
      "x": 2758.981715013915,
      "y": -1254.2029850851236,
      "radius": 50,
      "oreType": "cuprite"
    },
    {
      "x": 3314.3791655721147,
      "y": -1240.3180488211688,
      "radius": 40,
      "oreType": "cuprite"
    },
    {
      "x": 3522.6532095314396,
      "y": -1275.030389481056,
      "radius": 20,
      "oreType": "cuprite"
    },
    {
      "x": 3362.976442495957,
      "y": -1358.340007064786,
      "radius": 20,
      "oreType": "cuprite"
    },
    {
      "x": 1851.0939628156289,
      "y": -2493.621366806714,
      "radius": 20,
      "oreType": "cuprite"
    },
    {
      "x": 2612.9560349119247,
      "y": -2736.9939731708087,
      "radius": 50,
      "oreType": "cuprite"
    },
    {
      "x": 2433.071934555855,
      "y": -2705.249720166796,
      "radius": 70,
      "oreType": "cuprite"
    },
    {
      "x": 2337.839175543818,
      "y": -2408.970025462681,
      "radius": 40,
      "oreType": "cuprite"
    },
    {
      "x": 1219.4111383985228,
      "y": -1011.6666860313475,
      "radius": 60,
      "oreType": "cuprite"
    },
    {
      "x": 1300.860244079415,
      "y": -675.0103825503269,
      "radius": 70,
      "oreType": "cuprite"
    },
    {
      "x": 1116.2422712027262,
      "y": -837.9085939121111,
      "radius": 10,
      "oreType": "cuprite"
    },
    {
      "x": 942.4841790834897,
      "y": -973.6571033802644,
      "radius": 10,
      "oreType": "cuprite"
    },
    {
      "x": 1262.850661428332,
      "y": -881.34811694192,
      "radius": 20,
      "oreType": "cuprite"
    },
    {
      "x": 926.1943579473113,
      "y": -1169.1349570144057,
      "radius": 20,
      "oreType": "cuprite"
    },
    {
      "x": 1002.2135232494772,
      "y": -881.34811694192,
      "radius": 20,
      "oreType": "cuprite"
    },
    {
      "x": 1040.2231059005603,
      "y": -1006.2367456526214,
      "radius": 50,
      "oreType": "cuprite"
    },
    {
      "x": 1099.9524500665477,
      "y": -707.5900248226836,
      "radius": 40,
      "oreType": "cuprite"
    },
    {
      "x": 806.7356696153363,
      "y": -1076.825970576061,
      "radius": 40,
      "oreType": "cuprite"
    },
    {
      "x": 1414.888992032664,
      "y": -560.9816345970779,
      "radius": 40,
      "oreType": "cuprite"
    },
    {
      "x": 1469.1883958199253,
      "y": -452.38282702255503,
      "radius": 40,
      "oreType": "cuprite"
    },
    {
      "x": 1637.5165475604358,
      "y": -273.19479452459245,
      "radius": 60,
      "oreType": "cuprite"
    },
    {
      "x": 1659.2363090753402,
      "y": -490.3924096736381,
      "radius": 60,
      "oreType": "cuprite"
    },
    {
      "x": 1572.357263015722,
      "y": -392.6534828565675,
      "radius": 20,
      "oreType": "cuprite"
    },
    {
      "x": 1382.3093497603072,
      "y": -360.07384058421064,
      "radius": 20,
      "oreType": "cuprite"
    },
    {
      "x": 1889.488000144923,
      "y": -1118.982664040076,
      "radius": 30,
      "oreType": "diamite"
    },
    {
      "x": 1847.8497424485772,
      "y": -1188.3797602006525,
      "radius": 20,
      "oreType": "diamite"
    },
    {
      "x": 1968.138042460243,
      "y": -1105.103244807961,
      "radius": 20,
      "oreType": "diamite"
    },
    {
      "x": 1900.268365302032,
      "y": -1061.9375681092497,
      "radius": 10,
      "oreType": "diamite"
    },
    {
      "x": -514.1993716940551,
      "y": -3906.5381136849946,
      "radius": 40,
      "oreType": "cuprite"
    },
    {
      "x": -506.8179413761168,
      "y": -3736.7652163724115,
      "radius": 40,
      "oreType": "cuprite"
    },
    {
      "x": -506.8179413761168,
      "y": -3596.518040331582,
      "radius": 40,
      "oreType": "cuprite"
    },
    {
      "x": -499.4365110581783,
      "y": -3448.8894339728145,
      "radius": 40,
      "oreType": "cuprite"
    },
    {
      "x": -506.8179413761168,
      "y": -3316.0236882499235,
      "radius": 40,
      "oreType": "cuprite"
    },
    {
      "x": -499.4365110581783,
      "y": -3124.1064999835253,
      "radius": 40,
      "oreType": "cuprite"
    },
    {
      "x": -521.5808020119936,
      "y": -2910.045020763312,
      "radius": 40,
      "oreType": "cuprite"
    },
    {
      "x": -492.05508074024,
      "y": -2740.272123450729,
      "radius": 40,
      "oreType": "cuprite"
    },
    {
      "x": -263.2307408841499,
      "y": -3921.3009743208713,
      "radius": 40,
      "oreType": "hematite"
    },
    {
      "x": -270.61217120208823,
      "y": -3788.4352285979803,
      "radius": 40,
      "oreType": "hematite"
    },
    {
      "x": -248.4678802482731,
      "y": -3633.4251919212743,
      "radius": 40,
      "oreType": "hematite"
    },
    {
      "x": -300.1378924738418,
      "y": -3471.0337249266295,
      "radius": 40,
      "oreType": "hematite"
    },
    {
      "x": -277.9936015200267,
      "y": -3286.4979669781696,
      "radius": 40,
      "oreType": "hematite"
    },
    {
      "x": -241.08644993033465,
      "y": -3138.869360619402,
      "radius": 40,
      "oreType": "hematite"
    },
    {
      "x": -285.375031837965,
      "y": -2961.7150329888805,
      "radius": 40,
      "oreType": "hematite"
    },
    {
      "x": -277.9936015200267,
      "y": -2762.416414404544,
      "radius": 40,
      "oreType": "hematite"
    },
    {
      "x": 46.78933246926255,
      "y": -3921.3009743208713,
      "radius": 40,
      "oreType": "aurite"
    },
    {
      "x": 46.78933246926255,
      "y": -3714.6209254185965,
      "radius": 40,
      "oreType": "aurite"
    },
    {
      "x": 39.40790215132415,
      "y": -3500.5594461983833,
      "radius": 40,
      "oreType": "aurite"
    },
    {
      "x": -12.26211007424456,
      "y": -2939.5707420350655,
      "radius": 40,
      "oreType": "aurite"
    },
    {
      "x": 17.26361119750902,
      "y": -2777.179275040421,
      "radius": 40,
      "oreType": "aurite"
    },
    {
      "x": 342.0465451867982,
      "y": -3891.775253049118,
      "radius": 40,
      "oreType": "hematite"
    },
    {
      "x": 319.902254232983,
      "y": -3766.2909376441653,
      "radius": 40,
      "oreType": "hematite"
    },
    {
      "x": 290.3765329612295,
      "y": -3419.3637127010606,
      "radius": 40,
      "oreType": "hematite"
    },
    {
      "x": 312.5208239150446,
      "y": -3574.373749377767,
      "radius": 40,
      "oreType": "hematite"
    },
    {
      "x": 327.2836845509214,
      "y": -3264.3536760243546,
      "radius": 40,
      "oreType": "hematite"
    },
    {
      "x": 290.3765329612295,
      "y": -3079.817918075895,
      "radius": 40,
      "oreType": "hematite"
    },
    {
      "x": 327.2836845509214,
      "y": -2961.7150329888805,
      "radius": 40,
      "oreType": "hematite"
    },
    {
      "x": 319.902254232983,
      "y": -2821.467856948051,
      "radius": 40,
      "oreType": "hematite"
    },
    {
      "x": 644.6851882222722,
      "y": -3884.3938227311796,
      "radius": 40,
      "oreType": "cuprite"
    },
    {
      "x": 644.6851882222722,
      "y": -3714.6209254185965,
      "radius": 40,
      "oreType": "cuprite"
    },
    {
      "x": 666.8294791760874,
      "y": -3522.7037371521983,
      "radius": 40,
      "oreType": "cuprite"
    },
    {
      "x": 629.9223275863955,
      "y": -3382.456561111369,
      "radius": 40,
      "oreType": "cuprite"
    },
    {
      "x": 622.540897268457,
      "y": -3205.3022334808475,
      "radius": 40,
      "oreType": "cuprite"
    },
    {
      "x": 600.3966063146419,
      "y": -3006.003614896511,
      "radius": 40,
      "oreType": "cuprite"
    },
    {
      "x": 593.0151759967034,
      "y": -2828.8492872659895,
      "radius": 40,
      "oreType": "cuprite"
    },
    {
      "x": 622.540897268457,
      "y": -2629.550668681653,
      "radius": 40,
      "oreType": "cuprite"
    },
    {
      "x": 334.6651148688598,
      "y": -2644.31352931753,
      "radius": 40,
      "oreType": "hematite"
    },
    {
      "x": -241.08644993033465,
      "y": -2585.2620867740225,
      "radius": 40,
      "oreType": "hematite"
    },
    {
      "x": 39.40790215132415,
      "y": -2577.8806564560846,
      "radius": 40,
      "oreType": "aurite"
    },
    {
      "x": 442.3849113727622,
      "y": -2159.3110933979783,
      "radius": 60,
      "oreType": "cuprite"
    },
    {
      "x": -2335.8022366676705,
      "y": 1620.5543978729247,
      "radius": 40,
      "oreType": "aurite"
    },
    {
      "x": -2704.8103190551706,
      "y": 2048.2683115493455,
      "radius": 40,
      "oreType": "aurite"
    },
    {
      "x": -3031.8856648077276,
      "y": 2190.8396161081523,
      "radius": 40,
      "oreType": "aurite"
    },
    {
      "x": -2864.1547182679546,
      "y": 2325.0243733399707,
      "radius": 40,
      "oreType": "aurite"
    },
    {
      "x": -2511.919730534432,
      "y": 1779.8987970857088,
      "radius": 60,
      "oreType": "aurite"
    },
    {
      "x": -2511.919730534432,
      "y": 1486.3696406411063,
      "radius": 70,
      "oreType": "aurite"
    },
    {
      "x": -2117.7520061659657,
      "y": 1712.8064184697996,
      "radius": 80,
      "oreType": "aurite"
    },
    {
      "x": -2335.8022366676705,
      "y": 1880.5373650095726,
      "radius": 90,
      "oreType": "aurite"
    },
    {
      "x": -2604.171751131307,
      "y": 2249.5454473970726,
      "radius": 90,
      "oreType": "aurite"
    },
    {
      "x": -3115.751138077614,
      "y": 2366.9571099749137,
      "radius": 30,
      "oreType": "aurite"
    },
    {
      "x": -3166.070422039546,
      "y": 2257.9319947240615,
      "radius": 30,
      "oreType": "aurite"
    },
    {
      "x": -2889.314360248921,
      "y": 2157.2934268001977,
      "radius": 30,
      "oreType": "aurite"
    },
    {
      "x": -2956.40673886483,
      "y": 2023.1086695683794,
      "radius": 30,
      "oreType": "aurite"
    },
    {
      "x": -2503.5331832074435,
      "y": 2023.1086695683794,
      "radius": 40,
      "oreType": "aurite"
    },
    {
      "x": -2671.264129747216,
      "y": 1897.3104596635499,
      "radius": 10,
      "oreType": "aurite"
    },
    {
      "x": -2210.004026762841,
      "y": 1570.2351139109928,
      "radius": 10,
      "oreType": "aurite"
    },
    {
      "x": -2771.9026976710797,
      "y": 2165.679974127186,
      "radius": 10,
      "oreType": "aurite"
    },
    {
      "x": -3006.726022826762,
      "y": 2425.662941263834,
      "radius": 50,
      "oreType": "aurite"
    },
    {
      "x": -3249.9358953094325,
      "y": 2492.755319879743,
      "radius": 70,
      "oreType": "aurite"
    },
    {
      "x": -2025.4999855690908,
      "y": 1956.0162909524702,
      "radius": 80,
      "oreType": "aurite"
    },
    {
      "x": -2898.8059479911176,
      "y": 1532.882319216699,
      "radius": 50,
      "oreType": "aurite"
    },
    {
      "x": -1639.1123445549815,
      "y": 2443.5313141176985,
      "radius": 50,
      "oreType": "cuprite"
    },
    {
      "x": -1468.4005221712573,
      "y": 2368.4181122688597,
      "radius": 70,
      "oreType": "cuprite"
    },
    {
      "x": -1038.206729764272,
      "y": 2593.757717815376,
      "radius": 50,
      "oreType": "aurite"
    },
    {
      "x": -1748.3679108805654,
      "y": 2272.8194917339742,
      "radius": 50,
      "oreType": "aurite"
    },
    {
      "x": 175.09011635045715,
      "y": 2769.828103037162,
      "radius": 50,
      "oreType": "hematite"
    },
    {
      "x": 286.9631779014792,
      "y": 2683.07536049509,
      "radius": 10,
      "oreType": "hematite"
    },
    {
      "x": 294.1435610149166,
      "y": 3372.392139385083,
      "radius": 10,
      "oreType": "hematite"
    },
    {
      "x": 710.605781594287,
      "y": 3810.3955093047653,
      "radius": 10,
      "oreType": "hematite"
    },
    {
      "x": 825.4919114092859,
      "y": 2948.749535692275,
      "radius": 30,
      "oreType": "hematite"
    },
    {
      "x": 265.42202856116694,
      "y": 3085.176814847586,
      "radius": 20,
      "oreType": "hematite"
    },
    {
      "x": 286.9631779014792,
      "y": 3638.0663145822673,
      "radius": 20,
      "oreType": "hematite"
    },
    {
      "x": 552.6373530986638,
      "y": 3020.553366826649,
      "radius": 20,
      "oreType": "hematite"
    },
    {
      "x": 811.131145182411,
      "y": 2259.4327568022823,
      "radius": 100,
      "oreType": "hematite"
    },
    {
      "x": 531.0962037583515,
      "y": 2740.5184254025894,
      "radius": 100,
      "oreType": "hematite"
    },
    {
      "x": 71.55168449835651,
      "y": 3164.1610290953977,
      "radius": 100,
      "oreType": "hematite"
    },
    {
      "x": 997.821106131784,
      "y": 2740.5184254025894,
      "radius": 120,
      "oreType": "hematite"
    },
    {
      "x": 825.4919114092859,
      "y": 3386.7529056119574,
      "radius": 110,
      "oreType": "hematite"
    },
    {
      "x": 1134.248385287095,
      "y": 3156.98064598196,
      "radius": 150,
      "oreType": "hematite"
    },
    {
      "x": 559.8177362121012,
      "y": 3609.3447821285176,
      "radius": 170,
      "oreType": "hematite"
    },
    {
      "x": 93.09283383866881,
      "y": 3702.689762603204,
      "radius": 40,
      "oreType": "hematite"
    },
    {
      "x": 380.3081583761657,
      "y": 3214.4237108894595,
      "radius": 40,
      "oreType": "hematite"
    },
    {
      "x": -43.334445316642245,
      "y": 2769.239957856339,
      "radius": 40,
      "oreType": "hematite"
    },
    {
      "x": -2920.665417848185,
      "y": -3349.6565154395685,
      "radius": 30,
      "oreType": "cuprite"
    },
    {
      "x": 339.82214551612867,
      "y": 3810.2778888611815,
      "radius": 60,
      "oreType": "diamite"
    },
    {
      "x": 225.305557454305,
      "y": 3507.1457439916485,
      "radius": 80,
      "oreType": "diamite"
    },
    {
      "x": -3887.8350555790694,
      "y": 588.013209551408,
      "radius": 40,
      "oreType": "hematite"
    },
    {
      "x": -4218.790730708572,
      "y": 337.77843079495494,
      "radius": 40,
      "oreType": "aurite"
    },
    {
      "x": -4008.9164001386434,
      "y": 442.7155960799191,
      "radius": 60,
      "oreType": "aurite"
    },
    {
      "x": -4025.0605794132534,
      "y": 692.950374836372,
      "radius": 80,
      "oreType": "aurite"
    },
    {
      "x": -4315.655806356231,
      "y": 943.185153592825,
      "radius": 90,
      "oreType": "hematite"
    },
    {
      "x": -4630.467302211124,
      "y": 668.7341059244573,
      "radius": 90,
      "oreType": "hematite"
    },
    {
      "x": -4331.799985630841,
      "y": 741.3829126602016,
      "radius": 70,
      "oreType": "aurite"
    },
    {
      "x": -4138.0698343355225,
      "y": 822.103809033251,
      "radius": 40,
      "oreType": "aurite"
    },
    {
      "x": -4347.944164905451,
      "y": 450.787685717224,
      "radius": 50,
      "oreType": "aurite"
    },
    {
      "x": -4146.1419239728275,
      "y": 208.62499659807602,
      "radius": 60,
      "oreType": "aurite"
    },
    {
      "x": -3815.186248843325,
      "y": 458.85977535452895,
      "radius": 60,
      "oreType": "hematite"
    },
    {
      "x": -3855.5466970298494,
      "y": 862.4642572197756,
      "radius": 60,
      "oreType": "hematite"
    },
    {
      "x": -4501.313868014244,
      "y": 144.04827949963655,
      "radius": 60,
      "oreType": "hematite"
    },
    {
      "x": -126.98474797100084,
      "y": 3809.6537754752007,
      "radius": 80,
      "oreType": "hematite"
    },
    {
      "x": -4766.842957939241,
      "y": 421.4799001156625,
      "radius": 60,
      "oreType": "aurite"
    },
    {
      "x": -4618.228358298164,
      "y": 246.63919465557197,
      "radius": 60,
      "oreType": "aurite"
    },
    {
      "x": -4041.254030279865,
      "y": 89.2825597414905,
      "radius": 60,
      "oreType": "aurite"
    },
    {
      "x": -3665.3465135406705,
      "y": 447.70600593467606,
      "radius": 60,
      "oreType": "aurite"
    },
    {
      "x": -3883.8973953657837,
      "y": 1033.4223692259793,
      "radius": 60,
      "oreType": "cuprite"
    },
    {
      "x": -4119.932347736906,
      "y": 1042.164404498984,
      "radius": 80,
      "oreType": "cuprite"
    },
    {
      "x": -4469.613758657087,
      "y": 1050.9064397719885,
      "radius": 80,
      "oreType": "cuprite"
    },
    {
      "x": -3726.540760451702,
      "y": 596.320605575753,
      "radius": 50,
      "oreType": "cuprite"
    },
    {
      "x": -4338.483229562019,
      "y": 98.02459501449503,
      "radius": 50,
      "oreType": "hematite"
    },
    {
      "x": -3612.8943019026433,
      "y": 316.5754768396082,
      "radius": 50,
      "oreType": "hematite"
    }
  ],
  "structures": [
    {
      "x": 202.65627223783216,
      "y": -317.8921917456191,
      "type": "shop",
      "inventory": [
        {
          "item": "health pack",
          "quantity": 3,
          "health": 10
        },
        {
          "item": "small energy cell",
          "quantity": 4,
          "energy": 10,
          "maxEnergy": 10
        },
        {
          "item": "medium energy cell",
          "quantity": 2,
          "energy": 30,
          "maxEnergy": 30
        },
        {
          "item": "fuel tank",
          "quantity": 5,
          "fuel": 10,
          "maxFuel": 10
        },
        {
          "item": "oxygen canister",
          "quantity": 1,
          "oxygen": 10,
          "maxOxygen": 10
        }
      ],
      "prices": {}
    },
    {
      "x": -2110,
      "y": -1553.3333333333335,
      "type": "crafting",
      "recipes": [
        {
          "inputs": [
            {
              "item": "copper",
              "quantity": 30
            },
            {
              "item": "hematite",
              "quantity": 30
            },
            {
              "item": "scrap",
              "quantity": 10
            }
          ],
          "output": {
            "item": "large mining laser",
            "quantity": 1
          }
        },
        {
          "inputs": [
            {
              "item": "copper",
              "quantity": 20
            },
            {
              "item": "iron",
              "quantity": 20
            },
            {
              "item": "gold",
              "quantity": 20
            },
            {
              "item": "diamond",
              "quantity": 10
            }
          ],
          "output": {
            "item": "warp key",
            "quantity": 1
          }
        },
        {
          "inputs": [
            {
              "item": "cuprite",
              "quantity": 20
            }
          ],
          "output": {
            "item": "small energy cell",
            "quantity": 1
          }
        },
        {
          "inputs": [
            {
              "item": "hematite",
              "quantity": 10
            },
            {
              "item": "aurite",
              "quantity": 10
            }
          ],
          "output": {
            "item": "fuel tank",
            "quantity": 1
          }
        }
      ]
    },
    {
      "x": 1184.346087836628,
      "y": -87.59521768236709,
      "type": "shipyard",
      "availableShips": [
        "cutter",
        "transport"
      ]
    },
    {
      "x": -3.1546071384400487,
      "y": -3234.6082909316033,
      "type": "piratebase",
      "tier": 2,
      "defenseTypePercentages": {
        "normal": 100,
        "sturdy": 0,
        "fast": 0
      },
      "waveSpawnCount": 4,
      "waveSpawnTypePercentages": {
        "normal": 100,
        "sturdy": 0,
        "fast": 0
      },
      "drops": [
        {
          "item": "scrap",
          "quantity": 15
        }
      ],
      "defenseCount": 12,
      "health": 250,
      "spawnRate": 20
    },
    {
      "x": 2105.595917514832,
      "y": 2359.6222346412865,
      "type": "piratebase",
      "tier": 2,
      "defenseTypePercentages": {
        "normal": 100,
        "sturdy": 0,
        "fast": 0
      },
      "waveSpawnCount": 4,
      "waveSpawnTypePercentages": {
        "normal": 100,
        "sturdy": 0,
        "fast": 0
      },
      "drops": [
        {
          "item": "cuprite",
          "quantity": 30
        }
      ],
      "health": 150,
      "defenseCount": 6,
      "spawnRate": 40
    },
    {
      "x": 2015.0775340700911,
      "y": 1746.2037906960295,
      "type": "piratebase",
      "tier": 2,
      "defenseTypePercentages": {
        "normal": 100,
        "sturdy": 0,
        "fast": 0
      },
      "waveSpawnCount": 4,
      "waveSpawnTypePercentages": {
        "normal": 100,
        "sturdy": 0,
        "fast": 0
      },
      "drops": [
        {
          "item": "cuprite",
          "quantity": 30
        }
      ],
      "health": 150,
      "defenseCount": 6,
      "spawnRate": 40
    },
    {
      "x": 2291.7807634235114,
      "y": 2006.1222840120927,
      "type": "shop",
      "inventory": [
        {
          "item": "medium mining laser",
          "quantity": 1,
          "heat": 0,
          "overheated": false
        },
        {
          "item": "light blaster",
          "quantity": 1,
          "heat": 0,
          "overheated": false
        },
        {
          "item": "medium energy cell",
          "quantity": 5,
          "energy": 30,
          "maxEnergy": 30
        },
        {
          "item": "medium health pack",
          "quantity": 1,
          "health": 30
        },
        {
          "item": "oxygen canister",
          "quantity": 2,
          "oxygen": 10,
          "maxOxygen": 10
        },
        {
          "item": "fuel tank",
          "quantity": 4,
          "fuel": 10,
          "maxFuel": 10
        }
      ],
      "prices": {}
    },
    {
      "x": 358.65949283990255,
      "y": -2395.540509742746,
      "type": "shop",
      "inventory": [
        {
          "item": "small energy cell",
          "quantity": 6,
          "energy": 10,
          "maxEnergy": 10
        },
        {
          "item": "oxygen canister",
          "quantity": 4,
          "oxygen": 10,
          "maxOxygen": 10
        },
        {
          "item": "medium oxygen canister",
          "quantity": 3,
          "oxygen": 30,
          "maxOxygen": 30
        },
        {
          "item": "fuel tank",
          "quantity": 2,
          "fuel": 10,
          "maxFuel": 10
        }
      ],
      "prices": {}
    },
    {
      "x": -2438.7850068551243,
      "y": -3960.8219147478403,
      "type": "shop",
      "inventory": [
        {
          "item": "small energy cell",
          "quantity": 5,
          "energy": 10,
          "maxEnergy": 10
        },
        {
          "item": "fuel tank",
          "quantity": 6,
          "fuel": 10,
          "maxFuel": 10
        },
        {
          "item": "health pack",
          "quantity": 4,
          "health": 10
        }
      ],
      "prices": {}
    },
    {
      "x": -3825.6603360546646,
      "y": -3925.5623724800557,
      "type": "refinery",
      "acceptedOres": [
        "cuprite"
      ]
    },
    {
      "x": -1323.8764307396814,
      "y": 1810.5373148328704,
      "type": "warpgate",
      "warpCost": 5000,
      "warpDestination": "level3"
    },
    {
      "x": 2539.0102782666168,
      "y": 1987.0845089778209,
      "type": "piratebase",
      "tier": 2,
      "defenseTypePercentages": {
        "normal": 100,
        "sturdy": 0,
        "fast": 0
      },
      "waveSpawnCount": 4,
      "waveSpawnTypePercentages": {
        "normal": 100,
        "sturdy": 0,
        "fast": 0
      },
      "drops": [
        {
          "item": "cuprite",
          "quantity": 30
        }
      ],
      "defenseCount": 6,
      "spawnRate": 40
    },
    {
      "x": -4194.574461796657,
      "y": 563.7969406394931,
      "type": "refinery",
      "acceptedOres": [
        "hematite"
      ]
    },
    {
      "x": 3151.012003881905,
      "y": 171.95942887423504,
      "type": "refinery",
      "acceptedOres": [
        "aurite"
      ]
    },
    {
      "x": -1872.5357795369707,
      "y": 3117.1253770821795,
      "type": "refinery",
      "acceptedOres": [
        "diamite"
      ]
    },
    {
      "x": -1938.9426122595892,
      "y": 3183.532209804798,
      "type": "piratebase",
      "tier": 2,
      "defenseTypePercentages": {
        "normal": 100,
        "sturdy": 0,
        "fast": 0
      },
      "waveSpawnCount": 4,
      "waveSpawnTypePercentages": {
        "normal": 100,
        "sturdy": 0,
        "fast": 0
      },
      "drops": [
        {
          "item": "scrap",
          "quantity": 10
        }
      ],
      "defenseCount": 15,
      "spawnRate": 20,
      "health": 300
    },
    {
      "x": 4107.190564218403,
      "y": -4567.294249215078,
      "type": "piratebase",
      "tier": 2,
      "defenseTypePercentages": {
        "normal": 100,
        "sturdy": 0,
        "fast": 0
      },
      "waveSpawnCount": 4,
      "waveSpawnTypePercentages": {
        "normal": 100,
        "sturdy": 0,
        "fast": 0
      },
      "drops": [
        {
          "item": "fuel tank",
          "quantity": 1
        },
        {
          "item": "small energy cell",
          "quantity": 1
        },
        {
          "item": "oxygen canister",
          "quantity": 1
        },
        {
          "item": "scrap",
          "quantity": 5
        },
        {
          "item": "health pack",
          "quantity": 1
        }
      ],
      "health": 200,
      "spawnRate": 25,
      "defenseCount": 12
    },
    {
      "x": 3015.410065844679,
      "y": -2498.4734347029116,
      "type": "crafting",
      "recipes": [
        {
          "inputs": [
            {
              "item": "cuprite",
              "quantity": 50
            },
            {
              "item": "hematite",
              "quantity": 50
            },
            {
              "item": "aurite",
              "quantity": 40
            }
          ],
          "output": {
            "item": "medium blaster",
            "quantity": 1
          }
        },
        {
          "inputs": [
            {
              "item": "hematite",
              "quantity": 30
            }
          ],
          "output": {
            "item": "oxygen canister",
            "quantity": 1
          }
        },
        {
          "inputs": [
            {
              "item": "aurite",
              "quantity": 15
            }
          ],
          "output": {
            "item": "health pack",
            "quantity": 1
          }
        }
      ]
    }
  ],
  "spawnSettings": {
    "initialDelay": 60,
    "waveIntervalMin": 40,
    "waveIntervalMax": 70,
    "waveSizeMin": 1,
    "waveSizeMax": 2,
    "pirateTypePercentages": {
      "normal": 100,
      "sturdy": 0,
      "fast": 0
    },
    "tiers": [
      {
        "startTime": 300,
        "waveIntervalMin": 30,
        "waveIntervalMax": 60,
        "waveSizeMin": 1,
        "waveSizeMax": 3,
        "pirateTypePercentages": {
          "normal": 100,
          "sturdy": 0,
          "fast": 0
        }
      }
    ]
  }
}
```

## levels\level1.json
```
{
  "width": 3000,
  "height": 3000,
  "seed": 4242,
  "asteroids": [
    {
      "x": -215.0157472571609,
      "y": -253.41141641022537,
      "radius": 30
    },
    {
      "x": -130.54527512041912,
      "y": -307.1653532245156,
      "radius": 30
    },
    {
      "x": -341.7214554622736,
      "y": -238.0531487489996,
      "radius": 30
    },
    {
      "x": -426.1919275990154,
      "y": -299.48621939390273,
      "radius": 30
    },
    {
      "x": -142.06397586633847,
      "y": -433.8710614296283,
      "radius": 30
    },
    {
      "x": -314.84448705512847,
      "y": -337.88188854696716,
      "radius": 40
    },
    {
      "x": -241.89271566430602,
      "y": -460.7480298367734,
      "radius": 40
    },
    {
      "x": -145.90354278164492,
      "y": -518.3415335663701,
      "radius": 40
    },
    {
      "x": -334.04232163166074,
      "y": -506.82283282045074,
      "radius": 30
    },
    {
      "x": -42.235236068370895,
      "y": -426.1919275990154,
      "radius": 30
    },
    {
      "x": -46.074802983677344,
      "y": -549.0580688888216,
      "radius": 30
    },
    {
      "x": -30.71653532245156,
      "y": -307.1653532245156,
      "radius": 50
    },
    {
      "x": 64.25721490492191,
      "y": -508.9171420469815,
      "radius": 60
    },
    {
      "x": 478.2713102709257,
      "y": -59.11218441550768,
      "radius": 110
    },
    {
      "x": 91.35519409669368,
      "y": 429.90679574914674,
      "radius": 140
    },
    {
      "x": -338.55160165245303,
      "y": 419.15912585541804,
      "radius": 20
    },
    {
      "x": -462.1498054303327,
      "y": 521.2619898458404,
      "radius": 20
    },
    {
      "x": -494.39281511151876,
      "y": 403.03762101482505,
      "radius": 20
    },
    {
      "x": -591.1218441550767,
      "y": 478.2713102709257,
      "radius": 30
    },
    {
      "x": 974.6583192261886,
      "y": -1042.395190832642,
      "radius": 60
    },
    {
      "x": 914.447766687119,
      "y": -760.1582258057533,
      "radius": 50
    },
    {
      "x": 1283.2374009889202,
      "y": -884.3424904175843,
      "radius": 70
    },
    {
      "x": 1140.23733870863,
      "y": -361.2633152344174,
      "radius": 90
    },
    {
      "x": 1019.8162336304908,
      "y": 677.3687160645326,
      "radius": 140
    },
    {
      "x": 184.39481715090054,
      "y": 1034.8688717652583,
      "radius": 70
    },
    {
      "x": -86.5526692749125,
      "y": 1287.000560522612,
      "radius": 70
    },
    {
      "x": -116.65794554444729,
      "y": 1031.1057122315663,
      "radius": 40
    },
    {
      "x": 116.65794554444729,
      "y": 1241.8426461183099,
      "radius": 40
    },
    {
      "x": 56.44739300537772,
      "y": 1147.7636577760136,
      "radius": 40
    },
    {
      "x": 372.55279383549293,
      "y": 989.7109573609561,
      "radius": 40
    },
    {
      "x": 222.02641248781902,
      "y": 888.1056499512761,
      "radius": 40
    },
    {
      "x": -391.3685915039522,
      "y": 1136.4741791749382,
      "radius": 40
    },
    {
      "x": -867.3401847248717,
      "y": -475.9793696660882,
      "radius": 50
    },
    {
      "x": -1135.2989409813363,
      "y": -800.3504956607557,
      "radius": 50
    },
    {
      "x": 250.329890713276,
      "y": -1163.5051258504377,
      "radius": 50
    },
    {
      "x": -997.7937897444663,
      "y": -1216.3917224800032,
      "radius": 60
    },
    {
      "x": 56.41236973820304,
      "y": -821.5051343125818,
      "radius": 60
    },
    {
      "x": 581.7525629252189,
      "y": 320.8453528860298,
      "radius": 30
    },
    {
      "x": 1092.989663677684,
      "y": 56.41236973820304,
      "radius": 30
    },
    {
      "x": -1071.8350250258577,
      "y": -91.67010082457995,
      "radius": 30
    },
    {
      "x": -1145.8762603072494,
      "y": 35.2577310863769,
      "radius": 30
    },
    {
      "x": -1005.4982569077856,
      "y": 21.76403153480055,
      "radius": 30
    },
    {
      "x": -1057.7319325913068,
      "y": 100.11454506008258,
      "radius": 30
    },
    {
      "x": -1079.4959641261075,
      "y": 0,
      "radius": 10
    },
    {
      "x": -1170.9048965722698,
      "y": -56.58648199048139,
      "radius": 10
    },
    {
      "x": -1118.6712208887484,
      "y": -47.88086937656118,
      "radius": 10
    },
    {
      "x": -1014.2038695217058,
      "y": -43.5280630696011,
      "radius": 10
    },
    {
      "x": -983.7342253729851,
      "y": 82.70331983224213,
      "radius": 10
    },
    {
      "x": -1118.6712208887484,
      "y": 108.82015767400279,
      "radius": 10
    },
    {
      "x": -1197.0217344140306,
      "y": 60.93928829744158,
      "radius": 10
    },
    {
      "x": -1223.1385722557911,
      "y": -8.70561261392021,
      "radius": 10
    },
    {
      "x": -1018.5566758286659,
      "y": -91.40893244616228,
      "radius": 10
    },
    {
      "x": -957.6173875312244,
      "y": -21.76403153480055,
      "radius": 10
    },
    {
      "x": -1136.082446116589,
      "y": -78.35051352528194,
      "radius": 10
    },
    {
      "x": -1114.3184145817884,
      "y": -130.5841892088033,
      "radius": 10
    },
    {
      "x": -1192.6689281070703,
      "y": -100.11454506008255,
      "radius": 20
    },
    {
      "x": -970.6758064521047,
      "y": -65.29209460440165,
      "radius": 20
    },
    {
      "x": -1170.9048965722698,
      "y": 134.93699551576347,
      "radius": 20
    },
    {
      "x": -1109.9656082748284,
      "y": 191.5234775062449,
      "radius": 20
    },
    {
      "x": -1292.7834731671528,
      "y": -1240.5497974836314,
      "radius": 30
    },
    {
      "x": -1005.4982569077856,
      "y": -1375.486792999395,
      "radius": 30
    },
    {
      "x": 126.2313829018432,
      "y": -1044.6735136704265,
      "radius": 30
    },
    {
      "x": 282.9324099524072,
      "y": -848.7972298572215,
      "radius": 30
    },
    {
      "x": -887.9724866198626,
      "y": -700.8018154205779,
      "radius": 30
    },
    {
      "x": -964.0192632605659,
      "y": 919.8834415691183,
      "radius": 200,
      "oreType": "hematite"
    },
    {
      "x": 1098.7496663186691,
      "y": -882.716433828952,
      "radius": 30,
      "oreType": "hematite"
    },
    {
      "x": 13.670152204495139,
      "y": 989.3394478660074,
      "radius": 10,
      "oreType": "cuprite"
    },
    {
      "x": -63.358498715463156,
      "y": 1143.3967497059239,
      "radius": 10,
      "oreType": "cuprite"
    },
    {
      "x": 276.8513761810194,
      "y": 1181.911075165903,
      "radius": 10,
      "oreType": "cuprite"
    },
    {
      "x": -243.09201752869922,
      "y": 1136.977695462594,
      "radius": 10,
      "oreType": "cuprite"
    },
    {
      "x": -217.41580055537975,
      "y": -365.0809974765932,
      "radius": 20,
      "oreType": "cuprite"
    },
    {
      "x": -358.6349939086367,
      "y": -422.85248566656196,
      "radius": 20,
      "oreType": "cuprite"
    },
    {
      "x": 39.34636917781461,
      "y": -397.1762686932425,
      "radius": 20,
      "oreType": "cuprite"
    }
  ],
  "structures": [
    {
      "x": -432.7633463745625,
      "y": 7.526319067383696,
      "type": "warpgate",
      "warpCost": 3000,
      "warpDestination": "level2"
    },
    {
      "x": 835.4214164795902,
      "y": 1072.5004671021766,
      "type": "shop",
      "inventory": [
        {
          "item": "light blaster",
          "quantity": 1,
          "heat": 0,
          "overheated": false
        },
        {
          "item": "small energy cell",
          "energy": 5,
          "maxEnergy": 5,
          "quantity": 7
        },
        {
          "item": "fuel tank",
          "fuel": 5,
          "maxFuel": 5,
          "quantity": 4
        }
      ],
      "prices": {}
    },
    {
      "x": -514.7628738611028,
      "y": -1078.8865712431332,
      "type": "piratebase",
      "tier": 2,
      "defenseTypePercentages": {
        "normal": 100,
        "sturdy": 0,
        "fast": 0
      },
      "waveSpawnCount": 4,
      "waveSpawnTypePercentages": {
        "normal": 100,
        "sturdy": 0,
        "fast": 0
      },
      "drops": [
        {
          "item": "scrap",
          "quantity": 40
        },
        {
          "item": "warp key",
          "quantity": 1
        }
      ]
    },
    {
      "x": 730,
      "y": -453.33333333333337,
      "type": "shop",
      "inventory": [
        {
          "item": "medium mining laser",
          "quantity": 1,
          "heat": 0,
          "overheated": false
        },
        {
          "item": "small energy cell",
          "quantity": 3,
          "energy": 10,
          "maxEnergy": 10
        },
        {
          "item": "medium energy cell",
          "quantity": 2,
          "energy": 30,
          "maxEnergy": 30
        },
        {
          "item": "oxygen canister",
          "quantity": 3,
          "oxygen": 10,
          "maxOxygen": 10
        }
      ],
      "prices": {}
    },
    {
      "x": -1290,
      "y": 980,
      "type": "warpgate",
      "warpDestination": "level6",
      "warpCost": 3000
    }
  ],
  "spawnSettings": {
    "initialDelay": 120,
    "waveIntervalMin": 80,
    "waveIntervalMax": 120,
    "waveSizeMin": 1,
    "waveSizeMax": 2,
    "pirateTypePercentages": {
      "normal": 100,
      "sturdy": 0,
      "fast": 0
    },
    "tiers": [
      {
        "startTime": 400,
        "waveIntervalMin": 80,
        "waveIntervalMax": 110,
        "waveSizeMin": 2,
        "waveSizeMax": 3,
        "pirateTypePercentages": {
          "normal": 100,
          "sturdy": 0,
          "fast": 0
        }
      },
      {
        "startTime": 600,
        "waveIntervalMin": 70,
        "waveIntervalMax": 100,
        "waveSizeMin": 2,
        "waveSizeMax": 5,
        "pirateTypePercentages": {
          "normal": 100,
          "sturdy": 0,
          "fast": 0
        }
      }
    ]
  }
}
```

## levels\debug.json
```
{
  "width": 5000,
  "height": 5000,
  "seed": 1337,
  "debug": true,
  "asteroids": [
    {
      "x": -478.66600877487025,
      "y": 295.64665247859637,
      "radius": 10
    },
    {
      "x": -337.8818885469673,
      "y": 295.64665247859637,
      "radius": 20
    },
    {
      "x": -178.32655228867716,
      "y": 305.03226049378986,
      "radius": 30
    },
    {
      "x": -23.464020037983836,
      "y": 295.64665247859637,
      "radius": 40
    },
    {
      "x": 164.24814026588686,
      "y": 272.1826324406125,
      "radius": 50
    },
    {
      "x": 389.5027326305317,
      "y": 229.9473963722416,
      "radius": 60
    },
    {
      "x": 586.6005009495959,
      "y": 178.32655228867716,
      "radius": 70
    },
    {
      "x": 821.2407013294343,
      "y": 107.93449217472565,
      "radius": 80
    },
    {
      "x": 1074.6521177396596,
      "y": 0,
      "radius": 90
    },
    {
      "x": 1313.9851221270949,
      "y": -211.17618034185452,
      "radius": 100
    },
    {
      "x": 1604.9389705980943,
      "y": -450.50918472928964,
      "radius": 110
    },
    {
      "x": 1816.115150939949,
      "y": -736.7702291926925,
      "radius": 120
    },
    {
      "x": 1769.1871108639814,
      "y": -1093.4233337700468,
      "radius": 130
    },
    {
      "x": 1497.0044784233687,
      "y": -1426.6124183094173,
      "radius": 140
    },
    {
      "x": 1210.743433959966,
      "y": -1572.0893425449171,
      "radius": 150
    },
    {
      "x": 807.162289306644,
      "y": -1572.0893425449171,
      "radius": 160
    },
    {
      "x": 422.35236068370904,
      "y": -1572.0893425449171,
      "radius": 170
    },
    {
      "x": -32.84962805317737,
      "y": -1567.3965385373203,
      "radius": 180
    },
    {
      "x": -469.28040075967675,
      "y": -1529.8541064765461,
      "radius": 190
    },
    {
      "x": -915.0967814813696,
      "y": -1487.6188704081753,
      "radius": 200
    },
    {
      "x": -1281.1354940739175,
      "y": -1135.6585698384176,
      "radius": 210
    },
    {
      "x": -1487.6188704081753,
      "y": -642.9141490407571,
      "radius": 220
    },
    {
      "x": -1745.7230908259974,
      "y": -136.09131622030625,
      "radius": 230
    },
    {
      "x": -1689.4094427348361,
      "y": 422.35236068370904,
      "radius": 240
    },
    {
      "x": -1304.5995141119013,
      "y": 980.7960375877244,
      "radius": 250
    },
    {
      "x": -558.4436769040153,
      "y": 1177.8938059067887,
      "radius": 260
    },
    {
      "x": 244.0258083950319,
      "y": 1220.1290419751595,
      "radius": 270
    },
    {
      "x": 1051.1880977016758,
      "y": 1238.9002580055467,
      "radius": 280
    },
    {
      "x": 1783.2655228867716,
      "y": 877.5543494205955,
      "radius": 290
    },
    {
      "x": 2078.912175365368,
      "y": 28.156824045580603,
      "radius": 300
    },
    {
      "x": -64.78826626777249,
      "y": -165.6880252093854,
      "radius": 20,
      "oreType": "cuprite"
    },
    {
      "x": 39.29780085094397,
      "y": -182.6816688206044,
      "radius": 20,
      "oreType": "cuprite"
    },
    {
      "x": 115.76919710142953,
      "y": -214.54475059164005,
      "radius": 20,
      "oreType": "cuprite"
    },
    {
      "x": 62.66406081637011,
      "y": -293.140352293528,
      "radius": 20,
      "oreType": "cuprite"
    },
    {
      "x": 1.0621027257011884,
      "y": -335.6244613215755,
      "radius": 20,
      "oreType": "cuprite"
    },
    {
      "x": -77.53349897618675,
      "y": -354.7423103841969,
      "radius": 20,
      "oreType": "cuprite"
    },
    {
      "x": -86.03032078179626,
      "y": -254.9046541682852,
      "radius": 20,
      "oreType": "cuprite"
    },
    {
      "x": 9.558924531310694,
      "y": -257.0288596196876,
      "radius": 20,
      "oreType": "cuprite"
    },
    {
      "x": -49.918828107955854,
      "y": -280.3951195851137,
      "radius": 20,
      "oreType": "cuprite"
    },
    {
      "x": -62.66406081637011,
      "y": -305.8855850019422,
      "radius": 20,
      "oreType": "cuprite"
    },
    {
      "x": -154.00489522667232,
      "y": -322.8792286131613,
      "radius": 20,
      "oreType": "cuprite"
    },
    {
      "x": -202.86162060892698,
      "y": -250.65624326548044,
      "radius": 20,
      "oreType": "cuprite"
    },
    {
      "x": -162.50171703228182,
      "y": -148.69438159816636,
      "radius": 20,
      "oreType": "cuprite"
    },
    {
      "x": -92.40293713600339,
      "y": -237.9110105570662,
      "radius": 20,
      "oreType": "cuprite"
    },
    {
      "x": -158.25330612947707,
      "y": -157.1912034037759,
      "radius": 20,
      "oreType": "cuprite"
    },
    {
      "x": -323.9413313388624,
      "y": -129.57653253554497,
      "radius": 20,
      "oreType": "cuprite"
    },
    {
      "x": -334.56235859587434,
      "y": -240.03521600846858,
      "radius": 20,
      "oreType": "cuprite"
    },
    {
      "x": -296.32666047063157,
      "y": -365.3633376412088,
      "radius": 20,
      "oreType": "cuprite"
    },
    {
      "x": -209.2342369631341,
      "y": -463.0767884057181,
      "radius": 20,
      "oreType": "cuprite"
    },
    {
      "x": -45.6704172051511,
      "y": -475.8220211141324,
      "radius": 20,
      "oreType": "cuprite"
    },
    {
      "x": 143.38386796966043,
      "y": -384.4811867038302,
      "radius": 20,
      "oreType": "cuprite"
    },
    {
      "x": 156.12910067807468,
      "y": -350.49389948139213,
      "radius": 20,
      "oreType": "cuprite"
    },
    {
      "x": 298.4508659220339,
      "y": -263.4014759738947,
      "radius": 20,
      "oreType": "cuprite"
    },
    {
      "x": 126.39022435844142,
      "y": -110.45868347292358,
      "radius": 20,
      "oreType": "cuprite"
    },
    {
      "x": 24.428362691127333,
      "y": -118.9555052785331,
      "radius": 20,
      "oreType": "cuprite"
    },
    {
      "x": -128.5144298098438,
      "y": -89.21662895889982,
      "radius": 20,
      "oreType": "cuprite"
    },
    {
      "x": -213.48264786593887,
      "y": -97.71345076450933,
      "radius": 20,
      "oreType": "cuprite"
    },
    {
      "x": -258.0909623453888,
      "y": -212.42054514023766,
      "radius": 20,
      "oreType": "cuprite"
    },
    {
      "x": -255.9667568939864,
      "y": -299.51296864773514,
      "radius": 20,
      "oreType": "cuprite"
    },
    {
      "x": -215.60685331734123,
      "y": -361.11492673840405,
      "radius": 20,
      "oreType": "cuprite"
    },
    {
      "x": -130.63863526124618,
      "y": -375.9843648982207,
      "radius": 20,
      "oreType": "cuprite"
    },
    {
      "x": -54.1672390107606,
      "y": -422.71688482907297,
      "radius": 20,
      "oreType": "cuprite"
    },
    {
      "x": 11.683129982713071,
      "y": -390.85380305803733,
      "radius": 20,
      "oreType": "cuprite"
    },
    {
      "x": 54.1672390107606,
      "y": -382.35698125242783,
      "radius": 20,
      "oreType": "cuprite"
    },
    {
      "x": 105.14816984441765,
      "y": -282.5193250365161,
      "radius": 20,
      "oreType": "cuprite"
    },
    {
      "x": 134.88704616405093,
      "y": -276.146708682309,
      "radius": 20,
      "oreType": "cuprite"
    },
    {
      "x": -9.558924531310694,
      "y": -186.93007972340914,
      "radius": 20,
      "oreType": "cuprite"
    },
    {
      "x": -60.539855364967735,
      "y": -206.04792878603055,
      "radius": 20,
      "oreType": "cuprite"
    },
    {
      "x": -103.02396439301528,
      "y": -206.04792878603055,
      "radius": 20,
      "oreType": "cuprite"
    },
    {
      "x": -147.63227887246518,
      "y": -225.16577784865194,
      "radius": 20,
      "oreType": "cuprite"
    }
  ],
  "structures": [
    {
      "x": -647.0552671883593,
      "y": -851.8195922479665,
      "type": "shop"
    },
    {
      "x": -122.85859503576441,
      "y": -876.3913112551195,
      "type": "shop"
    },
    {
      "x": 401.3380771168304,
      "y": -909.1536032646567,
      "type": "shop"
    },
    {
      "x": 1122.1085013266484,
      "y": -991.0593332884996,
      "type": "shop"
    },
    {
      "x": 1187.6330853457225,
      "y": -573.3401101669006,
      "type": "shop"
    },
    {
      "x": -737.1515702145864,
      "y": 573.3401101669006,
      "type": "shipyard"
    },
    {
      "x": -352.19463910252466,
      "y": 720.7704242098179,
      "type": "shipyard"
    },
    {
      "x": 188.38317905483876,
      "y": 704.3892782050493,
      "type": "shipyard"
    },
    {
      "x": 597.9118291740534,
      "y": 655.2458401907435,
      "type": "shipyard"
    },
    {
      "x": 1228.5859503576442,
      "y": 540.5778181573634,
      "type": "shipyard"
    },
    {
      "x": -1425.159702414867,
      "y": 1646.305173479243,
      "type": "refinery"
    },
    {
      "x": -876.3913112551195,
      "y": 1793.7354875221604,
      "type": "refinery"
    },
    {
      "x": -319.43234709298747,
      "y": 1859.2600715412348,
      "type": "refinery"
    },
    {
      "x": 303.0512010882189,
      "y": 1867.450644543619,
      "type": "refinery"
    },
    {
      "x": 860.0101652503508,
      "y": 1900.2129365531562,
      "type": "refinery"
    },
    {
      "x": -1449.73142142202,
      "y": 2137.7395536223007,
      "type": "fueling"
    },
    {
      "x": -884.5818842575037,
      "y": 2186.8829916366067,
      "type": "fueling"
    },
    {
      "x": -499.6249531454419,
      "y": 2244.2170026532967,
      "type": "fueling"
    },
    {
      "x": 98.28687602861153,
      "y": 2268.7887216604495,
      "type": "fueling"
    },
    {
      "x": 671.6269861955121,
      "y": 2285.169867665218,
      "type": "fueling"
    },
    {
      "x": -1900.2129365531562,
      "y": -1433.3502754172514,
      "type": "warpgate"
    },
    {
      "x": -1498.8748594363258,
      "y": -1842.878925536466,
      "type": "warpgate"
    },
    {
      "x": -941.9158952741938,
      "y": -2104.9772616127634,
      "type": "warpgate"
    },
    {
      "x": -196.57375205722306,
      "y": -2203.264137641375,
      "type": "warpgate"
    },
    {
      "x": 360.38521210490893,
      "y": -2203.264137641375,
      "type": "warpgate"
    },
    {
      "x": 1310.491680381487,
      "y": -2162.3112726294535,
      "type": "piratebase",
      "tier": 2,
      "defenseTypePercentages": {
        "normal": 100,
        "sturdy": 0,
        "fast": 0
      },
      "waveSpawnCount": 4,
      "waveSpawnTypePercentages": {
        "normal": 100,
        "sturdy": 0,
        "fast": 0
      }
    },
    {
      "x": 2104.9772616127634,
      "y": -1679.0674654887803,
      "type": "piratebase",
      "tier": 2,
      "defenseTypePercentages": {
        "normal": 100,
        "sturdy": 0,
        "fast": 0
      },
      "waveSpawnCount": 4,
      "waveSpawnTypePercentages": {
        "normal": 100,
        "sturdy": 0,
        "fast": 0
      }
    },
    {
      "x": 993.4741168946478,
      "y": -1001.0004359620316,
      "type": "shop"
    },
    {
      "x": 940,
      "y": -966.6666666666667,
      "type": "warpgate"
    },
    {
      "x": 500,
      "y": -913.3333333333334,
      "type": "warpgate"
    }
  ]
}
```

## levels\level3.json
```
{
  "width": 6000,
  "height": 6000,
  "seed": 999,
  "asteroids": [
    {
      "x": 136.2761540417768,
      "y": 263.7684411646369,
      "radius": 30,
      "oreType": "cuprite"
    },
    {
      "x": 281.91739225364466,
      "y": 304.2243406679335,
      "radius": 30,
      "oreType": "cuprite"
    },
    {
      "x": 120.09379424045818,
      "y": 421.5464492274937,
      "radius": 30,
      "oreType": "cuprite"
    },
    {
      "x": 209.09677314771073,
      "y": 377.04495977386745,
      "radius": 30,
      "oreType": "cuprite"
    },
    {
      "x": 120.09379424045818,
      "y": 332.54347032024117,
      "radius": 30,
      "oreType": "aurite"
    },
    {
      "x": 201.00559324705142,
      "y": 296.1331607672742,
      "radius": 30,
      "oreType": "hematite"
    },
    {
      "x": 31.090815333205626,
      "y": 336.5890602705708,
      "radius": 30,
      "oreType": "hematite"
    },
    {
      "x": 87.72907463782087,
      "y": 498.4126582837573,
      "radius": 30,
      "oreType": "cuprite"
    },
    {
      "x": 306.1909319556226,
      "y": 385.13613967452676,
      "radius": 30,
      "oreType": "cuprite"
    },
    {
      "x": 330.46447165760065,
      "y": 502.45824823408697,
      "radius": 30,
      "oreType": "cuprite"
    },
    {
      "x": 217.1879530483701,
      "y": 482.2302984824387,
      "radius": 30,
      "oreType": "hematite"
    },
    {
      "x": 196.96000329672177,
      "y": 575.278867340021,
      "radius": 30,
      "oreType": "aurite"
    },
    {
      "x": 36.66666666666667,
      "y": 573.3333333333334,
      "radius": 30,
      "oreType": "cuprite"
    },
    {
      "x": 23.333333333333336,
      "y": 440,
      "radius": 30,
      "oreType": "hematite"
    },
    {
      "x": -877.5514785221641,
      "y": -1904.220958704698,
      "radius": 140,
      "oreType": "diamite"
    },
    {
      "x": 1224.4988482298259,
      "y": 1717.7761457084243,
      "radius": 180,
      "oreType": "diamite"
    },
    {
      "x": -1063.1697287072213,
      "y": 1245.7175504674465,
      "radius": 110,
      "oreType": "diamite"
    },
    {
      "x": 1544.046205008334,
      "y": 221.71352079086333,
      "radius": 120,
      "oreType": "diamite"
    },
    {
      "x": 95.72863247230195,
      "y": -1536.9884880111667,
      "radius": 170,
      "oreType": "platinite"
    },
    {
      "x": 229.54457826037992,
      "y": 1013.3194728103496,
      "radius": 190,
      "oreType": "platinite"
    },
    {
      "x": 1794.478046557064,
      "y": -1127.761140632761,
      "radius": 110,
      "oreType": "aurite"
    },
    {
      "x": -1285.8123869365998,
      "y": -277.7694061177084,
      "radius": 140,
      "oreType": "aurite"
    },
    {
      "x": -1774.3844584251206,
      "y": -1645.15260181983,
      "radius": 30,
      "oreType": "diamite"
    },
    {
      "x": -1666.5693639877818,
      "y": -1626.126408683829,
      "radius": 20,
      "oreType": "diamite"
    },
    {
      "x": -1679.2534927451159,
      "y": -1708.5732456064998,
      "radius": 30,
      "oreType": "diamite"
    },
    {
      "x": -1571.4383983077773,
      "y": -1657.836730577164,
      "radius": 40,
      "oreType": "diamite"
    },
    {
      "x": -1615.832848958446,
      "y": -1537.3375073824914,
      "radius": 20,
      "oreType": "diamite"
    },
    {
      "x": -1685.5955571237828,
      "y": -1550.0216361398252,
      "radius": 10,
      "oreType": "diamite"
    },
    {
      "x": -1729.9900077744517,
      "y": -1562.705764897159,
      "radius": 10,
      "oreType": "diamite"
    },
    {
      "x": -1710.9638146384507,
      "y": -1499.2851211104894,
      "radius": 20,
      "oreType": "diamite"
    },
    {
      "x": -1533.3860120357754,
      "y": -1569.0478292758262,
      "radius": 40,
      "oreType": "diamite"
    },
    {
      "x": -1622.1749133371131,
      "y": -1454.8906704598207,
      "radius": 30,
      "oreType": "diamite"
    },
    {
      "x": -1508.0177545211077,
      "y": -1473.9168635958215,
      "radius": 20,
      "oreType": "diamite"
    },
    {
      "x": -1495.3336257637736,
      "y": -1683.2049880918316,
      "radius": 10,
      "oreType": "diamite"
    },
    {
      "x": -1615.832848958446,
      "y": -1752.9676962571684,
      "radius": 10,
      "oreType": "diamite"
    },
    {
      "x": -1818.7789090757894,
      "y": -1518.3113142464904,
      "radius": 30,
      "oreType": "diamite"
    },
    {
      "x": -1710.9638146384507,
      "y": -1435.8644773238198,
      "radius": 20,
      "oreType": "diamite"
    },
    {
      "x": -1844.1471665904573,
      "y": -1594.416086790494,
      "radius": 20,
      "oreType": "diamite"
    },
    {
      "x": -1363.0506903593553,
      "y": 2074.0732876052384,
      "radius": 60,
      "oreType": "hematite"
    },
    {
      "x": -1343.7180752742556,
      "y": 1861.414521669141,
      "radius": 80,
      "oreType": "hematite"
    },
    {
      "x": -1566.0431487529027,
      "y": 1987.0765197222895,
      "radius": 120,
      "oreType": "hematite"
    },
    {
      "x": -1943.029142912348,
      "y": 2219.0679007434865,
      "radius": 100,
      "oreType": "hematite"
    },
    {
      "x": 1227.5197310440121,
      "y": 1107.4425333502506,
      "radius": 30,
      "oreType": "aurite"
    },
    {
      "x": 1304.8501913844111,
      "y": 1204.1056087757495,
      "radius": 30,
      "oreType": "aurite"
    },
    {
      "x": 1411.17957435246,
      "y": 1252.4371464884987,
      "radius": 40,
      "oreType": "aurite"
    },
    {
      "x": 1391.84695926736,
      "y": 1001.1131503822019,
      "radius": 40,
      "oreType": "aurite"
    },
    {
      "x": 1507.8426497779585,
      "y": 1059.1109956375012,
      "radius": 60,
      "oreType": "aurite"
    },
    {
      "x": 1623.8383402885572,
      "y": 1136.4414559779002,
      "radius": 20,
      "oreType": "aurite"
    },
    {
      "x": 1623.8383402885572,
      "y": 923.7826900418029,
      "radius": 30,
      "oreType": "aurite"
    },
    {
      "x": 1517.5089573205084,
      "y": 856.1185372439538,
      "radius": 70,
      "oreType": "aurite"
    },
    {
      "x": 1739.8340307991557,
      "y": 991.4468428396522,
      "radius": 40,
      "oreType": "aurite"
    },
    {
      "x": -657.2503163325954,
      "y": -1032.3674587578444,
      "radius": 230,
      "oreType": "cuprite"
    },
    {
      "x": 1707.5366644832047,
      "y": 1298.1472469736686,
      "radius": 70,
      "oreType": "cuprite"
    },
    {
      "x": 1776.0812146517787,
      "y": 784.0631207093642,
      "radius": 50,
      "oreType": "cuprite"
    },
    {
      "x": -194.9081003226977,
      "y": -1030.8103097313528,
      "radius": 20,
      "oreType": "diamite"
    },
    {
      "x": -46.34143701379662,
      "y": -975.097810990515,
      "radius": 20,
      "oreType": "diamite"
    },
    {
      "x": -167.05185095227876,
      "y": -928.6707287064833,
      "radius": 20,
      "oreType": "diamite"
    },
    {
      "x": -83.48310284102195,
      "y": -1030.8103097313528,
      "radius": 20,
      "oreType": "diamite"
    },
    {
      "x": -129.91018512505354,
      "y": -984.3832274473212,
      "radius": 30,
      "oreType": "diamite"
    },
    {
      "x": -148.4810180386661,
      "y": 1336.970886754259,
      "radius": 40,
      "oreType": "diamite"
    },
    {
      "x": -46.34143701379662,
      "y": 1364.827136124678,
      "radius": 20,
      "oreType": "diamite"
    },
    {
      "x": -74.19768638421556,
      "y": 1271.9729715566148,
      "radius": 20,
      "oreType": "diamite"
    },
    {
      "x": 0.08564527023497703,
      "y": 1290.5438044702273,
      "radius": 30,
      "oreType": "diamite"
    },
    {
      "x": -1761.5641991738528,
      "y": -333.37236253123365,
      "radius": 50,
      "oreType": "platinite"
    },
    {
      "x": -1668.7100346057898,
      "y": -188.93255098091316,
      "radius": 70,
      "oreType": "platinite"
    },
    {
      "x": -1596.4901288306294,
      "y": -374.6408801170395,
      "radius": 60,
      "oreType": "platinite"
    }
  ],
  "structures": [
    {
      "x": -552.9552945377911,
      "y": -214.93504381542803,
      "type": "piratebase",
      "tier": 4,
      "drops": [
        {
          "item": "large energy cell",
          "quantity": 3
        },
        {
          "item": "scrap",
          "quantity": 30
        }
      ],
      "defenseTypePercentages": {
        "normal": 50,
        "sturdy": 25,
        "fast": 25
      },
      "waveSpawnTypePercentages": {
        "normal": 34,
        "sturdy": 33,
        "fast": 33
      },
      "waveSpawnCount": 2,
      "spawnRate": 10,
      "defenseCount": 16,
      "health": 400,
      "pirateArchetype": "standard"
    },
    {
      "x": -275.1409903801884,
      "y": 405.4950436797544,
      "type": "piratebase",
      "tier": 2,
      "defenseTypePercentages": {
        "normal": 100,
        "sturdy": 0,
        "fast": 0
      },
      "waveSpawnTypePercentages": {
        "normal": 100,
        "sturdy": 0,
        "fast": 0
      },
      "waveSpawnCount": 4,
      "drops": [
        {
          "item": "medium energy cell",
          "quantity": 2
        },
        {
          "item": "medium fuel tank",
          "quantity": 1
        },
        {
          "item": "health pack",
          "quantity": 1
        },
        {
          "item": "scrap",
          "quantity": 10
        }
      ],
      "health": 250,
      "spawnRate": 40,
      "defenseCount": 10,
      "pirateArchetype": "standard"
    },
    {
      "x": 508.9571002368325,
      "y": 63.39647496319031,
      "type": "piratebase",
      "tier": 3,
      "defenseTypePercentages": {
        "normal": 100,
        "sturdy": 0,
        "fast": 0
      },
      "waveSpawnTypePercentages": {
        "normal": 100,
        "sturdy": 0,
        "fast": 0
      },
      "waveSpawnCount": 4,
      "drops": [
        {
          "item": "oxygen canister",
          "quantity": 1
        },
        {
          "item": "small energy cell",
          "quantity": 1
        },
        {
          "item": "medium energy cell",
          "quantity": 1
        },
        {
          "item": "scrap",
          "quantity": 20
        }
      ],
      "health": 300,
      "defenseCount": 12,
      "pirateArchetype": "standard"
    },
    {
      "x": 84.52203831544583,
      "y": -347.77323205007986,
      "type": "piratebase",
      "tier": 1,
      "defenseTypePercentages": {
        "normal": 100,
        "sturdy": 0,
        "fast": 0
      },
      "waveSpawnTypePercentages": {
        "normal": 100,
        "sturdy": 0,
        "fast": 0
      },
      "waveSpawnCount": 2,
      "drops": [
        {
          "item": "oxygen canister",
          "quantity": 2
        },
        {
          "item": "fuel tank",
          "quantity": 2
        },
        {
          "item": "health pack",
          "quantity": 2
        },
        {
          "item": "small energy cell",
          "quantity": 4
        },
        {
          "item": "scrap",
          "quantity": 5
        }
      ],
      "health": 100,
      "defenseCount": 4,
      "spawnRate": 30,
      "pirateArchetype": "standard"
    },
    {
      "x": 10.645274404096128,
      "y": -2475.9093297087347,
      "type": "piratebase",
      "tier": 5,
      "defenseTypePercentages": {
        "normal": 100,
        "sturdy": 0,
        "fast": 0
      },
      "waveSpawnTypePercentages": {
        "normal": 100,
        "sturdy": 0,
        "fast": 0
      },
      "waveSpawnCount": 4,
      "pirateArchetype": "slowing",
      "drops": [
        {
          "item": "scrap",
          "quantity": 50
        },
        {
          "item": "warp key fragment",
          "quantity": 1
        }
      ],
      "health": 600,
      "defenseCount": 22,
      "spawnRate": 10
    },
    {
      "x": -2496.920278790844,
      "y": -9.849420202609394,
      "type": "piratebase",
      "tier": 5,
      "pirateArchetype": "shotgun",
      "defenseTypePercentages": {
        "normal": 100,
        "sturdy": 0,
        "fast": 0
      },
      "waveSpawnTypePercentages": {
        "normal": 100,
        "sturdy": 0,
        "fast": 0
      },
      "waveSpawnCount": 4,
      "drops": [
        {
          "item": "scrap",
          "quantity": 50
        },
        {
          "item": "warp key fragment",
          "quantity": 1
        }
      ],
      "health": 600,
      "defenseCount": 22,
      "spawnRate": 10
    },
    {
      "x": -6.083605464924631,
      "y": 2470.038875094796,
      "type": "piratebase",
      "tier": 5,
      "pirateArchetype": "breaching",
      "defenseTypePercentages": {
        "normal": 100,
        "sturdy": 0,
        "fast": 0
      },
      "waveSpawnTypePercentages": {
        "normal": 100,
        "sturdy": 0,
        "fast": 0
      },
      "waveSpawnCount": 4,
      "drops": [
        {
          "item": "scrap",
          "quantity": 50
        },
        {
          "item": "warp key fragment",
          "quantity": 1
        }
      ],
      "health": 600,
      "defenseCount": 22,
      "spawnRate": 10
    },
    {
      "x": 2474.8867481996576,
      "y": 8.079788508103036,
      "type": "piratebase",
      "tier": 5,
      "pirateArchetype": "drone",
      "defenseTypePercentages": {
        "normal": 100,
        "sturdy": 0,
        "fast": 0
      },
      "waveSpawnTypePercentages": {
        "normal": 100,
        "sturdy": 0,
        "fast": 0
      },
      "waveSpawnCount": 8,
      "drops": [
        {
          "item": "scrap",
          "quantity": 50
        },
        {
          "item": "warp key fragment",
          "quantity": 1
        }
      ],
      "health": 600,
      "defenseCount": 46,
      "spawnRate": 10
    },
    {
      "x": -718.0410378693366,
      "y": -393.6411100089866,
      "type": "shop",
      "inventory": [
        {
          "item": "medium blaster",
          "quantity": 1,
          "heat": 0,
          "overheated": false
        },
        {
          "item": "medium energy cell",
          "quantity": 5,
          "energy": 30,
          "maxEnergy": 30
        },
        {
          "item": "medium oxygen canister",
          "quantity": 3,
          "oxygen": 30,
          "maxOxygen": 30
        },
        {
          "item": "medium fuel tank",
          "quantity": 3,
          "fuel": 30,
          "maxFuel": 30
        },
        {
          "item": "medium health pack",
          "quantity": 3,
          "health": 30
        }
      ],
      "prices": {}
    },
    {
      "x": -221.0259080548392,
      "y": 971.4159841845891,
      "type": "shop",
      "inventory": [
        {
          "item": "medium energy cell",
          "quantity": 6,
          "energy": 30,
          "maxEnergy": 30
        },
        {
          "item": "medium health pack",
          "quantity": 3,
          "health": 30
        },
        {
          "item": "large health pack",
          "quantity": 3,
          "health": 60
        },
        {
          "item": "fuel tank",
          "quantity": 3,
          "fuel": 10,
          "maxFuel": 10
        }
      ],
      "prices": {}
    },
    {
      "x": -1966.885642579632,
      "y": -1895.2726590473335,
      "type": "shop",
      "inventory": [
        {
          "item": "small energy cell",
          "quantity": 6,
          "energy": 10,
          "maxEnergy": 10
        },
        {
          "item": "fuel tank",
          "quantity": 6,
          "fuel": 10,
          "maxFuel": 10
        },
        {
          "item": "oxygen canister",
          "quantity": 6,
          "oxygen": 10,
          "maxOxygen": 10
        },
        {
          "item": "health pack",
          "quantity": 6,
          "health": 10
        }
      ],
      "prices": {}
    },
    {
      "x": 1545.5380321740968,
      "y": -836.912639175056,
      "type": "shop",
      "inventory": [
        {
          "item": "medium mining laser",
          "quantity": 1,
          "heat": 0,
          "overheated": false
        },
        {
          "item": "medium energy cell",
          "quantity": 5,
          "energy": 30,
          "maxEnergy": 30
        },
        {
          "item": "large energy cell",
          "quantity": 3,
          "energy": 60,
          "maxEnergy": 60
        },
        {
          "item": "large oxygen canister",
          "quantity": 2,
          "oxygen": 60,
          "maxOxygen": 60
        },
        {
          "item": "large fuel tank",
          "quantity": 2,
          "fuel": 60,
          "maxFuel": 60
        }
      ],
      "prices": {}
    },
    {
      "x": 703.7037037037037,
      "y": -1103.7037037037037,
      "type": "piratebase",
      "tier": 2,
      "pirateArchetype": "standard",
      "defenseTypePercentages": {
        "normal": 50,
        "sturdy": 25,
        "fast": 25
      },
      "waveSpawnTypePercentages": {
        "normal": 50,
        "sturdy": 25,
        "fast": 25
      },
      "waveSpawnCount": 4,
      "drops": [
        {
          "item": "medium energy cell",
          "quantity": 1
        },
        {
          "item": "oxygen canister",
          "quantity": 1
        },
        {
          "item": "health pack",
          "quantity": 1
        },
        {
          "item": "scrap",
          "quantity": 15
        }
      ],
      "health": 250,
      "defenseCount": 12,
      "spawnRate": 40
    },
    {
      "x": -1955.5249604299768,
      "y": -955.2619122448857,
      "type": "piratebase",
      "tier": 2,
      "pirateArchetype": "standard",
      "defenseTypePercentages": {
        "normal": 50,
        "sturdy": 25,
        "fast": 25
      },
      "waveSpawnTypePercentages": {
        "normal": 50,
        "sturdy": 25,
        "fast": 25
      },
      "waveSpawnCount": 4,
      "drops": [
        {
          "item": "medium energy cell",
          "quantity": 1
        },
        {
          "item": "oxygen canister",
          "quantity": 1
        },
        {
          "item": "fuel tank",
          "quantity": 1
        },
        {
          "item": "scrap",
          "quantity": 15
        }
      ],
      "health": 250,
      "defenseCount": 12,
      "spawnRate": 40
    },
    {
      "x": -598.3428670922134,
      "y": 1436.7715272629227,
      "type": "piratebase",
      "tier": 2,
      "pirateArchetype": "standard",
      "defenseTypePercentages": {
        "normal": 50,
        "sturdy": 25,
        "fast": 25
      },
      "waveSpawnTypePercentages": {
        "normal": 50,
        "sturdy": 25,
        "fast": 25
      },
      "waveSpawnCount": 4,
      "drops": [
        {
          "item": "medium energy cell",
          "quantity": 1
        },
        {
          "item": "fuel tank",
          "quantity": 1
        },
        {
          "item": "health pack",
          "quantity": 1
        },
        {
          "item": "scrap",
          "quantity": 15
        }
      ],
      "health": 250,
      "defenseCount": 12,
      "spawnRate": 40
    },
    {
      "x": 1225.3705708304067,
      "y": 257.7195836757405,
      "type": "piratebase",
      "tier": 2,
      "pirateArchetype": "standard",
      "defenseTypePercentages": {
        "normal": 50,
        "sturdy": 25,
        "fast": 25
      },
      "waveSpawnTypePercentages": {
        "normal": 50,
        "sturdy": 25,
        "fast": 25
      },
      "waveSpawnCount": 4,
      "drops": [
        {
          "item": "medium energy cell",
          "quantity": 1
        },
        {
          "item": "fuel tank",
          "quantity": 1
        },
        {
          "item": "health pack",
          "quantity": 1
        },
        {
          "item": "scrap",
          "quantity": 15
        }
      ],
      "health": 250,
      "defenseCount": 12,
      "spawnRate": 40
    },
    {
      "x": 1132.0643019134352,
      "y": 1267.1237655957023,
      "type": "piratebase",
      "tier": 2,
      "pirateArchetype": "standard",
      "defenseTypePercentages": {
        "normal": 50,
        "sturdy": 25,
        "fast": 25
      },
      "waveSpawnTypePercentages": {
        "normal": 50,
        "sturdy": 25,
        "fast": 25
      },
      "waveSpawnCount": 4,
      "drops": [
        {
          "item": "oxygen canister",
          "quantity": 1
        },
        {
          "item": "fuel tank",
          "quantity": 1
        },
        {
          "item": "health pack",
          "quantity": 1
        },
        {
          "item": "scrap",
          "quantity": 15
        }
      ],
      "health": 250,
      "defenseCount": 12,
      "spawnRate": 40
    },
    {
      "x": 1922.0402426062496,
      "y": -2156.3337925737223,
      "type": "piratebase",
      "tier": 2,
      "pirateArchetype": "standard",
      "defenseTypePercentages": {
        "normal": 50,
        "sturdy": 25,
        "fast": 25
      },
      "waveSpawnTypePercentages": {
        "normal": 50,
        "sturdy": 25,
        "fast": 25
      },
      "waveSpawnCount": 4,
      "drops": [
        {
          "item": "medium energy cell",
          "quantity": 1
        },
        {
          "item": "oxygen canister",
          "quantity": 1
        },
        {
          "item": "health pack",
          "quantity": 1
        },
        {
          "item": "scrap",
          "quantity": 15
        }
      ],
      "health": 250,
      "defenseCount": 12,
      "spawnRate": 40
    },
    {
      "x": -1401.9036851158621,
      "y": 589.0590159412715,
      "type": "piratebase",
      "tier": 3,
      "pirateArchetype": "standard",
      "defenseTypePercentages": {
        "normal": 25,
        "sturdy": 50,
        "fast": 25
      },
      "waveSpawnTypePercentages": {
        "normal": 25,
        "sturdy": 50,
        "fast": 25
      },
      "waveSpawnCount": 4,
      "drops": [
        {
          "item": "scrap",
          "quantity": 20
        },
        {
          "item": "large energy cell",
          "quantity": 1
        }
      ],
      "health": 300,
      "defenseCount": 14,
      "spawnRate": 30
    },
    {
      "x": 1226.6059021726367,
      "y": -1694.2315702517333,
      "type": "piratebase",
      "tier": 3,
      "pirateArchetype": "standard",
      "defenseTypePercentages": {
        "normal": 25,
        "sturdy": 25,
        "fast": 50
      },
      "waveSpawnTypePercentages": {
        "normal": 25,
        "sturdy": 25,
        "fast": 50
      },
      "waveSpawnCount": 4,
      "drops": [
        {
          "item": "scrap",
          "quantity": 20
        },
        {
          "item": "large oxygen canister",
          "quantity": 1
        }
      ],
      "health": 300,
      "defenseCount": 14,
      "spawnRate": 30
    },
    {
      "x": -1595.7108436256133,
      "y": 1770.0713881100671,
      "type": "piratebase",
      "tier": 3,
      "pirateArchetype": "standard",
      "defenseTypePercentages": {
        "normal": 50,
        "sturdy": 25,
        "fast": 25
      },
      "waveSpawnTypePercentages": {
        "normal": 50,
        "sturdy": 25,
        "fast": 25
      },
      "waveSpawnCount": 4,
      "drops": [
        {
          "item": "scrap",
          "quantity": 20
        },
        {
          "item": "large fuel tank",
          "quantity": 1
        }
      ],
      "health": 300,
      "defenseCount": 14,
      "spawnRate": 30
    },
    {
      "x": -1450.3554747433002,
      "y": -1294.5043058253718,
      "type": "piratebase",
      "tier": 3,
      "pirateArchetype": "standard",
      "defenseTypePercentages": {
        "normal": 25,
        "sturdy": 50,
        "fast": 25
      },
      "waveSpawnTypePercentages": {
        "normal": 25,
        "sturdy": 50,
        "fast": 25
      },
      "waveSpawnCount": 4,
      "drops": [
        {
          "item": "scrap",
          "quantity": 20
        },
        {
          "item": "large health pack",
          "quantity": 1
        }
      ],
      "health": 300,
      "defenseCount": 14,
      "spawnRate": 30
    },
    {
      "x": 1130.7443950156714,
      "y": -487.4763604697655,
      "type": "piratebase",
      "tier": 4,
      "drops": [
        {
          "item": "scrap",
          "quantity": 30
        },
        {
          "item": "large energy cell",
          "quantity": 1
        },
        {
          "item": "large health pack",
          "quantity": 1
        }
      ],
      "defenseTypePercentages": {
        "normal": 50,
        "sturdy": 25,
        "fast": 25
      },
      "waveSpawnTypePercentages": {
        "normal": 34,
        "sturdy": 33,
        "fast": 33
      },
      "waveSpawnCount": 3,
      "spawnRate": 20,
      "defenseCount": 16,
      "health": 400,
      "pirateArchetype": "standard"
    },
    {
      "x": 1058.066710574515,
      "y": 2359.066280142203,
      "type": "piratebase",
      "tier": 4,
      "drops": [
        {
          "item": "scrap",
          "quantity": 30
        },
        {
          "item": "large energy cell",
          "quantity": 1
        },
        {
          "item": "large fuel tank",
          "quantity": 1
        }
      ],
      "defenseTypePercentages": {
        "normal": 50,
        "sturdy": 25,
        "fast": 25
      },
      "waveSpawnTypePercentages": {
        "normal": 34,
        "sturdy": 33,
        "fast": 33
      },
      "waveSpawnCount": 3,
      "spawnRate": 20,
      "defenseCount": 16,
      "health": 400,
      "pirateArchetype": "standard"
    },
    {
      "x": -1812.701824851173,
      "y": 1099.3197498288214,
      "type": "piratebase",
      "tier": 4,
      "drops": [
        {
          "item": "scrap",
          "quantity": 30
        },
        {
          "item": "large energy cell",
          "quantity": 1
        },
        {
          "item": "large oxygen canister",
          "quantity": 1
        }
      ],
      "defenseTypePercentages": {
        "normal": 50,
        "sturdy": 25,
        "fast": 25
      },
      "waveSpawnTypePercentages": {
        "normal": 34,
        "sturdy": 33,
        "fast": 33
      },
      "waveSpawnCount": 3,
      "spawnRate": 20,
      "defenseCount": 16,
      "health": 400,
      "pirateArchetype": "standard"
    },
    {
      "x": -492.04142694049995,
      "y": -1522.937381942088,
      "type": "crafting",
      "recipes": [
        {
          "inputs": [
            {
              "item": "cuprite",
              "quantity": 40
            },
            {
              "item": "hematite",
              "quantity": 30
            },
            {
              "item": "aurite",
              "quantity": 30
            },
            {
              "item": "diamite",
              "quantity": 20
            }
          ],
          "output": {
            "item": "large mining laser",
            "quantity": 1
          }
        },
        {
          "inputs": [
            {
              "item": "scrap",
              "quantity": 20
            },
            {
              "item": "cuprite",
              "quantity": 10
            }
          ],
          "output": {
            "item": "medium fuel tank",
            "quantity": 1
          }
        }
      ]
    },
    {
      "x": 742.9189618147407,
      "y": 696.2771512346228,
      "type": "crafting",
      "recipes": [
        {
          "inputs": [
            {
              "item": "aurite",
              "quantity": 50
            },
            {
              "item": "diamite",
              "quantity": 50
            },
            {
              "item": "platinite",
              "quantity": 50
            }
          ],
          "output": {
            "item": "large blaster",
            "quantity": 1
          }
        },
        {
          "inputs": [
            {
              "item": "scrap",
              "quantity": 25
            },
            {
              "item": "hematite",
              "quantity": 10
            }
          ],
          "output": {
            "item": "medium health pack",
            "quantity": 1
          }
        }
      ]
    },
    {
      "x": 2243.546703925771,
      "y": 1794.2530719094302,
      "type": "piratebase",
      "tier": 2,
      "pirateArchetype": "standard",
      "defenseTypePercentages": {
        "normal": 50,
        "sturdy": 25,
        "fast": 25
      },
      "waveSpawnTypePercentages": {
        "normal": 50,
        "sturdy": 25,
        "fast": 25
      },
      "waveSpawnCount": 4,
      "drops": [
        {
          "item": "medium energy cell",
          "quantity": 1
        },
        {
          "item": "scrap",
          "quantity": 15
        },
        {
          "item": "medium health pack",
          "quantity": 2
        }
      ],
      "health": 250,
      "defenseCount": 12,
      "spawnRate": 40
    },
    {
      "x": -1522.2055257790148,
      "y": -2291.3301690853505,
      "type": "piratebase",
      "tier": 2,
      "pirateArchetype": "standard",
      "defenseTypePercentages": {
        "normal": 50,
        "sturdy": 25,
        "fast": 25
      },
      "waveSpawnTypePercentages": {
        "normal": 50,
        "sturdy": 25,
        "fast": 25
      },
      "waveSpawnCount": 4,
      "drops": [
        {
          "item": "medium energy cell",
          "quantity": 1
        },
        {
          "item": "oxygen canister",
          "quantity": 2
        },
        {
          "item": "scrap",
          "quantity": 15
        }
      ],
      "health": 250,
      "defenseCount": 12,
      "spawnRate": 40
    },
    {
      "x": -1266.3419881441826,
      "y": -704.7890208034864,
      "type": "piratebase",
      "tier": 1,
      "pirateArchetype": "standard",
      "defenseTypePercentages": {
        "normal": 34,
        "sturdy": 33,
        "fast": 33
      },
      "waveSpawnTypePercentages": {
        "normal": 34,
        "sturdy": 33,
        "fast": 33
      },
      "waveSpawnCount": 2,
      "drops": [
        {
          "item": "scrap",
          "quantity": 5
        },
        {
          "item": "small energy cell",
          "quantity": 3
        }
      ],
      "health": 80,
      "defenseCount": 6,
      "spawnRate": 25
    },
    {
      "x": -1529.4287877536951,
      "y": 2390.3497981319533,
      "type": "piratebase",
      "tier": 1,
      "pirateArchetype": "standard",
      "defenseTypePercentages": {
        "normal": 34,
        "sturdy": 33,
        "fast": 33
      },
      "waveSpawnTypePercentages": {
        "normal": 34,
        "sturdy": 33,
        "fast": 33
      },
      "waveSpawnCount": 2,
      "drops": [
        {
          "item": "scrap",
          "quantity": 5
        },
        {
          "item": "small energy cell",
          "quantity": 3
        }
      ],
      "health": 80,
      "defenseCount": 6,
      "spawnRate": 25
    },
    {
      "x": -2286.591450682161,
      "y": -1792.6729982737575,
      "type": "piratebase",
      "tier": 1,
      "pirateArchetype": "standard",
      "defenseTypePercentages": {
        "normal": 34,
        "sturdy": 33,
        "fast": 33
      },
      "waveSpawnTypePercentages": {
        "normal": 34,
        "sturdy": 33,
        "fast": 33
      },
      "waveSpawnCount": 2,
      "drops": [
        {
          "item": "scrap",
          "quantity": 5
        },
        {
          "item": "small energy cell",
          "quantity": 3
        }
      ],
      "health": 80,
      "defenseCount": 6,
      "spawnRate": 25
    },
    {
      "x": 487.5700092525665,
      "y": 1875.6396760200969,
      "type": "piratebase",
      "tier": 1,
      "pirateArchetype": "standard",
      "defenseTypePercentages": {
        "normal": 34,
        "sturdy": 33,
        "fast": 33
      },
      "waveSpawnTypePercentages": {
        "normal": 34,
        "sturdy": 33,
        "fast": 33
      },
      "waveSpawnCount": 2,
      "drops": [
        {
          "item": "scrap",
          "quantity": 5
        },
        {
          "item": "small energy cell",
          "quantity": 3
        }
      ],
      "health": 80,
      "defenseCount": 6,
      "spawnRate": 25
    },
    {
      "x": 2379.043731935335,
      "y": -829.7409212716209,
      "type": "piratebase",
      "tier": 1,
      "pirateArchetype": "standard",
      "defenseTypePercentages": {
        "normal": 34,
        "sturdy": 33,
        "fast": 33
      },
      "waveSpawnTypePercentages": {
        "normal": 34,
        "sturdy": 33,
        "fast": 33
      },
      "waveSpawnCount": 2,
      "drops": [
        {
          "item": "scrap",
          "quantity": 5
        },
        {
          "item": "small energy cell",
          "quantity": 3
        }
      ],
      "health": 80,
      "defenseCount": 6,
      "spawnRate": 25
    },
    {
      "x": 63.42135628733956,
      "y": -1838.526906702431,
      "type": "piratebase",
      "tier": 1,
      "pirateArchetype": "standard",
      "defenseTypePercentages": {
        "normal": 34,
        "sturdy": 33,
        "fast": 33
      },
      "waveSpawnTypePercentages": {
        "normal": 34,
        "sturdy": 33,
        "fast": 33
      },
      "waveSpawnCount": 2,
      "drops": [
        {
          "item": "scrap",
          "quantity": 5
        },
        {
          "item": "small energy cell",
          "quantity": 3
        }
      ],
      "health": 80,
      "defenseCount": 6,
      "spawnRate": 25
    },
    {
      "x": 1840.2603078984255,
      "y": 2219.543989235146,
      "type": "piratebase",
      "tier": 1,
      "pirateArchetype": "standard",
      "defenseTypePercentages": {
        "normal": 34,
        "sturdy": 33,
        "fast": 33
      },
      "waveSpawnTypePercentages": {
        "normal": 34,
        "sturdy": 33,
        "fast": 33
      },
      "waveSpawnCount": 2,
      "drops": [
        {
          "item": "scrap",
          "quantity": 5
        },
        {
          "item": "small energy cell",
          "quantity": 3
        }
      ],
      "health": 80,
      "defenseCount": 6,
      "spawnRate": 25
    },
    {
      "x": -2641.959241004378,
      "y": 1680.7605651982358,
      "type": "piratebase",
      "tier": 1,
      "pirateArchetype": "standard",
      "defenseTypePercentages": {
        "normal": 34,
        "sturdy": 33,
        "fast": 33
      },
      "waveSpawnTypePercentages": {
        "normal": 34,
        "sturdy": 33,
        "fast": 33
      },
      "waveSpawnCount": 2,
      "drops": [
        {
          "item": "scrap",
          "quantity": 5
        },
        {
          "item": "small energy cell",
          "quantity": 3
        }
      ],
      "health": 80,
      "defenseCount": 6,
      "spawnRate": 25
    },
    {
      "x": 2401.9706861496716,
      "y": -1540.476501916055,
      "type": "piratebase",
      "tier": 1,
      "pirateArchetype": "standard",
      "defenseTypePercentages": {
        "normal": 34,
        "sturdy": 33,
        "fast": 33
      },
      "waveSpawnTypePercentages": {
        "normal": 34,
        "sturdy": 33,
        "fast": 33
      },
      "waveSpawnCount": 2,
      "drops": [
        {
          "item": "scrap",
          "quantity": 5
        },
        {
          "item": "small energy cell",
          "quantity": 3
        }
      ],
      "health": 80,
      "defenseCount": 6,
      "spawnRate": 25
    },
    {
      "x": -727.5585641072728,
      "y": 694.9015339817624,
      "type": "piratebase",
      "tier": 1,
      "pirateArchetype": "standard",
      "defenseTypePercentages": {
        "normal": 34,
        "sturdy": 33,
        "fast": 33
      },
      "waveSpawnTypePercentages": {
        "normal": 34,
        "sturdy": 33,
        "fast": 33
      },
      "waveSpawnCount": 2,
      "drops": [
        {
          "item": "scrap",
          "quantity": 5
        },
        {
          "item": "small energy cell",
          "quantity": 3
        }
      ],
      "health": 80,
      "defenseCount": 6,
      "spawnRate": 25
    },
    {
      "x": 670.9856429672593,
      "y": 1061.732801411148,
      "type": "piratebase",
      "tier": 1,
      "pirateArchetype": "standard",
      "defenseTypePercentages": {
        "normal": 34,
        "sturdy": 33,
        "fast": 33
      },
      "waveSpawnTypePercentages": {
        "normal": 34,
        "sturdy": 33,
        "fast": 33
      },
      "waveSpawnCount": 2,
      "drops": [
        {
          "item": "scrap",
          "quantity": 5
        },
        {
          "item": "small energy cell",
          "quantity": 3
        }
      ],
      "health": 80,
      "defenseCount": 6,
      "spawnRate": 25
    },
    {
      "x": -979.7550604649754,
      "y": 1864.1761989129286,
      "type": "piratebase",
      "tier": 1,
      "pirateArchetype": "standard",
      "defenseTypePercentages": {
        "normal": 34,
        "sturdy": 33,
        "fast": 33
      },
      "waveSpawnTypePercentages": {
        "normal": 34,
        "sturdy": 33,
        "fast": 33
      },
      "waveSpawnCount": 2,
      "drops": [
        {
          "item": "scrap",
          "quantity": 5
        },
        {
          "item": "small energy cell",
          "quantity": 3
        }
      ],
      "health": 80,
      "defenseCount": 6,
      "spawnRate": 25
    },
    {
      "x": 1691.2351055052375,
      "y": 557.3398086957429,
      "type": "piratebase",
      "tier": 1,
      "pirateArchetype": "standard",
      "defenseTypePercentages": {
        "normal": 34,
        "sturdy": 33,
        "fast": 33
      },
      "waveSpawnTypePercentages": {
        "normal": 34,
        "sturdy": 33,
        "fast": 33
      },
      "waveSpawnCount": 2,
      "drops": [
        {
          "item": "scrap",
          "quantity": 5
        },
        {
          "item": "small energy cell",
          "quantity": 3
        }
      ],
      "health": 80,
      "defenseCount": 6,
      "spawnRate": 25
    },
    {
      "x": -1850.9793206097659,
      "y": 236.36244969503065,
      "type": "piratebase",
      "tier": 1,
      "pirateArchetype": "standard",
      "defenseTypePercentages": {
        "normal": 34,
        "sturdy": 33,
        "fast": 33
      },
      "waveSpawnTypePercentages": {
        "normal": 34,
        "sturdy": 33,
        "fast": 33
      },
      "waveSpawnCount": 2,
      "drops": [
        {
          "item": "scrap",
          "quantity": 5
        },
        {
          "item": "small energy cell",
          "quantity": 3
        }
      ],
      "health": 80,
      "defenseCount": 6,
      "spawnRate": 25
    },
    {
      "x": 2178.074502067605,
      "y": 1102.856843897331,
      "type": "piratebase",
      "tier": 3,
      "pirateArchetype": "standard",
      "defenseTypePercentages": {
        "normal": 50,
        "sturdy": 25,
        "fast": 25
      },
      "waveSpawnTypePercentages": {
        "normal": 50,
        "sturdy": 25,
        "fast": 25
      },
      "waveSpawnCount": 4,
      "drops": [
        {
          "item": "scrap",
          "quantity": 20
        },
        {
          "item": "medium energy cell",
          "quantity": 1
        },
        {
          "item": "medium health pack",
          "quantity": 1
        }
      ],
      "health": 300,
      "defenseCount": 14,
      "spawnRate": 30
    },
    {
      "x": 917.4504007713779,
      "y": -2062.064710292212,
      "type": "piratebase",
      "tier": 1,
      "pirateArchetype": "standard",
      "defenseTypePercentages": {
        "normal": 34,
        "sturdy": 33,
        "fast": 33
      },
      "waveSpawnTypePercentages": {
        "normal": 34,
        "sturdy": 33,
        "fast": 33
      },
      "waveSpawnCount": 2,
      "drops": [
        {
          "item": "scrap",
          "quantity": 5
        },
        {
          "item": "small energy cell",
          "quantity": 3
        }
      ],
      "health": 80,
      "defenseCount": 6,
      "spawnRate": 25
    },
    {
      "x": -2025.9584412945173,
      "y": 531.2249149011836,
      "type": "warpgate",
      "warpCost": 3000,
      "warpDestination": "level2"
    },
    {
      "x": -1175.1257430269775,
      "y": 2176.49748513946,
      "type": "shipyard",
      "availableShips": [
        "cutter",
        "transport"
      ]
    }
  ],
  "spawnSettings": {
    "initialDelay": 60,
    "waveIntervalMin": 20,
    "waveIntervalMax": 40,
    "waveSizeMin": 1,
    "waveSizeMax": 1,
    "tiers": [
      {
        "startTime": 300,
        "waveIntervalMin": 50,
        "waveIntervalMax": 80,
        "waveSizeMin": 3,
        "waveSizeMax": 5,
        "pirateTypePercentages": {
          "normal": 34,
          "sturdy": 33,
          "fast": 33
        }
      }
    ],
    "pirateTypePercentages": {
      "normal": 34,
      "sturdy": 33,
      "fast": 33
    }
  }
}
```

## levels\level4.json
```
{
  "width": 6000,
  "height": 6000,
  "seed": 999,
  "asteroids": [],
  "structures": [],
  "spawnSettings": {
    "initialDelay": 60,
    "waveIntervalMin": 20,
    "waveIntervalMax": 50,
    "waveSizeMin": 1,
    "waveSizeMax": 1,
    "tiers": [
      {
        "startTime": 300,
        "waveIntervalMin": 50,
        "waveIntervalMax": 80,
        "waveSizeMin": 3,
        "waveSizeMax": 5,
        "pirateTypePercentages": {
          "normal": 34,
          "sturdy": 33,
          "fast": 33
        }
      }
    ],
    "pirateTypePercentages": {
      "normal": 34,
      "sturdy": 33,
      "fast": 33
    }
  }
}
```

## vendor\three\examples\jsm\utils\BufferGeometryUtils.js
```
import {
	BufferAttribute,
	BufferGeometry,
	Float32BufferAttribute,
	InstancedBufferAttribute,
	InterleavedBuffer,
	InterleavedBufferAttribute,
	TriangleFanDrawMode,
	TriangleStripDrawMode,
	TrianglesDrawMode,
	Vector3,
} from '../../../build/three.module.js';

function computeMikkTSpaceTangents( geometry, MikkTSpace, negateSign = true ) {

	if ( ! MikkTSpace || ! MikkTSpace.isReady ) {

		throw new Error( 'BufferGeometryUtils: Initialized MikkTSpace library required.' );

	}

	if ( ! geometry.hasAttribute( 'position' ) || ! geometry.hasAttribute( 'normal' ) || ! geometry.hasAttribute( 'uv' ) ) {

		throw new Error( 'BufferGeometryUtils: Tangents require "position", "normal", and "uv" attributes.' );

	}

	function getAttributeArray( attribute ) {

		if ( attribute.normalized || attribute.isInterleavedBufferAttribute ) {

			const dstArray = new Float32Array( attribute.count * attribute.itemSize );

			for ( let i = 0, j = 0; i < attribute.count; i ++ ) {

				dstArray[ j ++ ] = attribute.getX( i );
				dstArray[ j ++ ] = attribute.getY( i );

				if ( attribute.itemSize > 2 ) {

					dstArray[ j ++ ] = attribute.getZ( i );

				}

			}

			return dstArray;

		}

		if ( attribute.array instanceof Float32Array ) {

			return attribute.array;

		}

		return new Float32Array( attribute.array );

	}

	// MikkTSpace algorithm requires non-indexed input.

	const _geometry = geometry.index ? geometry.toNonIndexed() : geometry;

	// Compute vertex tangents.

	const tangents = MikkTSpace.generateTangents(

		getAttributeArray( _geometry.attributes.position ),
		getAttributeArray( _geometry.attributes.normal ),
		getAttributeArray( _geometry.attributes.uv )

	);

	// Texture coordinate convention of glTF differs from the apparent
	// default of the MikkTSpace library; .w component must be flipped.

	if ( negateSign ) {

		for ( let i = 3; i < tangents.length; i += 4 ) {

			tangents[ i ] *= - 1;

		}

	}

	//

	_geometry.setAttribute( 'tangent', new BufferAttribute( tangents, 4 ) );

	if ( geometry !== _geometry ) {

		geometry.copy( _geometry );

	}

	return geometry;

}

/**
 * @param  {Array<BufferGeometry>} geometries
 * @param  {Boolean} useGroups
 * @return {BufferGeometry}
 */
function mergeGeometries( geometries, useGroups = false ) {

	const isIndexed = geometries[ 0 ].index !== null;

	const attributesUsed = new Set( Object.keys( geometries[ 0 ].attributes ) );
	const morphAttributesUsed = new Set( Object.keys( geometries[ 0 ].morphAttributes ) );

	const attributes = {};
	const morphAttributes = {};

	const morphTargetsRelative = geometries[ 0 ].morphTargetsRelative;

	const mergedGeometry = new BufferGeometry();

	let offset = 0;

	for ( let i = 0; i < geometries.length; ++ i ) {

		const geometry = geometries[ i ];
		let attributesCount = 0;

		// ensure that all geometries are indexed, or none

		if ( isIndexed !== ( geometry.index !== null ) ) {

			console.error( 'THREE.BufferGeometryUtils: .mergeGeometries() failed with geometry at index ' + i + '. All geometries must have compatible attributes; make sure index attribute exists among all geometries, or in none of them.' );
			return null;

		}

		// gather attributes, exit early if they're different

		for ( const name in geometry.attributes ) {

			if ( ! attributesUsed.has( name ) ) {

				console.error( 'THREE.BufferGeometryUtils: .mergeGeometries() failed with geometry at index ' + i + '. All geometries must have compatible attributes; make sure "' + name + '" attribute exists among all geometries, or in none of them.' );
				return null;

			}

			if ( attributes[ name ] === undefined ) attributes[ name ] = [];

			attributes[ name ].push( geometry.attributes[ name ] );

			attributesCount ++;

		}

		// ensure geometries have the same number of attributes

		if ( attributesCount !== attributesUsed.size ) {

			console.error( 'THREE.BufferGeometryUtils: .mergeGeometries() failed with geometry at index ' + i + '. Make sure all geometries have the same number of attributes.' );
			return null;

		}

		// gather morph attributes, exit early if they're different

		if ( morphTargetsRelative !== geometry.morphTargetsRelative ) {

			console.error( 'THREE.BufferGeometryUtils: .mergeGeometries() failed with geometry at index ' + i + '. .morphTargetsRelative must be consistent throughout all geometries.' );
			return null;

		}

		for ( const name in geometry.morphAttributes ) {

			if ( ! morphAttributesUsed.has( name ) ) {

				console.error( 'THREE.BufferGeometryUtils: .mergeGeometries() failed with geometry at index ' + i + '.  .morphAttributes must be consistent throughout all geometries.' );
				return null;

			}

			if ( morphAttributes[ name ] === undefined ) morphAttributes[ name ] = [];

			morphAttributes[ name ].push( geometry.morphAttributes[ name ] );

		}

		if ( useGroups ) {

			let count;

			if ( isIndexed ) {

				count = geometry.index.count;

			} else if ( geometry.attributes.position !== undefined ) {

				count = geometry.attributes.position.count;

			} else {

				console.error( 'THREE.BufferGeometryUtils: .mergeGeometries() failed with geometry at index ' + i + '. The geometry must have either an index or a position attribute' );
				return null;

			}

			mergedGeometry.addGroup( offset, count, i );

			offset += count;

		}

	}

	// merge indices

	if ( isIndexed ) {

		let indexOffset = 0;
		const mergedIndex = [];

		for ( let i = 0; i < geometries.length; ++ i ) {

			const index = geometries[ i ].index;

			for ( let j = 0; j < index.count; ++ j ) {

				mergedIndex.push( index.getX( j ) + indexOffset );

			}

			indexOffset += geometries[ i ].attributes.position.count;

		}

		mergedGeometry.setIndex( mergedIndex );

	}

	// merge attributes

	for ( const name in attributes ) {

		const mergedAttribute = mergeAttributes( attributes[ name ] );

		if ( ! mergedAttribute ) {

			console.error( 'THREE.BufferGeometryUtils: .mergeGeometries() failed while trying to merge the ' + name + ' attribute.' );
			return null;

		}

		mergedGeometry.setAttribute( name, mergedAttribute );

	}

	// merge morph attributes

	for ( const name in morphAttributes ) {

		const numMorphTargets = morphAttributes[ name ][ 0 ].length;

		if ( numMorphTargets === 0 ) break;

		mergedGeometry.morphAttributes = mergedGeometry.morphAttributes || {};
		mergedGeometry.morphAttributes[ name ] = [];

		for ( let i = 0; i < numMorphTargets; ++ i ) {

			const morphAttributesToMerge = [];

			for ( let j = 0; j < morphAttributes[ name ].length; ++ j ) {

				morphAttributesToMerge.push( morphAttributes[ name ][ j ][ i ] );

			}

			const mergedMorphAttribute = mergeAttributes( morphAttributesToMerge );

			if ( ! mergedMorphAttribute ) {

				console.error( 'THREE.BufferGeometryUtils: .mergeGeometries() failed while trying to merge the ' + name + ' morphAttribute.' );
				return null;

			}

			mergedGeometry.morphAttributes[ name ].push( mergedMorphAttribute );

		}

	}

	return mergedGeometry;

}

/**
 * @param {Array<BufferAttribute>} attributes
 * @return {BufferAttribute}
 */
function mergeAttributes( attributes ) {

	let TypedArray;
	let itemSize;
	let normalized;
	let gpuType = - 1;
	let arrayLength = 0;

	for ( let i = 0; i < attributes.length; ++ i ) {

		const attribute = attributes[ i ];

		if ( attribute.isInterleavedBufferAttribute ) {

			console.error( 'THREE.BufferGeometryUtils: .mergeAttributes() failed. InterleavedBufferAttributes are not supported.' );
			return null;

		}

		if ( TypedArray === undefined ) TypedArray = attribute.array.constructor;
		if ( TypedArray !== attribute.array.constructor ) {

			console.error( 'THREE.BufferGeometryUtils: .mergeAttributes() failed. BufferAttribute.array must be of consistent array types across matching attributes.' );
			return null;

		}

		if ( itemSize === undefined ) itemSize = attribute.itemSize;
		if ( itemSize !== attribute.itemSize ) {

			console.error( 'THREE.BufferGeometryUtils: .mergeAttributes() failed. BufferAttribute.itemSize must be consistent across matching attributes.' );
			return null;

		}

		if ( normalized === undefined ) normalized = attribute.normalized;
		if ( normalized !== attribute.normalized ) {

			console.error( 'THREE.BufferGeometryUtils: .mergeAttributes() failed. BufferAttribute.normalized must be consistent across matching attributes.' );
			return null;

		}

		if ( gpuType === - 1 ) gpuType = attribute.gpuType;
		if ( gpuType !== attribute.gpuType ) {

			console.error( 'THREE.BufferGeometryUtils: .mergeAttributes() failed. BufferAttribute.gpuType must be consistent across matching attributes.' );
			return null;

		}

		arrayLength += attribute.array.length;

	}

	const array = new TypedArray( arrayLength );
	let offset = 0;

	for ( let i = 0; i < attributes.length; ++ i ) {

		array.set( attributes[ i ].array, offset );

		offset += attributes[ i ].array.length;

	}

	const result = new BufferAttribute( array, itemSize, normalized );
	if ( gpuType !== undefined ) {

		result.gpuType = gpuType;

	}

	return result;

}

/**
 * @param {BufferAttribute}
 * @return {BufferAttribute}
 */
export function deepCloneAttribute( attribute ) {

	if ( attribute.isInstancedInterleavedBufferAttribute || attribute.isInterleavedBufferAttribute ) {

		return deinterleaveAttribute( attribute );

	}

	if ( attribute.isInstancedBufferAttribute ) {

		return new InstancedBufferAttribute().copy( attribute );

	}

	return new BufferAttribute().copy( attribute );

}

/**
 * @param {Array<BufferAttribute>} attributes
 * @return {Array<InterleavedBufferAttribute>}
 */
function interleaveAttributes( attributes ) {

	// Interleaves the provided attributes into an InterleavedBuffer and returns
	// a set of InterleavedBufferAttributes for each attribute
	let TypedArray;
	let arrayLength = 0;
	let stride = 0;

	// calculate the length and type of the interleavedBuffer
	for ( let i = 0, l = attributes.length; i < l; ++ i ) {

		const attribute = attributes[ i ];

		if ( TypedArray === undefined ) TypedArray = attribute.array.constructor;
		if ( TypedArray !== attribute.array.constructor ) {

			console.error( 'AttributeBuffers of different types cannot be interleaved' );
			return null;

		}

		arrayLength += attribute.array.length;
		stride += attribute.itemSize;

	}

	// Create the set of buffer attributes
	const interleavedBuffer = new InterleavedBuffer( new TypedArray( arrayLength ), stride );
	let offset = 0;
	const res = [];
	const getters = [ 'getX', 'getY', 'getZ', 'getW' ];
	const setters = [ 'setX', 'setY', 'setZ', 'setW' ];

	for ( let j = 0, l = attributes.length; j < l; j ++ ) {

		const attribute = attributes[ j ];
		const itemSize = attribute.itemSize;
		const count = attribute.count;
		const iba = new InterleavedBufferAttribute( interleavedBuffer, itemSize, offset, attribute.normalized );
		res.push( iba );

		offset += itemSize;

		// Move the data for each attribute into the new interleavedBuffer
		// at the appropriate offset
		for ( let c = 0; c < count; c ++ ) {

			for ( let k = 0; k < itemSize; k ++ ) {

				iba[ setters[ k ] ]( c, attribute[ getters[ k ] ]( c ) );

			}

		}

	}

	return res;

}

// returns a new, non-interleaved version of the provided attribute
export function deinterleaveAttribute( attribute ) {

	const cons = attribute.data.array.constructor;
	const count = attribute.count;
	const itemSize = attribute.itemSize;
	const normalized = attribute.normalized;

	const array = new cons( count * itemSize );
	let newAttribute;
	if ( attribute.isInstancedInterleavedBufferAttribute ) {

		newAttribute = new InstancedBufferAttribute( array, itemSize, normalized, attribute.meshPerAttribute );

	} else {

		newAttribute = new BufferAttribute( array, itemSize, normalized );

	}

	for ( let i = 0; i < count; i ++ ) {

		newAttribute.setX( i, attribute.getX( i ) );

		if ( itemSize >= 2 ) {

			newAttribute.setY( i, attribute.getY( i ) );

		}

		if ( itemSize >= 3 ) {

			newAttribute.setZ( i, attribute.getZ( i ) );

		}

		if ( itemSize >= 4 ) {

			newAttribute.setW( i, attribute.getW( i ) );

		}

	}

	return newAttribute;

}

// deinterleaves all attributes on the geometry
export function deinterleaveGeometry( geometry ) {

	const attributes = geometry.attributes;
	const morphTargets = geometry.morphTargets;
	const attrMap = new Map();

	for ( const key in attributes ) {

		const attr = attributes[ key ];
		if ( attr.isInterleavedBufferAttribute ) {

			if ( ! attrMap.has( attr ) ) {

				attrMap.set( attr, deinterleaveAttribute( attr ) );

			}

			attributes[ key ] = attrMap.get( attr );

		}

	}

	for ( const key in morphTargets ) {

		const attr = morphTargets[ key ];
		if ( attr.isInterleavedBufferAttribute ) {

			if ( ! attrMap.has( attr ) ) {

				attrMap.set( attr, deinterleaveAttribute( attr ) );

			}

			morphTargets[ key ] = attrMap.get( attr );

		}

	}

}

/**
 * @param {BufferGeometry} geometry
 * @return {number}
 */
function estimateBytesUsed( geometry ) {

	// Return the estimated memory used by this geometry in bytes
	// Calculate using itemSize, count, and BYTES_PER_ELEMENT to account
	// for InterleavedBufferAttributes.
	let mem = 0;
	for ( const name in geometry.attributes ) {

		const attr = geometry.getAttribute( name );
		mem += attr.count * attr.itemSize * attr.array.BYTES_PER_ELEMENT;

	}

	const indices = geometry.getIndex();
	mem += indices ? indices.count * indices.itemSize * indices.array.BYTES_PER_ELEMENT : 0;
	return mem;

}

/**
 * @param {BufferGeometry} geometry
 * @param {number} tolerance
 * @return {BufferGeometry}
 */
function mergeVertices( geometry, tolerance = 1e-4 ) {

	tolerance = Math.max( tolerance, Number.EPSILON );

	// Generate an index buffer if the geometry doesn't have one, or optimize it
	// if it's already available.
	const hashToIndex = {};
	const indices = geometry.getIndex();
	const positions = geometry.getAttribute( 'position' );
	const vertexCount = indices ? indices.count : positions.count;

	// next value for triangle indices
	let nextIndex = 0;

	// attributes and new attribute arrays
	const attributeNames = Object.keys( geometry.attributes );
	const tmpAttributes = {};
	const tmpMorphAttributes = {};
	const newIndices = [];
	const getters = [ 'getX', 'getY', 'getZ', 'getW' ];
	const setters = [ 'setX', 'setY', 'setZ', 'setW' ];

	// Initialize the arrays, allocating space conservatively. Extra
	// space will be trimmed in the last step.
	for ( let i = 0, l = attributeNames.length; i < l; i ++ ) {

		const name = attributeNames[ i ];
		const attr = geometry.attributes[ name ];

		tmpAttributes[ name ] = new BufferAttribute(
			new attr.array.constructor( attr.count * attr.itemSize ),
			attr.itemSize,
			attr.normalized
		);

		const morphAttr = geometry.morphAttributes[ name ];
		if ( morphAttr ) {

			tmpMorphAttributes[ name ] = new BufferAttribute(
				new morphAttr.array.constructor( morphAttr.count * morphAttr.itemSize ),
				morphAttr.itemSize,
				morphAttr.normalized
			);

		}

	}

	// convert the error tolerance to an amount of decimal places to truncate to
	const halfTolerance = tolerance * 0.5;
	const exponent = Math.log10( 1 / tolerance );
	const hashMultiplier = Math.pow( 10, exponent );
	const hashAdditive = halfTolerance * hashMultiplier;
	for ( let i = 0; i < vertexCount; i ++ ) {

		const index = indices ? indices.getX( i ) : i;

		// Generate a hash for the vertex attributes at the current index 'i'
		let hash = '';
		for ( let j = 0, l = attributeNames.length; j < l; j ++ ) {

			const name = attributeNames[ j ];
			const attribute = geometry.getAttribute( name );
			const itemSize = attribute.itemSize;

			for ( let k = 0; k < itemSize; k ++ ) {

				// double tilde truncates the decimal value
				hash += `${ ~ ~ ( attribute[ getters[ k ] ]( index ) * hashMultiplier + hashAdditive ) },`;

			}

		}

		// Add another reference to the vertex if it's already
		// used by another index
		if ( hash in hashToIndex ) {

			newIndices.push( hashToIndex[ hash ] );

		} else {

			// copy data to the new index in the temporary attributes
			for ( let j = 0, l = attributeNames.length; j < l; j ++ ) {

				const name = attributeNames[ j ];
				const attribute = geometry.getAttribute( name );
				const morphAttr = geometry.morphAttributes[ name ];
				const itemSize = attribute.itemSize;
				const newarray = tmpAttributes[ name ];
				const newMorphArrays = tmpMorphAttributes[ name ];

				for ( let k = 0; k < itemSize; k ++ ) {

					const getterFunc = getters[ k ];
					const setterFunc = setters[ k ];
					newarray[ setterFunc ]( nextIndex, attribute[ getterFunc ]( index ) );

					if ( morphAttr ) {

						for ( let m = 0, ml = morphAttr.length; m < ml; m ++ ) {

							newMorphArrays[ m ][ setterFunc ]( nextIndex, morphAttr[ m ][ getterFunc ]( index ) );

						}

					}

				}

			}

			hashToIndex[ hash ] = nextIndex;
			newIndices.push( nextIndex );
			nextIndex ++;

		}

	}

	// generate result BufferGeometry
	const result = geometry.clone();
	for ( const name in geometry.attributes ) {

		const tmpAttribute = tmpAttributes[ name ];

		result.setAttribute( name, new BufferAttribute(
			tmpAttribute.array.slice( 0, nextIndex * tmpAttribute.itemSize ),
			tmpAttribute.itemSize,
			tmpAttribute.normalized,
		) );

		if ( ! ( name in tmpMorphAttributes ) ) continue;

		for ( let j = 0; j < tmpMorphAttributes[ name ].length; j ++ ) {

			const tmpMorphAttribute = tmpMorphAttributes[ name ][ j ];

			result.morphAttributes[ name ][ j ] = new BufferAttribute(
				tmpMorphAttribute.array.slice( 0, nextIndex * tmpMorphAttribute.itemSize ),
				tmpMorphAttribute.itemSize,
				tmpMorphAttribute.normalized,
			);

		}

	}

	// indices

	result.setIndex( newIndices );

	return result;

}

/**
 * @param {BufferGeometry} geometry
 * @param {number} drawMode
 * @return {BufferGeometry}
 */
function toTrianglesDrawMode( geometry, drawMode ) {

	if ( drawMode === TrianglesDrawMode ) {

		console.warn( 'THREE.BufferGeometryUtils.toTrianglesDrawMode(): Geometry already defined as triangles.' );
		return geometry;

	}

	if ( drawMode === TriangleFanDrawMode || drawMode === TriangleStripDrawMode ) {

		let index = geometry.getIndex();

		// generate index if not present

		if ( index === null ) {

			const indices = [];

			const position = geometry.getAttribute( 'position' );

			if ( position !== undefined ) {

				for ( let i = 0; i < position.count; i ++ ) {

					indices.push( i );

				}

				geometry.setIndex( indices );
				index = geometry.getIndex();

			} else {

				console.error( 'THREE.BufferGeometryUtils.toTrianglesDrawMode(): Undefined position attribute. Processing not possible.' );
				return geometry;

			}

		}

		//

		const numberOfTriangles = index.count - 2;
		const newIndices = [];

		if ( drawMode === TriangleFanDrawMode ) {

			// gl.TRIANGLE_FAN

			for ( let i = 1; i <= numberOfTriangles; i ++ ) {

				newIndices.push( index.getX( 0 ) );
				newIndices.push( index.getX( i ) );
				newIndices.push( index.getX( i + 1 ) );

			}

		} else {

			// gl.TRIANGLE_STRIP

			for ( let i = 0; i < numberOfTriangles; i ++ ) {

				if ( i % 2 === 0 ) {

					newIndices.push( index.getX( i ) );
					newIndices.push( index.getX( i + 1 ) );
					newIndices.push( index.getX( i + 2 ) );

				} else {

					newIndices.push( index.getX( i + 2 ) );
					newIndices.push( index.getX( i + 1 ) );
					newIndices.push( index.getX( i ) );

				}

			}

		}

		if ( ( newIndices.length / 3 ) !== numberOfTriangles ) {

			console.error( 'THREE.BufferGeometryUtils.toTrianglesDrawMode(): Unable to generate correct amount of triangles.' );

		}

		// build final geometry

		const newGeometry = geometry.clone();
		newGeometry.setIndex( newIndices );
		newGeometry.clearGroups();

		return newGeometry;

	} else {

		console.error( 'THREE.BufferGeometryUtils.toTrianglesDrawMode(): Unknown draw mode:', drawMode );
		return geometry;

	}

}

/**
 * Calculates the morphed attributes of a morphed/skinned BufferGeometry.
 * Helpful for Raytracing or Decals.
 * @param {Mesh | Line | Points} object An instance of Mesh, Line or Points.
 * @return {Object} An Object with original position/normal attributes and morphed ones.
 */
function computeMorphedAttributes( object ) {

	const _vA = new Vector3();
	const _vB = new Vector3();
	const _vC = new Vector3();

	const _tempA = new Vector3();
	const _tempB = new Vector3();
	const _tempC = new Vector3();

	const _morphA = new Vector3();
	const _morphB = new Vector3();
	const _morphC = new Vector3();

	function _calculateMorphedAttributeData(
		object,
		attribute,
		morphAttribute,
		morphTargetsRelative,
		a,
		b,
		c,
		modifiedAttributeArray
	) {

		_vA.fromBufferAttribute( attribute, a );
		_vB.fromBufferAttribute( attribute, b );
		_vC.fromBufferAttribute( attribute, c );

		const morphInfluences = object.morphTargetInfluences;

		if ( morphAttribute && morphInfluences ) {

			_morphA.set( 0, 0, 0 );
			_morphB.set( 0, 0, 0 );
			_morphC.set( 0, 0, 0 );

			for ( let i = 0, il = morphAttribute.length; i < il; i ++ ) {

				const influence = morphInfluences[ i ];
				const morph = morphAttribute[ i ];

				if ( influence === 0 ) continue;

				_tempA.fromBufferAttribute( morph, a );
				_tempB.fromBufferAttribute( morph, b );
				_tempC.fromBufferAttribute( morph, c );

				if ( morphTargetsRelative ) {

					_morphA.addScaledVector( _tempA, influence );
					_morphB.addScaledVector( _tempB, influence );
					_morphC.addScaledVector( _tempC, influence );

				} else {

					_morphA.addScaledVector( _tempA.sub( _vA ), influence );
					_morphB.addScaledVector( _tempB.sub( _vB ), influence );
					_morphC.addScaledVector( _tempC.sub( _vC ), influence );

				}

			}

			_vA.add( _morphA );
			_vB.add( _morphB );
			_vC.add( _morphC );

		}

		if ( object.isSkinnedMesh ) {

			object.applyBoneTransform( a, _vA );
			object.applyBoneTransform( b, _vB );
			object.applyBoneTransform( c, _vC );

		}

		modifiedAttributeArray[ a * 3 + 0 ] = _vA.x;
		modifiedAttributeArray[ a * 3 + 1 ] = _vA.y;
		modifiedAttributeArray[ a * 3 + 2 ] = _vA.z;
		modifiedAttributeArray[ b * 3 + 0 ] = _vB.x;
		modifiedAttributeArray[ b * 3 + 1 ] = _vB.y;
		modifiedAttributeArray[ b * 3 + 2 ] = _vB.z;
		modifiedAttributeArray[ c * 3 + 0 ] = _vC.x;
		modifiedAttributeArray[ c * 3 + 1 ] = _vC.y;
		modifiedAttributeArray[ c * 3 + 2 ] = _vC.z;

	}

	const geometry = object.geometry;
	const material = object.material;

	let a, b, c;
	const index = geometry.index;
	const positionAttribute = geometry.attributes.position;
	const morphPosition = geometry.morphAttributes.position;
	const morphTargetsRelative = geometry.morphTargetsRelative;
	const normalAttribute = geometry.attributes.normal;
	const morphNormal = geometry.morphAttributes.position;

	const groups = geometry.groups;
	const drawRange = geometry.drawRange;
	let i, j, il, jl;
	let group;
	let start, end;

	const modifiedPosition = new Float32Array( positionAttribute.count * positionAttribute.itemSize );
	const modifiedNormal = new Float32Array( normalAttribute.count * normalAttribute.itemSize );

	if ( index !== null ) {

		// indexed buffer geometry

		if ( Array.isArray( material ) ) {

			for ( i = 0, il = groups.length; i < il; i ++ ) {

				group = groups[ i ];

				start = Math.max( group.start, drawRange.start );
				end = Math.min( ( group.start + group.count ), ( drawRange.start + drawRange.count ) );

				for ( j = start, jl = end; j < jl; j += 3 ) {

					a = index.getX( j );
					b = index.getX( j + 1 );
					c = index.getX( j + 2 );

					_calculateMorphedAttributeData(
						object,
						positionAttribute,
						morphPosition,
						morphTargetsRelative,
						a, b, c,
						modifiedPosition
					);

					_calculateMorphedAttributeData(
						object,
						normalAttribute,
						morphNormal,
						morphTargetsRelative,
						a, b, c,
						modifiedNormal
					);

				}

			}

		} else {

			start = Math.max( 0, drawRange.start );
			end = Math.min( index.count, ( drawRange.start + drawRange.count ) );

			for ( i = start, il = end; i < il; i += 3 ) {

				a = index.getX( i );
				b = index.getX( i + 1 );
				c = index.getX( i + 2 );

				_calculateMorphedAttributeData(
					object,
					positionAttribute,
					morphPosition,
					morphTargetsRelative,
					a, b, c,
					modifiedPosition
				);

				_calculateMorphedAttributeData(
					object,
					normalAttribute,
					morphNormal,
					morphTargetsRelative,
					a, b, c,
					modifiedNormal
				);

			}

		}

	} else {

		// non-indexed buffer geometry

		if ( Array.isArray( material ) ) {

			for ( i = 0, il = groups.length; i < il; i ++ ) {

				group = groups[ i ];

				start = Math.max( group.start, drawRange.start );
				end = Math.min( ( group.start + group.count ), ( drawRange.start + drawRange.count ) );

				for ( j = start, jl = end; j < jl; j += 3 ) {

					a = j;
					b = j + 1;
					c = j + 2;

					_calculateMorphedAttributeData(
						object,
						positionAttribute,
						morphPosition,
						morphTargetsRelative,
						a, b, c,
						modifiedPosition
					);

					_calculateMorphedAttributeData(
						object,
						normalAttribute,
						morphNormal,
						morphTargetsRelative,
						a, b, c,
						modifiedNormal
					);

				}

			}

		} else {

			start = Math.max( 0, drawRange.start );
			end = Math.min( positionAttribute.count, ( drawRange.start + drawRange.count ) );

			for ( i = start, il = end; i < il; i += 3 ) {

				a = i;
				b = i + 1;
				c = i + 2;

				_calculateMorphedAttributeData(
					object,
					positionAttribute,
					morphPosition,
					morphTargetsRelative,
					a, b, c,
					modifiedPosition
				);

				_calculateMorphedAttributeData(
					object,
					normalAttribute,
					morphNormal,
					morphTargetsRelative,
					a, b, c,
					modifiedNormal
				);

			}

		}

	}

	const morphedPositionAttribute = new Float32BufferAttribute( modifiedPosition, 3 );
	const morphedNormalAttribute = new Float32BufferAttribute( modifiedNormal, 3 );

	return {

		positionAttribute: positionAttribute,
		normalAttribute: normalAttribute,
		morphedPositionAttribute: morphedPositionAttribute,
		morphedNormalAttribute: morphedNormalAttribute

	};

}

function mergeGroups( geometry ) {

	if ( geometry.groups.length === 0 ) {

		console.warn( 'THREE.BufferGeometryUtils.mergeGroups(): No groups are defined. Nothing to merge.' );
		return geometry;

	}

	let groups = geometry.groups;

	// sort groups by material index

	groups = groups.sort( ( a, b ) => {

		if ( a.materialIndex !== b.materialIndex ) return a.materialIndex - b.materialIndex;

		return a.start - b.start;

	} );

	// create index for non-indexed geometries

	if ( geometry.getIndex() === null ) {

		const positionAttribute = geometry.getAttribute( 'position' );
		const indices = [];

		for ( let i = 0; i < positionAttribute.count; i += 3 ) {

			indices.push( i, i + 1, i + 2 );

		}

		geometry.setIndex( indices );

	}

	// sort index

	const index = geometry.getIndex();

	const newIndices = [];

	for ( let i = 0; i < groups.length; i ++ ) {

		const group = groups[ i ];

		const groupStart = group.start;
		const groupLength = groupStart + group.count;

		for ( let j = groupStart; j < groupLength; j ++ ) {

			newIndices.push( index.getX( j ) );

		}

	}

	geometry.dispose(); // Required to force buffer recreation
	geometry.setIndex( newIndices );

	// update groups indices

	let start = 0;

	for ( let i = 0; i < groups.length; i ++ ) {

		const group = groups[ i ];

		group.start = start;
		start += group.count;

	}

	// merge groups

	let currentGroup = groups[ 0 ];

	geometry.groups = [ currentGroup ];

	for ( let i = 1; i < groups.length; i ++ ) {

		const group = groups[ i ];

		if ( currentGroup.materialIndex === group.materialIndex ) {

			currentGroup.count += group.count;

		} else {

			currentGroup = group;
			geometry.groups.push( currentGroup );

		}

	}

	return geometry;

}


/**
 * Modifies the supplied geometry if it is non-indexed, otherwise creates a new,
 * non-indexed geometry. Returns the geometry with smooth normals everywhere except
 * faces that meet at an angle greater than the crease angle.
 *
 * @param {BufferGeometry} geometry
 * @param {number} [creaseAngle]
 * @return {BufferGeometry}
 */
function toCreasedNormals( geometry, creaseAngle = Math.PI / 3 /* 60 degrees */ ) {

	const creaseDot = Math.cos( creaseAngle );
	const hashMultiplier = ( 1 + 1e-10 ) * 1e2;

	// reusable vectors
	const verts = [ new Vector3(), new Vector3(), new Vector3() ];
	const tempVec1 = new Vector3();
	const tempVec2 = new Vector3();
	const tempNorm = new Vector3();
	const tempNorm2 = new Vector3();

	// hashes a vector
	function hashVertex( v ) {

		const x = ~ ~ ( v.x * hashMultiplier );
		const y = ~ ~ ( v.y * hashMultiplier );
		const z = ~ ~ ( v.z * hashMultiplier );
		return `${x},${y},${z}`;

	}

	// BufferGeometry.toNonIndexed() warns if the geometry is non-indexed
	// and returns the original geometry
	const resultGeometry = geometry.index ? geometry.toNonIndexed() : geometry;
	const posAttr = resultGeometry.attributes.position;
	const vertexMap = {};

	// find all the normals shared by commonly located vertices
	for ( let i = 0, l = posAttr.count / 3; i < l; i ++ ) {

		const i3 = 3 * i;
		const a = verts[ 0 ].fromBufferAttribute( posAttr, i3 + 0 );
		const b = verts[ 1 ].fromBufferAttribute( posAttr, i3 + 1 );
		const c = verts[ 2 ].fromBufferAttribute( posAttr, i3 + 2 );

		tempVec1.subVectors( c, b );
		tempVec2.subVectors( a, b );

		// add the normal to the map for all vertices
		const normal = new Vector3().crossVectors( tempVec1, tempVec2 ).normalize();
		for ( let n = 0; n < 3; n ++ ) {

			const vert = verts[ n ];
			const hash = hashVertex( vert );
			if ( ! ( hash in vertexMap ) ) {

				vertexMap[ hash ] = [];

			}

			vertexMap[ hash ].push( normal );

		}

	}

	// average normals from all vertices that share a common location if they are within the
	// provided crease threshold
	const normalArray = new Float32Array( posAttr.count * 3 );
	const normAttr = new BufferAttribute( normalArray, 3, false );
	for ( let i = 0, l = posAttr.count / 3; i < l; i ++ ) {

		// get the face normal for this vertex
		const i3 = 3 * i;
		const a = verts[ 0 ].fromBufferAttribute( posAttr, i3 + 0 );
		const b = verts[ 1 ].fromBufferAttribute( posAttr, i3 + 1 );
		const c = verts[ 2 ].fromBufferAttribute( posAttr, i3 + 2 );

		tempVec1.subVectors( c, b );
		tempVec2.subVectors( a, b );

		tempNorm.crossVectors( tempVec1, tempVec2 ).normalize();

		// average all normals that meet the threshold and set the normal value
		for ( let n = 0; n < 3; n ++ ) {

			const vert = verts[ n ];
			const hash = hashVertex( vert );
			const otherNormals = vertexMap[ hash ];
			tempNorm2.set( 0, 0, 0 );

			for ( let k = 0, lk = otherNormals.length; k < lk; k ++ ) {

				const otherNorm = otherNormals[ k ];
				if ( tempNorm.dot( otherNorm ) > creaseDot ) {

					tempNorm2.add( otherNorm );

				}

			}

			tempNorm2.normalize();
			normAttr.setXYZ( i3 + n, tempNorm2.x, tempNorm2.y, tempNorm2.z );

		}

	}

	resultGeometry.setAttribute( 'normal', normAttr );
	return resultGeometry;

}

function mergeBufferGeometries( geometries, useGroups = false ) {

	console.warn( 'THREE.BufferGeometryUtils: mergeBufferGeometries() has been renamed to mergeGeometries().' ); // @deprecated, r151
	return mergeGeometries( geometries, useGroups );

}

function mergeBufferAttributes( attributes ) {

	console.warn( 'THREE.BufferGeometryUtils: mergeBufferAttributes() has been renamed to mergeAttributes().' ); // @deprecated, r151
	return mergeAttributes( attributes );

}

export {
	computeMikkTSpaceTangents,
	mergeGeometries,
	mergeBufferGeometries,
	mergeAttributes,
	mergeBufferAttributes,
	interleaveAttributes,
	estimateBytesUsed,
	mergeVertices,
	toTrianglesDrawMode,
	computeMorphedAttributes,
	mergeGroups,
	toCreasedNormals
};

```

## vendor\three\examples\jsm\loaders\GLTFLoader.js
```
import {
	AnimationClip,
	Bone,
	Box3,
	BufferAttribute,
	BufferGeometry,
	ClampToEdgeWrapping,
	Color,
	ColorManagement,
	DirectionalLight,
	DoubleSide,
	FileLoader,
	FrontSide,
	Group,
	ImageBitmapLoader,
	InstancedMesh,
	InterleavedBuffer,
	InterleavedBufferAttribute,
	Interpolant,
	InterpolateDiscrete,
	InterpolateLinear,
	Line,
	LineBasicMaterial,
	LineLoop,
	LineSegments,
	LinearFilter,
	LinearMipmapLinearFilter,
	LinearMipmapNearestFilter,
	LinearSRGBColorSpace,
	Loader,
	LoaderUtils,
	Material,
	MathUtils,
	Matrix4,
	Mesh,
	MeshBasicMaterial,
	MeshPhysicalMaterial,
	MeshStandardMaterial,
	MirroredRepeatWrapping,
	NearestFilter,
	NearestMipmapLinearFilter,
	NearestMipmapNearestFilter,
	NumberKeyframeTrack,
	Object3D,
	OrthographicCamera,
	PerspectiveCamera,
	PointLight,
	Points,
	PointsMaterial,
	PropertyBinding,
	Quaternion,
	QuaternionKeyframeTrack,
	RepeatWrapping,
	Skeleton,
	SkinnedMesh,
	Sphere,
	SpotLight,
	Texture,
	TextureLoader,
	TriangleFanDrawMode,
	TriangleStripDrawMode,
	Vector2,
	Vector3,
	VectorKeyframeTrack,
	SRGBColorSpace,
	InstancedBufferAttribute
} from '../../../build/three.module.js';
import { toTrianglesDrawMode } from '../utils/BufferGeometryUtils.js';

class GLTFLoader extends Loader {

	constructor( manager ) {

		super( manager );

		this.dracoLoader = null;
		this.ktx2Loader = null;
		this.meshoptDecoder = null;

		this.pluginCallbacks = [];

		this.register( function ( parser ) {

			return new GLTFMaterialsClearcoatExtension( parser );

		} );

		this.register( function ( parser ) {

			return new GLTFTextureBasisUExtension( parser );

		} );

		this.register( function ( parser ) {

			return new GLTFTextureWebPExtension( parser );

		} );

		this.register( function ( parser ) {

			return new GLTFTextureAVIFExtension( parser );

		} );

		this.register( function ( parser ) {

			return new GLTFMaterialsSheenExtension( parser );

		} );

		this.register( function ( parser ) {

			return new GLTFMaterialsTransmissionExtension( parser );

		} );

		this.register( function ( parser ) {

			return new GLTFMaterialsVolumeExtension( parser );

		} );

		this.register( function ( parser ) {

			return new GLTFMaterialsIorExtension( parser );

		} );

		this.register( function ( parser ) {

			return new GLTFMaterialsEmissiveStrengthExtension( parser );

		} );

		this.register( function ( parser ) {

			return new GLTFMaterialsSpecularExtension( parser );

		} );

		this.register( function ( parser ) {

			return new GLTFMaterialsIridescenceExtension( parser );

		} );

		this.register( function ( parser ) {

			return new GLTFMaterialsAnisotropyExtension( parser );

		} );

		this.register( function ( parser ) {

			return new GLTFMaterialsBumpExtension( parser );

		} );

		this.register( function ( parser ) {

			return new GLTFLightsExtension( parser );

		} );

		this.register( function ( parser ) {

			return new GLTFMeshoptCompression( parser );

		} );

		this.register( function ( parser ) {

			return new GLTFMeshGpuInstancing( parser );

		} );

	}

	load( url, onLoad, onProgress, onError ) {

		const scope = this;

		let resourcePath;

		if ( this.resourcePath !== '' ) {

			resourcePath = this.resourcePath;

		} else if ( this.path !== '' ) {

			// If a base path is set, resources will be relative paths from that plus the relative path of the gltf file
			// Example  path = 'https://my-cnd-server.com/', url = 'assets/models/model.gltf'
			// resourcePath = 'https://my-cnd-server.com/assets/models/'
			// referenced resource 'model.bin' will be loaded from 'https://my-cnd-server.com/assets/models/model.bin'
			// referenced resource '../textures/texture.png' will be loaded from 'https://my-cnd-server.com/assets/textures/texture.png'
			const relativeUrl = LoaderUtils.extractUrlBase( url );
			resourcePath = LoaderUtils.resolveURL( relativeUrl, this.path );

		} else {

			resourcePath = LoaderUtils.extractUrlBase( url );

		}

		// Tells the LoadingManager to track an extra item, which resolves after
		// the model is fully loaded. This means the count of items loaded will
		// be incorrect, but ensures manager.onLoad() does not fire early.
		this.manager.itemStart( url );

		const _onError = function ( e ) {

			if ( onError ) {

				onError( e );

			} else {

				console.error( e );

			}

			scope.manager.itemError( url );
			scope.manager.itemEnd( url );

		};

		const loader = new FileLoader( this.manager );

		loader.setPath( this.path );
		loader.setResponseType( 'arraybuffer' );
		loader.setRequestHeader( this.requestHeader );
		loader.setWithCredentials( this.withCredentials );

		loader.load( url, function ( data ) {

			try {

				scope.parse( data, resourcePath, function ( gltf ) {

					onLoad( gltf );

					scope.manager.itemEnd( url );

				}, _onError );

			} catch ( e ) {

				_onError( e );

			}

		}, onProgress, _onError );

	}

	setDRACOLoader( dracoLoader ) {

		this.dracoLoader = dracoLoader;
		return this;

	}

	setDDSLoader() {

		throw new Error(

			'THREE.GLTFLoader: "MSFT_texture_dds" no longer supported. Please update to "KHR_texture_basisu".'

		);

	}

	setKTX2Loader( ktx2Loader ) {

		this.ktx2Loader = ktx2Loader;
		return this;

	}

	setMeshoptDecoder( meshoptDecoder ) {

		this.meshoptDecoder = meshoptDecoder;
		return this;

	}

	register( callback ) {

		if ( this.pluginCallbacks.indexOf( callback ) === - 1 ) {

			this.pluginCallbacks.push( callback );

		}

		return this;

	}

	unregister( callback ) {

		if ( this.pluginCallbacks.indexOf( callback ) !== - 1 ) {

			this.pluginCallbacks.splice( this.pluginCallbacks.indexOf( callback ), 1 );

		}

		return this;

	}

	parse( data, path, onLoad, onError ) {

		let json;
		const extensions = {};
		const plugins = {};
		const textDecoder = new TextDecoder();

		if ( typeof data === 'string' ) {

			json = JSON.parse( data );

		} else if ( data instanceof ArrayBuffer ) {

			const magic = textDecoder.decode( new Uint8Array( data, 0, 4 ) );

			if ( magic === BINARY_EXTENSION_HEADER_MAGIC ) {

				try {

					extensions[ EXTENSIONS.KHR_BINARY_GLTF ] = new GLTFBinaryExtension( data );

				} catch ( error ) {

					if ( onError ) onError( error );
					return;

				}

				json = JSON.parse( extensions[ EXTENSIONS.KHR_BINARY_GLTF ].content );

			} else {

				json = JSON.parse( textDecoder.decode( data ) );

			}

		} else {

			json = data;

		}

		if ( json.asset === undefined || json.asset.version[ 0 ] < 2 ) {

			if ( onError ) onError( new Error( 'THREE.GLTFLoader: Unsupported asset. glTF versions >=2.0 are supported.' ) );
			return;

		}

		const parser = new GLTFParser( json, {

			path: path || this.resourcePath || '',
			crossOrigin: this.crossOrigin,
			requestHeader: this.requestHeader,
			manager: this.manager,
			ktx2Loader: this.ktx2Loader,
			meshoptDecoder: this.meshoptDecoder

		} );

		parser.fileLoader.setRequestHeader( this.requestHeader );

		for ( let i = 0; i < this.pluginCallbacks.length; i ++ ) {

			const plugin = this.pluginCallbacks[ i ]( parser );

			if ( ! plugin.name ) console.error( 'THREE.GLTFLoader: Invalid plugin found: missing name' );

			plugins[ plugin.name ] = plugin;

			// Workaround to avoid determining as unknown extension
			// in addUnknownExtensionsToUserData().
			// Remove this workaround if we move all the existing
			// extension handlers to plugin system
			extensions[ plugin.name ] = true;

		}

		if ( json.extensionsUsed ) {

			for ( let i = 0; i < json.extensionsUsed.length; ++ i ) {

				const extensionName = json.extensionsUsed[ i ];
				const extensionsRequired = json.extensionsRequired || [];

				switch ( extensionName ) {

					case EXTENSIONS.KHR_MATERIALS_UNLIT:
						extensions[ extensionName ] = new GLTFMaterialsUnlitExtension();
						break;

					case EXTENSIONS.KHR_DRACO_MESH_COMPRESSION:
						extensions[ extensionName ] = new GLTFDracoMeshCompressionExtension( json, this.dracoLoader );
						break;

					case EXTENSIONS.KHR_TEXTURE_TRANSFORM:
						extensions[ extensionName ] = new GLTFTextureTransformExtension();
						break;

					case EXTENSIONS.KHR_MESH_QUANTIZATION:
						extensions[ extensionName ] = new GLTFMeshQuantizationExtension();
						break;

					default:

						if ( extensionsRequired.indexOf( extensionName ) >= 0 && plugins[ extensionName ] === undefined ) {

							console.warn( 'THREE.GLTFLoader: Unknown extension "' + extensionName + '".' );

						}

				}

			}

		}

		parser.setExtensions( extensions );
		parser.setPlugins( plugins );
		parser.parse( onLoad, onError );

	}

	parseAsync( data, path ) {

		const scope = this;

		return new Promise( function ( resolve, reject ) {

			scope.parse( data, path, resolve, reject );

		} );

	}

}

/* GLTFREGISTRY */

function GLTFRegistry() {

	let objects = {};

	return	{

		get: function ( key ) {

			return objects[ key ];

		},

		add: function ( key, object ) {

			objects[ key ] = object;

		},

		remove: function ( key ) {

			delete objects[ key ];

		},

		removeAll: function () {

			objects = {};

		}

	};

}

/*********************************/
/********** EXTENSIONS ***********/
/*********************************/

const EXTENSIONS = {
	KHR_BINARY_GLTF: 'KHR_binary_glTF',
	KHR_DRACO_MESH_COMPRESSION: 'KHR_draco_mesh_compression',
	KHR_LIGHTS_PUNCTUAL: 'KHR_lights_punctual',
	KHR_MATERIALS_CLEARCOAT: 'KHR_materials_clearcoat',
	KHR_MATERIALS_IOR: 'KHR_materials_ior',
	KHR_MATERIALS_SHEEN: 'KHR_materials_sheen',
	KHR_MATERIALS_SPECULAR: 'KHR_materials_specular',
	KHR_MATERIALS_TRANSMISSION: 'KHR_materials_transmission',
	KHR_MATERIALS_IRIDESCENCE: 'KHR_materials_iridescence',
	KHR_MATERIALS_ANISOTROPY: 'KHR_materials_anisotropy',
	KHR_MATERIALS_UNLIT: 'KHR_materials_unlit',
	KHR_MATERIALS_VOLUME: 'KHR_materials_volume',
	KHR_TEXTURE_BASISU: 'KHR_texture_basisu',
	KHR_TEXTURE_TRANSFORM: 'KHR_texture_transform',
	KHR_MESH_QUANTIZATION: 'KHR_mesh_quantization',
	KHR_MATERIALS_EMISSIVE_STRENGTH: 'KHR_materials_emissive_strength',
	EXT_MATERIALS_BUMP: 'EXT_materials_bump',
	EXT_TEXTURE_WEBP: 'EXT_texture_webp',
	EXT_TEXTURE_AVIF: 'EXT_texture_avif',
	EXT_MESHOPT_COMPRESSION: 'EXT_meshopt_compression',
	EXT_MESH_GPU_INSTANCING: 'EXT_mesh_gpu_instancing'
};

/**
 * Punctual Lights Extension
 *
 * Specification: https://github.com/KhronosGroup/glTF/tree/master/extensions/2.0/Khronos/KHR_lights_punctual
 */
class GLTFLightsExtension {

	constructor( parser ) {

		this.parser = parser;
		this.name = EXTENSIONS.KHR_LIGHTS_PUNCTUAL;

		// Object3D instance caches
		this.cache = { refs: {}, uses: {} };

	}

	_markDefs() {

		const parser = this.parser;
		const nodeDefs = this.parser.json.nodes || [];

		for ( let nodeIndex = 0, nodeLength = nodeDefs.length; nodeIndex < nodeLength; nodeIndex ++ ) {

			const nodeDef = nodeDefs[ nodeIndex ];

			if ( nodeDef.extensions
					&& nodeDef.extensions[ this.name ]
					&& nodeDef.extensions[ this.name ].light !== undefined ) {

				parser._addNodeRef( this.cache, nodeDef.extensions[ this.name ].light );

			}

		}

	}

	_loadLight( lightIndex ) {

		const parser = this.parser;
		const cacheKey = 'light:' + lightIndex;
		let dependency = parser.cache.get( cacheKey );

		if ( dependency ) return dependency;

		const json = parser.json;
		const extensions = ( json.extensions && json.extensions[ this.name ] ) || {};
		const lightDefs = extensions.lights || [];
		const lightDef = lightDefs[ lightIndex ];
		let lightNode;

		const color = new Color( 0xffffff );

		if ( lightDef.color !== undefined ) color.setRGB( lightDef.color[ 0 ], lightDef.color[ 1 ], lightDef.color[ 2 ], LinearSRGBColorSpace );

		const range = lightDef.range !== undefined ? lightDef.range : 0;

		switch ( lightDef.type ) {

			case 'directional':
				lightNode = new DirectionalLight( color );
				lightNode.target.position.set( 0, 0, - 1 );
				lightNode.add( lightNode.target );
				break;

			case 'point':
				lightNode = new PointLight( color );
				lightNode.distance = range;
				break;

			case 'spot':
				lightNode = new SpotLight( color );
				lightNode.distance = range;
				// Handle spotlight properties.
				lightDef.spot = lightDef.spot || {};
				lightDef.spot.innerConeAngle = lightDef.spot.innerConeAngle !== undefined ? lightDef.spot.innerConeAngle : 0;
				lightDef.spot.outerConeAngle = lightDef.spot.outerConeAngle !== undefined ? lightDef.spot.outerConeAngle : Math.PI / 4.0;
				lightNode.angle = lightDef.spot.outerConeAngle;
				lightNode.penumbra = 1.0 - lightDef.spot.innerConeAngle / lightDef.spot.outerConeAngle;
				lightNode.target.position.set( 0, 0, - 1 );
				lightNode.add( lightNode.target );
				break;

			default:
				throw new Error( 'THREE.GLTFLoader: Unexpected light type: ' + lightDef.type );

		}

		// Some lights (e.g. spot) default to a position other than the origin. Reset the position
		// here, because node-level parsing will only override position if explicitly specified.
		lightNode.position.set( 0, 0, 0 );

		lightNode.decay = 2;

		assignExtrasToUserData( lightNode, lightDef );

		if ( lightDef.intensity !== undefined ) lightNode.intensity = lightDef.intensity;

		lightNode.name = parser.createUniqueName( lightDef.name || ( 'light_' + lightIndex ) );

		dependency = Promise.resolve( lightNode );

		parser.cache.add( cacheKey, dependency );

		return dependency;

	}

	getDependency( type, index ) {

		if ( type !== 'light' ) return;

		return this._loadLight( index );

	}

	createNodeAttachment( nodeIndex ) {

		const self = this;
		const parser = this.parser;
		const json = parser.json;
		const nodeDef = json.nodes[ nodeIndex ];
		const lightDef = ( nodeDef.extensions && nodeDef.extensions[ this.name ] ) || {};
		const lightIndex = lightDef.light;

		if ( lightIndex === undefined ) return null;

		return this._loadLight( lightIndex ).then( function ( light ) {

			return parser._getNodeRef( self.cache, lightIndex, light );

		} );

	}

}

/**
 * Unlit Materials Extension
 *
 * Specification: https://github.com/KhronosGroup/glTF/tree/master/extensions/2.0/Khronos/KHR_materials_unlit
 */
class GLTFMaterialsUnlitExtension {

	constructor() {

		this.name = EXTENSIONS.KHR_MATERIALS_UNLIT;

	}

	getMaterialType() {

		return MeshBasicMaterial;

	}

	extendParams( materialParams, materialDef, parser ) {

		const pending = [];

		materialParams.color = new Color( 1.0, 1.0, 1.0 );
		materialParams.opacity = 1.0;

		const metallicRoughness = materialDef.pbrMetallicRoughness;

		if ( metallicRoughness ) {

			if ( Array.isArray( metallicRoughness.baseColorFactor ) ) {

				const array = metallicRoughness.baseColorFactor;

				materialParams.color.setRGB( array[ 0 ], array[ 1 ], array[ 2 ], LinearSRGBColorSpace );
				materialParams.opacity = array[ 3 ];

			}

			if ( metallicRoughness.baseColorTexture !== undefined ) {

				pending.push( parser.assignTexture( materialParams, 'map', metallicRoughness.baseColorTexture, SRGBColorSpace ) );

			}

		}

		return Promise.all( pending );

	}

}

/**
 * Materials Emissive Strength Extension
 *
 * Specification: https://github.com/KhronosGroup/glTF/blob/5768b3ce0ef32bc39cdf1bef10b948586635ead3/extensions/2.0/Khronos/KHR_materials_emissive_strength/README.md
 */
class GLTFMaterialsEmissiveStrengthExtension {

	constructor( parser ) {

		this.parser = parser;
		this.name = EXTENSIONS.KHR_MATERIALS_EMISSIVE_STRENGTH;

	}

	extendMaterialParams( materialIndex, materialParams ) {

		const parser = this.parser;
		const materialDef = parser.json.materials[ materialIndex ];

		if ( ! materialDef.extensions || ! materialDef.extensions[ this.name ] ) {

			return Promise.resolve();

		}

		const emissiveStrength = materialDef.extensions[ this.name ].emissiveStrength;

		if ( emissiveStrength !== undefined ) {

			materialParams.emissiveIntensity = emissiveStrength;

		}

		return Promise.resolve();

	}

}

/**
 * Clearcoat Materials Extension
 *
 * Specification: https://github.com/KhronosGroup/glTF/tree/master/extensions/2.0/Khronos/KHR_materials_clearcoat
 */
class GLTFMaterialsClearcoatExtension {

	constructor( parser ) {

		this.parser = parser;
		this.name = EXTENSIONS.KHR_MATERIALS_CLEARCOAT;

	}

	getMaterialType( materialIndex ) {

		const parser = this.parser;
		const materialDef = parser.json.materials[ materialIndex ];

		if ( ! materialDef.extensions || ! materialDef.extensions[ this.name ] ) return null;

		return MeshPhysicalMaterial;

	}

	extendMaterialParams( materialIndex, materialParams ) {

		const parser = this.parser;
		const materialDef = parser.json.materials[ materialIndex ];

		if ( ! materialDef.extensions || ! materialDef.extensions[ this.name ] ) {

			return Promise.resolve();

		}

		const pending = [];

		const extension = materialDef.extensions[ this.name ];

		if ( extension.clearcoatFactor !== undefined ) {

			materialParams.clearcoat = extension.clearcoatFactor;

		}

		if ( extension.clearcoatTexture !== undefined ) {

			pending.push( parser.assignTexture( materialParams, 'clearcoatMap', extension.clearcoatTexture ) );

		}

		if ( extension.clearcoatRoughnessFactor !== undefined ) {

			materialParams.clearcoatRoughness = extension.clearcoatRoughnessFactor;

		}

		if ( extension.clearcoatRoughnessTexture !== undefined ) {

			pending.push( parser.assignTexture( materialParams, 'clearcoatRoughnessMap', extension.clearcoatRoughnessTexture ) );

		}

		if ( extension.clearcoatNormalTexture !== undefined ) {

			pending.push( parser.assignTexture( materialParams, 'clearcoatNormalMap', extension.clearcoatNormalTexture ) );

			if ( extension.clearcoatNormalTexture.scale !== undefined ) {

				const scale = extension.clearcoatNormalTexture.scale;

				materialParams.clearcoatNormalScale = new Vector2( scale, scale );

			}

		}

		return Promise.all( pending );

	}

}

/**
 * Iridescence Materials Extension
 *
 * Specification: https://github.com/KhronosGroup/glTF/tree/master/extensions/2.0/Khronos/KHR_materials_iridescence
 */
class GLTFMaterialsIridescenceExtension {

	constructor( parser ) {

		this.parser = parser;
		this.name = EXTENSIONS.KHR_MATERIALS_IRIDESCENCE;

	}

	getMaterialType( materialIndex ) {

		const parser = this.parser;
		const materialDef = parser.json.materials[ materialIndex ];

		if ( ! materialDef.extensions || ! materialDef.extensions[ this.name ] ) return null;

		return MeshPhysicalMaterial;

	}

	extendMaterialParams( materialIndex, materialParams ) {

		const parser = this.parser;
		const materialDef = parser.json.materials[ materialIndex ];

		if ( ! materialDef.extensions || ! materialDef.extensions[ this.name ] ) {

			return Promise.resolve();

		}

		const pending = [];

		const extension = materialDef.extensions[ this.name ];

		if ( extension.iridescenceFactor !== undefined ) {

			materialParams.iridescence = extension.iridescenceFactor;

		}

		if ( extension.iridescenceTexture !== undefined ) {

			pending.push( parser.assignTexture( materialParams, 'iridescenceMap', extension.iridescenceTexture ) );

		}

		if ( extension.iridescenceIor !== undefined ) {

			materialParams.iridescenceIOR = extension.iridescenceIor;

		}

		if ( materialParams.iridescenceThicknessRange === undefined ) {

			materialParams.iridescenceThicknessRange = [ 100, 400 ];

		}

		if ( extension.iridescenceThicknessMinimum !== undefined ) {

			materialParams.iridescenceThicknessRange[ 0 ] = extension.iridescenceThicknessMinimum;

		}

		if ( extension.iridescenceThicknessMaximum !== undefined ) {

			materialParams.iridescenceThicknessRange[ 1 ] = extension.iridescenceThicknessMaximum;

		}

		if ( extension.iridescenceThicknessTexture !== undefined ) {

			pending.push( parser.assignTexture( materialParams, 'iridescenceThicknessMap', extension.iridescenceThicknessTexture ) );

		}

		return Promise.all( pending );

	}

}

/**
 * Sheen Materials Extension
 *
 * Specification: https://github.com/KhronosGroup/glTF/tree/main/extensions/2.0/Khronos/KHR_materials_sheen
 */
class GLTFMaterialsSheenExtension {

	constructor( parser ) {

		this.parser = parser;
		this.name = EXTENSIONS.KHR_MATERIALS_SHEEN;

	}

	getMaterialType( materialIndex ) {

		const parser = this.parser;
		const materialDef = parser.json.materials[ materialIndex ];

		if ( ! materialDef.extensions || ! materialDef.extensions[ this.name ] ) return null;

		return MeshPhysicalMaterial;

	}

	extendMaterialParams( materialIndex, materialParams ) {

		const parser = this.parser;
		const materialDef = parser.json.materials[ materialIndex ];

		if ( ! materialDef.extensions || ! materialDef.extensions[ this.name ] ) {

			return Promise.resolve();

		}

		const pending = [];

		materialParams.sheenColor = new Color( 0, 0, 0 );
		materialParams.sheenRoughness = 0;
		materialParams.sheen = 1;

		const extension = materialDef.extensions[ this.name ];

		if ( extension.sheenColorFactor !== undefined ) {

			const colorFactor = extension.sheenColorFactor;
			materialParams.sheenColor.setRGB( colorFactor[ 0 ], colorFactor[ 1 ], colorFactor[ 2 ], LinearSRGBColorSpace );

		}

		if ( extension.sheenRoughnessFactor !== undefined ) {

			materialParams.sheenRoughness = extension.sheenRoughnessFactor;

		}

		if ( extension.sheenColorTexture !== undefined ) {

			pending.push( parser.assignTexture( materialParams, 'sheenColorMap', extension.sheenColorTexture, SRGBColorSpace ) );

		}

		if ( extension.sheenRoughnessTexture !== undefined ) {

			pending.push( parser.assignTexture( materialParams, 'sheenRoughnessMap', extension.sheenRoughnessTexture ) );

		}

		return Promise.all( pending );

	}

}

/**
 * Transmission Materials Extension
 *
 * Specification: https://github.com/KhronosGroup/glTF/tree/master/extensions/2.0/Khronos/KHR_materials_transmission
 * Draft: https://github.com/KhronosGroup/glTF/pull/1698
 */
class GLTFMaterialsTransmissionExtension {

	constructor( parser ) {

		this.parser = parser;
		this.name = EXTENSIONS.KHR_MATERIALS_TRANSMISSION;

	}

	getMaterialType( materialIndex ) {

		const parser = this.parser;
		const materialDef = parser.json.materials[ materialIndex ];

		if ( ! materialDef.extensions || ! materialDef.extensions[ this.name ] ) return null;

		return MeshPhysicalMaterial;

	}

	extendMaterialParams( materialIndex, materialParams ) {

		const parser = this.parser;
		const materialDef = parser.json.materials[ materialIndex ];

		if ( ! materialDef.extensions || ! materialDef.extensions[ this.name ] ) {

			return Promise.resolve();

		}

		const pending = [];

		const extension = materialDef.extensions[ this.name ];

		if ( extension.transmissionFactor !== undefined ) {

			materialParams.transmission = extension.transmissionFactor;

		}

		if ( extension.transmissionTexture !== undefined ) {

			pending.push( parser.assignTexture( materialParams, 'transmissionMap', extension.transmissionTexture ) );

		}

		return Promise.all( pending );

	}

}

/**
 * Materials Volume Extension
 *
 * Specification: https://github.com/KhronosGroup/glTF/tree/master/extensions/2.0/Khronos/KHR_materials_volume
 */
class GLTFMaterialsVolumeExtension {

	constructor( parser ) {

		this.parser = parser;
		this.name = EXTENSIONS.KHR_MATERIALS_VOLUME;

	}

	getMaterialType( materialIndex ) {

		const parser = this.parser;
		const materialDef = parser.json.materials[ materialIndex ];

		if ( ! materialDef.extensions || ! materialDef.extensions[ this.name ] ) return null;

		return MeshPhysicalMaterial;

	}

	extendMaterialParams( materialIndex, materialParams ) {

		const parser = this.parser;
		const materialDef = parser.json.materials[ materialIndex ];

		if ( ! materialDef.extensions || ! materialDef.extensions[ this.name ] ) {

			return Promise.resolve();

		}

		const pending = [];

		const extension = materialDef.extensions[ this.name ];

		materialParams.thickness = extension.thicknessFactor !== undefined ? extension.thicknessFactor : 0;

		if ( extension.thicknessTexture !== undefined ) {

			pending.push( parser.assignTexture( materialParams, 'thicknessMap', extension.thicknessTexture ) );

		}

		materialParams.attenuationDistance = extension.attenuationDistance || Infinity;

		const colorArray = extension.attenuationColor || [ 1, 1, 1 ];
		materialParams.attenuationColor = new Color().setRGB( colorArray[ 0 ], colorArray[ 1 ], colorArray[ 2 ], LinearSRGBColorSpace );

		return Promise.all( pending );

	}

}

/**
 * Materials ior Extension
 *
 * Specification: https://github.com/KhronosGroup/glTF/tree/master/extensions/2.0/Khronos/KHR_materials_ior
 */
class GLTFMaterialsIorExtension {

	constructor( parser ) {

		this.parser = parser;
		this.name = EXTENSIONS.KHR_MATERIALS_IOR;

	}

	getMaterialType( materialIndex ) {

		const parser = this.parser;
		const materialDef = parser.json.materials[ materialIndex ];

		if ( ! materialDef.extensions || ! materialDef.extensions[ this.name ] ) return null;

		return MeshPhysicalMaterial;

	}

	extendMaterialParams( materialIndex, materialParams ) {

		const parser = this.parser;
		const materialDef = parser.json.materials[ materialIndex ];

		if ( ! materialDef.extensions || ! materialDef.extensions[ this.name ] ) {

			return Promise.resolve();

		}

		const extension = materialDef.extensions[ this.name ];

		materialParams.ior = extension.ior !== undefined ? extension.ior : 1.5;

		return Promise.resolve();

	}

}

/**
 * Materials specular Extension
 *
 * Specification: https://github.com/KhronosGroup/glTF/tree/master/extensions/2.0/Khronos/KHR_materials_specular
 */
class GLTFMaterialsSpecularExtension {

	constructor( parser ) {

		this.parser = parser;
		this.name = EXTENSIONS.KHR_MATERIALS_SPECULAR;

	}

	getMaterialType( materialIndex ) {

		const parser = this.parser;
		const materialDef = parser.json.materials[ materialIndex ];

		if ( ! materialDef.extensions || ! materialDef.extensions[ this.name ] ) return null;

		return MeshPhysicalMaterial;

	}

	extendMaterialParams( materialIndex, materialParams ) {

		const parser = this.parser;
		const materialDef = parser.json.materials[ materialIndex ];

		if ( ! materialDef.extensions || ! materialDef.extensions[ this.name ] ) {

			return Promise.resolve();

		}

		const pending = [];

		const extension = materialDef.extensions[ this.name ];

		materialParams.specularIntensity = extension.specularFactor !== undefined ? extension.specularFactor : 1.0;

		if ( extension.specularTexture !== undefined ) {

			pending.push( parser.assignTexture( materialParams, 'specularIntensityMap', extension.specularTexture ) );

		}

		const colorArray = extension.specularColorFactor || [ 1, 1, 1 ];
		materialParams.specularColor = new Color().setRGB( colorArray[ 0 ], colorArray[ 1 ], colorArray[ 2 ], LinearSRGBColorSpace );

		if ( extension.specularColorTexture !== undefined ) {

			pending.push( parser.assignTexture( materialParams, 'specularColorMap', extension.specularColorTexture, SRGBColorSpace ) );

		}

		return Promise.all( pending );

	}

}


/**
 * Materials bump Extension
 *
 * Specification: https://github.com/KhronosGroup/glTF/tree/master/extensions/2.0/Khronos/EXT_materials_bump
 */
class GLTFMaterialsBumpExtension {

	constructor( parser ) {

		this.parser = parser;
		this.name = EXTENSIONS.EXT_MATERIALS_BUMP;

	}

	getMaterialType( materialIndex ) {

		const parser = this.parser;
		const materialDef = parser.json.materials[ materialIndex ];

		if ( ! materialDef.extensions || ! materialDef.extensions[ this.name ] ) return null;

		return MeshPhysicalMaterial;

	}

	extendMaterialParams( materialIndex, materialParams ) {

		const parser = this.parser;
		const materialDef = parser.json.materials[ materialIndex ];

		if ( ! materialDef.extensions || ! materialDef.extensions[ this.name ] ) {

			return Promise.resolve();

		}

		const pending = [];

		const extension = materialDef.extensions[ this.name ];

		materialParams.bumpScale = extension.bumpFactor !== undefined ? extension.bumpFactor : 1.0;

		if ( extension.bumpTexture !== undefined ) {

			pending.push( parser.assignTexture( materialParams, 'bumpMap', extension.bumpTexture ) );

		}

		return Promise.all( pending );

	}

}

/**
 * Materials anisotropy Extension
 *
 * Specification: https://github.com/KhronosGroup/glTF/tree/master/extensions/2.0/Khronos/KHR_materials_anisotropy
 */
class GLTFMaterialsAnisotropyExtension {

	constructor( parser ) {

		this.parser = parser;
		this.name = EXTENSIONS.KHR_MATERIALS_ANISOTROPY;

	}

	getMaterialType( materialIndex ) {

		const parser = this.parser;
		const materialDef = parser.json.materials[ materialIndex ];

		if ( ! materialDef.extensions || ! materialDef.extensions[ this.name ] ) return null;

		return MeshPhysicalMaterial;

	}

	extendMaterialParams( materialIndex, materialParams ) {

		const parser = this.parser;
		const materialDef = parser.json.materials[ materialIndex ];

		if ( ! materialDef.extensions || ! materialDef.extensions[ this.name ] ) {

			return Promise.resolve();

		}

		const pending = [];

		const extension = materialDef.extensions[ this.name ];

		if ( extension.anisotropyStrength !== undefined ) {

			materialParams.anisotropy = extension.anisotropyStrength;

		}

		if ( extension.anisotropyRotation !== undefined ) {

			materialParams.anisotropyRotation = extension.anisotropyRotation;

		}

		if ( extension.anisotropyTexture !== undefined ) {

			pending.push( parser.assignTexture( materialParams, 'anisotropyMap', extension.anisotropyTexture ) );

		}

		return Promise.all( pending );

	}

}

/**
 * BasisU Texture Extension
 *
 * Specification: https://github.com/KhronosGroup/glTF/tree/master/extensions/2.0/Khronos/KHR_texture_basisu
 */
class GLTFTextureBasisUExtension {

	constructor( parser ) {

		this.parser = parser;
		this.name = EXTENSIONS.KHR_TEXTURE_BASISU;

	}

	loadTexture( textureIndex ) {

		const parser = this.parser;
		const json = parser.json;

		const textureDef = json.textures[ textureIndex ];

		if ( ! textureDef.extensions || ! textureDef.extensions[ this.name ] ) {

			return null;

		}

		const extension = textureDef.extensions[ this.name ];
		const loader = parser.options.ktx2Loader;

		if ( ! loader ) {

			if ( json.extensionsRequired && json.extensionsRequired.indexOf( this.name ) >= 0 ) {

				throw new Error( 'THREE.GLTFLoader: setKTX2Loader must be called before loading KTX2 textures' );

			} else {

				// Assumes that the extension is optional and that a fallback texture is present
				return null;

			}

		}

		return parser.loadTextureImage( textureIndex, extension.source, loader );

	}

}

/**
 * WebP Texture Extension
 *
 * Specification: https://github.com/KhronosGroup/glTF/tree/master/extensions/2.0/Vendor/EXT_texture_webp
 */
class GLTFTextureWebPExtension {

	constructor( parser ) {

		this.parser = parser;
		this.name = EXTENSIONS.EXT_TEXTURE_WEBP;
		this.isSupported = null;

	}

	loadTexture( textureIndex ) {

		const name = this.name;
		const parser = this.parser;
		const json = parser.json;

		const textureDef = json.textures[ textureIndex ];

		if ( ! textureDef.extensions || ! textureDef.extensions[ name ] ) {

			return null;

		}

		const extension = textureDef.extensions[ name ];
		const source = json.images[ extension.source ];

		let loader = parser.textureLoader;
		if ( source.uri ) {

			const handler = parser.options.manager.getHandler( source.uri );
			if ( handler !== null ) loader = handler;

		}

		return this.detectSupport().then( function ( isSupported ) {

			if ( isSupported ) return parser.loadTextureImage( textureIndex, extension.source, loader );

			if ( json.extensionsRequired && json.extensionsRequired.indexOf( name ) >= 0 ) {

				throw new Error( 'THREE.GLTFLoader: WebP required by asset but unsupported.' );

			}

			// Fall back to PNG or JPEG.
			return parser.loadTexture( textureIndex );

		} );

	}

	detectSupport() {

		if ( ! this.isSupported ) {

			this.isSupported = new Promise( function ( resolve ) {

				const image = new Image();

				// Lossy test image. Support for lossy images doesn't guarantee support for all
				// WebP images, unfortunately.
				image.src = 'data:image/webp;base64,UklGRiIAAABXRUJQVlA4IBYAAAAwAQCdASoBAAEADsD+JaQAA3AAAAAA';

				image.onload = image.onerror = function () {

					resolve( image.height === 1 );

				};

			} );

		}

		return this.isSupported;

	}

}

/**
 * AVIF Texture Extension
 *
 * Specification: https://github.com/KhronosGroup/glTF/tree/master/extensions/2.0/Vendor/EXT_texture_avif
 */
class GLTFTextureAVIFExtension {

	constructor( parser ) {

		this.parser = parser;
		this.name = EXTENSIONS.EXT_TEXTURE_AVIF;
		this.isSupported = null;

	}

	loadTexture( textureIndex ) {

		const name = this.name;
		const parser = this.parser;
		const json = parser.json;

		const textureDef = json.textures[ textureIndex ];

		if ( ! textureDef.extensions || ! textureDef.extensions[ name ] ) {

			return null;

		}

		const extension = textureDef.extensions[ name ];
		const source = json.images[ extension.source ];

		let loader = parser.textureLoader;
		if ( source.uri ) {

			const handler = parser.options.manager.getHandler( source.uri );
			if ( handler !== null ) loader = handler;

		}

		return this.detectSupport().then( function ( isSupported ) {

			if ( isSupported ) return parser.loadTextureImage( textureIndex, extension.source, loader );

			if ( json.extensionsRequired && json.extensionsRequired.indexOf( name ) >= 0 ) {

				throw new Error( 'THREE.GLTFLoader: AVIF required by asset but unsupported.' );

			}

			// Fall back to PNG or JPEG.
			return parser.loadTexture( textureIndex );

		} );

	}

	detectSupport() {

		if ( ! this.isSupported ) {

			this.isSupported = new Promise( function ( resolve ) {

				const image = new Image();

				// Lossy test image.
				image.src = 'data:image/avif;base64,AAAAIGZ0eXBhdmlmAAAAAGF2aWZtaWYxbWlhZk1BMUIAAADybWV0YQAAAAAAAAAoaGRscgAAAAAAAAAAcGljdAAAAAAAAAAAAAAAAGxpYmF2aWYAAAAADnBpdG0AAAAAAAEAAAAeaWxvYwAAAABEAAABAAEAAAABAAABGgAAABcAAAAoaWluZgAAAAAAAQAAABppbmZlAgAAAAABAABhdjAxQ29sb3IAAAAAamlwcnAAAABLaXBjbwAAABRpc3BlAAAAAAAAAAEAAAABAAAAEHBpeGkAAAAAAwgICAAAAAxhdjFDgQAMAAAAABNjb2xybmNseAACAAIABoAAAAAXaXBtYQAAAAAAAAABAAEEAQKDBAAAAB9tZGF0EgAKCBgABogQEDQgMgkQAAAAB8dSLfI=';
				image.onload = image.onerror = function () {

					resolve( image.height === 1 );

				};

			} );

		}

		return this.isSupported;

	}

}

/**
 * meshopt BufferView Compression Extension
 *
 * Specification: https://github.com/KhronosGroup/glTF/tree/master/extensions/2.0/Vendor/EXT_meshopt_compression
 */
class GLTFMeshoptCompression {

	constructor( parser ) {

		this.name = EXTENSIONS.EXT_MESHOPT_COMPRESSION;
		this.parser = parser;

	}

	loadBufferView( index ) {

		const json = this.parser.json;
		const bufferView = json.bufferViews[ index ];

		if ( bufferView.extensions && bufferView.extensions[ this.name ] ) {

			const extensionDef = bufferView.extensions[ this.name ];

			const buffer = this.parser.getDependency( 'buffer', extensionDef.buffer );
			const decoder = this.parser.options.meshoptDecoder;

			if ( ! decoder || ! decoder.supported ) {

				if ( json.extensionsRequired && json.extensionsRequired.indexOf( this.name ) >= 0 ) {

					throw new Error( 'THREE.GLTFLoader: setMeshoptDecoder must be called before loading compressed files' );

				} else {

					// Assumes that the extension is optional and that fallback buffer data is present
					return null;

				}

			}

			return buffer.then( function ( res ) {

				const byteOffset = extensionDef.byteOffset || 0;
				const byteLength = extensionDef.byteLength || 0;

				const count = extensionDef.count;
				const stride = extensionDef.byteStride;

				const source = new Uint8Array( res, byteOffset, byteLength );

				if ( decoder.decodeGltfBufferAsync ) {

					return decoder.decodeGltfBufferAsync( count, stride, source, extensionDef.mode, extensionDef.filter ).then( function ( res ) {

						return res.buffer;

					} );

				} else {

					// Support for MeshoptDecoder 0.18 or earlier, without decodeGltfBufferAsync
					return decoder.ready.then( function () {

						const result = new ArrayBuffer( count * stride );
						decoder.decodeGltfBuffer( new Uint8Array( result ), count, stride, source, extensionDef.mode, extensionDef.filter );
						return result;

					} );

				}

			} );

		} else {

			return null;

		}

	}

}

/**
 * GPU Instancing Extension
 *
 * Specification: https://github.com/KhronosGroup/glTF/tree/master/extensions/2.0/Vendor/EXT_mesh_gpu_instancing
 *
 */
class GLTFMeshGpuInstancing {

	constructor( parser ) {

		this.name = EXTENSIONS.EXT_MESH_GPU_INSTANCING;
		this.parser = parser;

	}

	createNodeMesh( nodeIndex ) {

		const json = this.parser.json;
		const nodeDef = json.nodes[ nodeIndex ];

		if ( ! nodeDef.extensions || ! nodeDef.extensions[ this.name ] ||
			nodeDef.mesh === undefined ) {

			return null;

		}

		const meshDef = json.meshes[ nodeDef.mesh ];

		// No Points or Lines + Instancing support yet

		for ( const primitive of meshDef.primitives ) {

			if ( primitive.mode !== WEBGL_CONSTANTS.TRIANGLES &&
				 primitive.mode !== WEBGL_CONSTANTS.TRIANGLE_STRIP &&
				 primitive.mode !== WEBGL_CONSTANTS.TRIANGLE_FAN &&
				 primitive.mode !== undefined ) {

				return null;

			}

		}

		const extensionDef = nodeDef.extensions[ this.name ];
		const attributesDef = extensionDef.attributes;

		// @TODO: Can we support InstancedMesh + SkinnedMesh?

		const pending = [];
		const attributes = {};

		for ( const key in attributesDef ) {

			pending.push( this.parser.getDependency( 'accessor', attributesDef[ key ] ).then( accessor => {

				attributes[ key ] = accessor;
				return attributes[ key ];

			} ) );

		}

		if ( pending.length < 1 ) {

			return null;

		}

		pending.push( this.parser.createNodeMesh( nodeIndex ) );

		return Promise.all( pending ).then( results => {

			const nodeObject = results.pop();
			const meshes = nodeObject.isGroup ? nodeObject.children : [ nodeObject ];
			const count = results[ 0 ].count; // All attribute counts should be same
			const instancedMeshes = [];

			for ( const mesh of meshes ) {

				// Temporal variables
				const m = new Matrix4();
				const p = new Vector3();
				const q = new Quaternion();
				const s = new Vector3( 1, 1, 1 );

				const instancedMesh = new InstancedMesh( mesh.geometry, mesh.material, count );

				for ( let i = 0; i < count; i ++ ) {

					if ( attributes.TRANSLATION ) {

						p.fromBufferAttribute( attributes.TRANSLATION, i );

					}

					if ( attributes.ROTATION ) {

						q.fromBufferAttribute( attributes.ROTATION, i );

					}

					if ( attributes.SCALE ) {

						s.fromBufferAttribute( attributes.SCALE, i );

					}

					instancedMesh.setMatrixAt( i, m.compose( p, q, s ) );

				}

				// Add instance attributes to the geometry, excluding TRS.
				for ( const attributeName in attributes ) {

					if ( attributeName === '_COLOR_0' ) {

						const attr = attributes[ attributeName ];
						instancedMesh.instanceColor = new InstancedBufferAttribute( attr.array, attr.itemSize, attr.normalized );

					} else if ( attributeName !== 'TRANSLATION' &&
						 attributeName !== 'ROTATION' &&
						 attributeName !== 'SCALE' ) {

						mesh.geometry.setAttribute( attributeName, attributes[ attributeName ] );

					}

				}

				// Just in case
				Object3D.prototype.copy.call( instancedMesh, mesh );

				this.parser.assignFinalMaterial( instancedMesh );

				instancedMeshes.push( instancedMesh );

			}

			if ( nodeObject.isGroup ) {

				nodeObject.clear();

				nodeObject.add( ... instancedMeshes );

				return nodeObject;

			}

			return instancedMeshes[ 0 ];

		} );

	}

}

/* BINARY EXTENSION */
const BINARY_EXTENSION_HEADER_MAGIC = 'glTF';
const BINARY_EXTENSION_HEADER_LENGTH = 12;
const BINARY_EXTENSION_CHUNK_TYPES = { JSON: 0x4E4F534A, BIN: 0x004E4942 };

class GLTFBinaryExtension {

	constructor( data ) {

		this.name = EXTENSIONS.KHR_BINARY_GLTF;
		this.content = null;
		this.body = null;

		const headerView = new DataView( data, 0, BINARY_EXTENSION_HEADER_LENGTH );
		const textDecoder = new TextDecoder();

		this.header = {
			magic: textDecoder.decode( new Uint8Array( data.slice( 0, 4 ) ) ),
			version: headerView.getUint32( 4, true ),
			length: headerView.getUint32( 8, true )
		};

		if ( this.header.magic !== BINARY_EXTENSION_HEADER_MAGIC ) {

			throw new Error( 'THREE.GLTFLoader: Unsupported glTF-Binary header.' );

		} else if ( this.header.version < 2.0 ) {

			throw new Error( 'THREE.GLTFLoader: Legacy binary file detected.' );

		}

		const chunkContentsLength = this.header.length - BINARY_EXTENSION_HEADER_LENGTH;
		const chunkView = new DataView( data, BINARY_EXTENSION_HEADER_LENGTH );
		let chunkIndex = 0;

		while ( chunkIndex < chunkContentsLength ) {

			const chunkLength = chunkView.getUint32( chunkIndex, true );
			chunkIndex += 4;

			const chunkType = chunkView.getUint32( chunkIndex, true );
			chunkIndex += 4;

			if ( chunkType === BINARY_EXTENSION_CHUNK_TYPES.JSON ) {

				const contentArray = new Uint8Array( data, BINARY_EXTENSION_HEADER_LENGTH + chunkIndex, chunkLength );
				this.content = textDecoder.decode( contentArray );

			} else if ( chunkType === BINARY_EXTENSION_CHUNK_TYPES.BIN ) {

				const byteOffset = BINARY_EXTENSION_HEADER_LENGTH + chunkIndex;
				this.body = data.slice( byteOffset, byteOffset + chunkLength );

			}

			// Clients must ignore chunks with unknown types.

			chunkIndex += chunkLength;

		}

		if ( this.content === null ) {

			throw new Error( 'THREE.GLTFLoader: JSON content not found.' );

		}

	}

}

/**
 * DRACO Mesh Compression Extension
 *
 * Specification: https://github.com/KhronosGroup/glTF/tree/master/extensions/2.0/Khronos/KHR_draco_mesh_compression
 */
class GLTFDracoMeshCompressionExtension {

	constructor( json, dracoLoader ) {

		if ( ! dracoLoader ) {

			throw new Error( 'THREE.GLTFLoader: No DRACOLoader instance provided.' );

		}

		this.name = EXTENSIONS.KHR_DRACO_MESH_COMPRESSION;
		this.json = json;
		this.dracoLoader = dracoLoader;
		this.dracoLoader.preload();

	}

	decodePrimitive( primitive, parser ) {

		const json = this.json;
		const dracoLoader = this.dracoLoader;
		const bufferViewIndex = primitive.extensions[ this.name ].bufferView;
		const gltfAttributeMap = primitive.extensions[ this.name ].attributes;
		const threeAttributeMap = {};
		const attributeNormalizedMap = {};
		const attributeTypeMap = {};

		for ( const attributeName in gltfAttributeMap ) {

			const threeAttributeName = ATTRIBUTES[ attributeName ] || attributeName.toLowerCase();

			threeAttributeMap[ threeAttributeName ] = gltfAttributeMap[ attributeName ];

		}

		for ( const attributeName in primitive.attributes ) {

			const threeAttributeName = ATTRIBUTES[ attributeName ] || attributeName.toLowerCase();

			if ( gltfAttributeMap[ attributeName ] !== undefined ) {

				const accessorDef = json.accessors[ primitive.attributes[ attributeName ] ];
				const componentType = WEBGL_COMPONENT_TYPES[ accessorDef.componentType ];

				attributeTypeMap[ threeAttributeName ] = componentType.name;
				attributeNormalizedMap[ threeAttributeName ] = accessorDef.normalized === true;

			}

		}

		return parser.getDependency( 'bufferView', bufferViewIndex ).then( function ( bufferView ) {

			return new Promise( function ( resolve, reject ) {

				dracoLoader.decodeDracoFile( bufferView, function ( geometry ) {

					for ( const attributeName in geometry.attributes ) {

						const attribute = geometry.attributes[ attributeName ];
						const normalized = attributeNormalizedMap[ attributeName ];

						if ( normalized !== undefined ) attribute.normalized = normalized;

					}

					resolve( geometry );

				}, threeAttributeMap, attributeTypeMap, LinearSRGBColorSpace, reject );

			} );

		} );

	}

}

/**
 * Texture Transform Extension
 *
 * Specification: https://github.com/KhronosGroup/glTF/tree/master/extensions/2.0/Khronos/KHR_texture_transform
 */
class GLTFTextureTransformExtension {

	constructor() {

		this.name = EXTENSIONS.KHR_TEXTURE_TRANSFORM;

	}

	extendTexture( texture, transform ) {

		if ( ( transform.texCoord === undefined || transform.texCoord === texture.channel )
			&& transform.offset === undefined
			&& transform.rotation === undefined
			&& transform.scale === undefined ) {

			// See https://github.com/mrdoob/three.js/issues/21819.
			return texture;

		}

		texture = texture.clone();

		if ( transform.texCoord !== undefined ) {

			texture.channel = transform.texCoord;

		}

		if ( transform.offset !== undefined ) {

			texture.offset.fromArray( transform.offset );

		}

		if ( transform.rotation !== undefined ) {

			texture.rotation = transform.rotation;

		}

		if ( transform.scale !== undefined ) {

			texture.repeat.fromArray( transform.scale );

		}

		texture.needsUpdate = true;

		return texture;

	}

}

/**
 * Mesh Quantization Extension
 *
 * Specification: https://github.com/KhronosGroup/glTF/tree/master/extensions/2.0/Khronos/KHR_mesh_quantization
 */
class GLTFMeshQuantizationExtension {

	constructor() {

		this.name = EXTENSIONS.KHR_MESH_QUANTIZATION;

	}

}

/*********************************/
/********** INTERPOLATION ********/
/*********************************/

// Spline Interpolation
// Specification: https://github.com/KhronosGroup/glTF/blob/master/specification/2.0/README.md#appendix-c-spline-interpolation
class GLTFCubicSplineInterpolant extends Interpolant {

	constructor( parameterPositions, sampleValues, sampleSize, resultBuffer ) {

		super( parameterPositions, sampleValues, sampleSize, resultBuffer );

	}

	copySampleValue_( index ) {

		// Copies a sample value to the result buffer. See description of glTF
		// CUBICSPLINE values layout in interpolate_() function below.

		const result = this.resultBuffer,
			values = this.sampleValues,
			valueSize = this.valueSize,
			offset = index * valueSize * 3 + valueSize;

		for ( let i = 0; i !== valueSize; i ++ ) {

			result[ i ] = values[ offset + i ];

		}

		return result;

	}

	interpolate_( i1, t0, t, t1 ) {

		const result = this.resultBuffer;
		const values = this.sampleValues;
		const stride = this.valueSize;

		const stride2 = stride * 2;
		const stride3 = stride * 3;

		const td = t1 - t0;

		const p = ( t - t0 ) / td;
		const pp = p * p;
		const ppp = pp * p;

		const offset1 = i1 * stride3;
		const offset0 = offset1 - stride3;

		const s2 = - 2 * ppp + 3 * pp;
		const s3 = ppp - pp;
		const s0 = 1 - s2;
		const s1 = s3 - pp + p;

		// Layout of keyframe output values for CUBICSPLINE animations:
		//   [ inTangent_1, splineVertex_1, outTangent_1, inTangent_2, splineVertex_2, ... ]
		for ( let i = 0; i !== stride; i ++ ) {

			const p0 = values[ offset0 + i + stride ]; // splineVertex_k
			const m0 = values[ offset0 + i + stride2 ] * td; // outTangent_k * (t_k+1 - t_k)
			const p1 = values[ offset1 + i + stride ]; // splineVertex_k+1
			const m1 = values[ offset1 + i ] * td; // inTangent_k+1 * (t_k+1 - t_k)

			result[ i ] = s0 * p0 + s1 * m0 + s2 * p1 + s3 * m1;

		}

		return result;

	}

}

const _q = new Quaternion();

class GLTFCubicSplineQuaternionInterpolant extends GLTFCubicSplineInterpolant {

	interpolate_( i1, t0, t, t1 ) {

		const result = super.interpolate_( i1, t0, t, t1 );

		_q.fromArray( result ).normalize().toArray( result );

		return result;

	}

}


/*********************************/
/********** INTERNALS ************/
/*********************************/

/* CONSTANTS */

const WEBGL_CONSTANTS = {
	FLOAT: 5126,
	//FLOAT_MAT2: 35674,
	FLOAT_MAT3: 35675,
	FLOAT_MAT4: 35676,
	FLOAT_VEC2: 35664,
	FLOAT_VEC3: 35665,
	FLOAT_VEC4: 35666,
	LINEAR: 9729,
	REPEAT: 10497,
	SAMPLER_2D: 35678,
	POINTS: 0,
	LINES: 1,
	LINE_LOOP: 2,
	LINE_STRIP: 3,
	TRIANGLES: 4,
	TRIANGLE_STRIP: 5,
	TRIANGLE_FAN: 6,
	UNSIGNED_BYTE: 5121,
	UNSIGNED_SHORT: 5123
};

const WEBGL_COMPONENT_TYPES = {
	5120: Int8Array,
	5121: Uint8Array,
	5122: Int16Array,
	5123: Uint16Array,
	5125: Uint32Array,
	5126: Float32Array
};

const WEBGL_FILTERS = {
	9728: NearestFilter,
	9729: LinearFilter,
	9984: NearestMipmapNearestFilter,
	9985: LinearMipmapNearestFilter,
	9986: NearestMipmapLinearFilter,
	9987: LinearMipmapLinearFilter
};

const WEBGL_WRAPPINGS = {
	33071: ClampToEdgeWrapping,
	33648: MirroredRepeatWrapping,
	10497: RepeatWrapping
};

const WEBGL_TYPE_SIZES = {
	'SCALAR': 1,
	'VEC2': 2,
	'VEC3': 3,
	'VEC4': 4,
	'MAT2': 4,
	'MAT3': 9,
	'MAT4': 16
};

const ATTRIBUTES = {
	POSITION: 'position',
	NORMAL: 'normal',
	TANGENT: 'tangent',
	TEXCOORD_0: 'uv',
	TEXCOORD_1: 'uv1',
	TEXCOORD_2: 'uv2',
	TEXCOORD_3: 'uv3',
	COLOR_0: 'color',
	WEIGHTS_0: 'skinWeight',
	JOINTS_0: 'skinIndex',
};

const PATH_PROPERTIES = {
	scale: 'scale',
	translation: 'position',
	rotation: 'quaternion',
	weights: 'morphTargetInfluences'
};

const INTERPOLATION = {
	CUBICSPLINE: undefined, // We use a custom interpolant (GLTFCubicSplineInterpolation) for CUBICSPLINE tracks. Each
		                        // keyframe track will be initialized with a default interpolation type, then modified.
	LINEAR: InterpolateLinear,
	STEP: InterpolateDiscrete
};

const ALPHA_MODES = {
	OPAQUE: 'OPAQUE',
	MASK: 'MASK',
	BLEND: 'BLEND'
};

/**
 * Specification: https://github.com/KhronosGroup/glTF/blob/master/specification/2.0/README.md#default-material
 */
function createDefaultMaterial( cache ) {

	if ( cache[ 'DefaultMaterial' ] === undefined ) {

		cache[ 'DefaultMaterial' ] = new MeshStandardMaterial( {
			color: 0xFFFFFF,
			emissive: 0x000000,
			metalness: 1,
			roughness: 1,
			transparent: false,
			depthTest: true,
			side: FrontSide
		} );

	}

	return cache[ 'DefaultMaterial' ];

}

function addUnknownExtensionsToUserData( knownExtensions, object, objectDef ) {

	// Add unknown glTF extensions to an object's userData.

	for ( const name in objectDef.extensions ) {

		if ( knownExtensions[ name ] === undefined ) {

			object.userData.gltfExtensions = object.userData.gltfExtensions || {};
			object.userData.gltfExtensions[ name ] = objectDef.extensions[ name ];

		}

	}

}

/**
 * @param {Object3D|Material|BufferGeometry} object
 * @param {GLTF.definition} gltfDef
 */
function assignExtrasToUserData( object, gltfDef ) {

	if ( gltfDef.extras !== undefined ) {

		if ( typeof gltfDef.extras === 'object' ) {

			Object.assign( object.userData, gltfDef.extras );

		} else {

			console.warn( 'THREE.GLTFLoader: Ignoring primitive type .extras, ' + gltfDef.extras );

		}

	}

}

/**
 * Specification: https://github.com/KhronosGroup/glTF/blob/master/specification/2.0/README.md#morph-targets
 *
 * @param {BufferGeometry} geometry
 * @param {Array<GLTF.Target>} targets
 * @param {GLTFParser} parser
 * @return {Promise<BufferGeometry>}
 */
function addMorphTargets( geometry, targets, parser ) {

	let hasMorphPosition = false;
	let hasMorphNormal = false;
	let hasMorphColor = false;

	for ( let i = 0, il = targets.length; i < il; i ++ ) {

		const target = targets[ i ];

		if ( target.POSITION !== undefined ) hasMorphPosition = true;
		if ( target.NORMAL !== undefined ) hasMorphNormal = true;
		if ( target.COLOR_0 !== undefined ) hasMorphColor = true;

		if ( hasMorphPosition && hasMorphNormal && hasMorphColor ) break;

	}

	if ( ! hasMorphPosition && ! hasMorphNormal && ! hasMorphColor ) return Promise.resolve( geometry );

	const pendingPositionAccessors = [];
	const pendingNormalAccessors = [];
	const pendingColorAccessors = [];

	for ( let i = 0, il = targets.length; i < il; i ++ ) {

		const target = targets[ i ];

		if ( hasMorphPosition ) {

			const pendingAccessor = target.POSITION !== undefined
				? parser.getDependency( 'accessor', target.POSITION )
				: geometry.attributes.position;

			pendingPositionAccessors.push( pendingAccessor );

		}

		if ( hasMorphNormal ) {

			const pendingAccessor = target.NORMAL !== undefined
				? parser.getDependency( 'accessor', target.NORMAL )
				: geometry.attributes.normal;

			pendingNormalAccessors.push( pendingAccessor );

		}

		if ( hasMorphColor ) {

			const pendingAccessor = target.COLOR_0 !== undefined
				? parser.getDependency( 'accessor', target.COLOR_0 )
				: geometry.attributes.color;

			pendingColorAccessors.push( pendingAccessor );

		}

	}

	return Promise.all( [
		Promise.all( pendingPositionAccessors ),
		Promise.all( pendingNormalAccessors ),
		Promise.all( pendingColorAccessors )
	] ).then( function ( accessors ) {

		const morphPositions = accessors[ 0 ];
		const morphNormals = accessors[ 1 ];
		const morphColors = accessors[ 2 ];

		if ( hasMorphPosition ) geometry.morphAttributes.position = morphPositions;
		if ( hasMorphNormal ) geometry.morphAttributes.normal = morphNormals;
		if ( hasMorphColor ) geometry.morphAttributes.color = morphColors;
		geometry.morphTargetsRelative = true;

		return geometry;

	} );

}

/**
 * @param {Mesh} mesh
 * @param {GLTF.Mesh} meshDef
 */
function updateMorphTargets( mesh, meshDef ) {

	mesh.updateMorphTargets();

	if ( meshDef.weights !== undefined ) {

		for ( let i = 0, il = meshDef.weights.length; i < il; i ++ ) {

			mesh.morphTargetInfluences[ i ] = meshDef.weights[ i ];

		}

	}

	// .extras has user-defined data, so check that .extras.targetNames is an array.
	if ( meshDef.extras && Array.isArray( meshDef.extras.targetNames ) ) {

		const targetNames = meshDef.extras.targetNames;

		if ( mesh.morphTargetInfluences.length === targetNames.length ) {

			mesh.morphTargetDictionary = {};

			for ( let i = 0, il = targetNames.length; i < il; i ++ ) {

				mesh.morphTargetDictionary[ targetNames[ i ] ] = i;

			}

		} else {

			console.warn( 'THREE.GLTFLoader: Invalid extras.targetNames length. Ignoring names.' );

		}

	}

}

function createPrimitiveKey( primitiveDef ) {

	let geometryKey;

	const dracoExtension = primitiveDef.extensions && primitiveDef.extensions[ EXTENSIONS.KHR_DRACO_MESH_COMPRESSION ];

	if ( dracoExtension ) {

		geometryKey = 'draco:' + dracoExtension.bufferView
				+ ':' + dracoExtension.indices
				+ ':' + createAttributesKey( dracoExtension.attributes );

	} else {

		geometryKey = primitiveDef.indices + ':' + createAttributesKey( primitiveDef.attributes ) + ':' + primitiveDef.mode;

	}

	if ( primitiveDef.targets !== undefined ) {

		for ( let i = 0, il = primitiveDef.targets.length; i < il; i ++ ) {

			geometryKey += ':' + createAttributesKey( primitiveDef.targets[ i ] );

		}

	}

	return geometryKey;

}

function createAttributesKey( attributes ) {

	let attributesKey = '';

	const keys = Object.keys( attributes ).sort();

	for ( let i = 0, il = keys.length; i < il; i ++ ) {

		attributesKey += keys[ i ] + ':' + attributes[ keys[ i ] ] + ';';

	}

	return attributesKey;

}

function getNormalizedComponentScale( constructor ) {

	// Reference:
	// https://github.com/KhronosGroup/glTF/tree/master/extensions/2.0/Khronos/KHR_mesh_quantization#encoding-quantized-data

	switch ( constructor ) {

		case Int8Array:
			return 1 / 127;

		case Uint8Array:
			return 1 / 255;

		case Int16Array:
			return 1 / 32767;

		case Uint16Array:
			return 1 / 65535;

		default:
			throw new Error( 'THREE.GLTFLoader: Unsupported normalized accessor component type.' );

	}

}

function getImageURIMimeType( uri ) {

	if ( uri.search( /\.jpe?g($|\?)/i ) > 0 || uri.search( /^data\:image\/jpeg/ ) === 0 ) return 'image/jpeg';
	if ( uri.search( /\.webp($|\?)/i ) > 0 || uri.search( /^data\:image\/webp/ ) === 0 ) return 'image/webp';

	return 'image/png';

}

const _identityMatrix = new Matrix4();

/* GLTF PARSER */

class GLTFParser {

	constructor( json = {}, options = {} ) {

		this.json = json;
		this.extensions = {};
		this.plugins = {};
		this.options = options;

		// loader object cache
		this.cache = new GLTFRegistry();

		// associations between Three.js objects and glTF elements
		this.associations = new Map();

		// BufferGeometry caching
		this.primitiveCache = {};

		// Node cache
		this.nodeCache = {};

		// Object3D instance caches
		this.meshCache = { refs: {}, uses: {} };
		this.cameraCache = { refs: {}, uses: {} };
		this.lightCache = { refs: {}, uses: {} };

		this.sourceCache = {};
		this.textureCache = {};

		// Track node names, to ensure no duplicates
		this.nodeNamesUsed = {};

		// Use an ImageBitmapLoader if imageBitmaps are supported. Moves much of the
		// expensive work of uploading a texture to the GPU off the main thread.

		let isSafari = false;
		let isFirefox = false;
		let firefoxVersion = - 1;

		if ( typeof navigator !== 'undefined' ) {

			isSafari = /^((?!chrome|android).)*safari/i.test( navigator.userAgent ) === true;
			isFirefox = navigator.userAgent.indexOf( 'Firefox' ) > - 1;
			firefoxVersion = isFirefox ? navigator.userAgent.match( /Firefox\/([0-9]+)\./ )[ 1 ] : - 1;

		}

		if ( typeof createImageBitmap === 'undefined' || isSafari || ( isFirefox && firefoxVersion < 98 ) ) {

			this.textureLoader = new TextureLoader( this.options.manager );

		} else {

			this.textureLoader = new ImageBitmapLoader( this.options.manager );

		}

		this.textureLoader.setCrossOrigin( this.options.crossOrigin );
		this.textureLoader.setRequestHeader( this.options.requestHeader );

		this.fileLoader = new FileLoader( this.options.manager );
		this.fileLoader.setResponseType( 'arraybuffer' );

		if ( this.options.crossOrigin === 'use-credentials' ) {

			this.fileLoader.setWithCredentials( true );

		}

	}

	setExtensions( extensions ) {

		this.extensions = extensions;

	}

	setPlugins( plugins ) {

		this.plugins = plugins;

	}

	parse( onLoad, onError ) {

		const parser = this;
		const json = this.json;
		const extensions = this.extensions;

		// Clear the loader cache
		this.cache.removeAll();
		this.nodeCache = {};

		// Mark the special nodes/meshes in json for efficient parse
		this._invokeAll( function ( ext ) {

			return ext._markDefs && ext._markDefs();

		} );

		Promise.all( this._invokeAll( function ( ext ) {

			return ext.beforeRoot && ext.beforeRoot();

		} ) ).then( function () {

			return Promise.all( [

				parser.getDependencies( 'scene' ),
				parser.getDependencies( 'animation' ),
				parser.getDependencies( 'camera' ),

			] );

		} ).then( function ( dependencies ) {

			const result = {
				scene: dependencies[ 0 ][ json.scene || 0 ],
				scenes: dependencies[ 0 ],
				animations: dependencies[ 1 ],
				cameras: dependencies[ 2 ],
				asset: json.asset,
				parser: parser,
				userData: {}
			};

			addUnknownExtensionsToUserData( extensions, result, json );

			assignExtrasToUserData( result, json );

			return Promise.all( parser._invokeAll( function ( ext ) {

				return ext.afterRoot && ext.afterRoot( result );

			} ) ).then( function () {

				onLoad( result );

			} );

		} ).catch( onError );

	}

	/**
	 * Marks the special nodes/meshes in json for efficient parse.
	 */
	_markDefs() {

		const nodeDefs = this.json.nodes || [];
		const skinDefs = this.json.skins || [];
		const meshDefs = this.json.meshes || [];

		// Nothing in the node definition indicates whether it is a Bone or an
		// Object3D. Use the skins' joint references to mark bones.
		for ( let skinIndex = 0, skinLength = skinDefs.length; skinIndex < skinLength; skinIndex ++ ) {

			const joints = skinDefs[ skinIndex ].joints;

			for ( let i = 0, il = joints.length; i < il; i ++ ) {

				nodeDefs[ joints[ i ] ].isBone = true;

			}

		}

		// Iterate over all nodes, marking references to shared resources,
		// as well as skeleton joints.
		for ( let nodeIndex = 0, nodeLength = nodeDefs.length; nodeIndex < nodeLength; nodeIndex ++ ) {

			const nodeDef = nodeDefs[ nodeIndex ];

			if ( nodeDef.mesh !== undefined ) {

				this._addNodeRef( this.meshCache, nodeDef.mesh );

				// Nothing in the mesh definition indicates whether it is
				// a SkinnedMesh or Mesh. Use the node's mesh reference
				// to mark SkinnedMesh if node has skin.
				if ( nodeDef.skin !== undefined ) {

					meshDefs[ nodeDef.mesh ].isSkinnedMesh = true;

				}

			}

			if ( nodeDef.camera !== undefined ) {

				this._addNodeRef( this.cameraCache, nodeDef.camera );

			}

		}

	}

	/**
	 * Counts references to shared node / Object3D resources. These resources
	 * can be reused, or "instantiated", at multiple nodes in the scene
	 * hierarchy. Mesh, Camera, and Light instances are instantiated and must
	 * be marked. Non-scenegraph resources (like Materials, Geometries, and
	 * Textures) can be reused directly and are not marked here.
	 *
	 * Example: CesiumMilkTruck sample model reuses "Wheel" meshes.
	 */
	_addNodeRef( cache, index ) {

		if ( index === undefined ) return;

		if ( cache.refs[ index ] === undefined ) {

			cache.refs[ index ] = cache.uses[ index ] = 0;

		}

		cache.refs[ index ] ++;

	}

	/** Returns a reference to a shared resource, cloning it if necessary. */
	_getNodeRef( cache, index, object ) {

		if ( cache.refs[ index ] <= 1 ) return object;

		const ref = object.clone();

		// Propagates mappings to the cloned object, prevents mappings on the
		// original object from being lost.
		const updateMappings = ( original, clone ) => {

			const mappings = this.associations.get( original );
			if ( mappings != null ) {

				this.associations.set( clone, mappings );

			}

			for ( const [ i, child ] of original.children.entries() ) {

				updateMappings( child, clone.children[ i ] );

			}

		};

		updateMappings( object, ref );

		ref.name += '_instance_' + ( cache.uses[ index ] ++ );

		return ref;

	}

	_invokeOne( func ) {

		const extensions = Object.values( this.plugins );
		extensions.push( this );

		for ( let i = 0; i < extensions.length; i ++ ) {

			const result = func( extensions[ i ] );

			if ( result ) return result;

		}

		return null;

	}

	_invokeAll( func ) {

		const extensions = Object.values( this.plugins );
		extensions.unshift( this );

		const pending = [];

		for ( let i = 0; i < extensions.length; i ++ ) {

			const result = func( extensions[ i ] );

			if ( result ) pending.push( result );

		}

		return pending;

	}

	/**
	 * Requests the specified dependency asynchronously, with caching.
	 * @param {string} type
	 * @param {number} index
	 * @return {Promise<Object3D|Material|THREE.Texture|AnimationClip|ArrayBuffer|Object>}
	 */
	getDependency( type, index ) {

		const cacheKey = type + ':' + index;
		let dependency = this.cache.get( cacheKey );

		if ( ! dependency ) {

			switch ( type ) {

				case 'scene':
					dependency = this.loadScene( index );
					break;

				case 'node':
					dependency = this._invokeOne( function ( ext ) {

						return ext.loadNode && ext.loadNode( index );

					} );
					break;

				case 'mesh':
					dependency = this._invokeOne( function ( ext ) {

						return ext.loadMesh && ext.loadMesh( index );

					} );
					break;

				case 'accessor':
					dependency = this.loadAccessor( index );
					break;

				case 'bufferView':
					dependency = this._invokeOne( function ( ext ) {

						return ext.loadBufferView && ext.loadBufferView( index );

					} );
					break;

				case 'buffer':
					dependency = this.loadBuffer( index );
					break;

				case 'material':
					dependency = this._invokeOne( function ( ext ) {

						return ext.loadMaterial && ext.loadMaterial( index );

					} );
					break;

				case 'texture':
					dependency = this._invokeOne( function ( ext ) {

						return ext.loadTexture && ext.loadTexture( index );

					} );
					break;

				case 'skin':
					dependency = this.loadSkin( index );
					break;

				case 'animation':
					dependency = this._invokeOne( function ( ext ) {

						return ext.loadAnimation && ext.loadAnimation( index );

					} );
					break;

				case 'camera':
					dependency = this.loadCamera( index );
					break;

				default:
					dependency = this._invokeOne( function ( ext ) {

						return ext != this && ext.getDependency && ext.getDependency( type, index );

					} );

					if ( ! dependency ) {

						throw new Error( 'Unknown type: ' + type );

					}

					break;

			}

			this.cache.add( cacheKey, dependency );

		}

		return dependency;

	}

	/**
	 * Requests all dependencies of the specified type asynchronously, with caching.
	 * @param {string} type
	 * @return {Promise<Array<Object>>}
	 */
	getDependencies( type ) {

		let dependencies = this.cache.get( type );

		if ( ! dependencies ) {

			const parser = this;
			const defs = this.json[ type + ( type === 'mesh' ? 'es' : 's' ) ] || [];

			dependencies = Promise.all( defs.map( function ( def, index ) {

				return parser.getDependency( type, index );

			} ) );

			this.cache.add( type, dependencies );

		}

		return dependencies;

	}

	/**
	 * Specification: https://github.com/KhronosGroup/glTF/blob/master/specification/2.0/README.md#buffers-and-buffer-views
	 * @param {number} bufferIndex
	 * @return {Promise<ArrayBuffer>}
	 */
	loadBuffer( bufferIndex ) {

		const bufferDef = this.json.buffers[ bufferIndex ];
		const loader = this.fileLoader;

		if ( bufferDef.type && bufferDef.type !== 'arraybuffer' ) {

			throw new Error( 'THREE.GLTFLoader: ' + bufferDef.type + ' buffer type is not supported.' );

		}

		// If present, GLB container is required to be the first buffer.
		if ( bufferDef.uri === undefined && bufferIndex === 0 ) {

			return Promise.resolve( this.extensions[ EXTENSIONS.KHR_BINARY_GLTF ].body );

		}

		const options = this.options;

		return new Promise( function ( resolve, reject ) {

			loader.load( LoaderUtils.resolveURL( bufferDef.uri, options.path ), resolve, undefined, function () {

				reject( new Error( 'THREE.GLTFLoader: Failed to load buffer "' + bufferDef.uri + '".' ) );

			} );

		} );

	}

	/**
	 * Specification: https://github.com/KhronosGroup/glTF/blob/master/specification/2.0/README.md#buffers-and-buffer-views
	 * @param {number} bufferViewIndex
	 * @return {Promise<ArrayBuffer>}
	 */
	loadBufferView( bufferViewIndex ) {

		const bufferViewDef = this.json.bufferViews[ bufferViewIndex ];

		return this.getDependency( 'buffer', bufferViewDef.buffer ).then( function ( buffer ) {

			const byteLength = bufferViewDef.byteLength || 0;
			const byteOffset = bufferViewDef.byteOffset || 0;
			return buffer.slice( byteOffset, byteOffset + byteLength );

		} );

	}

	/**
	 * Specification: https://github.com/KhronosGroup/glTF/blob/master/specification/2.0/README.md#accessors
	 * @param {number} accessorIndex
	 * @return {Promise<BufferAttribute|InterleavedBufferAttribute>}
	 */
	loadAccessor( accessorIndex ) {

		const parser = this;
		const json = this.json;

		const accessorDef = this.json.accessors[ accessorIndex ];

		if ( accessorDef.bufferView === undefined && accessorDef.sparse === undefined ) {

			const itemSize = WEBGL_TYPE_SIZES[ accessorDef.type ];
			const TypedArray = WEBGL_COMPONENT_TYPES[ accessorDef.componentType ];
			const normalized = accessorDef.normalized === true;

			const array = new TypedArray( accessorDef.count * itemSize );
			return Promise.resolve( new BufferAttribute( array, itemSize, normalized ) );

		}

		const pendingBufferViews = [];

		if ( accessorDef.bufferView !== undefined ) {

			pendingBufferViews.push( this.getDependency( 'bufferView', accessorDef.bufferView ) );

		} else {

			pendingBufferViews.push( null );

		}

		if ( accessorDef.sparse !== undefined ) {

			pendingBufferViews.push( this.getDependency( 'bufferView', accessorDef.sparse.indices.bufferView ) );
			pendingBufferViews.push( this.getDependency( 'bufferView', accessorDef.sparse.values.bufferView ) );

		}

		return Promise.all( pendingBufferViews ).then( function ( bufferViews ) {

			const bufferView = bufferViews[ 0 ];

			const itemSize = WEBGL_TYPE_SIZES[ accessorDef.type ];
			const TypedArray = WEBGL_COMPONENT_TYPES[ accessorDef.componentType ];

			// For VEC3: itemSize is 3, elementBytes is 4, itemBytes is 12.
			const elementBytes = TypedArray.BYTES_PER_ELEMENT;
			const itemBytes = elementBytes * itemSize;
			const byteOffset = accessorDef.byteOffset || 0;
			const byteStride = accessorDef.bufferView !== undefined ? json.bufferViews[ accessorDef.bufferView ].byteStride : undefined;
			const normalized = accessorDef.normalized === true;
			let array, bufferAttribute;

			// The buffer is not interleaved if the stride is the item size in bytes.
			if ( byteStride && byteStride !== itemBytes ) {

				// Each "slice" of the buffer, as defined by 'count' elements of 'byteStride' bytes, gets its own InterleavedBuffer
				// This makes sure that IBA.count reflects accessor.count properly
				const ibSlice = Math.floor( byteOffset / byteStride );
				const ibCacheKey = 'InterleavedBuffer:' + accessorDef.bufferView + ':' + accessorDef.componentType + ':' + ibSlice + ':' + accessorDef.count;
				let ib = parser.cache.get( ibCacheKey );

				if ( ! ib ) {

					array = new TypedArray( bufferView, ibSlice * byteStride, accessorDef.count * byteStride / elementBytes );

					// Integer parameters to IB/IBA are in array elements, not bytes.
					ib = new InterleavedBuffer( array, byteStride / elementBytes );

					parser.cache.add( ibCacheKey, ib );

				}

				bufferAttribute = new InterleavedBufferAttribute( ib, itemSize, ( byteOffset % byteStride ) / elementBytes, normalized );

			} else {

				if ( bufferView === null ) {

					array = new TypedArray( accessorDef.count * itemSize );

				} else {

					array = new TypedArray( bufferView, byteOffset, accessorDef.count * itemSize );

				}

				bufferAttribute = new BufferAttribute( array, itemSize, normalized );

			}

			// https://github.com/KhronosGroup/glTF/blob/master/specification/2.0/README.md#sparse-accessors
			if ( accessorDef.sparse !== undefined ) {

				const itemSizeIndices = WEBGL_TYPE_SIZES.SCALAR;
				const TypedArrayIndices = WEBGL_COMPONENT_TYPES[ accessorDef.sparse.indices.componentType ];

				const byteOffsetIndices = accessorDef.sparse.indices.byteOffset || 0;
				const byteOffsetValues = accessorDef.sparse.values.byteOffset || 0;

				const sparseIndices = new TypedArrayIndices( bufferViews[ 1 ], byteOffsetIndices, accessorDef.sparse.count * itemSizeIndices );
				const sparseValues = new TypedArray( bufferViews[ 2 ], byteOffsetValues, accessorDef.sparse.count * itemSize );

				if ( bufferView !== null ) {

					// Avoid modifying the original ArrayBuffer, if the bufferView wasn't initialized with zeroes.
					bufferAttribute = new BufferAttribute( bufferAttribute.array.slice(), bufferAttribute.itemSize, bufferAttribute.normalized );

				}

				for ( let i = 0, il = sparseIndices.length; i < il; i ++ ) {

					const index = sparseIndices[ i ];

					bufferAttribute.setX( index, sparseValues[ i * itemSize ] );
					if ( itemSize >= 2 ) bufferAttribute.setY( index, sparseValues[ i * itemSize + 1 ] );
					if ( itemSize >= 3 ) bufferAttribute.setZ( index, sparseValues[ i * itemSize + 2 ] );
					if ( itemSize >= 4 ) bufferAttribute.setW( index, sparseValues[ i * itemSize + 3 ] );
					if ( itemSize >= 5 ) throw new Error( 'THREE.GLTFLoader: Unsupported itemSize in sparse BufferAttribute.' );

				}

			}

			return bufferAttribute;

		} );

	}

	/**
	 * Specification: https://github.com/KhronosGroup/glTF/tree/master/specification/2.0#textures
	 * @param {number} textureIndex
	 * @return {Promise<THREE.Texture|null>}
	 */
	loadTexture( textureIndex ) {

		const json = this.json;
		const options = this.options;
		const textureDef = json.textures[ textureIndex ];
		const sourceIndex = textureDef.source;
		const sourceDef = json.images[ sourceIndex ];

		let loader = this.textureLoader;

		if ( sourceDef.uri ) {

			const handler = options.manager.getHandler( sourceDef.uri );
			if ( handler !== null ) loader = handler;

		}

		return this.loadTextureImage( textureIndex, sourceIndex, loader );

	}

	loadTextureImage( textureIndex, sourceIndex, loader ) {

		const parser = this;
		const json = this.json;

		const textureDef = json.textures[ textureIndex ];
		const sourceDef = json.images[ sourceIndex ];

		const cacheKey = ( sourceDef.uri || sourceDef.bufferView ) + ':' + textureDef.sampler;

		if ( this.textureCache[ cacheKey ] ) {

			// See https://github.com/mrdoob/three.js/issues/21559.
			return this.textureCache[ cacheKey ];

		}

		const promise = this.loadImageSource( sourceIndex, loader ).then( function ( texture ) {

			texture.flipY = false;

			texture.name = textureDef.name || sourceDef.name || '';

			if ( texture.name === '' && typeof sourceDef.uri === 'string' && sourceDef.uri.startsWith( 'data:image/' ) === false ) {

				texture.name = sourceDef.uri;

			}

			const samplers = json.samplers || {};
			const sampler = samplers[ textureDef.sampler ] || {};

			texture.magFilter = WEBGL_FILTERS[ sampler.magFilter ] || LinearFilter;
			texture.minFilter = WEBGL_FILTERS[ sampler.minFilter ] || LinearMipmapLinearFilter;
			texture.wrapS = WEBGL_WRAPPINGS[ sampler.wrapS ] || RepeatWrapping;
			texture.wrapT = WEBGL_WRAPPINGS[ sampler.wrapT ] || RepeatWrapping;

			parser.associations.set( texture, { textures: textureIndex } );

			return texture;

		} ).catch( function () {

			return null;

		} );

		this.textureCache[ cacheKey ] = promise;

		return promise;

	}

	loadImageSource( sourceIndex, loader ) {

		const parser = this;
		const json = this.json;
		const options = this.options;

		if ( this.sourceCache[ sourceIndex ] !== undefined ) {

			return this.sourceCache[ sourceIndex ].then( ( texture ) => texture.clone() );

		}

		const sourceDef = json.images[ sourceIndex ];

		const URL = self.URL || self.webkitURL;

		let sourceURI = sourceDef.uri || '';
		let isObjectURL = false;

		if ( sourceDef.bufferView !== undefined ) {

			// Load binary image data from bufferView, if provided.

			sourceURI = parser.getDependency( 'bufferView', sourceDef.bufferView ).then( function ( bufferView ) {

				isObjectURL = true;
				const blob = new Blob( [ bufferView ], { type: sourceDef.mimeType } );
				sourceURI = URL.createObjectURL( blob );
				return sourceURI;

			} );

		} else if ( sourceDef.uri === undefined ) {

			throw new Error( 'THREE.GLTFLoader: Image ' + sourceIndex + ' is missing URI and bufferView' );

		}

		const promise = Promise.resolve( sourceURI ).then( function ( sourceURI ) {

			return new Promise( function ( resolve, reject ) {

				let onLoad = resolve;

				if ( loader.isImageBitmapLoader === true ) {

					onLoad = function ( imageBitmap ) {

						const texture = new Texture( imageBitmap );
						texture.needsUpdate = true;

						resolve( texture );

					};

				}

				loader.load( LoaderUtils.resolveURL( sourceURI, options.path ), onLoad, undefined, reject );

			} );

		} ).then( function ( texture ) {

			// Clean up resources and configure Texture.

			if ( isObjectURL === true ) {

				URL.revokeObjectURL( sourceURI );

			}

			texture.userData.mimeType = sourceDef.mimeType || getImageURIMimeType( sourceDef.uri );

			return texture;

		} ).catch( function ( error ) {

			console.error( 'THREE.GLTFLoader: Couldn\'t load texture', sourceURI );
			throw error;

		} );

		this.sourceCache[ sourceIndex ] = promise;
		return promise;

	}

	/**
	 * Asynchronously assigns a texture to the given material parameters.
	 * @param {Object} materialParams
	 * @param {string} mapName
	 * @param {Object} mapDef
	 * @return {Promise<Texture>}
	 */
	assignTexture( materialParams, mapName, mapDef, colorSpace ) {

		const parser = this;

		return this.getDependency( 'texture', mapDef.index ).then( function ( texture ) {

			if ( ! texture ) return null;

			if ( mapDef.texCoord !== undefined && mapDef.texCoord > 0 ) {

				texture = texture.clone();
				texture.channel = mapDef.texCoord;

			}

			if ( parser.extensions[ EXTENSIONS.KHR_TEXTURE_TRANSFORM ] ) {

				const transform = mapDef.extensions !== undefined ? mapDef.extensions[ EXTENSIONS.KHR_TEXTURE_TRANSFORM ] : undefined;

				if ( transform ) {

					const gltfReference = parser.associations.get( texture );
					texture = parser.extensions[ EXTENSIONS.KHR_TEXTURE_TRANSFORM ].extendTexture( texture, transform );
					parser.associations.set( texture, gltfReference );

				}

			}

			if ( colorSpace !== undefined ) {

				texture.colorSpace = colorSpace;

			}

			materialParams[ mapName ] = texture;

			return texture;

		} );

	}

	/**
	 * Assigns final material to a Mesh, Line, or Points instance. The instance
	 * already has a material (generated from the glTF material options alone)
	 * but reuse of the same glTF material may require multiple threejs materials
	 * to accommodate different primitive types, defines, etc. New materials will
	 * be created if necessary, and reused from a cache.
	 * @param  {Object3D} mesh Mesh, Line, or Points instance.
	 */
	assignFinalMaterial( mesh ) {

		const geometry = mesh.geometry;
		let material = mesh.material;

		const useDerivativeTangents = geometry.attributes.tangent === undefined;
		const useVertexColors = geometry.attributes.color !== undefined;
		const useFlatShading = geometry.attributes.normal === undefined;

		if ( mesh.isPoints ) {

			const cacheKey = 'PointsMaterial:' + material.uuid;

			let pointsMaterial = this.cache.get( cacheKey );

			if ( ! pointsMaterial ) {

				pointsMaterial = new PointsMaterial();
				Material.prototype.copy.call( pointsMaterial, material );
				pointsMaterial.color.copy( material.color );
				pointsMaterial.map = material.map;
				pointsMaterial.sizeAttenuation = false; // glTF spec says points should be 1px

				this.cache.add( cacheKey, pointsMaterial );

			}

			material = pointsMaterial;

		} else if ( mesh.isLine ) {

			const cacheKey = 'LineBasicMaterial:' + material.uuid;

			let lineMaterial = this.cache.get( cacheKey );

			if ( ! lineMaterial ) {

				lineMaterial = new LineBasicMaterial();
				Material.prototype.copy.call( lineMaterial, material );
				lineMaterial.color.copy( material.color );
				lineMaterial.map = material.map;

				this.cache.add( cacheKey, lineMaterial );

			}

			material = lineMaterial;

		}

		// Clone the material if it will be modified
		if ( useDerivativeTangents || useVertexColors || useFlatShading ) {

			let cacheKey = 'ClonedMaterial:' + material.uuid + ':';

			if ( useDerivativeTangents ) cacheKey += 'derivative-tangents:';
			if ( useVertexColors ) cacheKey += 'vertex-colors:';
			if ( useFlatShading ) cacheKey += 'flat-shading:';

			let cachedMaterial = this.cache.get( cacheKey );

			if ( ! cachedMaterial ) {

				cachedMaterial = material.clone();

				if ( useVertexColors ) cachedMaterial.vertexColors = true;
				if ( useFlatShading ) cachedMaterial.flatShading = true;

				if ( useDerivativeTangents ) {

					// https://github.com/mrdoob/three.js/issues/11438#issuecomment-507003995
					if ( cachedMaterial.normalScale ) cachedMaterial.normalScale.y *= - 1;
					if ( cachedMaterial.clearcoatNormalScale ) cachedMaterial.clearcoatNormalScale.y *= - 1;

				}

				this.cache.add( cacheKey, cachedMaterial );

				this.associations.set( cachedMaterial, this.associations.get( material ) );

			}

			material = cachedMaterial;

		}

		mesh.material = material;

	}

	getMaterialType( /* materialIndex */ ) {

		return MeshStandardMaterial;

	}

	/**
	 * Specification: https://github.com/KhronosGroup/glTF/blob/master/specification/2.0/README.md#materials
	 * @param {number} materialIndex
	 * @return {Promise<Material>}
	 */
	loadMaterial( materialIndex ) {

		const parser = this;
		const json = this.json;
		const extensions = this.extensions;
		const materialDef = json.materials[ materialIndex ];

		let materialType;
		const materialParams = {};
		const materialExtensions = materialDef.extensions || {};

		const pending = [];

		if ( materialExtensions[ EXTENSIONS.KHR_MATERIALS_UNLIT ] ) {

			const kmuExtension = extensions[ EXTENSIONS.KHR_MATERIALS_UNLIT ];
			materialType = kmuExtension.getMaterialType();
			pending.push( kmuExtension.extendParams( materialParams, materialDef, parser ) );

		} else {

			// Specification:
			// https://github.com/KhronosGroup/glTF/tree/master/specification/2.0#metallic-roughness-material

			const metallicRoughness = materialDef.pbrMetallicRoughness || {};

			materialParams.color = new Color( 1.0, 1.0, 1.0 );
			materialParams.opacity = 1.0;

			if ( Array.isArray( metallicRoughness.baseColorFactor ) ) {

				const array = metallicRoughness.baseColorFactor;

				materialParams.color.setRGB( array[ 0 ], array[ 1 ], array[ 2 ], LinearSRGBColorSpace );
				materialParams.opacity = array[ 3 ];

			}

			if ( metallicRoughness.baseColorTexture !== undefined ) {

				pending.push( parser.assignTexture( materialParams, 'map', metallicRoughness.baseColorTexture, SRGBColorSpace ) );

			}

			materialParams.metalness = metallicRoughness.metallicFactor !== undefined ? metallicRoughness.metallicFactor : 1.0;
			materialParams.roughness = metallicRoughness.roughnessFactor !== undefined ? metallicRoughness.roughnessFactor : 1.0;

			if ( metallicRoughness.metallicRoughnessTexture !== undefined ) {

				pending.push( parser.assignTexture( materialParams, 'metalnessMap', metallicRoughness.metallicRoughnessTexture ) );
				pending.push( parser.assignTexture( materialParams, 'roughnessMap', metallicRoughness.metallicRoughnessTexture ) );

			}

			materialType = this._invokeOne( function ( ext ) {

				return ext.getMaterialType && ext.getMaterialType( materialIndex );

			} );

			pending.push( Promise.all( this._invokeAll( function ( ext ) {

				return ext.extendMaterialParams && ext.extendMaterialParams( materialIndex, materialParams );

			} ) ) );

		}

		if ( materialDef.doubleSided === true ) {

			materialParams.side = DoubleSide;

		}

		const alphaMode = materialDef.alphaMode || ALPHA_MODES.OPAQUE;

		if ( alphaMode === ALPHA_MODES.BLEND ) {

			materialParams.transparent = true;

			// See: https://github.com/mrdoob/three.js/issues/17706
			materialParams.depthWrite = false;

		} else {

			materialParams.transparent = false;

			if ( alphaMode === ALPHA_MODES.MASK ) {

				materialParams.alphaTest = materialDef.alphaCutoff !== undefined ? materialDef.alphaCutoff : 0.5;

			}

		}

		if ( materialDef.normalTexture !== undefined && materialType !== MeshBasicMaterial ) {

			pending.push( parser.assignTexture( materialParams, 'normalMap', materialDef.normalTexture ) );

			materialParams.normalScale = new Vector2( 1, 1 );

			if ( materialDef.normalTexture.scale !== undefined ) {

				const scale = materialDef.normalTexture.scale;

				materialParams.normalScale.set( scale, scale );

			}

		}

		if ( materialDef.occlusionTexture !== undefined && materialType !== MeshBasicMaterial ) {

			pending.push( parser.assignTexture( materialParams, 'aoMap', materialDef.occlusionTexture ) );

			if ( materialDef.occlusionTexture.strength !== undefined ) {

				materialParams.aoMapIntensity = materialDef.occlusionTexture.strength;

			}

		}

		if ( materialDef.emissiveFactor !== undefined && materialType !== MeshBasicMaterial ) {

			const emissiveFactor = materialDef.emissiveFactor;
			materialParams.emissive = new Color().setRGB( emissiveFactor[ 0 ], emissiveFactor[ 1 ], emissiveFactor[ 2 ], LinearSRGBColorSpace );

		}

		if ( materialDef.emissiveTexture !== undefined && materialType !== MeshBasicMaterial ) {

			pending.push( parser.assignTexture( materialParams, 'emissiveMap', materialDef.emissiveTexture, SRGBColorSpace ) );

		}

		return Promise.all( pending ).then( function () {

			const material = new materialType( materialParams );

			if ( materialDef.name ) material.name = materialDef.name;

			assignExtrasToUserData( material, materialDef );

			parser.associations.set( material, { materials: materialIndex } );

			if ( materialDef.extensions ) addUnknownExtensionsToUserData( extensions, material, materialDef );

			return material;

		} );

	}

	/** When Object3D instances are targeted by animation, they need unique names. */
	createUniqueName( originalName ) {

		const sanitizedName = PropertyBinding.sanitizeNodeName( originalName || '' );

		if ( sanitizedName in this.nodeNamesUsed ) {

			return sanitizedName + '_' + ( ++ this.nodeNamesUsed[ sanitizedName ] );

		} else {

			this.nodeNamesUsed[ sanitizedName ] = 0;

			return sanitizedName;

		}

	}

	/**
	 * Specification: https://github.com/KhronosGroup/glTF/blob/master/specification/2.0/README.md#geometry
	 *
	 * Creates BufferGeometries from primitives.
	 *
	 * @param {Array<GLTF.Primitive>} primitives
	 * @return {Promise<Array<BufferGeometry>>}
	 */
	loadGeometries( primitives ) {

		const parser = this;
		const extensions = this.extensions;
		const cache = this.primitiveCache;

		function createDracoPrimitive( primitive ) {

			return extensions[ EXTENSIONS.KHR_DRACO_MESH_COMPRESSION ]
				.decodePrimitive( primitive, parser )
				.then( function ( geometry ) {

					return addPrimitiveAttributes( geometry, primitive, parser );

				} );

		}

		const pending = [];

		for ( let i = 0, il = primitives.length; i < il; i ++ ) {

			const primitive = primitives[ i ];
			const cacheKey = createPrimitiveKey( primitive );

			// See if we've already created this geometry
			const cached = cache[ cacheKey ];

			if ( cached ) {

				// Use the cached geometry if it exists
				pending.push( cached.promise );

			} else {

				let geometryPromise;

				if ( primitive.extensions && primitive.extensions[ EXTENSIONS.KHR_DRACO_MESH_COMPRESSION ] ) {

					// Use DRACO geometry if available
					geometryPromise = createDracoPrimitive( primitive );

				} else {

					// Otherwise create a new geometry
					geometryPromise = addPrimitiveAttributes( new BufferGeometry(), primitive, parser );

				}

				// Cache this geometry
				cache[ cacheKey ] = { primitive: primitive, promise: geometryPromise };

				pending.push( geometryPromise );

			}

		}

		return Promise.all( pending );

	}

	/**
	 * Specification: https://github.com/KhronosGroup/glTF/blob/master/specification/2.0/README.md#meshes
	 * @param {number} meshIndex
	 * @return {Promise<Group|Mesh|SkinnedMesh>}
	 */
	loadMesh( meshIndex ) {

		const parser = this;
		const json = this.json;
		const extensions = this.extensions;

		const meshDef = json.meshes[ meshIndex ];
		const primitives = meshDef.primitives;

		const pending = [];

		for ( let i = 0, il = primitives.length; i < il; i ++ ) {

			const material = primitives[ i ].material === undefined
				? createDefaultMaterial( this.cache )
				: this.getDependency( 'material', primitives[ i ].material );

			pending.push( material );

		}

		pending.push( parser.loadGeometries( primitives ) );

		return Promise.all( pending ).then( function ( results ) {

			const materials = results.slice( 0, results.length - 1 );
			const geometries = results[ results.length - 1 ];

			const meshes = [];

			for ( let i = 0, il = geometries.length; i < il; i ++ ) {

				const geometry = geometries[ i ];
				const primitive = primitives[ i ];

				// 1. create Mesh

				let mesh;

				const material = materials[ i ];

				if ( primitive.mode === WEBGL_CONSTANTS.TRIANGLES ||
						primitive.mode === WEBGL_CONSTANTS.TRIANGLE_STRIP ||
						primitive.mode === WEBGL_CONSTANTS.TRIANGLE_FAN ||
						primitive.mode === undefined ) {

					// .isSkinnedMesh isn't in glTF spec. See ._markDefs()
					mesh = meshDef.isSkinnedMesh === true
						? new SkinnedMesh( geometry, material )
						: new Mesh( geometry, material );

					if ( mesh.isSkinnedMesh === true ) {

						// normalize skin weights to fix malformed assets (see #15319)
						mesh.normalizeSkinWeights();

					}

					if ( primitive.mode === WEBGL_CONSTANTS.TRIANGLE_STRIP ) {

						mesh.geometry = toTrianglesDrawMode( mesh.geometry, TriangleStripDrawMode );

					} else if ( primitive.mode === WEBGL_CONSTANTS.TRIANGLE_FAN ) {

						mesh.geometry = toTrianglesDrawMode( mesh.geometry, TriangleFanDrawMode );

					}

				} else if ( primitive.mode === WEBGL_CONSTANTS.LINES ) {

					mesh = new LineSegments( geometry, material );

				} else if ( primitive.mode === WEBGL_CONSTANTS.LINE_STRIP ) {

					mesh = new Line( geometry, material );

				} else if ( primitive.mode === WEBGL_CONSTANTS.LINE_LOOP ) {

					mesh = new LineLoop( geometry, material );

				} else if ( primitive.mode === WEBGL_CONSTANTS.POINTS ) {

					mesh = new Points( geometry, material );

				} else {

					throw new Error( 'THREE.GLTFLoader: Primitive mode unsupported: ' + primitive.mode );

				}

				if ( Object.keys( mesh.geometry.morphAttributes ).length > 0 ) {

					updateMorphTargets( mesh, meshDef );

				}

				mesh.name = parser.createUniqueName( meshDef.name || ( 'mesh_' + meshIndex ) );

				assignExtrasToUserData( mesh, meshDef );

				if ( primitive.extensions ) addUnknownExtensionsToUserData( extensions, mesh, primitive );

				parser.assignFinalMaterial( mesh );

				meshes.push( mesh );

			}

			for ( let i = 0, il = meshes.length; i < il; i ++ ) {

				parser.associations.set( meshes[ i ], {
					meshes: meshIndex,
					primitives: i
				} );

			}

			if ( meshes.length === 1 ) {

				if ( meshDef.extensions ) addUnknownExtensionsToUserData( extensions, meshes[ 0 ], meshDef );

				return meshes[ 0 ];

			}

			const group = new Group();

			if ( meshDef.extensions ) addUnknownExtensionsToUserData( extensions, group, meshDef );

			parser.associations.set( group, { meshes: meshIndex } );

			for ( let i = 0, il = meshes.length; i < il; i ++ ) {

				group.add( meshes[ i ] );

			}

			return group;

		} );

	}

	/**
	 * Specification: https://github.com/KhronosGroup/glTF/tree/master/specification/2.0#cameras
	 * @param {number} cameraIndex
	 * @return {Promise<THREE.Camera>}
	 */
	loadCamera( cameraIndex ) {

		let camera;
		const cameraDef = this.json.cameras[ cameraIndex ];
		const params = cameraDef[ cameraDef.type ];

		if ( ! params ) {

			console.warn( 'THREE.GLTFLoader: Missing camera parameters.' );
			return;

		}

		if ( cameraDef.type === 'perspective' ) {

			camera = new PerspectiveCamera( MathUtils.radToDeg( params.yfov ), params.aspectRatio || 1, params.znear || 1, params.zfar || 2e6 );

		} else if ( cameraDef.type === 'orthographic' ) {

			camera = new OrthographicCamera( - params.xmag, params.xmag, params.ymag, - params.ymag, params.znear, params.zfar );

		}

		if ( cameraDef.name ) camera.name = this.createUniqueName( cameraDef.name );

		assignExtrasToUserData( camera, cameraDef );

		return Promise.resolve( camera );

	}

	/**
	 * Specification: https://github.com/KhronosGroup/glTF/tree/master/specification/2.0#skins
	 * @param {number} skinIndex
	 * @return {Promise<Skeleton>}
	 */
	loadSkin( skinIndex ) {

		const skinDef = this.json.skins[ skinIndex ];

		const pending = [];

		for ( let i = 0, il = skinDef.joints.length; i < il; i ++ ) {

			pending.push( this._loadNodeShallow( skinDef.joints[ i ] ) );

		}

		if ( skinDef.inverseBindMatrices !== undefined ) {

			pending.push( this.getDependency( 'accessor', skinDef.inverseBindMatrices ) );

		} else {

			pending.push( null );

		}

		return Promise.all( pending ).then( function ( results ) {

			const inverseBindMatrices = results.pop();
			const jointNodes = results;

			// Note that bones (joint nodes) may or may not be in the
			// scene graph at this time.

			const bones = [];
			const boneInverses = [];

			for ( let i = 0, il = jointNodes.length; i < il; i ++ ) {

				const jointNode = jointNodes[ i ];

				if ( jointNode ) {

					bones.push( jointNode );

					const mat = new Matrix4();

					if ( inverseBindMatrices !== null ) {

						mat.fromArray( inverseBindMatrices.array, i * 16 );

					}

					boneInverses.push( mat );

				} else {

					console.warn( 'THREE.GLTFLoader: Joint "%s" could not be found.', skinDef.joints[ i ] );

				}

			}

			return new Skeleton( bones, boneInverses );

		} );

	}

	/**
	 * Specification: https://github.com/KhronosGroup/glTF/tree/master/specification/2.0#animations
	 * @param {number} animationIndex
	 * @return {Promise<AnimationClip>}
	 */
	loadAnimation( animationIndex ) {

		const json = this.json;
		const parser = this;

		const animationDef = json.animations[ animationIndex ];
		const animationName = animationDef.name ? animationDef.name : 'animation_' + animationIndex;

		const pendingNodes = [];
		const pendingInputAccessors = [];
		const pendingOutputAccessors = [];
		const pendingSamplers = [];
		const pendingTargets = [];

		for ( let i = 0, il = animationDef.channels.length; i < il; i ++ ) {

			const channel = animationDef.channels[ i ];
			const sampler = animationDef.samplers[ channel.sampler ];
			const target = channel.target;
			const name = target.node;
			const input = animationDef.parameters !== undefined ? animationDef.parameters[ sampler.input ] : sampler.input;
			const output = animationDef.parameters !== undefined ? animationDef.parameters[ sampler.output ] : sampler.output;

			if ( target.node === undefined ) continue;

			pendingNodes.push( this.getDependency( 'node', name ) );
			pendingInputAccessors.push( this.getDependency( 'accessor', input ) );
			pendingOutputAccessors.push( this.getDependency( 'accessor', output ) );
			pendingSamplers.push( sampler );
			pendingTargets.push( target );

		}

		return Promise.all( [

			Promise.all( pendingNodes ),
			Promise.all( pendingInputAccessors ),
			Promise.all( pendingOutputAccessors ),
			Promise.all( pendingSamplers ),
			Promise.all( pendingTargets )

		] ).then( function ( dependencies ) {

			const nodes = dependencies[ 0 ];
			const inputAccessors = dependencies[ 1 ];
			const outputAccessors = dependencies[ 2 ];
			const samplers = dependencies[ 3 ];
			const targets = dependencies[ 4 ];

			const tracks = [];

			for ( let i = 0, il = nodes.length; i < il; i ++ ) {

				const node = nodes[ i ];
				const inputAccessor = inputAccessors[ i ];
				const outputAccessor = outputAccessors[ i ];
				const sampler = samplers[ i ];
				const target = targets[ i ];

				if ( node === undefined ) continue;

				if ( node.updateMatrix ) {

					node.updateMatrix();

				}

				const createdTracks = parser._createAnimationTracks( node, inputAccessor, outputAccessor, sampler, target );

				if ( createdTracks ) {

					for ( let k = 0; k < createdTracks.length; k ++ ) {

						tracks.push( createdTracks[ k ] );

					}

				}

			}

			return new AnimationClip( animationName, undefined, tracks );

		} );

	}

	createNodeMesh( nodeIndex ) {

		const json = this.json;
		const parser = this;
		const nodeDef = json.nodes[ nodeIndex ];

		if ( nodeDef.mesh === undefined ) return null;

		return parser.getDependency( 'mesh', nodeDef.mesh ).then( function ( mesh ) {

			const node = parser._getNodeRef( parser.meshCache, nodeDef.mesh, mesh );

			// if weights are provided on the node, override weights on the mesh.
			if ( nodeDef.weights !== undefined ) {

				node.traverse( function ( o ) {

					if ( ! o.isMesh ) return;

					for ( let i = 0, il = nodeDef.weights.length; i < il; i ++ ) {

						o.morphTargetInfluences[ i ] = nodeDef.weights[ i ];

					}

				} );

			}

			return node;

		} );

	}

	/**
	 * Specification: https://github.com/KhronosGroup/glTF/tree/master/specification/2.0#nodes-and-hierarchy
	 * @param {number} nodeIndex
	 * @return {Promise<Object3D>}
	 */
	loadNode( nodeIndex ) {

		const json = this.json;
		const parser = this;

		const nodeDef = json.nodes[ nodeIndex ];

		const nodePending = parser._loadNodeShallow( nodeIndex );

		const childPending = [];
		const childrenDef = nodeDef.children || [];

		for ( let i = 0, il = childrenDef.length; i < il; i ++ ) {

			childPending.push( parser.getDependency( 'node', childrenDef[ i ] ) );

		}

		const skeletonPending = nodeDef.skin === undefined
			? Promise.resolve( null )
			: parser.getDependency( 'skin', nodeDef.skin );

		return Promise.all( [
			nodePending,
			Promise.all( childPending ),
			skeletonPending
		] ).then( function ( results ) {

			const node = results[ 0 ];
			const children = results[ 1 ];
			const skeleton = results[ 2 ];

			if ( skeleton !== null ) {

				// This full traverse should be fine because
				// child glTF nodes have not been added to this node yet.
				node.traverse( function ( mesh ) {

					if ( ! mesh.isSkinnedMesh ) return;

					mesh.bind( skeleton, _identityMatrix );

				} );

			}

			for ( let i = 0, il = children.length; i < il; i ++ ) {

				node.add( children[ i ] );

			}

			return node;

		} );

	}

	// ._loadNodeShallow() parses a single node.
	// skin and child nodes are created and added in .loadNode() (no '_' prefix).
	_loadNodeShallow( nodeIndex ) {

		const json = this.json;
		const extensions = this.extensions;
		const parser = this;

		// This method is called from .loadNode() and .loadSkin().
		// Cache a node to avoid duplication.

		if ( this.nodeCache[ nodeIndex ] !== undefined ) {

			return this.nodeCache[ nodeIndex ];

		}

		const nodeDef = json.nodes[ nodeIndex ];

		// reserve node's name before its dependencies, so the root has the intended name.
		const nodeName = nodeDef.name ? parser.createUniqueName( nodeDef.name ) : '';

		const pending = [];

		const meshPromise = parser._invokeOne( function ( ext ) {

			return ext.createNodeMesh && ext.createNodeMesh( nodeIndex );

		} );

		if ( meshPromise ) {

			pending.push( meshPromise );

		}

		if ( nodeDef.camera !== undefined ) {

			pending.push( parser.getDependency( 'camera', nodeDef.camera ).then( function ( camera ) {

				return parser._getNodeRef( parser.cameraCache, nodeDef.camera, camera );

			} ) );

		}

		parser._invokeAll( function ( ext ) {

			return ext.createNodeAttachment && ext.createNodeAttachment( nodeIndex );

		} ).forEach( function ( promise ) {

			pending.push( promise );

		} );

		this.nodeCache[ nodeIndex ] = Promise.all( pending ).then( function ( objects ) {

			let node;

			// .isBone isn't in glTF spec. See ._markDefs
			if ( nodeDef.isBone === true ) {

				node = new Bone();

			} else if ( objects.length > 1 ) {

				node = new Group();

			} else if ( objects.length === 1 ) {

				node = objects[ 0 ];

			} else {

				node = new Object3D();

			}

			if ( node !== objects[ 0 ] ) {

				for ( let i = 0, il = objects.length; i < il; i ++ ) {

					node.add( objects[ i ] );

				}

			}

			if ( nodeDef.name ) {

				node.userData.name = nodeDef.name;
				node.name = nodeName;

			}

			assignExtrasToUserData( node, nodeDef );

			if ( nodeDef.extensions ) addUnknownExtensionsToUserData( extensions, node, nodeDef );

			if ( nodeDef.matrix !== undefined ) {

				const matrix = new Matrix4();
				matrix.fromArray( nodeDef.matrix );
				node.applyMatrix4( matrix );

			} else {

				if ( nodeDef.translation !== undefined ) {

					node.position.fromArray( nodeDef.translation );

				}

				if ( nodeDef.rotation !== undefined ) {

					node.quaternion.fromArray( nodeDef.rotation );

				}

				if ( nodeDef.scale !== undefined ) {

					node.scale.fromArray( nodeDef.scale );

				}

			}

			if ( ! parser.associations.has( node ) ) {

				parser.associations.set( node, {} );

			}

			parser.associations.get( node ).nodes = nodeIndex;

			return node;

		} );

		return this.nodeCache[ nodeIndex ];

	}

	/**
	 * Specification: https://github.com/KhronosGroup/glTF/tree/master/specification/2.0#scenes
	 * @param {number} sceneIndex
	 * @return {Promise<Group>}
	 */
	loadScene( sceneIndex ) {

		const extensions = this.extensions;
		const sceneDef = this.json.scenes[ sceneIndex ];
		const parser = this;

		// Loader returns Group, not Scene.
		// See: https://github.com/mrdoob/three.js/issues/18342#issuecomment-578981172
		const scene = new Group();
		if ( sceneDef.name ) scene.name = parser.createUniqueName( sceneDef.name );

		assignExtrasToUserData( scene, sceneDef );

		if ( sceneDef.extensions ) addUnknownExtensionsToUserData( extensions, scene, sceneDef );

		const nodeIds = sceneDef.nodes || [];

		const pending = [];

		for ( let i = 0, il = nodeIds.length; i < il; i ++ ) {

			pending.push( parser.getDependency( 'node', nodeIds[ i ] ) );

		}

		return Promise.all( pending ).then( function ( nodes ) {

			for ( let i = 0, il = nodes.length; i < il; i ++ ) {

				scene.add( nodes[ i ] );

			}

			// Removes dangling associations, associations that reference a node that
			// didn't make it into the scene.
			const reduceAssociations = ( node ) => {

				const reducedAssociations = new Map();

				for ( const [ key, value ] of parser.associations ) {

					if ( key instanceof Material || key instanceof Texture ) {

						reducedAssociations.set( key, value );

					}

				}

				node.traverse( ( node ) => {

					const mappings = parser.associations.get( node );

					if ( mappings != null ) {

						reducedAssociations.set( node, mappings );

					}

				} );

				return reducedAssociations;

			};

			parser.associations = reduceAssociations( scene );

			return scene;

		} );

	}

	_createAnimationTracks( node, inputAccessor, outputAccessor, sampler, target ) {

		const tracks = [];

		const targetName = node.name ? node.name : node.uuid;
		const targetNames = [];

		if ( PATH_PROPERTIES[ target.path ] === PATH_PROPERTIES.weights ) {

			node.traverse( function ( object ) {

				if ( object.morphTargetInfluences ) {

					targetNames.push( object.name ? object.name : object.uuid );

				}

			} );

		} else {

			targetNames.push( targetName );

		}

		let TypedKeyframeTrack;

		switch ( PATH_PROPERTIES[ target.path ] ) {

			case PATH_PROPERTIES.weights:

				TypedKeyframeTrack = NumberKeyframeTrack;
				break;

			case PATH_PROPERTIES.rotation:

				TypedKeyframeTrack = QuaternionKeyframeTrack;
				break;

			case PATH_PROPERTIES.position:
			case PATH_PROPERTIES.scale:

				TypedKeyframeTrack = VectorKeyframeTrack;
				break;

			default:

				switch ( outputAccessor.itemSize ) {

					case 1:
						TypedKeyframeTrack = NumberKeyframeTrack;
						break;
					case 2:
					case 3:
					default:
						TypedKeyframeTrack = VectorKeyframeTrack;
						break;

				}

				break;

		}

		const interpolation = sampler.interpolation !== undefined ? INTERPOLATION[ sampler.interpolation ] : InterpolateLinear;


		const outputArray = this._getArrayFromAccessor( outputAccessor );

		for ( let j = 0, jl = targetNames.length; j < jl; j ++ ) {

			const track = new TypedKeyframeTrack(
				targetNames[ j ] + '.' + PATH_PROPERTIES[ target.path ],
				inputAccessor.array,
				outputArray,
				interpolation
			);

			// Override interpolation with custom factory method.
			if ( sampler.interpolation === 'CUBICSPLINE' ) {

				this._createCubicSplineTrackInterpolant( track );

			}

			tracks.push( track );

		}

		return tracks;

	}

	_getArrayFromAccessor( accessor ) {

		let outputArray = accessor.array;

		if ( accessor.normalized ) {

			const scale = getNormalizedComponentScale( outputArray.constructor );
			const scaled = new Float32Array( outputArray.length );

			for ( let j = 0, jl = outputArray.length; j < jl; j ++ ) {

				scaled[ j ] = outputArray[ j ] * scale;

			}

			outputArray = scaled;

		}

		return outputArray;

	}

	_createCubicSplineTrackInterpolant( track ) {

		track.createInterpolant = function InterpolantFactoryMethodGLTFCubicSpline( result ) {

			// A CUBICSPLINE keyframe in glTF has three output values for each input value,
			// representing inTangent, splineVertex, and outTangent. As a result, track.getValueSize()
			// must be divided by three to get the interpolant's sampleSize argument.

			const interpolantType = ( this instanceof QuaternionKeyframeTrack ) ? GLTFCubicSplineQuaternionInterpolant : GLTFCubicSplineInterpolant;

			return new interpolantType( this.times, this.values, this.getValueSize() / 3, result );

		};

		// Mark as CUBICSPLINE. `track.getInterpolation()` doesn't support custom interpolants.
		track.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline = true;

	}

}

/**
 * @param {BufferGeometry} geometry
 * @param {GLTF.Primitive} primitiveDef
 * @param {GLTFParser} parser
 */
function computeBounds( geometry, primitiveDef, parser ) {

	const attributes = primitiveDef.attributes;

	const box = new Box3();

	if ( attributes.POSITION !== undefined ) {

		const accessor = parser.json.accessors[ attributes.POSITION ];

		const min = accessor.min;
		const max = accessor.max;

		// glTF requires 'min' and 'max', but VRM (which extends glTF) currently ignores that requirement.

		if ( min !== undefined && max !== undefined ) {

			box.set(
				new Vector3( min[ 0 ], min[ 1 ], min[ 2 ] ),
				new Vector3( max[ 0 ], max[ 1 ], max[ 2 ] )
			);

			if ( accessor.normalized ) {

				const boxScale = getNormalizedComponentScale( WEBGL_COMPONENT_TYPES[ accessor.componentType ] );
				box.min.multiplyScalar( boxScale );
				box.max.multiplyScalar( boxScale );

			}

		} else {

			console.warn( 'THREE.GLTFLoader: Missing min/max properties for accessor POSITION.' );

			return;

		}

	} else {

		return;

	}

	const targets = primitiveDef.targets;

	if ( targets !== undefined ) {

		const maxDisplacement = new Vector3();
		const vector = new Vector3();

		for ( let i = 0, il = targets.length; i < il; i ++ ) {

			const target = targets[ i ];

			if ( target.POSITION !== undefined ) {

				const accessor = parser.json.accessors[ target.POSITION ];
				const min = accessor.min;
				const max = accessor.max;

				// glTF requires 'min' and 'max', but VRM (which extends glTF) currently ignores that requirement.

				if ( min !== undefined && max !== undefined ) {

					// we need to get max of absolute components because target weight is [-1,1]
					vector.setX( Math.max( Math.abs( min[ 0 ] ), Math.abs( max[ 0 ] ) ) );
					vector.setY( Math.max( Math.abs( min[ 1 ] ), Math.abs( max[ 1 ] ) ) );
					vector.setZ( Math.max( Math.abs( min[ 2 ] ), Math.abs( max[ 2 ] ) ) );


					if ( accessor.normalized ) {

						const boxScale = getNormalizedComponentScale( WEBGL_COMPONENT_TYPES[ accessor.componentType ] );
						vector.multiplyScalar( boxScale );

					}

					// Note: this assumes that the sum of all weights is at most 1. This isn't quite correct - it's more conservative
					// to assume that each target can have a max weight of 1. However, for some use cases - notably, when morph targets
					// are used to implement key-frame animations and as such only two are active at a time - this results in very large
					// boxes. So for now we make a box that's sometimes a touch too small but is hopefully mostly of reasonable size.
					maxDisplacement.max( vector );

				} else {

					console.warn( 'THREE.GLTFLoader: Missing min/max properties for accessor POSITION.' );

				}

			}

		}

		// As per comment above this box isn't conservative, but has a reasonable size for a very large number of morph targets.
		box.expandByVector( maxDisplacement );

	}

	geometry.boundingBox = box;

	const sphere = new Sphere();

	box.getCenter( sphere.center );
	sphere.radius = box.min.distanceTo( box.max ) / 2;

	geometry.boundingSphere = sphere;

}

/**
 * @param {BufferGeometry} geometry
 * @param {GLTF.Primitive} primitiveDef
 * @param {GLTFParser} parser
 * @return {Promise<BufferGeometry>}
 */
function addPrimitiveAttributes( geometry, primitiveDef, parser ) {

	const attributes = primitiveDef.attributes;

	const pending = [];

	function assignAttributeAccessor( accessorIndex, attributeName ) {

		return parser.getDependency( 'accessor', accessorIndex )
			.then( function ( accessor ) {

				geometry.setAttribute( attributeName, accessor );

			} );

	}

	for ( const gltfAttributeName in attributes ) {

		const threeAttributeName = ATTRIBUTES[ gltfAttributeName ] || gltfAttributeName.toLowerCase();

		// Skip attributes already provided by e.g. Draco extension.
		if ( threeAttributeName in geometry.attributes ) continue;

		pending.push( assignAttributeAccessor( attributes[ gltfAttributeName ], threeAttributeName ) );

	}

	if ( primitiveDef.indices !== undefined && ! geometry.index ) {

		const accessor = parser.getDependency( 'accessor', primitiveDef.indices ).then( function ( accessor ) {

			geometry.setIndex( accessor );

		} );

		pending.push( accessor );

	}

	if ( ColorManagement.workingColorSpace !== LinearSRGBColorSpace && 'COLOR_0' in attributes ) {

		console.warn( `THREE.GLTFLoader: Converting vertex colors from "srgb-linear" to "${ColorManagement.workingColorSpace}" not supported.` );

	}

	assignExtrasToUserData( geometry, primitiveDef );

	computeBounds( geometry, primitiveDef, parser );

	return Promise.all( pending ).then( function () {

		return primitiveDef.targets !== undefined
			? addMorphTargets( geometry, primitiveDef.targets, parser )
			: geometry;

	} );

}

export { GLTFLoader };

```

